let process = requireNativeModule('process');
var NK=Object.create;var{getPrototypeOf:MK,defineProperty:fQ,getOwnPropertyNames:jK}=Object;var zK=Object.prototype.hasOwnProperty;var v7=(Q,W,$)=>{$=Q!=null?NK(MK(Q)):{};let Y=W||!Q||!Q.__esModule?fQ($,"default",{value:Q,enumerable:!0}):$;for(let J of jK(Q))if(!zK.call(Y,J))fQ(Y,J,{get:()=>Q[J],enumerable:!0});return Y};var Z=(Q,W)=>()=>(W||Q((W={exports:{}}).exports,W),W.exports);var uQ=(Q,W)=>{for(var $ in W)fQ(Q,$,{get:W[$],enumerable:!0,configurable:!0,set:(Y)=>W[$]=()=>Y})};var A9=Z((Q0)=>{Object.defineProperty(Q0,"__esModule",{value:!0});Q0.regexpCode=Q0.getEsmExportName=Q0.getProperty=Q0.safeStringify=Q0.stringify=Q0.strConcat=Q0.addCodeArg=Q0.str=Q0._=Q0.nil=Q0._Code=Q0.Name=Q0.IDENTIFIER=Q0._CodeOrName=void 0;class o8{}Q0._CodeOrName=o8;Q0.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class w4 extends o8{constructor(Q){super();if(!Q0.IDENTIFIER.test(Q))throw Error("CodeGen: name must be a valid identifier");this.str=Q}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}Q0.Name=w4;class O1 extends o8{constructor(Q){super();this._items=typeof Q==="string"?[Q]:Q}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let Q=this._items[0];return Q===""||Q==='""'}get str(){var Q;return(Q=this._str)!==null&&Q!==void 0?Q:this._str=this._items.reduce((W,$)=>`${W}${$}`,"")}get names(){var Q;return(Q=this._names)!==null&&Q!==void 0?Q:this._names=this._items.reduce((W,$)=>{if($ instanceof w4)W[$.str]=(W[$.str]||0)+1;return W},{})}}Q0._Code=O1;Q0.nil=new O1("");function I3(Q,...W){let $=[Q[0]],Y=0;while(Y<W.length)IY($,W[Y]),$.push(Q[++Y]);return new O1($)}Q0._=I3;var RY=new O1("+");function S3(Q,...W){let $=[U9(Q[0])],Y=0;while(Y<W.length)$.push(RY),IY($,W[Y]),$.push(RY,U9(Q[++Y]));return zU($),new O1($)}Q0.str=S3;function IY(Q,W){if(W instanceof O1)Q.push(...W._items);else if(W instanceof w4)Q.push(W);else Q.push(RU(W))}Q0.addCodeArg=IY;function zU(Q){let W=1;while(W<Q.length-1){if(Q[W]===RY){let $=EU(Q[W-1],Q[W+1]);if($!==void 0){Q.splice(W-1,3,$);continue}Q[W++]="+"}W++}}function EU(Q,W){if(W==='""')return Q;if(Q==='""')return W;if(typeof Q=="string"){if(W instanceof w4||Q[Q.length-1]!=='"')return;if(typeof W!="string")return`${Q.slice(0,-1)}${W}"`;if(W[0]==='"')return Q.slice(0,-1)+W.slice(1);return}if(typeof W=="string"&&W[0]==='"'&&!(Q instanceof w4))return`"${Q}${W.slice(1)}`;return}function PU(Q,W){return W.emptyStr()?Q:Q.emptyStr()?W:S3`${Q}${W}`}Q0.strConcat=PU;function RU(Q){return typeof Q=="number"||typeof Q=="boolean"||Q===null?Q:U9(Array.isArray(Q)?Q.join(","):Q)}function IU(Q){return new O1(U9(Q))}Q0.stringify=IU;function U9(Q){return JSON.stringify(Q).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}Q0.safeStringify=U9;function SU(Q){return typeof Q=="string"&&Q0.IDENTIFIER.test(Q)?new O1(`.${Q}`):I3`[${Q}]`}Q0.getProperty=SU;function bU(Q){if(typeof Q=="string"&&Q0.IDENTIFIER.test(Q))return new O1(`${Q}`);throw Error(`CodeGen: invalid export name: ${Q}, use explicit $id name mapping`)}Q0.getEsmExportName=bU;function CU(Q){return new O1(Q.toString())}Q0.regexpCode=CU});var CY=Z((r0)=>{Object.defineProperty(r0,"__esModule",{value:!0});r0.ValueScope=r0.ValueScopeName=r0.Scope=r0.varKinds=r0.UsedValueState=void 0;var o0=A9();class b3 extends Error{constructor(Q){super(`CodeGen: "code" for ${Q} not defined`);this.value=Q.value}}var r8;(function(Q){Q[Q.Started=0]="Started",Q[Q.Completed=1]="Completed"})(r8||(r0.UsedValueState=r8={}));r0.varKinds={const:new o0.Name("const"),let:new o0.Name("let"),var:new o0.Name("var")};class SY{constructor({prefixes:Q,parent:W}={}){this._names={},this._prefixes=Q,this._parent=W}toName(Q){return Q instanceof o0.Name?Q:this.name(Q)}name(Q){return new o0.Name(this._newName(Q))}_newName(Q){let W=this._names[Q]||this._nameGroup(Q);return`${Q}${W.index++}`}_nameGroup(Q){var W,$;if((($=(W=this._parent)===null||W===void 0?void 0:W._prefixes)===null||$===void 0?void 0:$.has(Q))||this._prefixes&&!this._prefixes.has(Q))throw Error(`CodeGen: prefix "${Q}" is not allowed in this scope`);return this._names[Q]={prefix:Q,index:0}}}r0.Scope=SY;class bY extends o0.Name{constructor(Q,W){super(W);this.prefix=Q}setValue(Q,{property:W,itemIndex:$}){this.value=Q,this.scopePath=o0._`.${new o0.Name(W)}[${$}]`}}r0.ValueScopeName=bY;var ZU=o0._`\n`;class C3 extends SY{constructor(Q){super(Q);this._values={},this._scope=Q.scope,this.opts={...Q,_n:Q.lines?ZU:o0.nil}}get(){return this._scope}name(Q){return new bY(Q,this._newName(Q))}value(Q,W){var $;if(W.ref===void 0)throw Error("CodeGen: ref must be passed in value");let Y=this.toName(Q),{prefix:J}=Y,X=($=W.key)!==null&&$!==void 0?$:W.ref,G=this._values[J];if(G){let K=G.get(X);if(K)return K}else G=this._values[J]=new Map;G.set(X,Y);let H=this._scope[J]||(this._scope[J]=[]),B=H.length;return H[B]=W.ref,Y.setValue(W,{property:J,itemIndex:B}),Y}getValue(Q,W){let $=this._values[Q];if(!$)return;return $.get(W)}scopeRefs(Q,W=this._values){return this._reduceValues(W,($)=>{if($.scopePath===void 0)throw Error(`CodeGen: name "${$}" has no value`);return o0._`${Q}${$.scopePath}`})}scopeCode(Q=this._values,W,$){return this._reduceValues(Q,(Y)=>{if(Y.value===void 0)throw Error(`CodeGen: name "${Y}" has no value`);return Y.value.code},W,$)}_reduceValues(Q,W,$={},Y){let J=o0.nil;for(let X in Q){let G=Q[X];if(!G)continue;let H=$[X]=$[X]||new Map;G.forEach((B)=>{if(H.has(B))return;H.set(B,r8.Started);let K=W(B);if(K){let F=this.opts.es5?r0.varKinds.var:r0.varKinds.const;J=o0._`${J}${F} ${B} = ${K};${this.opts._n}`}else if(K=Y===null||Y===void 0?void 0:Y(B))J=o0._`${J}${K}${this.opts._n}`;else throw new b3(B);H.set(B,r8.Completed)})}return J}}r0.ValueScope=C3});var p=Z((i)=>{Object.defineProperty(i,"__esModule",{value:!0});i.or=i.and=i.not=i.CodeGen=i.operators=i.varKinds=i.ValueScopeName=i.ValueScope=i.Scope=i.Name=i.regexpCode=i.stringify=i.getProperty=i.nil=i.strConcat=i.str=i._=void 0;var s=A9(),w1=CY(),H6=A9();Object.defineProperty(i,"_",{enumerable:!0,get:function(){return H6._}});Object.defineProperty(i,"str",{enumerable:!0,get:function(){return H6.str}});Object.defineProperty(i,"strConcat",{enumerable:!0,get:function(){return H6.strConcat}});Object.defineProperty(i,"nil",{enumerable:!0,get:function(){return H6.nil}});Object.defineProperty(i,"getProperty",{enumerable:!0,get:function(){return H6.getProperty}});Object.defineProperty(i,"stringify",{enumerable:!0,get:function(){return H6.stringify}});Object.defineProperty(i,"regexpCode",{enumerable:!0,get:function(){return H6.regexpCode}});Object.defineProperty(i,"Name",{enumerable:!0,get:function(){return H6.Name}});var WQ=CY();Object.defineProperty(i,"Scope",{enumerable:!0,get:function(){return WQ.Scope}});Object.defineProperty(i,"ValueScope",{enumerable:!0,get:function(){return WQ.ValueScope}});Object.defineProperty(i,"ValueScopeName",{enumerable:!0,get:function(){return WQ.ValueScopeName}});Object.defineProperty(i,"varKinds",{enumerable:!0,get:function(){return WQ.varKinds}});i.operators={GT:new s._Code(">"),GTE:new s._Code(">="),LT:new s._Code("<"),LTE:new s._Code("<="),EQ:new s._Code("==="),NEQ:new s._Code("!=="),NOT:new s._Code("!"),OR:new s._Code("||"),AND:new s._Code("&&"),ADD:new s._Code("+")};class B6{optimizeNodes(){return this}optimizeNames(Q,W){return this}}class Z3 extends B6{constructor(Q,W,$){super();this.varKind=Q,this.name=W,this.rhs=$}render({es5:Q,_n:W}){let $=Q?w1.varKinds.var:this.varKind,Y=this.rhs===void 0?"":` = ${this.rhs}`;return`${$} ${this.name}${Y};`+W}optimizeNames(Q,W){if(!Q[this.name.str])return;if(this.rhs)this.rhs=M4(this.rhs,Q,W);return this}get names(){return this.rhs instanceof s._CodeOrName?this.rhs.names:{}}}class TY extends B6{constructor(Q,W,$){super();this.lhs=Q,this.rhs=W,this.sideEffects=$}render({_n:Q}){return`${this.lhs} = ${this.rhs};`+Q}optimizeNames(Q,W){if(this.lhs instanceof s.Name&&!Q[this.lhs.str]&&!this.sideEffects)return;return this.rhs=M4(this.rhs,Q,W),this}get names(){let Q=this.lhs instanceof s.Name?{}:{...this.lhs.names};return QQ(Q,this.rhs)}}class v3 extends TY{constructor(Q,W,$,Y){super(Q,$,Y);this.op=W}render({_n:Q}){return`${this.lhs} ${this.op}= ${this.rhs};`+Q}}class T3 extends B6{constructor(Q){super();this.label=Q,this.names={}}render({_n:Q}){return`${this.label}:`+Q}}class k3 extends B6{constructor(Q){super();this.label=Q,this.names={}}render({_n:Q}){return`break${this.label?` ${this.label}`:""};`+Q}}class _3 extends B6{constructor(Q){super();this.error=Q}render({_n:Q}){return`throw ${this.error};`+Q}get names(){return this.error.names}}class x3 extends B6{constructor(Q){super();this.code=Q}render({_n:Q}){return`${this.code};`+Q}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(Q,W){return this.code=M4(this.code,Q,W),this}get names(){return this.code instanceof s._CodeOrName?this.code.names:{}}}class $Q extends B6{constructor(Q=[]){super();this.nodes=Q}render(Q){return this.nodes.reduce((W,$)=>W+$.render(Q),"")}optimizeNodes(){let{nodes:Q}=this,W=Q.length;while(W--){let $=Q[W].optimizeNodes();if(Array.isArray($))Q.splice(W,1,...$);else if($)Q[W]=$;else Q.splice(W,1)}return Q.length>0?this:void 0}optimizeNames(Q,W){let{nodes:$}=this,Y=$.length;while(Y--){let J=$[Y];if(J.optimizeNames(Q,W))continue;vU(Q,J.names),$.splice(Y,1)}return $.length>0?this:void 0}get names(){return this.nodes.reduce((Q,W)=>v6(Q,W.names),{})}}class K6 extends $Q{render(Q){return"{"+Q._n+super.render(Q)+"}"+Q._n}}class y3 extends $Q{}class D9 extends K6{}D9.kind="else";class u1 extends K6{constructor(Q,W){super(W);this.condition=Q}render(Q){let W=`if(${this.condition})`+super.render(Q);if(this.else)W+="else "+this.else.render(Q);return W}optimizeNodes(){super.optimizeNodes();let Q=this.condition;if(Q===!0)return this.nodes;let W=this.else;if(W){let $=W.optimizeNodes();W=this.else=Array.isArray($)?new D9($):$}if(W){if(Q===!1)return W instanceof u1?W:W.nodes;if(this.nodes.length)return this;return new u1(l3(Q),W instanceof u1?[W]:W.nodes)}if(Q===!1||!this.nodes.length)return;return this}optimizeNames(Q,W){var $;if(this.else=($=this.else)===null||$===void 0?void 0:$.optimizeNames(Q,W),!(super.optimizeNames(Q,W)||this.else))return;return this.condition=M4(this.condition,Q,W),this}get names(){let Q=super.names;if(QQ(Q,this.condition),this.else)v6(Q,this.else.names);return Q}}u1.kind="if";class N4 extends K6{}N4.kind="for";class g3 extends N4{constructor(Q){super();this.iteration=Q}render(Q){return`for(${this.iteration})`+super.render(Q)}optimizeNames(Q,W){if(!super.optimizeNames(Q,W))return;return this.iteration=M4(this.iteration,Q,W),this}get names(){return v6(super.names,this.iteration.names)}}class h3 extends N4{constructor(Q,W,$,Y){super();this.varKind=Q,this.name=W,this.from=$,this.to=Y}render(Q){let W=Q.es5?w1.varKinds.var:this.varKind,{name:$,from:Y,to:J}=this;return`for(${W} ${$}=${Y}; ${$}<${J}; ${$}++)`+super.render(Q)}get names(){let Q=QQ(super.names,this.from);return QQ(Q,this.to)}}class ZY extends N4{constructor(Q,W,$,Y){super();this.loop=Q,this.varKind=W,this.name=$,this.iterable=Y}render(Q){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(Q)}optimizeNames(Q,W){if(!super.optimizeNames(Q,W))return;return this.iterable=M4(this.iterable,Q,W),this}get names(){return v6(super.names,this.iterable.names)}}class a8 extends K6{constructor(Q,W,$){super();this.name=Q,this.args=W,this.async=$}render(Q){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(Q)}}a8.kind="func";class t8 extends $Q{render(Q){return"return "+super.render(Q)}}t8.kind="return";class f3 extends K6{render(Q){let W="try"+super.render(Q);if(this.catch)W+=this.catch.render(Q);if(this.finally)W+=this.finally.render(Q);return W}optimizeNodes(){var Q,W;return super.optimizeNodes(),(Q=this.catch)===null||Q===void 0||Q.optimizeNodes(),(W=this.finally)===null||W===void 0||W.optimizeNodes(),this}optimizeNames(Q,W){var $,Y;return super.optimizeNames(Q,W),($=this.catch)===null||$===void 0||$.optimizeNames(Q,W),(Y=this.finally)===null||Y===void 0||Y.optimizeNames(Q,W),this}get names(){let Q=super.names;if(this.catch)v6(Q,this.catch.names);if(this.finally)v6(Q,this.finally.names);return Q}}class s8 extends K6{constructor(Q){super();this.error=Q}render(Q){return`catch(${this.error})`+super.render(Q)}}s8.kind="catch";class e8 extends K6{render(Q){return"finally"+super.render(Q)}}e8.kind="finally";class u3{constructor(Q,W={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...W,_n:W.lines?`
`:""},this._extScope=Q,this._scope=new w1.Scope({parent:Q}),this._nodes=[new y3]}toString(){return this._root.render(this.opts)}name(Q){return this._scope.name(Q)}scopeName(Q){return this._extScope.name(Q)}scopeValue(Q,W){let $=this._extScope.value(Q,W);return(this._values[$.prefix]||(this._values[$.prefix]=new Set)).add($),$}getScopeValue(Q,W){return this._extScope.getValue(Q,W)}scopeRefs(Q){return this._extScope.scopeRefs(Q,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(Q,W,$,Y){let J=this._scope.toName(W);if($!==void 0&&Y)this._constants[J.str]=$;return this._leafNode(new Z3(Q,J,$)),J}const(Q,W,$){return this._def(w1.varKinds.const,Q,W,$)}let(Q,W,$){return this._def(w1.varKinds.let,Q,W,$)}var(Q,W,$){return this._def(w1.varKinds.var,Q,W,$)}assign(Q,W,$){return this._leafNode(new TY(Q,W,$))}add(Q,W){return this._leafNode(new v3(Q,i.operators.ADD,W))}code(Q){if(typeof Q=="function")Q();else if(Q!==s.nil)this._leafNode(new x3(Q));return this}object(...Q){let W=["{"];for(let[$,Y]of Q){if(W.length>1)W.push(",");if(W.push($),$!==Y||this.opts.es5)W.push(":"),(0,s.addCodeArg)(W,Y)}return W.push("}"),new s._Code(W)}if(Q,W,$){if(this._blockNode(new u1(Q)),W&&$)this.code(W).else().code($).endIf();else if(W)this.code(W).endIf();else if($)throw Error('CodeGen: "else" body without "then" body');return this}elseIf(Q){return this._elseNode(new u1(Q))}else(){return this._elseNode(new D9)}endIf(){return this._endBlockNode(u1,D9)}_for(Q,W){if(this._blockNode(Q),W)this.code(W).endFor();return this}for(Q,W){return this._for(new g3(Q),W)}forRange(Q,W,$,Y,J=this.opts.es5?w1.varKinds.var:w1.varKinds.let){let X=this._scope.toName(Q);return this._for(new h3(J,X,W,$),()=>Y(X))}forOf(Q,W,$,Y=w1.varKinds.const){let J=this._scope.toName(Q);if(this.opts.es5){let X=W instanceof s.Name?W:this.var("_arr",W);return this.forRange("_i",0,s._`${X}.length`,(G)=>{this.var(J,s._`${X}[${G}]`),$(J)})}return this._for(new ZY("of",Y,J,W),()=>$(J))}forIn(Q,W,$,Y=this.opts.es5?w1.varKinds.var:w1.varKinds.const){if(this.opts.ownProperties)return this.forOf(Q,s._`Object.keys(${W})`,$);let J=this._scope.toName(Q);return this._for(new ZY("in",Y,J,W),()=>$(J))}endFor(){return this._endBlockNode(N4)}label(Q){return this._leafNode(new T3(Q))}break(Q){return this._leafNode(new k3(Q))}return(Q){let W=new t8;if(this._blockNode(W),this.code(Q),W.nodes.length!==1)throw Error('CodeGen: "return" should have one node');return this._endBlockNode(t8)}try(Q,W,$){if(!W&&!$)throw Error('CodeGen: "try" without "catch" and "finally"');let Y=new f3;if(this._blockNode(Y),this.code(Q),W){let J=this.name("e");this._currNode=Y.catch=new s8(J),W(J)}if($)this._currNode=Y.finally=new e8,this.code($);return this._endBlockNode(s8,e8)}throw(Q){return this._leafNode(new _3(Q))}block(Q,W){if(this._blockStarts.push(this._nodes.length),Q)this.code(Q).endBlock(W);return this}endBlock(Q){let W=this._blockStarts.pop();if(W===void 0)throw Error("CodeGen: not in self-balancing block");let $=this._nodes.length-W;if($<0||Q!==void 0&&$!==Q)throw Error(`CodeGen: wrong number of nodes: ${$} vs ${Q} expected`);return this._nodes.length=W,this}func(Q,W=s.nil,$,Y){if(this._blockNode(new a8(Q,W,$)),Y)this.code(Y).endFunc();return this}endFunc(){return this._endBlockNode(a8)}optimize(Q=1){while(Q-- >0)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(Q){return this._currNode.nodes.push(Q),this}_blockNode(Q){this._currNode.nodes.push(Q),this._nodes.push(Q)}_endBlockNode(Q,W){let $=this._currNode;if($ instanceof Q||W&&$ instanceof W)return this._nodes.pop(),this;throw Error(`CodeGen: not in block "${W?`${Q.kind}/${W.kind}`:Q.kind}"`)}_elseNode(Q){let W=this._currNode;if(!(W instanceof u1))throw Error('CodeGen: "else" without "if"');return this._currNode=W.else=Q,this}get _root(){return this._nodes[0]}get _currNode(){let Q=this._nodes;return Q[Q.length-1]}set _currNode(Q){let W=this._nodes;W[W.length-1]=Q}}i.CodeGen=u3;function v6(Q,W){for(let $ in W)Q[$]=(Q[$]||0)+(W[$]||0);return Q}function QQ(Q,W){return W instanceof s._CodeOrName?v6(Q,W.names):Q}function M4(Q,W,$){if(Q instanceof s.Name)return Y(Q);if(!J(Q))return Q;return new s._Code(Q._items.reduce((X,G)=>{if(G instanceof s.Name)G=Y(G);if(G instanceof s._Code)X.push(...G._items);else X.push(G);return X},[]));function Y(X){let G=$[X.str];if(G===void 0||W[X.str]!==1)return X;return delete W[X.str],G}function J(X){return X instanceof s._Code&&X._items.some((G)=>G instanceof s.Name&&W[G.str]===1&&$[G.str]!==void 0)}}function vU(Q,W){for(let $ in W)Q[$]=(Q[$]||0)-(W[$]||0)}function l3(Q){return typeof Q=="boolean"||typeof Q=="number"||Q===null?!Q:s._`!${vY(Q)}`}i.not=l3;var TU=m3(i.operators.AND);function kU(...Q){return Q.reduce(TU)}i.and=kU;var _U=m3(i.operators.OR);function xU(...Q){return Q.reduce(_U)}i.or=xU;function m3(Q){return(W,$)=>W===s.nil?$:$===s.nil?W:s._`${vY(W)} ${Q} ${vY($)}`}function vY(Q){return Q instanceof s.Name?Q:s._`(${Q})`}});var W0=Z((n)=>{Object.defineProperty(n,"__esModule",{value:!0});n.checkStrictMode=n.getErrorPath=n.Type=n.useFunc=n.setEvaluated=n.evaluatedPropsToName=n.mergeEvaluated=n.eachItem=n.unescapeJsonPointer=n.escapeJsonPointer=n.escapeFragment=n.unescapeFragment=n.schemaRefOrVal=n.schemaHasRulesButRef=n.schemaHasRules=n.checkUnknownRules=n.alwaysValidSchema=n.toHash=void 0;var X0=p(),yU=A9();function gU(Q){let W={};for(let $ of Q)W[$]=!0;return W}n.toHash=gU;function hU(Q,W){if(typeof W=="boolean")return W;if(Object.keys(W).length===0)return!0;return d3(Q,W),!i3(W,Q.self.RULES.all)}n.alwaysValidSchema=hU;function d3(Q,W=Q.schema){let{opts:$,self:Y}=Q;if(!$.strictSchema)return;if(typeof W==="boolean")return;let J=Y.RULES.keywords;for(let X in W)if(!J[X])r3(Q,`unknown keyword: "${X}"`)}n.checkUnknownRules=d3;function i3(Q,W){if(typeof Q=="boolean")return!Q;for(let $ in Q)if(W[$])return!0;return!1}n.schemaHasRules=i3;function fU(Q,W){if(typeof Q=="boolean")return!Q;for(let $ in Q)if($!=="$ref"&&W.all[$])return!0;return!1}n.schemaHasRulesButRef=fU;function uU({topSchemaRef:Q,schemaPath:W},$,Y,J){if(!J){if(typeof $=="number"||typeof $=="boolean")return $;if(typeof $=="string")return X0._`${$}`}return X0._`${Q}${W}${(0,X0.getProperty)(Y)}`}n.schemaRefOrVal=uU;function lU(Q){return n3(decodeURIComponent(Q))}n.unescapeFragment=lU;function mU(Q){return encodeURIComponent(_Y(Q))}n.escapeFragment=mU;function _Y(Q){if(typeof Q=="number")return`${Q}`;return Q.replace(/~/g,"~0").replace(/\//g,"~1")}n.escapeJsonPointer=_Y;function n3(Q){return Q.replace(/~1/g,"/").replace(/~0/g,"~")}n.unescapeJsonPointer=n3;function cU(Q,W){if(Array.isArray(Q))for(let $ of Q)W($);else W(Q)}n.eachItem=cU;function c3({mergeNames:Q,mergeToName:W,mergeValues:$,resultToName:Y}){return(J,X,G,H)=>{let B=G===void 0?X:G instanceof X0.Name?(X instanceof X0.Name?Q(J,X,G):W(J,X,G),G):X instanceof X0.Name?(W(J,G,X),X):$(X,G);return H===X0.Name&&!(B instanceof X0.Name)?Y(J,B):B}}n.mergeEvaluated={props:c3({mergeNames:(Q,W,$)=>Q.if(X0._`${$} !== true && ${W} !== undefined`,()=>{Q.if(X0._`${W} === true`,()=>Q.assign($,!0),()=>Q.assign($,X0._`${$} || {}`).code(X0._`Object.assign(${$}, ${W})`))}),mergeToName:(Q,W,$)=>Q.if(X0._`${$} !== true`,()=>{if(W===!0)Q.assign($,!0);else Q.assign($,X0._`${$} || {}`),xY(Q,$,W)}),mergeValues:(Q,W)=>Q===!0?!0:{...Q,...W},resultToName:o3}),items:c3({mergeNames:(Q,W,$)=>Q.if(X0._`${$} !== true && ${W} !== undefined`,()=>Q.assign($,X0._`${W} === true ? true : ${$} > ${W} ? ${$} : ${W}`)),mergeToName:(Q,W,$)=>Q.if(X0._`${$} !== true`,()=>Q.assign($,W===!0?!0:X0._`${$} > ${W} ? ${$} : ${W}`)),mergeValues:(Q,W)=>Q===!0?!0:Math.max(Q,W),resultToName:(Q,W)=>Q.var("items",W)})};function o3(Q,W){if(W===!0)return Q.var("props",!0);let $=Q.var("props",X0._`{}`);if(W!==void 0)xY(Q,$,W);return $}n.evaluatedPropsToName=o3;function xY(Q,W,$){Object.keys($).forEach((Y)=>Q.assign(X0._`${W}${(0,X0.getProperty)(Y)}`,!0))}n.setEvaluated=xY;var p3={};function pU(Q,W){return Q.scopeValue("func",{ref:W,code:p3[W.code]||(p3[W.code]=new yU._Code(W.code))})}n.useFunc=pU;var kY;(function(Q){Q[Q.Num=0]="Num",Q[Q.Str=1]="Str"})(kY||(n.Type=kY={}));function dU(Q,W,$){if(Q instanceof X0.Name){let Y=W===kY.Num;return $?Y?X0._`"[" + ${Q} + "]"`:X0._`"['" + ${Q} + "']"`:Y?X0._`"/" + ${Q}`:X0._`"/" + ${Q}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return $?(0,X0.getProperty)(Q).toString():"/"+_Y(Q)}n.getErrorPath=dU;function r3(Q,W,$=Q.opts.strictSchema){if(!$)return;if(W=`strict mode: ${W}`,$===!0)throw Error(W);Q.self.logger.warn(W)}n.checkStrictMode=r3});var l1=Z((yY)=>{Object.defineProperty(yY,"__esModule",{value:!0});var y0=p(),iU={data:new y0.Name("data"),valCxt:new y0.Name("valCxt"),instancePath:new y0.Name("instancePath"),parentData:new y0.Name("parentData"),parentDataProperty:new y0.Name("parentDataProperty"),rootData:new y0.Name("rootData"),dynamicAnchors:new y0.Name("dynamicAnchors"),vErrors:new y0.Name("vErrors"),errors:new y0.Name("errors"),this:new y0.Name("this"),self:new y0.Name("self"),scope:new y0.Name("scope"),json:new y0.Name("json"),jsonPos:new y0.Name("jsonPos"),jsonLen:new y0.Name("jsonLen"),jsonPart:new y0.Name("jsonPart")};yY.default=iU});var O9=Z((g0)=>{Object.defineProperty(g0,"__esModule",{value:!0});g0.extendErrors=g0.resetErrorsCount=g0.reportExtraError=g0.reportError=g0.keyword$DataError=g0.keywordError=void 0;var e=p(),YQ=W0(),p0=l1();g0.keywordError={message:({keyword:Q})=>e.str`must pass "${Q}" keyword validation`};g0.keyword$DataError={message:({keyword:Q,schemaType:W})=>W?e.str`"${Q}" keyword must be ${W} ($data)`:e.str`"${Q}" keyword is invalid ($data)`};function nU(Q,W=g0.keywordError,$,Y){let{it:J}=Q,{gen:X,compositeRule:G,allErrors:H}=J,B=s3(Q,W,$);if(Y!==null&&Y!==void 0?Y:G||H)a3(X,B);else t3(J,e._`[${B}]`)}g0.reportError=nU;function oU(Q,W=g0.keywordError,$){let{it:Y}=Q,{gen:J,compositeRule:X,allErrors:G}=Y,H=s3(Q,W,$);if(a3(J,H),!(X||G))t3(Y,p0.default.vErrors)}g0.reportExtraError=oU;function rU(Q,W){Q.assign(p0.default.errors,W),Q.if(e._`${p0.default.vErrors} !== null`,()=>Q.if(W,()=>Q.assign(e._`${p0.default.vErrors}.length`,W),()=>Q.assign(p0.default.vErrors,null)))}g0.resetErrorsCount=rU;function aU({gen:Q,keyword:W,schemaValue:$,data:Y,errsCount:J,it:X}){if(J===void 0)throw Error("ajv implementation error");let G=Q.name("err");Q.forRange("i",J,p0.default.errors,(H)=>{if(Q.const(G,e._`${p0.default.vErrors}[${H}]`),Q.if(e._`${G}.instancePath === undefined`,()=>Q.assign(e._`${G}.instancePath`,(0,e.strConcat)(p0.default.instancePath,X.errorPath))),Q.assign(e._`${G}.schemaPath`,e.str`${X.errSchemaPath}/${W}`),X.opts.verbose)Q.assign(e._`${G}.schema`,$),Q.assign(e._`${G}.data`,Y)})}g0.extendErrors=aU;function a3(Q,W){let $=Q.const("err",W);Q.if(e._`${p0.default.vErrors} === null`,()=>Q.assign(p0.default.vErrors,e._`[${$}]`),e._`${p0.default.vErrors}.push(${$})`),Q.code(e._`${p0.default.errors}++`)}function t3(Q,W){let{gen:$,validateName:Y,schemaEnv:J}=Q;if(J.$async)$.throw(e._`new ${Q.ValidationError}(${W})`);else $.assign(e._`${Y}.errors`,W),$.return(!1)}var T6={keyword:new e.Name("keyword"),schemaPath:new e.Name("schemaPath"),params:new e.Name("params"),propertyName:new e.Name("propertyName"),message:new e.Name("message"),schema:new e.Name("schema"),parentSchema:new e.Name("parentSchema")};function s3(Q,W,$){let{createErrors:Y}=Q.it;if(Y===!1)return e._`{}`;return tU(Q,W,$)}function tU(Q,W,$={}){let{gen:Y,it:J}=Q,X=[sU(J,$),eU(Q,$)];return QA(Q,W,X),Y.object(...X)}function sU({errorPath:Q},{instancePath:W}){let $=W?e.str`${Q}${(0,YQ.getErrorPath)(W,YQ.Type.Str)}`:Q;return[p0.default.instancePath,(0,e.strConcat)(p0.default.instancePath,$)]}function eU({keyword:Q,it:{errSchemaPath:W}},{schemaPath:$,parentSchema:Y}){let J=Y?W:e.str`${W}/${Q}`;if($)J=e.str`${J}${(0,YQ.getErrorPath)($,YQ.Type.Str)}`;return[T6.schemaPath,J]}function QA(Q,{params:W,message:$},Y){let{keyword:J,data:X,schemaValue:G,it:H}=Q,{opts:B,propertyName:K,topSchemaRef:F,schemaPath:L}=H;if(Y.push([T6.keyword,J],[T6.params,typeof W=="function"?W(Q):W||e._`{}`]),B.messages)Y.push([T6.message,typeof $=="function"?$(Q):$]);if(B.verbose)Y.push([T6.schema,G],[T6.parentSchema,e._`${F}${L}`],[p0.default.data,X]);if(K)Y.push([T6.propertyName,K])}});var QG=Z((j4)=>{Object.defineProperty(j4,"__esModule",{value:!0});j4.boolOrEmptySchema=j4.topBoolOrEmptySchema=void 0;var WA=O9(),$A=p(),YA=l1(),JA={message:"boolean schema is false"};function XA(Q){let{gen:W,schema:$,validateName:Y}=Q;if($===!1)e3(Q,!1);else if(typeof $=="object"&&$.$async===!0)W.return(YA.default.data);else W.assign($A._`${Y}.errors`,null),W.return(!0)}j4.topBoolOrEmptySchema=XA;function GA(Q,W){let{gen:$,schema:Y}=Q;if(Y===!1)$.var(W,!1),e3(Q);else $.var(W,!0)}j4.boolOrEmptySchema=GA;function e3(Q,W){let{gen:$,data:Y}=Q,J={gen:$,keyword:"false schema",data:Y,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:Q};(0,WA.reportError)(J,JA,void 0,W)}});var gY=Z((z4)=>{Object.defineProperty(z4,"__esModule",{value:!0});z4.getRules=z4.isJSONType=void 0;var HA=["string","number","integer","boolean","null","object","array"],BA=new Set(HA);function KA(Q){return typeof Q=="string"&&BA.has(Q)}z4.isJSONType=KA;function VA(){let Q={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...Q,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},Q.number,Q.string,Q.array,Q.object],post:{rules:[]},all:{},keywords:{}}}z4.getRules=VA});var hY=Z((V6)=>{Object.defineProperty(V6,"__esModule",{value:!0});V6.shouldUseRule=V6.shouldUseGroup=V6.schemaHasRulesForType=void 0;function FA({schema:Q,self:W},$){let Y=W.RULES.types[$];return Y&&Y!==!0&&WG(Q,Y)}V6.schemaHasRulesForType=FA;function WG(Q,W){return W.rules.some(($)=>$G(Q,$))}V6.shouldUseGroup=WG;function $G(Q,W){var $;return Q[W.keyword]!==void 0||(($=W.definition.implements)===null||$===void 0?void 0:$.some((Y)=>Q[Y]!==void 0))}V6.shouldUseRule=$G});var w9=Z((h0)=>{Object.defineProperty(h0,"__esModule",{value:!0});h0.reportTypeError=h0.checkDataTypes=h0.checkDataType=h0.coerceAndCheckDataType=h0.getJSONTypes=h0.getSchemaTypes=h0.DataType=void 0;var LA=gY(),qA=hY(),UA=O9(),c=p(),YG=W0(),E4;(function(Q){Q[Q.Correct=0]="Correct",Q[Q.Wrong=1]="Wrong"})(E4||(h0.DataType=E4={}));function AA(Q){let W=JG(Q.type);if(W.includes("null")){if(Q.nullable===!1)throw Error("type: null contradicts nullable: false")}else{if(!W.length&&Q.nullable!==void 0)throw Error('"nullable" cannot be used without "type"');if(Q.nullable===!0)W.push("null")}return W}h0.getSchemaTypes=AA;function JG(Q){let W=Array.isArray(Q)?Q:Q?[Q]:[];if(W.every(LA.isJSONType))return W;throw Error("type must be JSONType or JSONType[]: "+W.join(","))}h0.getJSONTypes=JG;function DA(Q,W){let{gen:$,data:Y,opts:J}=Q,X=OA(W,J.coerceTypes),G=W.length>0&&!(X.length===0&&W.length===1&&(0,qA.schemaHasRulesForType)(Q,W[0]));if(G){let H=uY(W,Y,J.strictNumbers,E4.Wrong);$.if(H,()=>{if(X.length)wA(Q,W,X);else lY(Q)})}return G}h0.coerceAndCheckDataType=DA;var XG=new Set(["string","number","integer","boolean","null"]);function OA(Q,W){return W?Q.filter(($)=>XG.has($)||W==="array"&&$==="array"):[]}function wA(Q,W,$){let{gen:Y,data:J,opts:X}=Q,G=Y.let("dataType",c._`typeof ${J}`),H=Y.let("coerced",c._`undefined`);if(X.coerceTypes==="array")Y.if(c._`${G} == 'object' && Array.isArray(${J}) && ${J}.length == 1`,()=>Y.assign(J,c._`${J}[0]`).assign(G,c._`typeof ${J}`).if(uY(W,J,X.strictNumbers),()=>Y.assign(H,J)));Y.if(c._`${H} !== undefined`);for(let K of $)if(XG.has(K)||K==="array"&&X.coerceTypes==="array")B(K);Y.else(),lY(Q),Y.endIf(),Y.if(c._`${H} !== undefined`,()=>{Y.assign(J,H),NA(Q,H)});function B(K){switch(K){case"string":Y.elseIf(c._`${G} == "number" || ${G} == "boolean"`).assign(H,c._`"" + ${J}`).elseIf(c._`${J} === null`).assign(H,c._`""`);return;case"number":Y.elseIf(c._`${G} == "boolean" || ${J} === null
              || (${G} == "string" && ${J} && ${J} == +${J})`).assign(H,c._`+${J}`);return;case"integer":Y.elseIf(c._`${G} === "boolean" || ${J} === null
              || (${G} === "string" && ${J} && ${J} == +${J} && !(${J} % 1))`).assign(H,c._`+${J}`);return;case"boolean":Y.elseIf(c._`${J} === "false" || ${J} === 0 || ${J} === null`).assign(H,!1).elseIf(c._`${J} === "true" || ${J} === 1`).assign(H,!0);return;case"null":Y.elseIf(c._`${J} === "" || ${J} === 0 || ${J} === false`),Y.assign(H,null);return;case"array":Y.elseIf(c._`${G} === "string" || ${G} === "number"
              || ${G} === "boolean" || ${J} === null`).assign(H,c._`[${J}]`)}}}function NA({gen:Q,parentData:W,parentDataProperty:$},Y){Q.if(c._`${W} !== undefined`,()=>Q.assign(c._`${W}[${$}]`,Y))}function fY(Q,W,$,Y=E4.Correct){let J=Y===E4.Correct?c.operators.EQ:c.operators.NEQ,X;switch(Q){case"null":return c._`${W} ${J} null`;case"array":X=c._`Array.isArray(${W})`;break;case"object":X=c._`${W} && typeof ${W} == "object" && !Array.isArray(${W})`;break;case"integer":X=G(c._`!(${W} % 1) && !isNaN(${W})`);break;case"number":X=G();break;default:return c._`typeof ${W} ${J} ${Q}`}return Y===E4.Correct?X:(0,c.not)(X);function G(H=c.nil){return(0,c.and)(c._`typeof ${W} == "number"`,H,$?c._`isFinite(${W})`:c.nil)}}h0.checkDataType=fY;function uY(Q,W,$,Y){if(Q.length===1)return fY(Q[0],W,$,Y);let J,X=(0,YG.toHash)(Q);if(X.array&&X.object){let G=c._`typeof ${W} != "object"`;J=X.null?G:c._`!${W} || ${G}`,delete X.null,delete X.array,delete X.object}else J=c.nil;if(X.number)delete X.integer;for(let G in X)J=(0,c.and)(J,fY(G,W,$,Y));return J}h0.checkDataTypes=uY;var MA={message:({schema:Q})=>`must be ${Q}`,params:({schema:Q,schemaValue:W})=>typeof Q=="string"?c._`{type: ${Q}}`:c._`{type: ${W}}`};function lY(Q){let W=jA(Q);(0,UA.reportError)(W,MA)}h0.reportTypeError=lY;function jA(Q){let{gen:W,data:$,schema:Y}=Q,J=(0,YG.schemaRefOrVal)(Q,Y,"type");return{gen:W,keyword:"type",data:$,schema:Y.type,schemaCode:J,schemaValue:J,parentSchema:Y,params:{},it:Q}}});var HG=Z((JQ)=>{Object.defineProperty(JQ,"__esModule",{value:!0});JQ.assignDefaults=void 0;var P4=p(),zA=W0();function EA(Q,W){let{properties:$,items:Y}=Q.schema;if(W==="object"&&$)for(let J in $)GG(Q,J,$[J].default);else if(W==="array"&&Array.isArray(Y))Y.forEach((J,X)=>GG(Q,X,J.default))}JQ.assignDefaults=EA;function GG(Q,W,$){let{gen:Y,compositeRule:J,data:X,opts:G}=Q;if($===void 0)return;let H=P4._`${X}${(0,P4.getProperty)(W)}`;if(J){(0,zA.checkStrictMode)(Q,`default is ignored for: ${H}`);return}let B=P4._`${H} === undefined`;if(G.useDefaults==="empty")B=P4._`${B} || ${H} === null || ${H} === ""`;Y.if(B,P4._`${H} = ${(0,P4.stringify)($)}`)}});var H1=Z((J0)=>{Object.defineProperty(J0,"__esModule",{value:!0});J0.validateUnion=J0.validateArray=J0.usePattern=J0.callValidateCode=J0.schemaProperties=J0.allSchemaProperties=J0.noPropertyInData=J0.propertyInData=J0.isOwnProperty=J0.hasPropFunc=J0.reportMissingProp=J0.checkMissingProp=J0.checkReportMissingProp=void 0;var V0=p(),mY=W0(),F6=l1(),PA=W0();function RA(Q,W){let{gen:$,data:Y,it:J}=Q;$.if(pY($,Y,W,J.opts.ownProperties),()=>{Q.setParams({missingProperty:V0._`${W}`},!0),Q.error()})}J0.checkReportMissingProp=RA;function IA({gen:Q,data:W,it:{opts:$}},Y,J){return(0,V0.or)(...Y.map((X)=>(0,V0.and)(pY(Q,W,X,$.ownProperties),V0._`${J} = ${X}`)))}J0.checkMissingProp=IA;function SA(Q,W){Q.setParams({missingProperty:W},!0),Q.error()}J0.reportMissingProp=SA;function BG(Q){return Q.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:V0._`Object.prototype.hasOwnProperty`})}J0.hasPropFunc=BG;function cY(Q,W,$){return V0._`${BG(Q)}.call(${W}, ${$})`}J0.isOwnProperty=cY;function bA(Q,W,$,Y){let J=V0._`${W}${(0,V0.getProperty)($)} !== undefined`;return Y?V0._`${J} && ${cY(Q,W,$)}`:J}J0.propertyInData=bA;function pY(Q,W,$,Y){let J=V0._`${W}${(0,V0.getProperty)($)} === undefined`;return Y?(0,V0.or)(J,(0,V0.not)(cY(Q,W,$))):J}J0.noPropertyInData=pY;function KG(Q){return Q?Object.keys(Q).filter((W)=>W!=="__proto__"):[]}J0.allSchemaProperties=KG;function CA(Q,W){return KG(W).filter(($)=>!(0,mY.alwaysValidSchema)(Q,W[$]))}J0.schemaProperties=CA;function ZA({schemaCode:Q,data:W,it:{gen:$,topSchemaRef:Y,schemaPath:J,errorPath:X},it:G},H,B,K){let F=K?V0._`${Q}, ${W}, ${Y}${J}`:W,L=[[F6.default.instancePath,(0,V0.strConcat)(F6.default.instancePath,X)],[F6.default.parentData,G.parentData],[F6.default.parentDataProperty,G.parentDataProperty],[F6.default.rootData,F6.default.rootData]];if(G.opts.dynamicRef)L.push([F6.default.dynamicAnchors,F6.default.dynamicAnchors]);let U=V0._`${F}, ${$.object(...L)}`;return B!==V0.nil?V0._`${H}.call(${B}, ${U})`:V0._`${H}(${U})`}J0.callValidateCode=ZA;var vA=V0._`new RegExp`;function TA({gen:Q,it:{opts:W}},$){let Y=W.unicodeRegExp?"u":"",{regExp:J}=W.code,X=J($,Y);return Q.scopeValue("pattern",{key:X.toString(),ref:X,code:V0._`${J.code==="new RegExp"?vA:(0,PA.useFunc)(Q,J)}(${$}, ${Y})`})}J0.usePattern=TA;function kA(Q){let{gen:W,data:$,keyword:Y,it:J}=Q,X=W.name("valid");if(J.allErrors){let H=W.let("valid",!0);return G(()=>W.assign(H,!1)),H}return W.var(X,!0),G(()=>W.break()),X;function G(H){let B=W.const("len",V0._`${$}.length`);W.forRange("i",0,B,(K)=>{Q.subschema({keyword:Y,dataProp:K,dataPropType:mY.Type.Num},X),W.if((0,V0.not)(X),H)})}}J0.validateArray=kA;function _A(Q){let{gen:W,schema:$,keyword:Y,it:J}=Q;if(!Array.isArray($))throw Error("ajv implementation error");if($.some((B)=>(0,mY.alwaysValidSchema)(J,B))&&!J.opts.unevaluated)return;let G=W.let("valid",!1),H=W.name("_valid");W.block(()=>$.forEach((B,K)=>{let F=Q.subschema({keyword:Y,schemaProp:K,compositeRule:!0},H);if(W.assign(G,V0._`${G} || ${H}`),!Q.mergeValidEvaluated(F,H))W.if((0,V0.not)(G))})),Q.result(G,()=>Q.reset(),()=>Q.error(!0))}J0.validateUnion=_A});var LG=Z((C1)=>{Object.defineProperty(C1,"__esModule",{value:!0});C1.validateKeywordUsage=C1.validSchemaType=C1.funcKeywordCode=C1.macroKeywordCode=void 0;var d0=p(),k6=l1(),xA=H1(),yA=O9();function gA(Q,W){let{gen:$,keyword:Y,schema:J,parentSchema:X,it:G}=Q,H=W.macro.call(G.self,J,X,G),B=FG($,Y,H);if(G.opts.validateSchema!==!1)G.self.validateSchema(H,!0);let K=$.name("valid");Q.subschema({schema:H,schemaPath:d0.nil,errSchemaPath:`${G.errSchemaPath}/${Y}`,topSchemaRef:B,compositeRule:!0},K),Q.pass(K,()=>Q.error(!0))}C1.macroKeywordCode=gA;function hA(Q,W){var $;let{gen:Y,keyword:J,schema:X,parentSchema:G,$data:H,it:B}=Q;uA(B,W);let K=!H&&W.compile?W.compile.call(B.self,X,G,B):W.validate,F=FG(Y,J,K),L=Y.let("valid");Q.block$data(L,U),Q.ok(($=W.valid)!==null&&$!==void 0?$:L);function U(){if(W.errors===!1){if(D(),W.modifying)VG(Q);O(()=>Q.error())}else{let w=W.async?q():A();if(W.modifying)VG(Q);O(()=>fA(Q,w))}}function q(){let w=Y.let("ruleErrs",null);return Y.try(()=>D(d0._`await `),(j)=>Y.assign(L,!1).if(d0._`${j} instanceof ${B.ValidationError}`,()=>Y.assign(w,d0._`${j}.errors`),()=>Y.throw(j))),w}function A(){let w=d0._`${F}.errors`;return Y.assign(w,null),D(d0.nil),w}function D(w=W.async?d0._`await `:d0.nil){let j=B.opts.passContext?k6.default.this:k6.default.self,z=!(("compile"in W)&&!H||W.schema===!1);Y.assign(L,d0._`${w}${(0,xA.callValidateCode)(Q,F,j,z)}`,W.modifying)}function O(w){var j;Y.if((0,d0.not)((j=W.valid)!==null&&j!==void 0?j:L),w)}}C1.funcKeywordCode=hA;function VG(Q){let{gen:W,data:$,it:Y}=Q;W.if(Y.parentData,()=>W.assign($,d0._`${Y.parentData}[${Y.parentDataProperty}]`))}function fA(Q,W){let{gen:$}=Q;$.if(d0._`Array.isArray(${W})`,()=>{$.assign(k6.default.vErrors,d0._`${k6.default.vErrors} === null ? ${W} : ${k6.default.vErrors}.concat(${W})`).assign(k6.default.errors,d0._`${k6.default.vErrors}.length`),(0,yA.extendErrors)(Q)},()=>Q.error())}function uA({schemaEnv:Q},W){if(W.async&&!Q.$async)throw Error("async keyword in sync schema")}function FG(Q,W,$){if($===void 0)throw Error(`keyword "${W}" failed to compile`);return Q.scopeValue("keyword",typeof $=="function"?{ref:$}:{ref:$,code:(0,d0.stringify)($)})}function lA(Q,W,$=!1){return!W.length||W.some((Y)=>Y==="array"?Array.isArray(Q):Y==="object"?Q&&typeof Q=="object"&&!Array.isArray(Q):typeof Q==Y||$&&typeof Q>"u")}C1.validSchemaType=lA;function mA({schema:Q,opts:W,self:$,errSchemaPath:Y},J,X){if(Array.isArray(J.keyword)?!J.keyword.includes(X):J.keyword!==X)throw Error("ajv implementation error");let G=J.dependencies;if(G===null||G===void 0?void 0:G.some((H)=>!Object.prototype.hasOwnProperty.call(Q,H)))throw Error(`parent schema must have dependencies of ${X}: ${G.join(",")}`);if(J.validateSchema){if(!J.validateSchema(Q[X])){let B=`keyword "${X}" value is invalid at path "${Y}": `+$.errorsText(J.validateSchema.errors);if(W.validateSchema==="log")$.logger.error(B);else throw Error(B)}}}C1.validateKeywordUsage=mA});var UG=Z((L6)=>{Object.defineProperty(L6,"__esModule",{value:!0});L6.extendSubschemaMode=L6.extendSubschemaData=L6.getSubschema=void 0;var Z1=p(),qG=W0();function cA(Q,{keyword:W,schemaProp:$,schema:Y,schemaPath:J,errSchemaPath:X,topSchemaRef:G}){if(W!==void 0&&Y!==void 0)throw Error('both "keyword" and "schema" passed, only one allowed');if(W!==void 0){let H=Q.schema[W];return $===void 0?{schema:H,schemaPath:Z1._`${Q.schemaPath}${(0,Z1.getProperty)(W)}`,errSchemaPath:`${Q.errSchemaPath}/${W}`}:{schema:H[$],schemaPath:Z1._`${Q.schemaPath}${(0,Z1.getProperty)(W)}${(0,Z1.getProperty)($)}`,errSchemaPath:`${Q.errSchemaPath}/${W}/${(0,qG.escapeFragment)($)}`}}if(Y!==void 0){if(J===void 0||X===void 0||G===void 0)throw Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:Y,schemaPath:J,topSchemaRef:G,errSchemaPath:X}}throw Error('either "keyword" or "schema" must be passed')}L6.getSubschema=cA;function pA(Q,W,{dataProp:$,dataPropType:Y,data:J,dataTypes:X,propertyName:G}){if(J!==void 0&&$!==void 0)throw Error('both "data" and "dataProp" passed, only one allowed');let{gen:H}=W;if($!==void 0){let{errorPath:K,dataPathArr:F,opts:L}=W,U=H.let("data",Z1._`${W.data}${(0,Z1.getProperty)($)}`,!0);B(U),Q.errorPath=Z1.str`${K}${(0,qG.getErrorPath)($,Y,L.jsPropertySyntax)}`,Q.parentDataProperty=Z1._`${$}`,Q.dataPathArr=[...F,Q.parentDataProperty]}if(J!==void 0){let K=J instanceof Z1.Name?J:H.let("data",J,!0);if(B(K),G!==void 0)Q.propertyName=G}if(X)Q.dataTypes=X;function B(K){Q.data=K,Q.dataLevel=W.dataLevel+1,Q.dataTypes=[],W.definedProperties=new Set,Q.parentData=W.data,Q.dataNames=[...W.dataNames,K]}}L6.extendSubschemaData=pA;function dA(Q,{jtdDiscriminator:W,jtdMetadata:$,compositeRule:Y,createErrors:J,allErrors:X}){if(Y!==void 0)Q.compositeRule=Y;if(J!==void 0)Q.createErrors=J;if(X!==void 0)Q.allErrors=X;Q.jtdDiscriminator=W,Q.jtdMetadata=$}L6.extendSubschemaMode=dA});var dY=Z((iR,AG)=>{AG.exports=function Q(W,$){if(W===$)return!0;if(W&&$&&typeof W=="object"&&typeof $=="object"){if(W.constructor!==$.constructor)return!1;var Y,J,X;if(Array.isArray(W)){if(Y=W.length,Y!=$.length)return!1;for(J=Y;J--!==0;)if(!Q(W[J],$[J]))return!1;return!0}if(W.constructor===RegExp)return W.source===$.source&&W.flags===$.flags;if(W.valueOf!==Object.prototype.valueOf)return W.valueOf()===$.valueOf();if(W.toString!==Object.prototype.toString)return W.toString()===$.toString();if(X=Object.keys(W),Y=X.length,Y!==Object.keys($).length)return!1;for(J=Y;J--!==0;)if(!Object.prototype.hasOwnProperty.call($,X[J]))return!1;for(J=Y;J--!==0;){var G=X[J];if(!Q(W[G],$[G]))return!1}return!0}return W!==W&&$!==$}});var OG=Z((nR,DG)=>{var q6=DG.exports=function(Q,W,$){if(typeof W=="function")$=W,W={};$=W.cb||$;var Y=typeof $=="function"?$:$.pre||function(){},J=$.post||function(){};XQ(W,Y,J,Q,"",Q)};q6.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};q6.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};q6.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};q6.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function XQ(Q,W,$,Y,J,X,G,H,B,K){if(Y&&typeof Y=="object"&&!Array.isArray(Y)){W(Y,J,X,G,H,B,K);for(var F in Y){var L=Y[F];if(Array.isArray(L)){if(F in q6.arrayKeywords)for(var U=0;U<L.length;U++)XQ(Q,W,$,L[U],J+"/"+F+"/"+U,X,J,F,Y,U)}else if(F in q6.propsKeywords){if(L&&typeof L=="object")for(var q in L)XQ(Q,W,$,L[q],J+"/"+F+"/"+iA(q),X,J,F,Y,q)}else if(F in q6.keywords||Q.allKeys&&!(F in q6.skipKeywords))XQ(Q,W,$,L,J+"/"+F,X,J,F,Y)}$(Y,J,X,G,H,B,K)}}function iA(Q){return Q.replace(/~/g,"~0").replace(/\//g,"~1")}});var N9=Z((a0)=>{Object.defineProperty(a0,"__esModule",{value:!0});a0.getSchemaRefs=a0.resolveUrl=a0.normalizeId=a0._getFullPath=a0.getFullPath=a0.inlineRef=void 0;var nA=W0(),oA=dY(),rA=OG(),aA=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function tA(Q,W=!0){if(typeof Q=="boolean")return!0;if(W===!0)return!iY(Q);if(!W)return!1;return wG(Q)<=W}a0.inlineRef=tA;var sA=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function iY(Q){for(let W in Q){if(sA.has(W))return!0;let $=Q[W];if(Array.isArray($)&&$.some(iY))return!0;if(typeof $=="object"&&iY($))return!0}return!1}function wG(Q){let W=0;for(let $ in Q){if($==="$ref")return 1/0;if(W++,aA.has($))continue;if(typeof Q[$]=="object")(0,nA.eachItem)(Q[$],(Y)=>W+=wG(Y));if(W===1/0)return 1/0}return W}function NG(Q,W="",$){if($!==!1)W=R4(W);let Y=Q.parse(W);return MG(Q,Y)}a0.getFullPath=NG;function MG(Q,W){return Q.serialize(W).split("#")[0]+"#"}a0._getFullPath=MG;var eA=/#\/?$/;function R4(Q){return Q?Q.replace(eA,""):""}a0.normalizeId=R4;function QD(Q,W,$){return $=R4($),Q.resolve(W,$)}a0.resolveUrl=QD;var WD=/^[a-z_][-a-z0-9._]*$/i;function $D(Q,W){if(typeof Q=="boolean")return{};let{schemaId:$,uriResolver:Y}=this.opts,J=R4(Q[$]||W),X={"":J},G=NG(Y,J,!1),H={},B=new Set;return rA(Q,{allKeys:!0},(L,U,q,A)=>{if(A===void 0)return;let D=G+U,O=X[A];if(typeof L[$]=="string")O=w.call(this,L[$]);j.call(this,L.$anchor),j.call(this,L.$dynamicAnchor),X[U]=O;function w(z){let C=this.opts.uriResolver.resolve;if(z=R4(O?C(O,z):z),B.has(z))throw F(z);B.add(z);let b=this.refs[z];if(typeof b=="string")b=this.refs[b];if(typeof b=="object")K(L,b.schema,z);else if(z!==R4(D))if(z[0]==="#")K(L,H[z],z),H[z]=L;else this.refs[z]=D;return z}function j(z){if(typeof z=="string"){if(!WD.test(z))throw Error(`invalid anchor "${z}"`);w.call(this,`#${z}`)}}}),H;function K(L,U,q){if(U!==void 0&&!oA(L,U))throw F(q)}function F(L){return Error(`reference "${L}" resolves to more than one schema`)}}a0.getSchemaRefs=$D});var z9=Z((U6)=>{Object.defineProperty(U6,"__esModule",{value:!0});U6.getData=U6.KeywordCxt=U6.validateFunctionCode=void 0;var RG=QG(),jG=w9(),oY=hY(),GQ=w9(),YD=HG(),j9=LG(),nY=UG(),x=p(),l=l1(),JD=N9(),m1=W0(),M9=O9();function XD(Q){if(bG(Q)){if(CG(Q),SG(Q)){BD(Q);return}}IG(Q,()=>(0,RG.topBoolOrEmptySchema)(Q))}U6.validateFunctionCode=XD;function IG({gen:Q,validateName:W,schema:$,schemaEnv:Y,opts:J},X){if(J.code.es5)Q.func(W,x._`${l.default.data}, ${l.default.valCxt}`,Y.$async,()=>{Q.code(x._`"use strict"; ${zG($,J)}`),HD(Q,J),Q.code(X)});else Q.func(W,x._`${l.default.data}, ${GD(J)}`,Y.$async,()=>Q.code(zG($,J)).code(X))}function GD(Q){return x._`{${l.default.instancePath}="", ${l.default.parentData}, ${l.default.parentDataProperty}, ${l.default.rootData}=${l.default.data}${Q.dynamicRef?x._`, ${l.default.dynamicAnchors}={}`:x.nil}}={}`}function HD(Q,W){Q.if(l.default.valCxt,()=>{if(Q.var(l.default.instancePath,x._`${l.default.valCxt}.${l.default.instancePath}`),Q.var(l.default.parentData,x._`${l.default.valCxt}.${l.default.parentData}`),Q.var(l.default.parentDataProperty,x._`${l.default.valCxt}.${l.default.parentDataProperty}`),Q.var(l.default.rootData,x._`${l.default.valCxt}.${l.default.rootData}`),W.dynamicRef)Q.var(l.default.dynamicAnchors,x._`${l.default.valCxt}.${l.default.dynamicAnchors}`)},()=>{if(Q.var(l.default.instancePath,x._`""`),Q.var(l.default.parentData,x._`undefined`),Q.var(l.default.parentDataProperty,x._`undefined`),Q.var(l.default.rootData,l.default.data),W.dynamicRef)Q.var(l.default.dynamicAnchors,x._`{}`)})}function BD(Q){let{schema:W,opts:$,gen:Y}=Q;IG(Q,()=>{if($.$comment&&W.$comment)vG(Q);if(qD(Q),Y.let(l.default.vErrors,null),Y.let(l.default.errors,0),$.unevaluated)KD(Q);ZG(Q),DD(Q)});return}function KD(Q){let{gen:W,validateName:$}=Q;Q.evaluated=W.const("evaluated",x._`${$}.evaluated`),W.if(x._`${Q.evaluated}.dynamicProps`,()=>W.assign(x._`${Q.evaluated}.props`,x._`undefined`)),W.if(x._`${Q.evaluated}.dynamicItems`,()=>W.assign(x._`${Q.evaluated}.items`,x._`undefined`))}function zG(Q,W){let $=typeof Q=="object"&&Q[W.schemaId];return $&&(W.code.source||W.code.process)?x._`/*# sourceURL=${$} */`:x.nil}function VD(Q,W){if(bG(Q)){if(CG(Q),SG(Q)){FD(Q,W);return}}(0,RG.boolOrEmptySchema)(Q,W)}function SG({schema:Q,self:W}){if(typeof Q=="boolean")return!Q;for(let $ in Q)if(W.RULES.all[$])return!0;return!1}function bG(Q){return typeof Q.schema!="boolean"}function FD(Q,W){let{schema:$,gen:Y,opts:J}=Q;if(J.$comment&&$.$comment)vG(Q);UD(Q),AD(Q);let X=Y.const("_errs",l.default.errors);ZG(Q,X),Y.var(W,x._`${X} === ${l.default.errors}`)}function CG(Q){(0,m1.checkUnknownRules)(Q),LD(Q)}function ZG(Q,W){if(Q.opts.jtd)return EG(Q,[],!1,W);let $=(0,jG.getSchemaTypes)(Q.schema),Y=(0,jG.coerceAndCheckDataType)(Q,$);EG(Q,$,!Y,W)}function LD(Q){let{schema:W,errSchemaPath:$,opts:Y,self:J}=Q;if(W.$ref&&Y.ignoreKeywordsWithRef&&(0,m1.schemaHasRulesButRef)(W,J.RULES))J.logger.warn(`$ref: keywords ignored in schema at path "${$}"`)}function qD(Q){let{schema:W,opts:$}=Q;if(W.default!==void 0&&$.useDefaults&&$.strictSchema)(0,m1.checkStrictMode)(Q,"default is ignored in the schema root")}function UD(Q){let W=Q.schema[Q.opts.schemaId];if(W)Q.baseId=(0,JD.resolveUrl)(Q.opts.uriResolver,Q.baseId,W)}function AD(Q){if(Q.schema.$async&&!Q.schemaEnv.$async)throw Error("async schema in sync schema")}function vG({gen:Q,schemaEnv:W,schema:$,errSchemaPath:Y,opts:J}){let X=$.$comment;if(J.$comment===!0)Q.code(x._`${l.default.self}.logger.log(${X})`);else if(typeof J.$comment=="function"){let G=x.str`${Y}/$comment`,H=Q.scopeValue("root",{ref:W.root});Q.code(x._`${l.default.self}.opts.$comment(${X}, ${G}, ${H}.schema)`)}}function DD(Q){let{gen:W,schemaEnv:$,validateName:Y,ValidationError:J,opts:X}=Q;if($.$async)W.if(x._`${l.default.errors} === 0`,()=>W.return(l.default.data),()=>W.throw(x._`new ${J}(${l.default.vErrors})`));else{if(W.assign(x._`${Y}.errors`,l.default.vErrors),X.unevaluated)OD(Q);W.return(x._`${l.default.errors} === 0`)}}function OD({gen:Q,evaluated:W,props:$,items:Y}){if($ instanceof x.Name)Q.assign(x._`${W}.props`,$);if(Y instanceof x.Name)Q.assign(x._`${W}.items`,Y)}function EG(Q,W,$,Y){let{gen:J,schema:X,data:G,allErrors:H,opts:B,self:K}=Q,{RULES:F}=K;if(X.$ref&&(B.ignoreKeywordsWithRef||!(0,m1.schemaHasRulesButRef)(X,F))){J.block(()=>kG(Q,"$ref",F.all.$ref.definition));return}if(!B.jtd)wD(Q,W);J.block(()=>{for(let U of F.rules)L(U);L(F.post)});function L(U){if(!(0,oY.shouldUseGroup)(X,U))return;if(U.type){if(J.if((0,GQ.checkDataType)(U.type,G,B.strictNumbers)),PG(Q,U),W.length===1&&W[0]===U.type&&$)J.else(),(0,GQ.reportTypeError)(Q);J.endIf()}else PG(Q,U);if(!H)J.if(x._`${l.default.errors} === ${Y||0}`)}}function PG(Q,W){let{gen:$,schema:Y,opts:{useDefaults:J}}=Q;if(J)(0,YD.assignDefaults)(Q,W.type);$.block(()=>{for(let X of W.rules)if((0,oY.shouldUseRule)(Y,X))kG(Q,X.keyword,X.definition,W.type)})}function wD(Q,W){if(Q.schemaEnv.meta||!Q.opts.strictTypes)return;if(ND(Q,W),!Q.opts.allowUnionTypes)MD(Q,W);jD(Q,Q.dataTypes)}function ND(Q,W){if(!W.length)return;if(!Q.dataTypes.length){Q.dataTypes=W;return}W.forEach(($)=>{if(!TG(Q.dataTypes,$))rY(Q,`type "${$}" not allowed by context "${Q.dataTypes.join(",")}"`)}),ED(Q,W)}function MD(Q,W){if(W.length>1&&!(W.length===2&&W.includes("null")))rY(Q,"use allowUnionTypes to allow union type keyword")}function jD(Q,W){let $=Q.self.RULES.all;for(let Y in $){let J=$[Y];if(typeof J=="object"&&(0,oY.shouldUseRule)(Q.schema,J)){let{type:X}=J.definition;if(X.length&&!X.some((G)=>zD(W,G)))rY(Q,`missing type "${X.join(",")}" for keyword "${Y}"`)}}}function zD(Q,W){return Q.includes(W)||W==="number"&&Q.includes("integer")}function TG(Q,W){return Q.includes(W)||W==="integer"&&Q.includes("number")}function ED(Q,W){let $=[];for(let Y of Q.dataTypes)if(TG(W,Y))$.push(Y);else if(W.includes("integer")&&Y==="number")$.push("integer");Q.dataTypes=$}function rY(Q,W){let $=Q.schemaEnv.baseId+Q.errSchemaPath;W+=` at "${$}" (strictTypes)`,(0,m1.checkStrictMode)(Q,W,Q.opts.strictTypes)}class aY{constructor(Q,W,$){if((0,j9.validateKeywordUsage)(Q,W,$),this.gen=Q.gen,this.allErrors=Q.allErrors,this.keyword=$,this.data=Q.data,this.schema=Q.schema[$],this.$data=W.$data&&Q.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,m1.schemaRefOrVal)(Q,this.schema,$,this.$data),this.schemaType=W.schemaType,this.parentSchema=Q.schema,this.params={},this.it=Q,this.def=W,this.$data)this.schemaCode=Q.gen.const("vSchema",_G(this.$data,Q));else if(this.schemaCode=this.schemaValue,!(0,j9.validSchemaType)(this.schema,W.schemaType,W.allowUndefined))throw Error(`${$} value must be ${JSON.stringify(W.schemaType)}`);if("code"in W?W.trackErrors:W.errors!==!1)this.errsCount=Q.gen.const("_errs",l.default.errors)}result(Q,W,$){this.failResult((0,x.not)(Q),W,$)}failResult(Q,W,$){if(this.gen.if(Q),$)$();else this.error();if(W){if(this.gen.else(),W(),this.allErrors)this.gen.endIf()}else if(this.allErrors)this.gen.endIf();else this.gen.else()}pass(Q,W){this.failResult((0,x.not)(Q),void 0,W)}fail(Q){if(Q===void 0){if(this.error(),!this.allErrors)this.gen.if(!1);return}if(this.gen.if(Q),this.error(),this.allErrors)this.gen.endIf();else this.gen.else()}fail$data(Q){if(!this.$data)return this.fail(Q);let{schemaCode:W}=this;this.fail(x._`${W} !== undefined && (${(0,x.or)(this.invalid$data(),Q)})`)}error(Q,W,$){if(W){this.setParams(W),this._error(Q,$),this.setParams({});return}this._error(Q,$)}_error(Q,W){(Q?M9.reportExtraError:M9.reportError)(this,this.def.error,W)}$dataError(){(0,M9.reportError)(this,this.def.$dataError||M9.keyword$DataError)}reset(){if(this.errsCount===void 0)throw Error('add "trackErrors" to keyword definition');(0,M9.resetErrorsCount)(this.gen,this.errsCount)}ok(Q){if(!this.allErrors)this.gen.if(Q)}setParams(Q,W){if(W)Object.assign(this.params,Q);else this.params=Q}block$data(Q,W,$=x.nil){this.gen.block(()=>{this.check$data(Q,$),W()})}check$data(Q=x.nil,W=x.nil){if(!this.$data)return;let{gen:$,schemaCode:Y,schemaType:J,def:X}=this;if($.if((0,x.or)(x._`${Y} === undefined`,W)),Q!==x.nil)$.assign(Q,!0);if(J.length||X.validateSchema){if($.elseIf(this.invalid$data()),this.$dataError(),Q!==x.nil)$.assign(Q,!1)}$.else()}invalid$data(){let{gen:Q,schemaCode:W,schemaType:$,def:Y,it:J}=this;return(0,x.or)(X(),G());function X(){if($.length){if(!(W instanceof x.Name))throw Error("ajv implementation error");let H=Array.isArray($)?$:[$];return x._`${(0,GQ.checkDataTypes)(H,W,J.opts.strictNumbers,GQ.DataType.Wrong)}`}return x.nil}function G(){if(Y.validateSchema){let H=Q.scopeValue("validate$data",{ref:Y.validateSchema});return x._`!${H}(${W})`}return x.nil}}subschema(Q,W){let $=(0,nY.getSubschema)(this.it,Q);(0,nY.extendSubschemaData)($,this.it,Q),(0,nY.extendSubschemaMode)($,Q);let Y={...this.it,...$,items:void 0,props:void 0};return VD(Y,W),Y}mergeEvaluated(Q,W){let{it:$,gen:Y}=this;if(!$.opts.unevaluated)return;if($.props!==!0&&Q.props!==void 0)$.props=m1.mergeEvaluated.props(Y,Q.props,$.props,W);if($.items!==!0&&Q.items!==void 0)$.items=m1.mergeEvaluated.items(Y,Q.items,$.items,W)}mergeValidEvaluated(Q,W){let{it:$,gen:Y}=this;if($.opts.unevaluated&&($.props!==!0||$.items!==!0))return Y.if(W,()=>this.mergeEvaluated(Q,x.Name)),!0}}U6.KeywordCxt=aY;function kG(Q,W,$,Y){let J=new aY(Q,$,W);if("code"in $)$.code(J,Y);else if(J.$data&&$.validate)(0,j9.funcKeywordCode)(J,$);else if("macro"in $)(0,j9.macroKeywordCode)(J,$);else if($.compile||$.validate)(0,j9.funcKeywordCode)(J,$)}var PD=/^\/(?:[^~]|~0|~1)*$/,RD=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function _G(Q,{dataLevel:W,dataNames:$,dataPathArr:Y}){let J,X;if(Q==="")return l.default.rootData;if(Q[0]==="/"){if(!PD.test(Q))throw Error(`Invalid JSON-pointer: ${Q}`);J=Q,X=l.default.rootData}else{let K=RD.exec(Q);if(!K)throw Error(`Invalid JSON-pointer: ${Q}`);let F=+K[1];if(J=K[2],J==="#"){if(F>=W)throw Error(B("property/index",F));return Y[W-F]}if(F>W)throw Error(B("data",F));if(X=$[W-F],!J)return X}let G=X,H=J.split("/");for(let K of H)if(K)X=x._`${X}${(0,x.getProperty)((0,m1.unescapeJsonPointer)(K))}`,G=x._`${G} && ${X}`;return G;function B(K,F){return`Cannot access ${K} ${F} levels up, current level is ${W}`}}U6.getData=_G});var HQ=Z((tY)=>{Object.defineProperty(tY,"__esModule",{value:!0});class xG extends Error{constructor(Q){super("validation failed");this.errors=Q,this.ajv=this.validation=!0}}tY.default=xG});var E9=Z((eY)=>{Object.defineProperty(eY,"__esModule",{value:!0});var sY=N9();class yG extends Error{constructor(Q,W,$,Y){super(Y||`can't resolve reference ${$} from id ${W}`);this.missingRef=(0,sY.resolveUrl)(Q,W,$),this.missingSchema=(0,sY.normalizeId)((0,sY.getFullPath)(Q,this.missingRef))}}eY.default=yG});var KQ=Z((B1)=>{Object.defineProperty(B1,"__esModule",{value:!0});B1.resolveSchema=B1.getCompilingSchema=B1.resolveRef=B1.compileSchema=B1.SchemaEnv=void 0;var N1=p(),ID=HQ(),_6=l1(),M1=N9(),gG=W0(),SD=z9();class P9{constructor(Q){var W;this.refs={},this.dynamicAnchors={};let $;if(typeof Q.schema=="object")$=Q.schema;this.schema=Q.schema,this.schemaId=Q.schemaId,this.root=Q.root||this,this.baseId=(W=Q.baseId)!==null&&W!==void 0?W:(0,M1.normalizeId)($===null||$===void 0?void 0:$[Q.schemaId||"$id"]),this.schemaPath=Q.schemaPath,this.localRefs=Q.localRefs,this.meta=Q.meta,this.$async=$===null||$===void 0?void 0:$.$async,this.refs={}}}B1.SchemaEnv=P9;function W5(Q){let W=hG.call(this,Q);if(W)return W;let $=(0,M1.getFullPath)(this.opts.uriResolver,Q.root.baseId),{es5:Y,lines:J}=this.opts.code,{ownProperties:X}=this.opts,G=new N1.CodeGen(this.scope,{es5:Y,lines:J,ownProperties:X}),H;if(Q.$async)H=G.scopeValue("Error",{ref:ID.default,code:N1._`require("ajv/dist/runtime/validation_error").default`});let B=G.scopeName("validate");Q.validateName=B;let K={gen:G,allErrors:this.opts.allErrors,data:_6.default.data,parentData:_6.default.parentData,parentDataProperty:_6.default.parentDataProperty,dataNames:[_6.default.data],dataPathArr:[N1.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:G.scopeValue("schema",this.opts.code.source===!0?{ref:Q.schema,code:(0,N1.stringify)(Q.schema)}:{ref:Q.schema}),validateName:B,ValidationError:H,schema:Q.schema,schemaEnv:Q,rootId:$,baseId:Q.baseId||$,schemaPath:N1.nil,errSchemaPath:Q.schemaPath||(this.opts.jtd?"":"#"),errorPath:N1._`""`,opts:this.opts,self:this},F;try{this._compilations.add(Q),(0,SD.validateFunctionCode)(K),G.optimize(this.opts.code.optimize);let L=G.toString();if(F=`${G.scopeRefs(_6.default.scope)}return ${L}`,this.opts.code.process)F=this.opts.code.process(F,Q);let q=Function(`${_6.default.self}`,`${_6.default.scope}`,F)(this,this.scope.get());if(this.scope.value(B,{ref:q}),q.errors=null,q.schema=Q.schema,q.schemaEnv=Q,Q.$async)q.$async=!0;if(this.opts.code.source===!0)q.source={validateName:B,validateCode:L,scopeValues:G._values};if(this.opts.unevaluated){let{props:A,items:D}=K;if(q.evaluated={props:A instanceof N1.Name?void 0:A,items:D instanceof N1.Name?void 0:D,dynamicProps:A instanceof N1.Name,dynamicItems:D instanceof N1.Name},q.source)q.source.evaluated=(0,N1.stringify)(q.evaluated)}return Q.validate=q,Q}catch(L){if(delete Q.validate,delete Q.validateName,F)this.logger.error("Error compiling schema, function code:",F);throw L}finally{this._compilations.delete(Q)}}B1.compileSchema=W5;function bD(Q,W,$){var Y;$=(0,M1.resolveUrl)(this.opts.uriResolver,W,$);let J=Q.refs[$];if(J)return J;let X=vD.call(this,Q,$);if(X===void 0){let G=(Y=Q.localRefs)===null||Y===void 0?void 0:Y[$],{schemaId:H}=this.opts;if(G)X=new P9({schema:G,schemaId:H,root:Q,baseId:W})}if(X===void 0)return;return Q.refs[$]=CD.call(this,X)}B1.resolveRef=bD;function CD(Q){if((0,M1.inlineRef)(Q.schema,this.opts.inlineRefs))return Q.schema;return Q.validate?Q:W5.call(this,Q)}function hG(Q){for(let W of this._compilations)if(ZD(W,Q))return W}B1.getCompilingSchema=hG;function ZD(Q,W){return Q.schema===W.schema&&Q.root===W.root&&Q.baseId===W.baseId}function vD(Q,W){let $;while(typeof($=this.refs[W])=="string")W=$;return $||this.schemas[W]||BQ.call(this,Q,W)}function BQ(Q,W){let $=this.opts.uriResolver.parse(W),Y=(0,M1._getFullPath)(this.opts.uriResolver,$),J=(0,M1.getFullPath)(this.opts.uriResolver,Q.baseId,void 0);if(Object.keys(Q.schema).length>0&&Y===J)return Q5.call(this,$,Q);let X=(0,M1.normalizeId)(Y),G=this.refs[X]||this.schemas[X];if(typeof G=="string"){let H=BQ.call(this,Q,G);if(typeof(H===null||H===void 0?void 0:H.schema)!=="object")return;return Q5.call(this,$,H)}if(typeof(G===null||G===void 0?void 0:G.schema)!=="object")return;if(!G.validate)W5.call(this,G);if(X===(0,M1.normalizeId)(W)){let{schema:H}=G,{schemaId:B}=this.opts,K=H[B];if(K)J=(0,M1.resolveUrl)(this.opts.uriResolver,J,K);return new P9({schema:H,schemaId:B,root:Q,baseId:J})}return Q5.call(this,$,G)}B1.resolveSchema=BQ;var TD=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function Q5(Q,{baseId:W,schema:$,root:Y}){var J;if(((J=Q.fragment)===null||J===void 0?void 0:J[0])!=="/")return;for(let H of Q.fragment.slice(1).split("/")){if(typeof $==="boolean")return;let B=$[(0,gG.unescapeFragment)(H)];if(B===void 0)return;$=B;let K=typeof $==="object"&&$[this.opts.schemaId];if(!TD.has(H)&&K)W=(0,M1.resolveUrl)(this.opts.uriResolver,W,K)}let X;if(typeof $!="boolean"&&$.$ref&&!(0,gG.schemaHasRulesButRef)($,this.RULES)){let H=(0,M1.resolveUrl)(this.opts.uriResolver,W,$.$ref);X=BQ.call(this,Y,H)}let{schemaId:G}=this.opts;if(X=X||new P9({schema:$,schemaId:G,root:Y,baseId:W}),X.schema!==X.root.schema)return X;return}});var fG=Z((eR,kD)=>{kD.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var Y5=Z((Q2,cG)=>{var _D=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),lG=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function $5(Q){let W="",$=0,Y=0;for(Y=0;Y<Q.length;Y++){if($=Q[Y].charCodeAt(0),$===48)continue;if(!($>=48&&$<=57||$>=65&&$<=70||$>=97&&$<=102))return"";W+=Q[Y];break}for(Y+=1;Y<Q.length;Y++){if($=Q[Y].charCodeAt(0),!($>=48&&$<=57||$>=65&&$<=70||$>=97&&$<=102))return"";W+=Q[Y]}return W}var xD=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function uG(Q){return Q.length=0,!0}function yD(Q,W,$){if(Q.length){let Y=$5(Q);if(Y!=="")W.push(Y);else return $.error=!0,!1;Q.length=0}return!0}function gD(Q){let W=0,$={error:!1,address:"",zone:""},Y=[],J=[],X=!1,G=!1,H=yD;for(let B=0;B<Q.length;B++){let K=Q[B];if(K==="["||K==="]")continue;if(K===":"){if(X===!0)G=!0;if(!H(J,Y,$))break;if(++W>7){$.error=!0;break}if(B>0&&Q[B-1]===":")X=!0;Y.push(":");continue}else if(K==="%"){if(!H(J,Y,$))break;H=uG}else{J.push(K);continue}}if(J.length)if(H===uG)$.zone=J.join("");else if(G)Y.push(J.join(""));else Y.push($5(J));return $.address=Y.join(""),$}function mG(Q){if(hD(Q,":")<2)return{host:Q,isIPV6:!1};let W=gD(Q);if(!W.error){let{address:$,address:Y}=W;if(W.zone)$+="%"+W.zone,Y+="%25"+W.zone;return{host:$,isIPV6:!0,escapedHost:Y}}else return{host:Q,isIPV6:!1}}function hD(Q,W){let $=0;for(let Y=0;Y<Q.length;Y++)if(Q[Y]===W)$++;return $}function fD(Q){let W=Q,$=[],Y=-1,J=0;while(J=W.length){if(J===1)if(W===".")break;else if(W==="/"){$.push("/");break}else{$.push(W);break}else if(J===2){if(W[0]==="."){if(W[1]===".")break;else if(W[1]==="/"){W=W.slice(2);continue}}else if(W[0]==="/"){if(W[1]==="."||W[1]==="/"){$.push("/");break}}}else if(J===3){if(W==="/.."){if($.length!==0)$.pop();$.push("/");break}}if(W[0]==="."){if(W[1]==="."){if(W[2]==="/"){W=W.slice(3);continue}}else if(W[1]==="/"){W=W.slice(2);continue}}else if(W[0]==="/"){if(W[1]==="."){if(W[2]==="/"){W=W.slice(2);continue}else if(W[2]==="."){if(W[3]==="/"){if(W=W.slice(3),$.length!==0)$.pop();continue}}}}if((Y=W.indexOf("/",1))===-1){$.push(W);break}else $.push(W.slice(0,Y)),W=W.slice(Y)}return $.join("")}function uD(Q,W){let $=W!==!0?escape:unescape;if(Q.scheme!==void 0)Q.scheme=$(Q.scheme);if(Q.userinfo!==void 0)Q.userinfo=$(Q.userinfo);if(Q.host!==void 0)Q.host=$(Q.host);if(Q.path!==void 0)Q.path=$(Q.path);if(Q.query!==void 0)Q.query=$(Q.query);if(Q.fragment!==void 0)Q.fragment=$(Q.fragment);return Q}function lD(Q){let W=[];if(Q.userinfo!==void 0)W.push(Q.userinfo),W.push("@");if(Q.host!==void 0){let $=unescape(Q.host);if(!lG($)){let Y=mG($);if(Y.isIPV6===!0)$=`[${Y.escapedHost}]`;else $=Q.host}W.push($)}if(typeof Q.port==="number"||typeof Q.port==="string")W.push(":"),W.push(String(Q.port));return W.length?W.join(""):void 0}cG.exports={nonSimpleDomain:xD,recomposeAuthority:lD,normalizeComponentEncoding:uD,removeDotSegments:fD,isIPv4:lG,isUUID:_D,normalizeIPv6:mG,stringArrayToHexStripped:$5}});var oG=Z((W2,nG)=>{var{isUUID:mD}=Y5(),cD=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,pD=["http","https","ws","wss","urn","urn:uuid"];function dD(Q){return pD.indexOf(Q)!==-1}function J5(Q){if(Q.secure===!0)return!0;else if(Q.secure===!1)return!1;else if(Q.scheme)return Q.scheme.length===3&&(Q.scheme[0]==="w"||Q.scheme[0]==="W")&&(Q.scheme[1]==="s"||Q.scheme[1]==="S")&&(Q.scheme[2]==="s"||Q.scheme[2]==="S");else return!1}function pG(Q){if(!Q.host)Q.error=Q.error||"HTTP URIs must have a host.";return Q}function dG(Q){let W=String(Q.scheme).toLowerCase()==="https";if(Q.port===(W?443:80)||Q.port==="")Q.port=void 0;if(!Q.path)Q.path="/";return Q}function iD(Q){return Q.secure=J5(Q),Q.resourceName=(Q.path||"/")+(Q.query?"?"+Q.query:""),Q.path=void 0,Q.query=void 0,Q}function nD(Q){if(Q.port===(J5(Q)?443:80)||Q.port==="")Q.port=void 0;if(typeof Q.secure==="boolean")Q.scheme=Q.secure?"wss":"ws",Q.secure=void 0;if(Q.resourceName){let[W,$]=Q.resourceName.split("?");Q.path=W&&W!=="/"?W:void 0,Q.query=$,Q.resourceName=void 0}return Q.fragment=void 0,Q}function oD(Q,W){if(!Q.path)return Q.error="URN can not be parsed",Q;let $=Q.path.match(cD);if($){let Y=W.scheme||Q.scheme||"urn";Q.nid=$[1].toLowerCase(),Q.nss=$[2];let J=`${Y}:${W.nid||Q.nid}`,X=X5(J);if(Q.path=void 0,X)Q=X.parse(Q,W)}else Q.error=Q.error||"URN can not be parsed.";return Q}function rD(Q,W){if(Q.nid===void 0)throw Error("URN without nid cannot be serialized");let $=W.scheme||Q.scheme||"urn",Y=Q.nid.toLowerCase(),J=`${$}:${W.nid||Y}`,X=X5(J);if(X)Q=X.serialize(Q,W);let G=Q,H=Q.nss;return G.path=`${Y||W.nid}:${H}`,W.skipEscape=!0,G}function aD(Q,W){let $=Q;if($.uuid=$.nss,$.nss=void 0,!W.tolerant&&(!$.uuid||!mD($.uuid)))$.error=$.error||"UUID is not valid.";return $}function tD(Q){let W=Q;return W.nss=(Q.uuid||"").toLowerCase(),W}var iG={scheme:"http",domainHost:!0,parse:pG,serialize:dG},sD={scheme:"https",domainHost:iG.domainHost,parse:pG,serialize:dG},VQ={scheme:"ws",domainHost:!0,parse:iD,serialize:nD},eD={scheme:"wss",domainHost:VQ.domainHost,parse:VQ.parse,serialize:VQ.serialize},QO={scheme:"urn",parse:oD,serialize:rD,skipNormalize:!0},WO={scheme:"urn:uuid",parse:aD,serialize:tD,skipNormalize:!0},FQ={http:iG,https:sD,ws:VQ,wss:eD,urn:QO,"urn:uuid":WO};Object.setPrototypeOf(FQ,null);function X5(Q){return Q&&(FQ[Q]||FQ[Q.toLowerCase()])||void 0}nG.exports={wsIsSecure:J5,SCHEMES:FQ,isValidSchemeName:dD,getSchemeHandler:X5}});var tG=Z(($2,qQ)=>{var{normalizeIPv6:$O,removeDotSegments:R9,recomposeAuthority:YO,normalizeComponentEncoding:LQ,isIPv4:JO,nonSimpleDomain:XO}=Y5(),{SCHEMES:GO,getSchemeHandler:rG}=oG();function HO(Q,W){if(typeof Q==="string")Q=v1(c1(Q,W),W);else if(typeof Q==="object")Q=c1(v1(Q,W),W);return Q}function BO(Q,W,$){let Y=$?Object.assign({scheme:"null"},$):{scheme:"null"},J=aG(c1(Q,Y),c1(W,Y),Y,!0);return Y.skipEscape=!0,v1(J,Y)}function aG(Q,W,$,Y){let J={};if(!Y)Q=c1(v1(Q,$),$),W=c1(v1(W,$),$);if($=$||{},!$.tolerant&&W.scheme)J.scheme=W.scheme,J.userinfo=W.userinfo,J.host=W.host,J.port=W.port,J.path=R9(W.path||""),J.query=W.query;else{if(W.userinfo!==void 0||W.host!==void 0||W.port!==void 0)J.userinfo=W.userinfo,J.host=W.host,J.port=W.port,J.path=R9(W.path||""),J.query=W.query;else{if(!W.path)if(J.path=Q.path,W.query!==void 0)J.query=W.query;else J.query=Q.query;else{if(W.path[0]==="/")J.path=R9(W.path);else{if((Q.userinfo!==void 0||Q.host!==void 0||Q.port!==void 0)&&!Q.path)J.path="/"+W.path;else if(!Q.path)J.path=W.path;else J.path=Q.path.slice(0,Q.path.lastIndexOf("/")+1)+W.path;J.path=R9(J.path)}J.query=W.query}J.userinfo=Q.userinfo,J.host=Q.host,J.port=Q.port}J.scheme=Q.scheme}return J.fragment=W.fragment,J}function KO(Q,W,$){if(typeof Q==="string")Q=unescape(Q),Q=v1(LQ(c1(Q,$),!0),{...$,skipEscape:!0});else if(typeof Q==="object")Q=v1(LQ(Q,!0),{...$,skipEscape:!0});if(typeof W==="string")W=unescape(W),W=v1(LQ(c1(W,$),!0),{...$,skipEscape:!0});else if(typeof W==="object")W=v1(LQ(W,!0),{...$,skipEscape:!0});return Q.toLowerCase()===W.toLowerCase()}function v1(Q,W){let $={host:Q.host,scheme:Q.scheme,userinfo:Q.userinfo,port:Q.port,path:Q.path,query:Q.query,nid:Q.nid,nss:Q.nss,uuid:Q.uuid,fragment:Q.fragment,reference:Q.reference,resourceName:Q.resourceName,secure:Q.secure,error:""},Y=Object.assign({},W),J=[],X=rG(Y.scheme||$.scheme);if(X&&X.serialize)X.serialize($,Y);if($.path!==void 0)if(!Y.skipEscape){if($.path=escape($.path),$.scheme!==void 0)$.path=$.path.split("%3A").join(":")}else $.path=unescape($.path);if(Y.reference!=="suffix"&&$.scheme)J.push($.scheme,":");let G=YO($);if(G!==void 0){if(Y.reference!=="suffix")J.push("//");if(J.push(G),$.path&&$.path[0]!=="/")J.push("/")}if($.path!==void 0){let H=$.path;if(!Y.absolutePath&&(!X||!X.absolutePath))H=R9(H);if(G===void 0&&H[0]==="/"&&H[1]==="/")H="/%2F"+H.slice(2);J.push(H)}if($.query!==void 0)J.push("?",$.query);if($.fragment!==void 0)J.push("#",$.fragment);return J.join("")}var VO=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function c1(Q,W){let $=Object.assign({},W),Y={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},J=!1;if($.reference==="suffix")if($.scheme)Q=$.scheme+":"+Q;else Q="//"+Q;let X=Q.match(VO);if(X){if(Y.scheme=X[1],Y.userinfo=X[3],Y.host=X[4],Y.port=parseInt(X[5],10),Y.path=X[6]||"",Y.query=X[7],Y.fragment=X[8],isNaN(Y.port))Y.port=X[5];if(Y.host)if(JO(Y.host)===!1){let B=$O(Y.host);Y.host=B.host.toLowerCase(),J=B.isIPV6}else J=!0;if(Y.scheme===void 0&&Y.userinfo===void 0&&Y.host===void 0&&Y.port===void 0&&Y.query===void 0&&!Y.path)Y.reference="same-document";else if(Y.scheme===void 0)Y.reference="relative";else if(Y.fragment===void 0)Y.reference="absolute";else Y.reference="uri";if($.reference&&$.reference!=="suffix"&&$.reference!==Y.reference)Y.error=Y.error||"URI is not a "+$.reference+" reference.";let G=rG($.scheme||Y.scheme);if(!$.unicodeSupport&&(!G||!G.unicodeSupport)){if(Y.host&&($.domainHost||G&&G.domainHost)&&J===!1&&XO(Y.host))try{Y.host=URL.domainToASCII(Y.host.toLowerCase())}catch(H){Y.error=Y.error||"Host's domain name can not be converted to ASCII: "+H}}if(!G||G&&!G.skipNormalize){if(Q.indexOf("%")!==-1){if(Y.scheme!==void 0)Y.scheme=unescape(Y.scheme);if(Y.host!==void 0)Y.host=unescape(Y.host)}if(Y.path)Y.path=escape(unescape(Y.path));if(Y.fragment)Y.fragment=encodeURI(decodeURIComponent(Y.fragment))}if(G&&G.parse)G.parse(Y,$)}else Y.error=Y.error||"URI can not be parsed.";return Y}var G5={SCHEMES:GO,normalize:HO,resolve:BO,resolveComponent:aG,equal:KO,serialize:v1,parse:c1};qQ.exports=G5;qQ.exports.default=G5;qQ.exports.fastUri=G5});var eG=Z((H5)=>{Object.defineProperty(H5,"__esModule",{value:!0});var sG=tG();sG.code='require("ajv/dist/runtime/uri").default';H5.default=sG});var HH=Z((k0)=>{Object.defineProperty(k0,"__esModule",{value:!0});k0.CodeGen=k0.Name=k0.nil=k0.stringify=k0.str=k0._=k0.KeywordCxt=void 0;var FO=z9();Object.defineProperty(k0,"KeywordCxt",{enumerable:!0,get:function(){return FO.KeywordCxt}});var I4=p();Object.defineProperty(k0,"_",{enumerable:!0,get:function(){return I4._}});Object.defineProperty(k0,"str",{enumerable:!0,get:function(){return I4.str}});Object.defineProperty(k0,"stringify",{enumerable:!0,get:function(){return I4.stringify}});Object.defineProperty(k0,"nil",{enumerable:!0,get:function(){return I4.nil}});Object.defineProperty(k0,"Name",{enumerable:!0,get:function(){return I4.Name}});Object.defineProperty(k0,"CodeGen",{enumerable:!0,get:function(){return I4.CodeGen}});var LO=HQ(),JH=E9(),qO=gY(),I9=KQ(),UO=p(),S9=N9(),UQ=w9(),K5=W0(),QH=fG(),AO=eG(),XH=(Q,W)=>new RegExp(Q,W);XH.code="new RegExp";var DO=["removeAdditional","useDefaults","coerceTypes"],OO=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),wO={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},NO={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},WH=200;function MO(Q){var W,$,Y,J,X,G,H,B,K,F,L,U,q,A,D,O,w,j,z,C,b,D0,S0,x1,j0;let R0=Q.strict,l0=(W=Q.code)===null||W===void 0?void 0:W.optimize,n1=l0===!0||l0===void 0?1:l0||0,gQ=(Y=($=Q.code)===null||$===void 0?void 0:$.regExp)!==null&&Y!==void 0?Y:XH,s0=(J=Q.uriResolver)!==null&&J!==void 0?J:AO.default;return{strictSchema:(G=(X=Q.strictSchema)!==null&&X!==void 0?X:R0)!==null&&G!==void 0?G:!0,strictNumbers:(B=(H=Q.strictNumbers)!==null&&H!==void 0?H:R0)!==null&&B!==void 0?B:!0,strictTypes:(F=(K=Q.strictTypes)!==null&&K!==void 0?K:R0)!==null&&F!==void 0?F:"log",strictTuples:(U=(L=Q.strictTuples)!==null&&L!==void 0?L:R0)!==null&&U!==void 0?U:"log",strictRequired:(A=(q=Q.strictRequired)!==null&&q!==void 0?q:R0)!==null&&A!==void 0?A:!1,code:Q.code?{...Q.code,optimize:n1,regExp:gQ}:{optimize:n1,regExp:gQ},loopRequired:(D=Q.loopRequired)!==null&&D!==void 0?D:WH,loopEnum:(O=Q.loopEnum)!==null&&O!==void 0?O:WH,meta:(w=Q.meta)!==null&&w!==void 0?w:!0,messages:(j=Q.messages)!==null&&j!==void 0?j:!0,inlineRefs:(z=Q.inlineRefs)!==null&&z!==void 0?z:!0,schemaId:(C=Q.schemaId)!==null&&C!==void 0?C:"$id",addUsedSchema:(b=Q.addUsedSchema)!==null&&b!==void 0?b:!0,validateSchema:(D0=Q.validateSchema)!==null&&D0!==void 0?D0:!0,validateFormats:(S0=Q.validateFormats)!==null&&S0!==void 0?S0:!0,unicodeRegExp:(x1=Q.unicodeRegExp)!==null&&x1!==void 0?x1:!0,int32range:(j0=Q.int32range)!==null&&j0!==void 0?j0:!0,uriResolver:s0}}class AQ{constructor(Q={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,Q=this.opts={...Q,...MO(Q)};let{es5:W,lines:$}=this.opts.code;this.scope=new UO.ValueScope({scope:{},prefixes:OO,es5:W,lines:$}),this.logger=IO(Q.logger);let Y=Q.validateFormats;if(Q.validateFormats=!1,this.RULES=(0,qO.getRules)(),$H.call(this,wO,Q,"NOT SUPPORTED"),$H.call(this,NO,Q,"DEPRECATED","warn"),this._metaOpts=PO.call(this),Q.formats)zO.call(this);if(this._addVocabularies(),this._addDefaultMetaSchema(),Q.keywords)EO.call(this,Q.keywords);if(typeof Q.meta=="object")this.addMetaSchema(Q.meta);jO.call(this),Q.validateFormats=Y}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:Q,meta:W,schemaId:$}=this.opts,Y=QH;if($==="id")Y={...QH},Y.id=Y.$id,delete Y.$id;if(W&&Q)this.addMetaSchema(Y,Y[$],!1)}defaultMeta(){let{meta:Q,schemaId:W}=this.opts;return this.opts.defaultMeta=typeof Q=="object"?Q[W]||Q:void 0}validate(Q,W){let $;if(typeof Q=="string"){if($=this.getSchema(Q),!$)throw Error(`no schema with key or ref "${Q}"`)}else $=this.compile(Q);let Y=$(W);if(!("$async"in $))this.errors=$.errors;return Y}compile(Q,W){let $=this._addSchema(Q,W);return $.validate||this._compileSchemaEnv($)}compileAsync(Q,W){if(typeof this.opts.loadSchema!="function")throw Error("options.loadSchema should be a function");let{loadSchema:$}=this.opts;return Y.call(this,Q,W);async function Y(K,F){await J.call(this,K.$schema);let L=this._addSchema(K,F);return L.validate||X.call(this,L)}async function J(K){if(K&&!this.getSchema(K))await Y.call(this,{$ref:K},!0)}async function X(K){try{return this._compileSchemaEnv(K)}catch(F){if(!(F instanceof JH.default))throw F;return G.call(this,F),await H.call(this,F.missingSchema),X.call(this,K)}}function G({missingSchema:K,missingRef:F}){if(this.refs[K])throw Error(`AnySchema ${K} is loaded but ${F} cannot be resolved`)}async function H(K){let F=await B.call(this,K);if(!this.refs[K])await J.call(this,F.$schema);if(!this.refs[K])this.addSchema(F,K,W)}async function B(K){let F=this._loading[K];if(F)return F;try{return await(this._loading[K]=$(K))}finally{delete this._loading[K]}}}addSchema(Q,W,$,Y=this.opts.validateSchema){if(Array.isArray(Q)){for(let X of Q)this.addSchema(X,void 0,$,Y);return this}let J;if(typeof Q==="object"){let{schemaId:X}=this.opts;if(J=Q[X],J!==void 0&&typeof J!="string")throw Error(`schema ${X} must be string`)}return W=(0,S9.normalizeId)(W||J),this._checkUnique(W),this.schemas[W]=this._addSchema(Q,$,W,Y,!0),this}addMetaSchema(Q,W,$=this.opts.validateSchema){return this.addSchema(Q,W,!0,$),this}validateSchema(Q,W){if(typeof Q=="boolean")return!0;let $;if($=Q.$schema,$!==void 0&&typeof $!="string")throw Error("$schema must be a string");if($=$||this.opts.defaultMeta||this.defaultMeta(),!$)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let Y=this.validate($,Q);if(!Y&&W){let J="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(J);else throw Error(J)}return Y}getSchema(Q){let W;while(typeof(W=YH.call(this,Q))=="string")Q=W;if(W===void 0){let{schemaId:$}=this.opts,Y=new I9.SchemaEnv({schema:{},schemaId:$});if(W=I9.resolveSchema.call(this,Y,Q),!W)return;this.refs[Q]=W}return W.validate||this._compileSchemaEnv(W)}removeSchema(Q){if(Q instanceof RegExp)return this._removeAllSchemas(this.schemas,Q),this._removeAllSchemas(this.refs,Q),this;switch(typeof Q){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let W=YH.call(this,Q);if(typeof W=="object")this._cache.delete(W.schema);return delete this.schemas[Q],delete this.refs[Q],this}case"object":{let W=Q;this._cache.delete(W);let $=Q[this.opts.schemaId];if($)$=(0,S9.normalizeId)($),delete this.schemas[$],delete this.refs[$];return this}default:throw Error("ajv.removeSchema: invalid parameter")}}addVocabulary(Q){for(let W of Q)this.addKeyword(W);return this}addKeyword(Q,W){let $;if(typeof Q=="string"){if($=Q,typeof W=="object")this.logger.warn("these parameters are deprecated, see docs for addKeyword"),W.keyword=$}else if(typeof Q=="object"&&W===void 0){if(W=Q,$=W.keyword,Array.isArray($)&&!$.length)throw Error("addKeywords: keyword must be string or non-empty array")}else throw Error("invalid addKeywords parameters");if(bO.call(this,$,W),!W)return(0,K5.eachItem)($,(J)=>B5.call(this,J)),this;ZO.call(this,W);let Y={...W,type:(0,UQ.getJSONTypes)(W.type),schemaType:(0,UQ.getJSONTypes)(W.schemaType)};return(0,K5.eachItem)($,Y.type.length===0?(J)=>B5.call(this,J,Y):(J)=>Y.type.forEach((X)=>B5.call(this,J,Y,X))),this}getKeyword(Q){let W=this.RULES.all[Q];return typeof W=="object"?W.definition:!!W}removeKeyword(Q){let{RULES:W}=this;delete W.keywords[Q],delete W.all[Q];for(let $ of W.rules){let Y=$.rules.findIndex((J)=>J.keyword===Q);if(Y>=0)$.rules.splice(Y,1)}return this}addFormat(Q,W){if(typeof W=="string")W=new RegExp(W);return this.formats[Q]=W,this}errorsText(Q=this.errors,{separator:W=", ",dataVar:$="data"}={}){if(!Q||Q.length===0)return"No errors";return Q.map((Y)=>`${$}${Y.instancePath} ${Y.message}`).reduce((Y,J)=>Y+W+J)}$dataMetaSchema(Q,W){let $=this.RULES.all;Q=JSON.parse(JSON.stringify(Q));for(let Y of W){let J=Y.split("/").slice(1),X=Q;for(let G of J)X=X[G];for(let G in $){let H=$[G];if(typeof H!="object")continue;let{$data:B}=H.definition,K=X[G];if(B&&K)X[G]=GH(K)}}return Q}_removeAllSchemas(Q,W){for(let $ in Q){let Y=Q[$];if(!W||W.test($)){if(typeof Y=="string")delete Q[$];else if(Y&&!Y.meta)this._cache.delete(Y.schema),delete Q[$]}}}_addSchema(Q,W,$,Y=this.opts.validateSchema,J=this.opts.addUsedSchema){let X,{schemaId:G}=this.opts;if(typeof Q=="object")X=Q[G];else if(this.opts.jtd)throw Error("schema must be object");else if(typeof Q!="boolean")throw Error("schema must be object or boolean");let H=this._cache.get(Q);if(H!==void 0)return H;$=(0,S9.normalizeId)(X||$);let B=S9.getSchemaRefs.call(this,Q,$);if(H=new I9.SchemaEnv({schema:Q,schemaId:G,meta:W,baseId:$,localRefs:B}),this._cache.set(H.schema,H),J&&!$.startsWith("#")){if($)this._checkUnique($);this.refs[$]=H}if(Y)this.validateSchema(Q,!0);return H}_checkUnique(Q){if(this.schemas[Q]||this.refs[Q])throw Error(`schema with key or id "${Q}" already exists`)}_compileSchemaEnv(Q){if(Q.meta)this._compileMetaSchema(Q);else I9.compileSchema.call(this,Q);if(!Q.validate)throw Error("ajv implementation error");return Q.validate}_compileMetaSchema(Q){let W=this.opts;this.opts=this._metaOpts;try{I9.compileSchema.call(this,Q)}finally{this.opts=W}}}AQ.ValidationError=LO.default;AQ.MissingRefError=JH.default;k0.default=AQ;function $H(Q,W,$,Y="error"){for(let J in Q){let X=J;if(X in W)this.logger[Y](`${$}: option ${J}. ${Q[X]}`)}}function YH(Q){return Q=(0,S9.normalizeId)(Q),this.schemas[Q]||this.refs[Q]}function jO(){let Q=this.opts.schemas;if(!Q)return;if(Array.isArray(Q))this.addSchema(Q);else for(let W in Q)this.addSchema(Q[W],W)}function zO(){for(let Q in this.opts.formats){let W=this.opts.formats[Q];if(W)this.addFormat(Q,W)}}function EO(Q){if(Array.isArray(Q)){this.addVocabulary(Q);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let W in Q){let $=Q[W];if(!$.keyword)$.keyword=W;this.addKeyword($)}}function PO(){let Q={...this.opts};for(let W of DO)delete Q[W];return Q}var RO={log(){},warn(){},error(){}};function IO(Q){if(Q===!1)return RO;if(Q===void 0)return console;if(Q.log&&Q.warn&&Q.error)return Q;throw Error("logger must implement log, warn and error methods")}var SO=/^[a-z_$][a-z0-9_$:-]*$/i;function bO(Q,W){let{RULES:$}=this;if((0,K5.eachItem)(Q,(Y)=>{if($.keywords[Y])throw Error(`Keyword ${Y} is already defined`);if(!SO.test(Y))throw Error(`Keyword ${Y} has invalid name`)}),!W)return;if(W.$data&&!(("code"in W)||("validate"in W)))throw Error('$data keyword must have "code" or "validate" function')}function B5(Q,W,$){var Y;let J=W===null||W===void 0?void 0:W.post;if($&&J)throw Error('keyword with "post" flag cannot have "type"');let{RULES:X}=this,G=J?X.post:X.rules.find(({type:B})=>B===$);if(!G)G={type:$,rules:[]},X.rules.push(G);if(X.keywords[Q]=!0,!W)return;let H={keyword:Q,definition:{...W,type:(0,UQ.getJSONTypes)(W.type),schemaType:(0,UQ.getJSONTypes)(W.schemaType)}};if(W.before)CO.call(this,G,H,W.before);else G.rules.push(H);X.all[Q]=H,(Y=W.implements)===null||Y===void 0||Y.forEach((B)=>this.addKeyword(B))}function CO(Q,W,$){let Y=Q.rules.findIndex((J)=>J.keyword===$);if(Y>=0)Q.rules.splice(Y,0,W);else Q.rules.push(W),this.logger.warn(`rule ${$} is not defined`)}function ZO(Q){let{metaSchema:W}=Q;if(W===void 0)return;if(Q.$data&&this.opts.$data)W=GH(W);Q.validateSchema=this.compile(W,!0)}var vO={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function GH(Q){return{anyOf:[Q,vO]}}});var BH=Z((V5)=>{Object.defineProperty(V5,"__esModule",{value:!0});var TO={keyword:"id",code(){throw Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};V5.default=TO});var LH=Z((x6)=>{Object.defineProperty(x6,"__esModule",{value:!0});x6.callRef=x6.getValidate=void 0;var kO=E9(),KH=H1(),t0=p(),S4=l1(),VH=KQ(),DQ=W0(),_O={keyword:"$ref",schemaType:"string",code(Q){let{gen:W,schema:$,it:Y}=Q,{baseId:J,schemaEnv:X,validateName:G,opts:H,self:B}=Y,{root:K}=X;if(($==="#"||$==="#/")&&J===K.baseId)return L();let F=VH.resolveRef.call(B,K,J,$);if(F===void 0)throw new kO.default(Y.opts.uriResolver,J,$);if(F instanceof VH.SchemaEnv)return U(F);return q(F);function L(){if(X===K)return OQ(Q,G,X,X.$async);let A=W.scopeValue("root",{ref:K});return OQ(Q,t0._`${A}.validate`,K,K.$async)}function U(A){let D=FH(Q,A);OQ(Q,D,A,A.$async)}function q(A){let D=W.scopeValue("schema",H.code.source===!0?{ref:A,code:(0,t0.stringify)(A)}:{ref:A}),O=W.name("valid"),w=Q.subschema({schema:A,dataTypes:[],schemaPath:t0.nil,topSchemaRef:D,errSchemaPath:$},O);Q.mergeEvaluated(w),Q.ok(O)}}};function FH(Q,W){let{gen:$}=Q;return W.validate?$.scopeValue("validate",{ref:W.validate}):t0._`${$.scopeValue("wrapper",{ref:W})}.validate`}x6.getValidate=FH;function OQ(Q,W,$,Y){let{gen:J,it:X}=Q,{allErrors:G,schemaEnv:H,opts:B}=X,K=B.passContext?S4.default.this:t0.nil;if(Y)F();else L();function F(){if(!H.$async)throw Error("async schema referenced by sync schema");let A=J.let("valid");J.try(()=>{if(J.code(t0._`await ${(0,KH.callValidateCode)(Q,W,K)}`),q(W),!G)J.assign(A,!0)},(D)=>{if(J.if(t0._`!(${D} instanceof ${X.ValidationError})`,()=>J.throw(D)),U(D),!G)J.assign(A,!1)}),Q.ok(A)}function L(){Q.result((0,KH.callValidateCode)(Q,W,K),()=>q(W),()=>U(W))}function U(A){let D=t0._`${A}.errors`;J.assign(S4.default.vErrors,t0._`${S4.default.vErrors} === null ? ${D} : ${S4.default.vErrors}.concat(${D})`),J.assign(S4.default.errors,t0._`${S4.default.vErrors}.length`)}function q(A){var D;if(!X.opts.unevaluated)return;let O=(D=$===null||$===void 0?void 0:$.validate)===null||D===void 0?void 0:D.evaluated;if(X.props!==!0)if(O&&!O.dynamicProps){if(O.props!==void 0)X.props=DQ.mergeEvaluated.props(J,O.props,X.props)}else{let w=J.var("props",t0._`${A}.evaluated.props`);X.props=DQ.mergeEvaluated.props(J,w,X.props,t0.Name)}if(X.items!==!0)if(O&&!O.dynamicItems){if(O.items!==void 0)X.items=DQ.mergeEvaluated.items(J,O.items,X.items)}else{let w=J.var("items",t0._`${A}.evaluated.items`);X.items=DQ.mergeEvaluated.items(J,w,X.items,t0.Name)}}}x6.callRef=OQ;x6.default=_O});var qH=Z((F5)=>{Object.defineProperty(F5,"__esModule",{value:!0});var xO=BH(),yO=LH(),gO=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",xO.default,yO.default];F5.default=gO});var UH=Z((L5)=>{Object.defineProperty(L5,"__esModule",{value:!0});var wQ=p(),A6=wQ.operators,NQ={maximum:{okStr:"<=",ok:A6.LTE,fail:A6.GT},minimum:{okStr:">=",ok:A6.GTE,fail:A6.LT},exclusiveMaximum:{okStr:"<",ok:A6.LT,fail:A6.GTE},exclusiveMinimum:{okStr:">",ok:A6.GT,fail:A6.LTE}},hO={message:({keyword:Q,schemaCode:W})=>wQ.str`must be ${NQ[Q].okStr} ${W}`,params:({keyword:Q,schemaCode:W})=>wQ._`{comparison: ${NQ[Q].okStr}, limit: ${W}}`},fO={keyword:Object.keys(NQ),type:"number",schemaType:"number",$data:!0,error:hO,code(Q){let{keyword:W,data:$,schemaCode:Y}=Q;Q.fail$data(wQ._`${$} ${NQ[W].fail} ${Y} || isNaN(${$})`)}};L5.default=fO});var AH=Z((q5)=>{Object.defineProperty(q5,"__esModule",{value:!0});var b9=p(),uO={message:({schemaCode:Q})=>b9.str`must be multiple of ${Q}`,params:({schemaCode:Q})=>b9._`{multipleOf: ${Q}}`},lO={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:uO,code(Q){let{gen:W,data:$,schemaCode:Y,it:J}=Q,X=J.opts.multipleOfPrecision,G=W.let("res"),H=X?b9._`Math.abs(Math.round(${G}) - ${G}) > 1e-${X}`:b9._`${G} !== parseInt(${G})`;Q.fail$data(b9._`(${Y} === 0 || (${G} = ${$}/${Y}, ${H}))`)}};q5.default=lO});var OH=Z((U5)=>{Object.defineProperty(U5,"__esModule",{value:!0});function DH(Q){let W=Q.length,$=0,Y=0,J;while(Y<W)if($++,J=Q.charCodeAt(Y++),J>=55296&&J<=56319&&Y<W){if(J=Q.charCodeAt(Y),(J&64512)===56320)Y++}return $}U5.default=DH;DH.code='require("ajv/dist/runtime/ucs2length").default'});var wH=Z((A5)=>{Object.defineProperty(A5,"__esModule",{value:!0});var y6=p(),mO=W0(),cO=OH(),pO={message({keyword:Q,schemaCode:W}){let $=Q==="maxLength"?"more":"fewer";return y6.str`must NOT have ${$} than ${W} characters`},params:({schemaCode:Q})=>y6._`{limit: ${Q}}`},dO={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:pO,code(Q){let{keyword:W,data:$,schemaCode:Y,it:J}=Q,X=W==="maxLength"?y6.operators.GT:y6.operators.LT,G=J.opts.unicode===!1?y6._`${$}.length`:y6._`${(0,mO.useFunc)(Q.gen,cO.default)}(${$})`;Q.fail$data(y6._`${G} ${X} ${Y}`)}};A5.default=dO});var NH=Z((D5)=>{Object.defineProperty(D5,"__esModule",{value:!0});var iO=H1(),MQ=p(),nO={message:({schemaCode:Q})=>MQ.str`must match pattern "${Q}"`,params:({schemaCode:Q})=>MQ._`{pattern: ${Q}}`},oO={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:nO,code(Q){let{data:W,$data:$,schema:Y,schemaCode:J,it:X}=Q,G=X.opts.unicodeRegExp?"u":"",H=$?MQ._`(new RegExp(${J}, ${G}))`:(0,iO.usePattern)(Q,Y);Q.fail$data(MQ._`!${H}.test(${W})`)}};D5.default=oO});var MH=Z((O5)=>{Object.defineProperty(O5,"__esModule",{value:!0});var C9=p(),rO={message({keyword:Q,schemaCode:W}){let $=Q==="maxProperties"?"more":"fewer";return C9.str`must NOT have ${$} than ${W} properties`},params:({schemaCode:Q})=>C9._`{limit: ${Q}}`},aO={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:rO,code(Q){let{keyword:W,data:$,schemaCode:Y}=Q,J=W==="maxProperties"?C9.operators.GT:C9.operators.LT;Q.fail$data(C9._`Object.keys(${$}).length ${J} ${Y}`)}};O5.default=aO});var jH=Z((w5)=>{Object.defineProperty(w5,"__esModule",{value:!0});var Z9=H1(),v9=p(),tO=W0(),sO={message:({params:{missingProperty:Q}})=>v9.str`must have required property '${Q}'`,params:({params:{missingProperty:Q}})=>v9._`{missingProperty: ${Q}}`},eO={keyword:"required",type:"object",schemaType:"array",$data:!0,error:sO,code(Q){let{gen:W,schema:$,schemaCode:Y,data:J,$data:X,it:G}=Q,{opts:H}=G;if(!X&&$.length===0)return;let B=$.length>=H.loopRequired;if(G.allErrors)K();else F();if(H.strictRequired){let q=Q.parentSchema.properties,{definedProperties:A}=Q.it;for(let D of $)if((q===null||q===void 0?void 0:q[D])===void 0&&!A.has(D)){let O=G.schemaEnv.baseId+G.errSchemaPath,w=`required property "${D}" is not defined at "${O}" (strictRequired)`;(0,tO.checkStrictMode)(G,w,G.opts.strictRequired)}}function K(){if(B||X)Q.block$data(v9.nil,L);else for(let q of $)(0,Z9.checkReportMissingProp)(Q,q)}function F(){let q=W.let("missing");if(B||X){let A=W.let("valid",!0);Q.block$data(A,()=>U(q,A)),Q.ok(A)}else W.if((0,Z9.checkMissingProp)(Q,$,q)),(0,Z9.reportMissingProp)(Q,q),W.else()}function L(){W.forOf("prop",Y,(q)=>{Q.setParams({missingProperty:q}),W.if((0,Z9.noPropertyInData)(W,J,q,H.ownProperties),()=>Q.error())})}function U(q,A){Q.setParams({missingProperty:q}),W.forOf(q,Y,()=>{W.assign(A,(0,Z9.propertyInData)(W,J,q,H.ownProperties)),W.if((0,v9.not)(A),()=>{Q.error(),W.break()})},v9.nil)}}};w5.default=eO});var zH=Z((N5)=>{Object.defineProperty(N5,"__esModule",{value:!0});var T9=p(),Qw={message({keyword:Q,schemaCode:W}){let $=Q==="maxItems"?"more":"fewer";return T9.str`must NOT have ${$} than ${W} items`},params:({schemaCode:Q})=>T9._`{limit: ${Q}}`},Ww={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:Qw,code(Q){let{keyword:W,data:$,schemaCode:Y}=Q,J=W==="maxItems"?T9.operators.GT:T9.operators.LT;Q.fail$data(T9._`${$}.length ${J} ${Y}`)}};N5.default=Ww});var jQ=Z((M5)=>{Object.defineProperty(M5,"__esModule",{value:!0});var EH=dY();EH.code='require("ajv/dist/runtime/equal").default';M5.default=EH});var PH=Z((z5)=>{Object.defineProperty(z5,"__esModule",{value:!0});var j5=w9(),_0=p(),$w=W0(),Yw=jQ(),Jw={message:({params:{i:Q,j:W}})=>_0.str`must NOT have duplicate items (items ## ${W} and ${Q} are identical)`,params:({params:{i:Q,j:W}})=>_0._`{i: ${Q}, j: ${W}}`},Xw={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:Jw,code(Q){let{gen:W,data:$,$data:Y,schema:J,parentSchema:X,schemaCode:G,it:H}=Q;if(!Y&&!J)return;let B=W.let("valid"),K=X.items?(0,j5.getSchemaTypes)(X.items):[];Q.block$data(B,F,_0._`${G} === false`),Q.ok(B);function F(){let A=W.let("i",_0._`${$}.length`),D=W.let("j");Q.setParams({i:A,j:D}),W.assign(B,!0),W.if(_0._`${A} > 1`,()=>(L()?U:q)(A,D))}function L(){return K.length>0&&!K.some((A)=>A==="object"||A==="array")}function U(A,D){let O=W.name("item"),w=(0,j5.checkDataTypes)(K,O,H.opts.strictNumbers,j5.DataType.Wrong),j=W.const("indices",_0._`{}`);W.for(_0._`;${A}--;`,()=>{if(W.let(O,_0._`${$}[${A}]`),W.if(w,_0._`continue`),K.length>1)W.if(_0._`typeof ${O} == "string"`,_0._`${O} += "_"`);W.if(_0._`typeof ${j}[${O}] == "number"`,()=>{W.assign(D,_0._`${j}[${O}]`),Q.error(),W.assign(B,!1).break()}).code(_0._`${j}[${O}] = ${A}`)})}function q(A,D){let O=(0,$w.useFunc)(W,Yw.default),w=W.name("outer");W.label(w).for(_0._`;${A}--;`,()=>W.for(_0._`${D} = ${A}; ${D}--;`,()=>W.if(_0._`${O}(${$}[${A}], ${$}[${D}])`,()=>{Q.error(),W.assign(B,!1).break(w)})))}}};z5.default=Xw});var RH=Z((P5)=>{Object.defineProperty(P5,"__esModule",{value:!0});var E5=p(),Gw=W0(),Hw=jQ(),Bw={message:"must be equal to constant",params:({schemaCode:Q})=>E5._`{allowedValue: ${Q}}`},Kw={keyword:"const",$data:!0,error:Bw,code(Q){let{gen:W,data:$,$data:Y,schemaCode:J,schema:X}=Q;if(Y||X&&typeof X=="object")Q.fail$data(E5._`!${(0,Gw.useFunc)(W,Hw.default)}(${$}, ${J})`);else Q.fail(E5._`${X} !== ${$}`)}};P5.default=Kw});var IH=Z((R5)=>{Object.defineProperty(R5,"__esModule",{value:!0});var k9=p(),Vw=W0(),Fw=jQ(),Lw={message:"must be equal to one of the allowed values",params:({schemaCode:Q})=>k9._`{allowedValues: ${Q}}`},qw={keyword:"enum",schemaType:"array",$data:!0,error:Lw,code(Q){let{gen:W,data:$,$data:Y,schema:J,schemaCode:X,it:G}=Q;if(!Y&&J.length===0)throw Error("enum must have non-empty array");let H=J.length>=G.opts.loopEnum,B,K=()=>B!==null&&B!==void 0?B:B=(0,Vw.useFunc)(W,Fw.default),F;if(H||Y)F=W.let("valid"),Q.block$data(F,L);else{if(!Array.isArray(J))throw Error("ajv implementation error");let q=W.const("vSchema",X);F=(0,k9.or)(...J.map((A,D)=>U(q,D)))}Q.pass(F);function L(){W.assign(F,!1),W.forOf("v",X,(q)=>W.if(k9._`${K()}(${$}, ${q})`,()=>W.assign(F,!0).break()))}function U(q,A){let D=J[A];return typeof D==="object"&&D!==null?k9._`${K()}(${$}, ${q}[${A}])`:k9._`${$} === ${D}`}}};R5.default=qw});var SH=Z((I5)=>{Object.defineProperty(I5,"__esModule",{value:!0});var Uw=UH(),Aw=AH(),Dw=wH(),Ow=NH(),ww=MH(),Nw=jH(),Mw=zH(),jw=PH(),zw=RH(),Ew=IH(),Pw=[Uw.default,Aw.default,Dw.default,Ow.default,ww.default,Nw.default,Mw.default,jw.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},zw.default,Ew.default];I5.default=Pw});var b5=Z((_9)=>{Object.defineProperty(_9,"__esModule",{value:!0});_9.validateAdditionalItems=void 0;var g6=p(),S5=W0(),Rw={message:({params:{len:Q}})=>g6.str`must NOT have more than ${Q} items`,params:({params:{len:Q}})=>g6._`{limit: ${Q}}`},Iw={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:Rw,code(Q){let{parentSchema:W,it:$}=Q,{items:Y}=W;if(!Array.isArray(Y)){(0,S5.checkStrictMode)($,'"additionalItems" is ignored when "items" is not an array of schemas');return}bH(Q,Y)}};function bH(Q,W){let{gen:$,schema:Y,data:J,keyword:X,it:G}=Q;G.items=!0;let H=$.const("len",g6._`${J}.length`);if(Y===!1)Q.setParams({len:W.length}),Q.pass(g6._`${H} <= ${W.length}`);else if(typeof Y=="object"&&!(0,S5.alwaysValidSchema)(G,Y)){let K=$.var("valid",g6._`${H} <= ${W.length}`);$.if((0,g6.not)(K),()=>B(K)),Q.ok(K)}function B(K){$.forRange("i",W.length,H,(F)=>{if(Q.subschema({keyword:X,dataProp:F,dataPropType:S5.Type.Num},K),!G.allErrors)$.if((0,g6.not)(K),()=>$.break())})}}_9.validateAdditionalItems=bH;_9.default=Iw});var C5=Z((x9)=>{Object.defineProperty(x9,"__esModule",{value:!0});x9.validateTuple=void 0;var CH=p(),zQ=W0(),Sw=H1(),bw={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(Q){let{schema:W,it:$}=Q;if(Array.isArray(W))return ZH(Q,"additionalItems",W);if($.items=!0,(0,zQ.alwaysValidSchema)($,W))return;Q.ok((0,Sw.validateArray)(Q))}};function ZH(Q,W,$=Q.schema){let{gen:Y,parentSchema:J,data:X,keyword:G,it:H}=Q;if(F(J),H.opts.unevaluated&&$.length&&H.items!==!0)H.items=zQ.mergeEvaluated.items(Y,$.length,H.items);let B=Y.name("valid"),K=Y.const("len",CH._`${X}.length`);$.forEach((L,U)=>{if((0,zQ.alwaysValidSchema)(H,L))return;Y.if(CH._`${K} > ${U}`,()=>Q.subschema({keyword:G,schemaProp:U,dataProp:U},B)),Q.ok(B)});function F(L){let{opts:U,errSchemaPath:q}=H,A=$.length,D=A===L.minItems&&(A===L.maxItems||L[W]===!1);if(U.strictTuples&&!D){let O=`"${G}" is ${A}-tuple, but minItems or maxItems/${W} are not specified or different at path "${q}"`;(0,zQ.checkStrictMode)(H,O,U.strictTuples)}}}x9.validateTuple=ZH;x9.default=bw});var vH=Z((Z5)=>{Object.defineProperty(Z5,"__esModule",{value:!0});var Cw=C5(),Zw={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:(Q)=>(0,Cw.validateTuple)(Q,"items")};Z5.default=Zw});var kH=Z((v5)=>{Object.defineProperty(v5,"__esModule",{value:!0});var TH=p(),vw=W0(),Tw=H1(),kw=b5(),_w={message:({params:{len:Q}})=>TH.str`must NOT have more than ${Q} items`,params:({params:{len:Q}})=>TH._`{limit: ${Q}}`},xw={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:_w,code(Q){let{schema:W,parentSchema:$,it:Y}=Q,{prefixItems:J}=$;if(Y.items=!0,(0,vw.alwaysValidSchema)(Y,W))return;if(J)(0,kw.validateAdditionalItems)(Q,J);else Q.ok((0,Tw.validateArray)(Q))}};v5.default=xw});var _H=Z((T5)=>{Object.defineProperty(T5,"__esModule",{value:!0});var K1=p(),EQ=W0(),yw={message:({params:{min:Q,max:W}})=>W===void 0?K1.str`must contain at least ${Q} valid item(s)`:K1.str`must contain at least ${Q} and no more than ${W} valid item(s)`,params:({params:{min:Q,max:W}})=>W===void 0?K1._`{minContains: ${Q}}`:K1._`{minContains: ${Q}, maxContains: ${W}}`},gw={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:yw,code(Q){let{gen:W,schema:$,parentSchema:Y,data:J,it:X}=Q,G,H,{minContains:B,maxContains:K}=Y;if(X.opts.next)G=B===void 0?1:B,H=K;else G=1;let F=W.const("len",K1._`${J}.length`);if(Q.setParams({min:G,max:H}),H===void 0&&G===0){(0,EQ.checkStrictMode)(X,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(H!==void 0&&G>H){(0,EQ.checkStrictMode)(X,'"minContains" > "maxContains" is always invalid'),Q.fail();return}if((0,EQ.alwaysValidSchema)(X,$)){let D=K1._`${F} >= ${G}`;if(H!==void 0)D=K1._`${D} && ${F} <= ${H}`;Q.pass(D);return}X.items=!0;let L=W.name("valid");if(H===void 0&&G===1)q(L,()=>W.if(L,()=>W.break()));else if(G===0){if(W.let(L,!0),H!==void 0)W.if(K1._`${J}.length > 0`,U)}else W.let(L,!1),U();Q.result(L,()=>Q.reset());function U(){let D=W.name("_valid"),O=W.let("count",0);q(D,()=>W.if(D,()=>A(O)))}function q(D,O){W.forRange("i",0,F,(w)=>{Q.subschema({keyword:"contains",dataProp:w,dataPropType:EQ.Type.Num,compositeRule:!0},D),O()})}function A(D){if(W.code(K1._`${D}++`),H===void 0)W.if(K1._`${D} >= ${G}`,()=>W.assign(L,!0).break());else if(W.if(K1._`${D} > ${H}`,()=>W.assign(L,!1).break()),G===1)W.assign(L,!0);else W.if(K1._`${D} >= ${G}`,()=>W.assign(L,!0))}}};T5.default=gw});var gH=Z((T1)=>{Object.defineProperty(T1,"__esModule",{value:!0});T1.validateSchemaDeps=T1.validatePropertyDeps=T1.error=void 0;var k5=p(),hw=W0(),y9=H1();T1.error={message:({params:{property:Q,depsCount:W,deps:$}})=>{let Y=W===1?"property":"properties";return k5.str`must have ${Y} ${$} when property ${Q} is present`},params:({params:{property:Q,depsCount:W,deps:$,missingProperty:Y}})=>k5._`{property: ${Q},
    missingProperty: ${Y},
    depsCount: ${W},
    deps: ${$}}`};var fw={keyword:"dependencies",type:"object",schemaType:"object",error:T1.error,code(Q){let[W,$]=uw(Q);xH(Q,W),yH(Q,$)}};function uw({schema:Q}){let W={},$={};for(let Y in Q){if(Y==="__proto__")continue;let J=Array.isArray(Q[Y])?W:$;J[Y]=Q[Y]}return[W,$]}function xH(Q,W=Q.schema){let{gen:$,data:Y,it:J}=Q;if(Object.keys(W).length===0)return;let X=$.let("missing");for(let G in W){let H=W[G];if(H.length===0)continue;let B=(0,y9.propertyInData)($,Y,G,J.opts.ownProperties);if(Q.setParams({property:G,depsCount:H.length,deps:H.join(", ")}),J.allErrors)$.if(B,()=>{for(let K of H)(0,y9.checkReportMissingProp)(Q,K)});else $.if(k5._`${B} && (${(0,y9.checkMissingProp)(Q,H,X)})`),(0,y9.reportMissingProp)(Q,X),$.else()}}T1.validatePropertyDeps=xH;function yH(Q,W=Q.schema){let{gen:$,data:Y,keyword:J,it:X}=Q,G=$.name("valid");for(let H in W){if((0,hw.alwaysValidSchema)(X,W[H]))continue;$.if((0,y9.propertyInData)($,Y,H,X.opts.ownProperties),()=>{let B=Q.subschema({keyword:J,schemaProp:H},G);Q.mergeValidEvaluated(B,G)},()=>$.var(G,!0)),Q.ok(G)}}T1.validateSchemaDeps=yH;T1.default=fw});var fH=Z((_5)=>{Object.defineProperty(_5,"__esModule",{value:!0});var hH=p(),lw=W0(),mw={message:"property name must be valid",params:({params:Q})=>hH._`{propertyName: ${Q.propertyName}}`},cw={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:mw,code(Q){let{gen:W,schema:$,data:Y,it:J}=Q;if((0,lw.alwaysValidSchema)(J,$))return;let X=W.name("valid");W.forIn("key",Y,(G)=>{Q.setParams({propertyName:G}),Q.subschema({keyword:"propertyNames",data:G,dataTypes:["string"],propertyName:G,compositeRule:!0},X),W.if((0,hH.not)(X),()=>{if(Q.error(!0),!J.allErrors)W.break()})}),Q.ok(X)}};_5.default=cw});var y5=Z((x5)=>{Object.defineProperty(x5,"__esModule",{value:!0});var PQ=H1(),j1=p(),pw=l1(),RQ=W0(),dw={message:"must NOT have additional properties",params:({params:Q})=>j1._`{additionalProperty: ${Q.additionalProperty}}`},iw={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:dw,code(Q){let{gen:W,schema:$,parentSchema:Y,data:J,errsCount:X,it:G}=Q;if(!X)throw Error("ajv implementation error");let{allErrors:H,opts:B}=G;if(G.props=!0,B.removeAdditional!=="all"&&(0,RQ.alwaysValidSchema)(G,$))return;let K=(0,PQ.allSchemaProperties)(Y.properties),F=(0,PQ.allSchemaProperties)(Y.patternProperties);L(),Q.ok(j1._`${X} === ${pw.default.errors}`);function L(){W.forIn("key",J,(O)=>{if(!K.length&&!F.length)A(O);else W.if(U(O),()=>A(O))})}function U(O){let w;if(K.length>8){let j=(0,RQ.schemaRefOrVal)(G,Y.properties,"properties");w=(0,PQ.isOwnProperty)(W,j,O)}else if(K.length)w=(0,j1.or)(...K.map((j)=>j1._`${O} === ${j}`));else w=j1.nil;if(F.length)w=(0,j1.or)(w,...F.map((j)=>j1._`${(0,PQ.usePattern)(Q,j)}.test(${O})`));return(0,j1.not)(w)}function q(O){W.code(j1._`delete ${J}[${O}]`)}function A(O){if(B.removeAdditional==="all"||B.removeAdditional&&$===!1){q(O);return}if($===!1){if(Q.setParams({additionalProperty:O}),Q.error(),!H)W.break();return}if(typeof $=="object"&&!(0,RQ.alwaysValidSchema)(G,$)){let w=W.name("valid");if(B.removeAdditional==="failing")D(O,w,!1),W.if((0,j1.not)(w),()=>{Q.reset(),q(O)});else if(D(O,w),!H)W.if((0,j1.not)(w),()=>W.break())}}function D(O,w,j){let z={keyword:"additionalProperties",dataProp:O,dataPropType:RQ.Type.Str};if(j===!1)Object.assign(z,{compositeRule:!0,createErrors:!1,allErrors:!1});Q.subschema(z,w)}}};x5.default=iw});var mH=Z((h5)=>{Object.defineProperty(h5,"__esModule",{value:!0});var nw=z9(),uH=H1(),g5=W0(),lH=y5(),ow={keyword:"properties",type:"object",schemaType:"object",code(Q){let{gen:W,schema:$,parentSchema:Y,data:J,it:X}=Q;if(X.opts.removeAdditional==="all"&&Y.additionalProperties===void 0)lH.default.code(new nw.KeywordCxt(X,lH.default,"additionalProperties"));let G=(0,uH.allSchemaProperties)($);for(let L of G)X.definedProperties.add(L);if(X.opts.unevaluated&&G.length&&X.props!==!0)X.props=g5.mergeEvaluated.props(W,(0,g5.toHash)(G),X.props);let H=G.filter((L)=>!(0,g5.alwaysValidSchema)(X,$[L]));if(H.length===0)return;let B=W.name("valid");for(let L of H){if(K(L))F(L);else{if(W.if((0,uH.propertyInData)(W,J,L,X.opts.ownProperties)),F(L),!X.allErrors)W.else().var(B,!0);W.endIf()}Q.it.definedProperties.add(L),Q.ok(B)}function K(L){return X.opts.useDefaults&&!X.compositeRule&&$[L].default!==void 0}function F(L){Q.subschema({keyword:"properties",schemaProp:L,dataProp:L},B)}}};h5.default=ow});var iH=Z((f5)=>{Object.defineProperty(f5,"__esModule",{value:!0});var cH=H1(),IQ=p(),pH=W0(),dH=W0(),rw={keyword:"patternProperties",type:"object",schemaType:"object",code(Q){let{gen:W,schema:$,data:Y,parentSchema:J,it:X}=Q,{opts:G}=X,H=(0,cH.allSchemaProperties)($),B=H.filter((D)=>(0,pH.alwaysValidSchema)(X,$[D]));if(H.length===0||B.length===H.length&&(!X.opts.unevaluated||X.props===!0))return;let K=G.strictSchema&&!G.allowMatchingProperties&&J.properties,F=W.name("valid");if(X.props!==!0&&!(X.props instanceof IQ.Name))X.props=(0,dH.evaluatedPropsToName)(W,X.props);let{props:L}=X;U();function U(){for(let D of H){if(K)q(D);if(X.allErrors)A(D);else W.var(F,!0),A(D),W.if(F)}}function q(D){for(let O in K)if(new RegExp(D).test(O))(0,pH.checkStrictMode)(X,`property ${O} matches pattern ${D} (use allowMatchingProperties)`)}function A(D){W.forIn("key",Y,(O)=>{W.if(IQ._`${(0,cH.usePattern)(Q,D)}.test(${O})`,()=>{let w=B.includes(D);if(!w)Q.subschema({keyword:"patternProperties",schemaProp:D,dataProp:O,dataPropType:dH.Type.Str},F);if(X.opts.unevaluated&&L!==!0)W.assign(IQ._`${L}[${O}]`,!0);else if(!w&&!X.allErrors)W.if((0,IQ.not)(F),()=>W.break())})})}}};f5.default=rw});var nH=Z((u5)=>{Object.defineProperty(u5,"__esModule",{value:!0});var aw=W0(),tw={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(Q){let{gen:W,schema:$,it:Y}=Q;if((0,aw.alwaysValidSchema)(Y,$)){Q.fail();return}let J=W.name("valid");Q.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},J),Q.failResult(J,()=>Q.reset(),()=>Q.error())},error:{message:"must NOT be valid"}};u5.default=tw});var oH=Z((l5)=>{Object.defineProperty(l5,"__esModule",{value:!0});var sw=H1(),ew={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:sw.validateUnion,error:{message:"must match a schema in anyOf"}};l5.default=ew});var rH=Z((m5)=>{Object.defineProperty(m5,"__esModule",{value:!0});var SQ=p(),QN=W0(),WN={message:"must match exactly one schema in oneOf",params:({params:Q})=>SQ._`{passingSchemas: ${Q.passing}}`},$N={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:WN,code(Q){let{gen:W,schema:$,parentSchema:Y,it:J}=Q;if(!Array.isArray($))throw Error("ajv implementation error");if(J.opts.discriminator&&Y.discriminator)return;let X=$,G=W.let("valid",!1),H=W.let("passing",null),B=W.name("_valid");Q.setParams({passing:H}),W.block(K),Q.result(G,()=>Q.reset(),()=>Q.error(!0));function K(){X.forEach((F,L)=>{let U;if((0,QN.alwaysValidSchema)(J,F))W.var(B,!0);else U=Q.subschema({keyword:"oneOf",schemaProp:L,compositeRule:!0},B);if(L>0)W.if(SQ._`${B} && ${G}`).assign(G,!1).assign(H,SQ._`[${H}, ${L}]`).else();W.if(B,()=>{if(W.assign(G,!0),W.assign(H,L),U)Q.mergeEvaluated(U,SQ.Name)})})}}};m5.default=$N});var aH=Z((c5)=>{Object.defineProperty(c5,"__esModule",{value:!0});var YN=W0(),JN={keyword:"allOf",schemaType:"array",code(Q){let{gen:W,schema:$,it:Y}=Q;if(!Array.isArray($))throw Error("ajv implementation error");let J=W.name("valid");$.forEach((X,G)=>{if((0,YN.alwaysValidSchema)(Y,X))return;let H=Q.subschema({keyword:"allOf",schemaProp:G},J);Q.ok(J),Q.mergeEvaluated(H)})}};c5.default=JN});var eH=Z((p5)=>{Object.defineProperty(p5,"__esModule",{value:!0});var bQ=p(),sH=W0(),XN={message:({params:Q})=>bQ.str`must match "${Q.ifClause}" schema`,params:({params:Q})=>bQ._`{failingKeyword: ${Q.ifClause}}`},GN={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:XN,code(Q){let{gen:W,parentSchema:$,it:Y}=Q;if($.then===void 0&&$.else===void 0)(0,sH.checkStrictMode)(Y,'"if" without "then" and "else" is ignored');let J=tH(Y,"then"),X=tH(Y,"else");if(!J&&!X)return;let G=W.let("valid",!0),H=W.name("_valid");if(B(),Q.reset(),J&&X){let F=W.let("ifClause");Q.setParams({ifClause:F}),W.if(H,K("then",F),K("else",F))}else if(J)W.if(H,K("then"));else W.if((0,bQ.not)(H),K("else"));Q.pass(G,()=>Q.error(!0));function B(){let F=Q.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},H);Q.mergeEvaluated(F)}function K(F,L){return()=>{let U=Q.subschema({keyword:F},H);if(W.assign(G,H),Q.mergeValidEvaluated(U,G),L)W.assign(L,bQ._`${F}`);else Q.setParams({ifClause:F})}}}};function tH(Q,W){let $=Q.schema[W];return $!==void 0&&!(0,sH.alwaysValidSchema)(Q,$)}p5.default=GN});var QB=Z((d5)=>{Object.defineProperty(d5,"__esModule",{value:!0});var HN=W0(),BN={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:Q,parentSchema:W,it:$}){if(W.if===void 0)(0,HN.checkStrictMode)($,`"${Q}" without "if" is ignored`)}};d5.default=BN});var WB=Z((i5)=>{Object.defineProperty(i5,"__esModule",{value:!0});var KN=b5(),VN=vH(),FN=C5(),LN=kH(),qN=_H(),UN=gH(),AN=fH(),DN=y5(),ON=mH(),wN=iH(),NN=nH(),MN=oH(),jN=rH(),zN=aH(),EN=eH(),PN=QB();function RN(Q=!1){let W=[NN.default,MN.default,jN.default,zN.default,EN.default,PN.default,AN.default,DN.default,UN.default,ON.default,wN.default];if(Q)W.push(VN.default,LN.default);else W.push(KN.default,FN.default);return W.push(qN.default),W}i5.default=RN});var $B=Z((n5)=>{Object.defineProperty(n5,"__esModule",{value:!0});var z0=p(),IN={message:({schemaCode:Q})=>z0.str`must match format "${Q}"`,params:({schemaCode:Q})=>z0._`{format: ${Q}}`},SN={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:IN,code(Q,W){let{gen:$,data:Y,$data:J,schema:X,schemaCode:G,it:H}=Q,{opts:B,errSchemaPath:K,schemaEnv:F,self:L}=H;if(!B.validateFormats)return;if(J)U();else q();function U(){let A=$.scopeValue("formats",{ref:L.formats,code:B.code.formats}),D=$.const("fDef",z0._`${A}[${G}]`),O=$.let("fType"),w=$.let("format");$.if(z0._`typeof ${D} == "object" && !(${D} instanceof RegExp)`,()=>$.assign(O,z0._`${D}.type || "string"`).assign(w,z0._`${D}.validate`),()=>$.assign(O,z0._`"string"`).assign(w,D)),Q.fail$data((0,z0.or)(j(),z()));function j(){if(B.strictSchema===!1)return z0.nil;return z0._`${G} && !${w}`}function z(){let C=F.$async?z0._`(${D}.async ? await ${w}(${Y}) : ${w}(${Y}))`:z0._`${w}(${Y})`,b=z0._`(typeof ${w} == "function" ? ${C} : ${w}.test(${Y}))`;return z0._`${w} && ${w} !== true && ${O} === ${W} && !${b}`}}function q(){let A=L.formats[X];if(!A){j();return}if(A===!0)return;let[D,O,w]=z(A);if(D===W)Q.pass(C());function j(){if(B.strictSchema===!1){L.logger.warn(b());return}throw Error(b());function b(){return`unknown format "${X}" ignored in schema at path "${K}"`}}function z(b){let D0=b instanceof RegExp?(0,z0.regexpCode)(b):B.code.formats?z0._`${B.code.formats}${(0,z0.getProperty)(X)}`:void 0,S0=$.scopeValue("formats",{key:X,ref:b,code:D0});if(typeof b=="object"&&!(b instanceof RegExp))return[b.type||"string",b.validate,z0._`${S0}.validate`];return["string",b,S0]}function C(){if(typeof A=="object"&&!(A instanceof RegExp)&&A.async){if(!F.$async)throw Error("async format in sync schema");return z0._`await ${w}(${Y})`}return typeof O=="function"?z0._`${w}(${Y})`:z0._`${w}.test(${Y})`}}}};n5.default=SN});var YB=Z((o5)=>{Object.defineProperty(o5,"__esModule",{value:!0});var bN=$B(),CN=[bN.default];o5.default=CN});var JB=Z((b4)=>{Object.defineProperty(b4,"__esModule",{value:!0});b4.contentVocabulary=b4.metadataVocabulary=void 0;b4.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];b4.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var GB=Z((r5)=>{Object.defineProperty(r5,"__esModule",{value:!0});var ZN=qH(),vN=SH(),TN=WB(),kN=YB(),XB=JB(),_N=[ZN.default,vN.default,(0,TN.default)(),kN.default,XB.metadataVocabulary,XB.contentVocabulary];r5.default=_N});var BB=Z((CQ)=>{Object.defineProperty(CQ,"__esModule",{value:!0});CQ.DiscrError=void 0;var HB;(function(Q){Q.Tag="tag",Q.Mapping="mapping"})(HB||(CQ.DiscrError=HB={}))});var VB=Z((t5)=>{Object.defineProperty(t5,"__esModule",{value:!0});var C4=p(),a5=BB(),KB=KQ(),xN=E9(),yN=W0(),gN={message:({params:{discrError:Q,tagName:W}})=>Q===a5.DiscrError.Tag?`tag "${W}" must be string`:`value of tag "${W}" must be in oneOf`,params:({params:{discrError:Q,tag:W,tagName:$}})=>C4._`{error: ${Q}, tag: ${$}, tagValue: ${W}}`},hN={keyword:"discriminator",type:"object",schemaType:"object",error:gN,code(Q){let{gen:W,data:$,schema:Y,parentSchema:J,it:X}=Q,{oneOf:G}=J;if(!X.opts.discriminator)throw Error("discriminator: requires discriminator option");let H=Y.propertyName;if(typeof H!="string")throw Error("discriminator: requires propertyName");if(Y.mapping)throw Error("discriminator: mapping is not supported");if(!G)throw Error("discriminator: requires oneOf keyword");let B=W.let("valid",!1),K=W.const("tag",C4._`${$}${(0,C4.getProperty)(H)}`);W.if(C4._`typeof ${K} == "string"`,()=>F(),()=>Q.error(!1,{discrError:a5.DiscrError.Tag,tag:K,tagName:H})),Q.ok(B);function F(){let q=U();W.if(!1);for(let A in q)W.elseIf(C4._`${K} === ${A}`),W.assign(B,L(q[A]));W.else(),Q.error(!1,{discrError:a5.DiscrError.Mapping,tag:K,tagName:H}),W.endIf()}function L(q){let A=W.name("valid"),D=Q.subschema({keyword:"oneOf",schemaProp:q},A);return Q.mergeEvaluated(D,C4.Name),A}function U(){var q;let A={},D=w(J),O=!0;for(let C=0;C<G.length;C++){let b=G[C];if((b===null||b===void 0?void 0:b.$ref)&&!(0,yN.schemaHasRulesButRef)(b,X.self.RULES)){let S0=b.$ref;if(b=KB.resolveRef.call(X.self,X.schemaEnv.root,X.baseId,S0),b instanceof KB.SchemaEnv)b=b.schema;if(b===void 0)throw new xN.default(X.opts.uriResolver,X.baseId,S0)}let D0=(q=b===null||b===void 0?void 0:b.properties)===null||q===void 0?void 0:q[H];if(typeof D0!="object")throw Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${H}"`);O=O&&(D||w(b)),j(D0,C)}if(!O)throw Error(`discriminator: "${H}" must be required`);return A;function w({required:C}){return Array.isArray(C)&&C.includes(H)}function j(C,b){if(C.const)z(C.const,b);else if(C.enum)for(let D0 of C.enum)z(D0,b);else throw Error(`discriminator: "properties/${H}" must have "const" or "enum"`)}function z(C,b){if(typeof C!="string"||C in A)throw Error(`discriminator: "${H}" values must be unique strings`);A[C]=b}}}};t5.default=hN});var FB=Z((p2,fN)=>{fN.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var e5=Z((F0,s5)=>{Object.defineProperty(F0,"__esModule",{value:!0});F0.MissingRefError=F0.ValidationError=F0.CodeGen=F0.Name=F0.nil=F0.stringify=F0.str=F0._=F0.KeywordCxt=F0.Ajv=void 0;var uN=HH(),lN=GB(),mN=VB(),LB=FB(),cN=["/properties"],ZQ="http://json-schema.org/draft-07/schema";class g9 extends uN.default{_addVocabularies(){if(super._addVocabularies(),lN.default.forEach((Q)=>this.addVocabulary(Q)),this.opts.discriminator)this.addKeyword(mN.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let Q=this.opts.$data?this.$dataMetaSchema(LB,cN):LB;this.addMetaSchema(Q,ZQ,!1),this.refs["http://json-schema.org/schema"]=ZQ}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(ZQ)?ZQ:void 0)}}F0.Ajv=g9;s5.exports=F0=g9;s5.exports.Ajv=g9;Object.defineProperty(F0,"__esModule",{value:!0});F0.default=g9;var pN=z9();Object.defineProperty(F0,"KeywordCxt",{enumerable:!0,get:function(){return pN.KeywordCxt}});var Z4=p();Object.defineProperty(F0,"_",{enumerable:!0,get:function(){return Z4._}});Object.defineProperty(F0,"str",{enumerable:!0,get:function(){return Z4.str}});Object.defineProperty(F0,"stringify",{enumerable:!0,get:function(){return Z4.stringify}});Object.defineProperty(F0,"nil",{enumerable:!0,get:function(){return Z4.nil}});Object.defineProperty(F0,"Name",{enumerable:!0,get:function(){return Z4.Name}});Object.defineProperty(F0,"CodeGen",{enumerable:!0,get:function(){return Z4.CodeGen}});var dN=HQ();Object.defineProperty(F0,"ValidationError",{enumerable:!0,get:function(){return dN.default}});var iN=E9();Object.defineProperty(F0,"MissingRefError",{enumerable:!0,get:function(){return iN.default}})});var MB=Z((_1)=>{Object.defineProperty(_1,"__esModule",{value:!0});_1.formatNames=_1.fastFormats=_1.fullFormats=void 0;function k1(Q,W){return{validate:Q,compare:W}}_1.fullFormats={date:k1(DB,Y7),time:k1(W7(!0),J7),"date-time":k1(qB(!0),wB),"iso-time":k1(W7(),OB),"iso-date-time":k1(qB(),NB),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:sN,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:XM,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:eN,int32:{type:"number",validate:$M},int64:{type:"number",validate:YM},float:{type:"number",validate:AB},double:{type:"number",validate:AB},password:!0,binary:!0};_1.fastFormats={..._1.fullFormats,date:k1(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,Y7),time:k1(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,J7),"date-time":k1(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,wB),"iso-time":k1(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,OB),"iso-date-time":k1(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,NB),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};_1.formatNames=Object.keys(_1.fullFormats);function nN(Q){return Q%4===0&&(Q%100!==0||Q%400===0)}var oN=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,rN=[0,31,28,31,30,31,30,31,31,30,31,30,31];function DB(Q){let W=oN.exec(Q);if(!W)return!1;let $=+W[1],Y=+W[2],J=+W[3];return Y>=1&&Y<=12&&J>=1&&J<=(Y===2&&nN($)?29:rN[Y])}function Y7(Q,W){if(!(Q&&W))return;if(Q>W)return 1;if(Q<W)return-1;return 0}var Q7=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function W7(Q){return function($){let Y=Q7.exec($);if(!Y)return!1;let J=+Y[1],X=+Y[2],G=+Y[3],H=Y[4],B=Y[5]==="-"?-1:1,K=+(Y[6]||0),F=+(Y[7]||0);if(K>23||F>59||Q&&!H)return!1;if(J<=23&&X<=59&&G<60)return!0;let L=X-F*B,U=J-K*B-(L<0?1:0);return(U===23||U===-1)&&(L===59||L===-1)&&G<61}}function J7(Q,W){if(!(Q&&W))return;let $=new Date("2020-01-01T"+Q).valueOf(),Y=new Date("2020-01-01T"+W).valueOf();if(!($&&Y))return;return $-Y}function OB(Q,W){if(!(Q&&W))return;let $=Q7.exec(Q),Y=Q7.exec(W);if(!($&&Y))return;if(Q=$[1]+$[2]+$[3],W=Y[1]+Y[2]+Y[3],Q>W)return 1;if(Q<W)return-1;return 0}var $7=/t|\s/i;function qB(Q){let W=W7(Q);return function(Y){let J=Y.split($7);return J.length===2&&DB(J[0])&&W(J[1])}}function wB(Q,W){if(!(Q&&W))return;let $=new Date(Q).valueOf(),Y=new Date(W).valueOf();if(!($&&Y))return;return $-Y}function NB(Q,W){if(!(Q&&W))return;let[$,Y]=Q.split($7),[J,X]=W.split($7),G=Y7($,J);if(G===void 0)return;return G||J7(Y,X)}var aN=/\/|:/,tN=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function sN(Q){return aN.test(Q)&&tN.test(Q)}var UB=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function eN(Q){return UB.lastIndex=0,UB.test(Q)}var QM=-2147483648,WM=2147483647;function $M(Q){return Number.isInteger(Q)&&Q<=WM&&Q>=QM}function YM(Q){return Number.isInteger(Q)}function AB(){return!0}var JM=/[^\\]\\Z/;function XM(Q){if(JM.test(Q))return!1;try{return new RegExp(Q),!0}catch(W){return!1}}});var jB=Z((v4)=>{Object.defineProperty(v4,"__esModule",{value:!0});v4.formatLimitDefinition=void 0;var GM=e5(),z1=p(),D6=z1.operators,vQ={formatMaximum:{okStr:"<=",ok:D6.LTE,fail:D6.GT},formatMinimum:{okStr:">=",ok:D6.GTE,fail:D6.LT},formatExclusiveMaximum:{okStr:"<",ok:D6.LT,fail:D6.GTE},formatExclusiveMinimum:{okStr:">",ok:D6.GT,fail:D6.LTE}},HM={message:({keyword:Q,schemaCode:W})=>z1.str`should be ${vQ[Q].okStr} ${W}`,params:({keyword:Q,schemaCode:W})=>z1._`{comparison: ${vQ[Q].okStr}, limit: ${W}}`};v4.formatLimitDefinition={keyword:Object.keys(vQ),type:"string",schemaType:"string",$data:!0,error:HM,code(Q){let{gen:W,data:$,schemaCode:Y,keyword:J,it:X}=Q,{opts:G,self:H}=X;if(!G.validateFormats)return;let B=new GM.KeywordCxt(X,H.RULES.all.format.definition,"format");if(B.$data)K();else F();function K(){let U=W.scopeValue("formats",{ref:H.formats,code:G.code.formats}),q=W.const("fmt",z1._`${U}[${B.schemaCode}]`);Q.fail$data((0,z1.or)(z1._`typeof ${q} != "object"`,z1._`${q} instanceof RegExp`,z1._`typeof ${q}.compare != "function"`,L(q)))}function F(){let U=B.schema,q=H.formats[U];if(!q||q===!0)return;if(typeof q!="object"||q instanceof RegExp||typeof q.compare!="function")throw Error(`"${J}": format "${U}" does not define "compare" function`);let A=W.scopeValue("formats",{key:U,ref:q,code:G.code.formats?z1._`${G.code.formats}${(0,z1.getProperty)(U)}`:void 0});Q.fail$data(L(A))}function L(U){return z1._`${U}.compare(${$}, ${Y}) ${vQ[J].fail} 0`}},dependencies:["format"]};var BM=(Q)=>{return Q.addKeyword(v4.formatLimitDefinition),Q};v4.default=BM});var RB=Z((h9,PB)=>{Object.defineProperty(h9,"__esModule",{value:!0});var T4=MB(),KM=jB(),X7=p(),zB=new X7.Name("fullFormats"),VM=new X7.Name("fastFormats"),G7=(Q,W={keywords:!0})=>{if(Array.isArray(W))return EB(Q,W,T4.fullFormats,zB),Q;let[$,Y]=W.mode==="fast"?[T4.fastFormats,VM]:[T4.fullFormats,zB],J=W.formats||T4.formatNames;if(EB(Q,J,$,Y),W.keywords)(0,KM.default)(Q);return Q};G7.get=(Q,W="full")=>{let Y=(W==="fast"?T4.fastFormats:T4.fullFormats)[Q];if(!Y)throw Error(`Unknown format "${Q}"`);return Y};function EB(Q,W,$,Y){var J,X;(J=(X=Q.opts.code).formats)!==null&&J!==void 0||(X.formats=X7._`require("ajv-formats/dist/formats").${Y}`);for(let G of W)Q.addFormat(G,$[G])}PB.exports=h9=G7;Object.defineProperty(h9,"__esModule",{value:!0});h9.default=G7});var T7={name:"blockbench-mcp",version:"1.4.0",description:"Blockbench MCP server plugin",keywords:["Blockbench","MCP"],license:"GPL-3.0-only",author:"Jason J. Gardner",type:"module",main:"dist/mcp.js",scripts:{test:'echo "Error: no test specified" && exit 1',dev:"bun run ./build.ts --sourcemap","dev:watch":"bun run dev --watch",build:"bun run ./build.ts --minify",inspect:"bunx @modelcontextprotocol/inspector"},dependencies:{zod:"^3.25.76"},devDependencies:{"@types/express":"^5.0.6","blockbench-types":"^5.0.6",typescript:"^5.9.3","@modelcontextprotocol/sdk":"^1.25.1","@types/bun":"^1.3.5",tinycolor2:"^1.6.0"}};var n6=T7.version,K0="stable",g="experimental";var V={};uQ(V,{void:()=>HV,util:()=>o,unknown:()=>XV,union:()=>VV,undefined:()=>$V,tuple:()=>qV,transformer:()=>EV,symbol:()=>WV,string:()=>l7,strictObject:()=>KV,setErrorMap:()=>IK,set:()=>DV,record:()=>UV,quotelessJson:()=>PK,promise:()=>zV,preprocess:()=>IV,pipeline:()=>SV,ostring:()=>bV,optional:()=>PV,onumber:()=>CV,oboolean:()=>ZV,objectUtil:()=>lQ,object:()=>pQ,number:()=>m7,nullable:()=>RV,null:()=>YV,never:()=>GV,nativeEnum:()=>jV,nan:()=>sK,map:()=>AV,makeIssue:()=>h4,literal:()=>NV,lazy:()=>wV,late:()=>aK,isValid:()=>o1,isDirty:()=>a9,isAsync:()=>r6,isAborted:()=>r9,intersection:()=>LV,instanceof:()=>tK,getParsedType:()=>R1,getErrorMap:()=>o6,function:()=>OV,enum:()=>MV,effect:()=>EV,discriminatedUnion:()=>FV,defaultErrorMap:()=>y1,datetimeRegex:()=>h7,date:()=>QV,custom:()=>u7,coerce:()=>vV,boolean:()=>c7,bigint:()=>eK,array:()=>BV,any:()=>JV,addIssueToContext:()=>S,ZodVoid:()=>u4,ZodUnknown:()=>r1,ZodUnion:()=>W4,ZodUndefined:()=>e6,ZodType:()=>d,ZodTuple:()=>S1,ZodTransformer:()=>q1,ZodSymbol:()=>f4,ZodString:()=>V1,ZodSet:()=>z6,ZodSchema:()=>d,ZodRecord:()=>l4,ZodReadonly:()=>B4,ZodPromise:()=>E6,ZodPipeline:()=>p4,ZodParsedType:()=>I,ZodOptional:()=>e0,ZodObject:()=>O0,ZodNumber:()=>a1,ZodNullable:()=>h1,ZodNull:()=>Q4,ZodNever:()=>I1,ZodNativeEnum:()=>X4,ZodNaN:()=>c4,ZodMap:()=>m4,ZodLiteral:()=>J4,ZodLazy:()=>Y4,ZodIssueCode:()=>E,ZodIntersection:()=>$4,ZodFunction:()=>t6,ZodFirstPartyTypeKind:()=>P,ZodError:()=>i0,ZodEnum:()=>s1,ZodEffects:()=>q1,ZodDiscriminatedUnion:()=>t9,ZodDefault:()=>G4,ZodDate:()=>M6,ZodCatch:()=>H4,ZodBranded:()=>s9,ZodBoolean:()=>s6,ZodBigInt:()=>t1,ZodArray:()=>F1,ZodAny:()=>j6,Schema:()=>d,ParseStatus:()=>b0,OK:()=>x0,NEVER:()=>TV,INVALID:()=>h,EMPTY_PATH:()=>SK,DIRTY:()=>N6,BRAND:()=>rK});var o;(function(Q){Q.assertEqual=(J)=>{};function W(J){}Q.assertIs=W;function $(J){throw Error()}Q.assertNever=$,Q.arrayToEnum=(J)=>{let X={};for(let G of J)X[G]=G;return X},Q.getValidEnumValues=(J)=>{let X=Q.objectKeys(J).filter((H)=>typeof J[J[H]]!=="number"),G={};for(let H of X)G[H]=J[H];return Q.objectValues(G)},Q.objectValues=(J)=>{return Q.objectKeys(J).map(function(X){return J[X]})},Q.objectKeys=typeof Object.keys==="function"?(J)=>Object.keys(J):(J)=>{let X=[];for(let G in J)if(Object.prototype.hasOwnProperty.call(J,G))X.push(G);return X},Q.find=(J,X)=>{for(let G of J)if(X(G))return G;return},Q.isInteger=typeof Number.isInteger==="function"?(J)=>Number.isInteger(J):(J)=>typeof J==="number"&&Number.isFinite(J)&&Math.floor(J)===J;function Y(J,X=" | "){return J.map((G)=>typeof G==="string"?`'${G}'`:G).join(X)}Q.joinValues=Y,Q.jsonStringifyReplacer=(J,X)=>{if(typeof X==="bigint")return X.toString();return X}})(o||(o={}));var lQ;(function(Q){Q.mergeShapes=(W,$)=>{return{...W,...$}}})(lQ||(lQ={}));var I=o.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),R1=(Q)=>{switch(typeof Q){case"undefined":return I.undefined;case"string":return I.string;case"number":return Number.isNaN(Q)?I.nan:I.number;case"boolean":return I.boolean;case"function":return I.function;case"bigint":return I.bigint;case"symbol":return I.symbol;case"object":if(Array.isArray(Q))return I.array;if(Q===null)return I.null;if(Q.then&&typeof Q.then==="function"&&Q.catch&&typeof Q.catch==="function")return I.promise;if(typeof Map<"u"&&Q instanceof Map)return I.map;if(typeof Set<"u"&&Q instanceof Set)return I.set;if(typeof Date<"u"&&Q instanceof Date)return I.date;return I.object;default:return I.unknown}};var E=o.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),PK=(Q)=>{return JSON.stringify(Q,null,2).replace(/"([^"]+)":/g,"$1:")};class i0 extends Error{get errors(){return this.issues}constructor(Q){super();this.issues=[],this.addIssue=($)=>{this.issues=[...this.issues,$]},this.addIssues=($=[])=>{this.issues=[...this.issues,...$]};let W=new.target.prototype;if(Object.setPrototypeOf)Object.setPrototypeOf(this,W);else this.__proto__=W;this.name="ZodError",this.issues=Q}format(Q){let W=Q||function(J){return J.message},$={_errors:[]},Y=(J)=>{for(let X of J.issues)if(X.code==="invalid_union")X.unionErrors.map(Y);else if(X.code==="invalid_return_type")Y(X.returnTypeError);else if(X.code==="invalid_arguments")Y(X.argumentsError);else if(X.path.length===0)$._errors.push(W(X));else{let G=$,H=0;while(H<X.path.length){let B=X.path[H];if(H!==X.path.length-1)G[B]=G[B]||{_errors:[]};else G[B]=G[B]||{_errors:[]},G[B]._errors.push(W(X));G=G[B],H++}}};return Y(this),$}static assert(Q){if(!(Q instanceof i0))throw Error(`Not a ZodError: ${Q}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,o.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(Q=(W)=>W.message){let W={},$=[];for(let Y of this.issues)if(Y.path.length>0){let J=Y.path[0];W[J]=W[J]||[],W[J].push(Q(Y))}else $.push(Q(Y));return{formErrors:$,fieldErrors:W}}get formErrors(){return this.flatten()}}i0.create=(Q)=>{return new i0(Q)};var RK=(Q,W)=>{let $;switch(Q.code){case E.invalid_type:if(Q.received===I.undefined)$="Required";else $=`Expected ${Q.expected}, received ${Q.received}`;break;case E.invalid_literal:$=`Invalid literal value, expected ${JSON.stringify(Q.expected,o.jsonStringifyReplacer)}`;break;case E.unrecognized_keys:$=`Unrecognized key(s) in object: ${o.joinValues(Q.keys,", ")}`;break;case E.invalid_union:$="Invalid input";break;case E.invalid_union_discriminator:$=`Invalid discriminator value. Expected ${o.joinValues(Q.options)}`;break;case E.invalid_enum_value:$=`Invalid enum value. Expected ${o.joinValues(Q.options)}, received '${Q.received}'`;break;case E.invalid_arguments:$="Invalid function arguments";break;case E.invalid_return_type:$="Invalid function return type";break;case E.invalid_date:$="Invalid date";break;case E.invalid_string:if(typeof Q.validation==="object")if("includes"in Q.validation){if($=`Invalid input: must include "${Q.validation.includes}"`,typeof Q.validation.position==="number")$=`${$} at one or more positions greater than or equal to ${Q.validation.position}`}else if("startsWith"in Q.validation)$=`Invalid input: must start with "${Q.validation.startsWith}"`;else if("endsWith"in Q.validation)$=`Invalid input: must end with "${Q.validation.endsWith}"`;else o.assertNever(Q.validation);else if(Q.validation!=="regex")$=`Invalid ${Q.validation}`;else $="Invalid";break;case E.too_small:if(Q.type==="array")$=`Array must contain ${Q.exact?"exactly":Q.inclusive?"at least":"more than"} ${Q.minimum} element(s)`;else if(Q.type==="string")$=`String must contain ${Q.exact?"exactly":Q.inclusive?"at least":"over"} ${Q.minimum} character(s)`;else if(Q.type==="number")$=`Number must be ${Q.exact?"exactly equal to ":Q.inclusive?"greater than or equal to ":"greater than "}${Q.minimum}`;else if(Q.type==="bigint")$=`Number must be ${Q.exact?"exactly equal to ":Q.inclusive?"greater than or equal to ":"greater than "}${Q.minimum}`;else if(Q.type==="date")$=`Date must be ${Q.exact?"exactly equal to ":Q.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(Q.minimum))}`;else $="Invalid input";break;case E.too_big:if(Q.type==="array")$=`Array must contain ${Q.exact?"exactly":Q.inclusive?"at most":"less than"} ${Q.maximum} element(s)`;else if(Q.type==="string")$=`String must contain ${Q.exact?"exactly":Q.inclusive?"at most":"under"} ${Q.maximum} character(s)`;else if(Q.type==="number")$=`Number must be ${Q.exact?"exactly":Q.inclusive?"less than or equal to":"less than"} ${Q.maximum}`;else if(Q.type==="bigint")$=`BigInt must be ${Q.exact?"exactly":Q.inclusive?"less than or equal to":"less than"} ${Q.maximum}`;else if(Q.type==="date")$=`Date must be ${Q.exact?"exactly":Q.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(Q.maximum))}`;else $="Invalid input";break;case E.custom:$="Invalid input";break;case E.invalid_intersection_types:$="Intersection results could not be merged";break;case E.not_multiple_of:$=`Number must be a multiple of ${Q.multipleOf}`;break;case E.not_finite:$="Number must be finite";break;default:$=W.defaultError,o.assertNever(Q)}return{message:$}},y1=RK;var k7=y1;function IK(Q){k7=Q}function o6(){return k7}var h4=(Q)=>{let{data:W,path:$,errorMaps:Y,issueData:J}=Q,X=[...$,...J.path||[]],G={...J,path:X};if(J.message!==void 0)return{...J,path:X,message:J.message};let H="",B=Y.filter((K)=>!!K).slice().reverse();for(let K of B)H=K(G,{data:W,defaultError:H}).message;return{...J,path:X,message:H}},SK=[];function S(Q,W){let $=o6(),Y=h4({issueData:W,data:Q.data,path:Q.path,errorMaps:[Q.common.contextualErrorMap,Q.schemaErrorMap,$,$===y1?void 0:y1].filter((J)=>!!J)});Q.common.issues.push(Y)}class b0{constructor(){this.value="valid"}dirty(){if(this.value==="valid")this.value="dirty"}abort(){if(this.value!=="aborted")this.value="aborted"}static mergeArray(Q,W){let $=[];for(let Y of W){if(Y.status==="aborted")return h;if(Y.status==="dirty")Q.dirty();$.push(Y.value)}return{status:Q.value,value:$}}static async mergeObjectAsync(Q,W){let $=[];for(let Y of W){let J=await Y.key,X=await Y.value;$.push({key:J,value:X})}return b0.mergeObjectSync(Q,$)}static mergeObjectSync(Q,W){let $={};for(let Y of W){let{key:J,value:X}=Y;if(J.status==="aborted")return h;if(X.status==="aborted")return h;if(J.status==="dirty")Q.dirty();if(X.status==="dirty")Q.dirty();if(J.value!=="__proto__"&&(typeof X.value<"u"||Y.alwaysSet))$[J.value]=X.value}return{status:Q.value,value:$}}}var h=Object.freeze({status:"aborted"}),N6=(Q)=>({status:"dirty",value:Q}),x0=(Q)=>({status:"valid",value:Q}),r9=(Q)=>Q.status==="aborted",a9=(Q)=>Q.status==="dirty",o1=(Q)=>Q.status==="valid",r6=(Q)=>typeof Promise<"u"&&Q instanceof Promise;var T;(function(Q){Q.errToObj=(W)=>typeof W==="string"?{message:W}:W||{},Q.toString=(W)=>typeof W==="string"?W:W?.message})(T||(T={}));class L1{constructor(Q,W,$,Y){this._cachedPath=[],this.parent=Q,this.data=W,this._path=$,this._key=Y}get path(){if(!this._cachedPath.length)if(Array.isArray(this._key))this._cachedPath.push(...this._path,...this._key);else this._cachedPath.push(...this._path,this._key);return this._cachedPath}}var _7=(Q,W)=>{if(o1(W))return{success:!0,data:W.value};else{if(!Q.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let $=new i0(Q.common.issues);return this._error=$,this._error}}}};function m(Q){if(!Q)return{};let{errorMap:W,invalid_type_error:$,required_error:Y,description:J}=Q;if(W&&($||Y))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);if(W)return{errorMap:W,description:J};return{errorMap:(G,H)=>{let{message:B}=Q;if(G.code==="invalid_enum_value")return{message:B??H.defaultError};if(typeof H.data>"u")return{message:B??Y??H.defaultError};if(G.code!=="invalid_type")return{message:H.defaultError};return{message:B??$??H.defaultError}},description:J}}class d{get description(){return this._def.description}_getType(Q){return R1(Q.data)}_getOrReturnCtx(Q,W){return W||{common:Q.parent.common,data:Q.data,parsedType:R1(Q.data),schemaErrorMap:this._def.errorMap,path:Q.path,parent:Q.parent}}_processInputParams(Q){return{status:new b0,ctx:{common:Q.parent.common,data:Q.data,parsedType:R1(Q.data),schemaErrorMap:this._def.errorMap,path:Q.path,parent:Q.parent}}}_parseSync(Q){let W=this._parse(Q);if(r6(W))throw Error("Synchronous parse encountered promise.");return W}_parseAsync(Q){let W=this._parse(Q);return Promise.resolve(W)}parse(Q,W){let $=this.safeParse(Q,W);if($.success)return $.data;throw $.error}safeParse(Q,W){let $={common:{issues:[],async:W?.async??!1,contextualErrorMap:W?.errorMap},path:W?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:Q,parsedType:R1(Q)},Y=this._parseSync({data:Q,path:$.path,parent:$});return _7($,Y)}"~validate"(Q){let W={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:Q,parsedType:R1(Q)};if(!this["~standard"].async)try{let $=this._parseSync({data:Q,path:[],parent:W});return o1($)?{value:$.value}:{issues:W.common.issues}}catch($){if($?.message?.toLowerCase()?.includes("encountered"))this["~standard"].async=!0;W.common={issues:[],async:!0}}return this._parseAsync({data:Q,path:[],parent:W}).then(($)=>o1($)?{value:$.value}:{issues:W.common.issues})}async parseAsync(Q,W){let $=await this.safeParseAsync(Q,W);if($.success)return $.data;throw $.error}async safeParseAsync(Q,W){let $={common:{issues:[],contextualErrorMap:W?.errorMap,async:!0},path:W?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:Q,parsedType:R1(Q)},Y=this._parse({data:Q,path:$.path,parent:$}),J=await(r6(Y)?Y:Promise.resolve(Y));return _7($,J)}refine(Q,W){let $=(Y)=>{if(typeof W==="string"||typeof W>"u")return{message:W};else if(typeof W==="function")return W(Y);else return W};return this._refinement((Y,J)=>{let X=Q(Y),G=()=>J.addIssue({code:E.custom,...$(Y)});if(typeof Promise<"u"&&X instanceof Promise)return X.then((H)=>{if(!H)return G(),!1;else return!0});if(!X)return G(),!1;else return!0})}refinement(Q,W){return this._refinement(($,Y)=>{if(!Q($))return Y.addIssue(typeof W==="function"?W($,Y):W),!1;else return!0})}_refinement(Q){return new q1({schema:this,typeName:P.ZodEffects,effect:{type:"refinement",refinement:Q}})}superRefine(Q){return this._refinement(Q)}constructor(Q){this.spa=this.safeParseAsync,this._def=Q,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:(W)=>this["~validate"](W)}}optional(){return e0.create(this,this._def)}nullable(){return h1.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return F1.create(this)}promise(){return E6.create(this,this._def)}or(Q){return W4.create([this,Q],this._def)}and(Q){return $4.create(this,Q,this._def)}transform(Q){return new q1({...m(this._def),schema:this,typeName:P.ZodEffects,effect:{type:"transform",transform:Q}})}default(Q){let W=typeof Q==="function"?Q:()=>Q;return new G4({...m(this._def),innerType:this,defaultValue:W,typeName:P.ZodDefault})}brand(){return new s9({typeName:P.ZodBranded,type:this,...m(this._def)})}catch(Q){let W=typeof Q==="function"?Q:()=>Q;return new H4({...m(this._def),innerType:this,catchValue:W,typeName:P.ZodCatch})}describe(Q){return new this.constructor({...this._def,description:Q})}pipe(Q){return p4.create(this,Q)}readonly(){return B4.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}var bK=/^c[^\s-]{8,}$/i,CK=/^[0-9a-z]+$/,ZK=/^[0-9A-HJKMNP-TV-Z]{26}$/i,vK=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,TK=/^[a-z0-9_-]{21}$/i,kK=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,_K=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,xK=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,yK="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",mQ,gK=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,hK=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,fK=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,uK=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,lK=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,mK=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,y7="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",cK=new RegExp(`^${y7}$`);function g7(Q){let W="[0-5]\\d";if(Q.precision)W=`${W}\\.\\d{${Q.precision}}`;else if(Q.precision==null)W=`${W}(\\.\\d+)?`;let $=Q.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${W})${$}`}function pK(Q){return new RegExp(`^${g7(Q)}$`)}function h7(Q){let W=`${y7}T${g7(Q)}`,$=[];if($.push(Q.local?"Z?":"Z"),Q.offset)$.push("([+-]\\d{2}:?\\d{2})");return W=`${W}(${$.join("|")})`,new RegExp(`^${W}$`)}function dK(Q,W){if((W==="v4"||!W)&&gK.test(Q))return!0;if((W==="v6"||!W)&&fK.test(Q))return!0;return!1}function iK(Q,W){if(!kK.test(Q))return!1;try{let[$]=Q.split(".");if(!$)return!1;let Y=$.replace(/-/g,"+").replace(/_/g,"/").padEnd($.length+(4-$.length%4)%4,"="),J=JSON.parse(atob(Y));if(typeof J!=="object"||J===null)return!1;if("typ"in J&&J?.typ!=="JWT")return!1;if(!J.alg)return!1;if(W&&J.alg!==W)return!1;return!0}catch{return!1}}function nK(Q,W){if((W==="v4"||!W)&&hK.test(Q))return!0;if((W==="v6"||!W)&&uK.test(Q))return!0;return!1}class V1 extends d{_parse(Q){if(this._def.coerce)Q.data=String(Q.data);if(this._getType(Q)!==I.string){let J=this._getOrReturnCtx(Q);return S(J,{code:E.invalid_type,expected:I.string,received:J.parsedType}),h}let $=new b0,Y=void 0;for(let J of this._def.checks)if(J.kind==="min"){if(Q.data.length<J.value)Y=this._getOrReturnCtx(Q,Y),S(Y,{code:E.too_small,minimum:J.value,type:"string",inclusive:!0,exact:!1,message:J.message}),$.dirty()}else if(J.kind==="max"){if(Q.data.length>J.value)Y=this._getOrReturnCtx(Q,Y),S(Y,{code:E.too_big,maximum:J.value,type:"string",inclusive:!0,exact:!1,message:J.message}),$.dirty()}else if(J.kind==="length"){let X=Q.data.length>J.value,G=Q.data.length<J.value;if(X||G){if(Y=this._getOrReturnCtx(Q,Y),X)S(Y,{code:E.too_big,maximum:J.value,type:"string",inclusive:!0,exact:!0,message:J.message});else if(G)S(Y,{code:E.too_small,minimum:J.value,type:"string",inclusive:!0,exact:!0,message:J.message});$.dirty()}}else if(J.kind==="email"){if(!xK.test(Q.data))Y=this._getOrReturnCtx(Q,Y),S(Y,{validation:"email",code:E.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="emoji"){if(!mQ)mQ=new RegExp(yK,"u");if(!mQ.test(Q.data))Y=this._getOrReturnCtx(Q,Y),S(Y,{validation:"emoji",code:E.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="uuid"){if(!vK.test(Q.data))Y=this._getOrReturnCtx(Q,Y),S(Y,{validation:"uuid",code:E.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="nanoid"){if(!TK.test(Q.data))Y=this._getOrReturnCtx(Q,Y),S(Y,{validation:"nanoid",code:E.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="cuid"){if(!bK.test(Q.data))Y=this._getOrReturnCtx(Q,Y),S(Y,{validation:"cuid",code:E.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="cuid2"){if(!CK.test(Q.data))Y=this._getOrReturnCtx(Q,Y),S(Y,{validation:"cuid2",code:E.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="ulid"){if(!ZK.test(Q.data))Y=this._getOrReturnCtx(Q,Y),S(Y,{validation:"ulid",code:E.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="url")try{new URL(Q.data)}catch{Y=this._getOrReturnCtx(Q,Y),S(Y,{validation:"url",code:E.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="regex"){if(J.regex.lastIndex=0,!J.regex.test(Q.data))Y=this._getOrReturnCtx(Q,Y),S(Y,{validation:"regex",code:E.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="trim")Q.data=Q.data.trim();else if(J.kind==="includes"){if(!Q.data.includes(J.value,J.position))Y=this._getOrReturnCtx(Q,Y),S(Y,{code:E.invalid_string,validation:{includes:J.value,position:J.position},message:J.message}),$.dirty()}else if(J.kind==="toLowerCase")Q.data=Q.data.toLowerCase();else if(J.kind==="toUpperCase")Q.data=Q.data.toUpperCase();else if(J.kind==="startsWith"){if(!Q.data.startsWith(J.value))Y=this._getOrReturnCtx(Q,Y),S(Y,{code:E.invalid_string,validation:{startsWith:J.value},message:J.message}),$.dirty()}else if(J.kind==="endsWith"){if(!Q.data.endsWith(J.value))Y=this._getOrReturnCtx(Q,Y),S(Y,{code:E.invalid_string,validation:{endsWith:J.value},message:J.message}),$.dirty()}else if(J.kind==="datetime"){if(!h7(J).test(Q.data))Y=this._getOrReturnCtx(Q,Y),S(Y,{code:E.invalid_string,validation:"datetime",message:J.message}),$.dirty()}else if(J.kind==="date"){if(!cK.test(Q.data))Y=this._getOrReturnCtx(Q,Y),S(Y,{code:E.invalid_string,validation:"date",message:J.message}),$.dirty()}else if(J.kind==="time"){if(!pK(J).test(Q.data))Y=this._getOrReturnCtx(Q,Y),S(Y,{code:E.invalid_string,validation:"time",message:J.message}),$.dirty()}else if(J.kind==="duration"){if(!_K.test(Q.data))Y=this._getOrReturnCtx(Q,Y),S(Y,{validation:"duration",code:E.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="ip"){if(!dK(Q.data,J.version))Y=this._getOrReturnCtx(Q,Y),S(Y,{validation:"ip",code:E.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="jwt"){if(!iK(Q.data,J.alg))Y=this._getOrReturnCtx(Q,Y),S(Y,{validation:"jwt",code:E.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="cidr"){if(!nK(Q.data,J.version))Y=this._getOrReturnCtx(Q,Y),S(Y,{validation:"cidr",code:E.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="base64"){if(!lK.test(Q.data))Y=this._getOrReturnCtx(Q,Y),S(Y,{validation:"base64",code:E.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="base64url"){if(!mK.test(Q.data))Y=this._getOrReturnCtx(Q,Y),S(Y,{validation:"base64url",code:E.invalid_string,message:J.message}),$.dirty()}else o.assertNever(J);return{status:$.value,value:Q.data}}_regex(Q,W,$){return this.refinement((Y)=>Q.test(Y),{validation:W,code:E.invalid_string,...T.errToObj($)})}_addCheck(Q){return new V1({...this._def,checks:[...this._def.checks,Q]})}email(Q){return this._addCheck({kind:"email",...T.errToObj(Q)})}url(Q){return this._addCheck({kind:"url",...T.errToObj(Q)})}emoji(Q){return this._addCheck({kind:"emoji",...T.errToObj(Q)})}uuid(Q){return this._addCheck({kind:"uuid",...T.errToObj(Q)})}nanoid(Q){return this._addCheck({kind:"nanoid",...T.errToObj(Q)})}cuid(Q){return this._addCheck({kind:"cuid",...T.errToObj(Q)})}cuid2(Q){return this._addCheck({kind:"cuid2",...T.errToObj(Q)})}ulid(Q){return this._addCheck({kind:"ulid",...T.errToObj(Q)})}base64(Q){return this._addCheck({kind:"base64",...T.errToObj(Q)})}base64url(Q){return this._addCheck({kind:"base64url",...T.errToObj(Q)})}jwt(Q){return this._addCheck({kind:"jwt",...T.errToObj(Q)})}ip(Q){return this._addCheck({kind:"ip",...T.errToObj(Q)})}cidr(Q){return this._addCheck({kind:"cidr",...T.errToObj(Q)})}datetime(Q){if(typeof Q==="string")return this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:Q});return this._addCheck({kind:"datetime",precision:typeof Q?.precision>"u"?null:Q?.precision,offset:Q?.offset??!1,local:Q?.local??!1,...T.errToObj(Q?.message)})}date(Q){return this._addCheck({kind:"date",message:Q})}time(Q){if(typeof Q==="string")return this._addCheck({kind:"time",precision:null,message:Q});return this._addCheck({kind:"time",precision:typeof Q?.precision>"u"?null:Q?.precision,...T.errToObj(Q?.message)})}duration(Q){return this._addCheck({kind:"duration",...T.errToObj(Q)})}regex(Q,W){return this._addCheck({kind:"regex",regex:Q,...T.errToObj(W)})}includes(Q,W){return this._addCheck({kind:"includes",value:Q,position:W?.position,...T.errToObj(W?.message)})}startsWith(Q,W){return this._addCheck({kind:"startsWith",value:Q,...T.errToObj(W)})}endsWith(Q,W){return this._addCheck({kind:"endsWith",value:Q,...T.errToObj(W)})}min(Q,W){return this._addCheck({kind:"min",value:Q,...T.errToObj(W)})}max(Q,W){return this._addCheck({kind:"max",value:Q,...T.errToObj(W)})}length(Q,W){return this._addCheck({kind:"length",value:Q,...T.errToObj(W)})}nonempty(Q){return this.min(1,T.errToObj(Q))}trim(){return new V1({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new V1({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new V1({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((Q)=>Q.kind==="datetime")}get isDate(){return!!this._def.checks.find((Q)=>Q.kind==="date")}get isTime(){return!!this._def.checks.find((Q)=>Q.kind==="time")}get isDuration(){return!!this._def.checks.find((Q)=>Q.kind==="duration")}get isEmail(){return!!this._def.checks.find((Q)=>Q.kind==="email")}get isURL(){return!!this._def.checks.find((Q)=>Q.kind==="url")}get isEmoji(){return!!this._def.checks.find((Q)=>Q.kind==="emoji")}get isUUID(){return!!this._def.checks.find((Q)=>Q.kind==="uuid")}get isNANOID(){return!!this._def.checks.find((Q)=>Q.kind==="nanoid")}get isCUID(){return!!this._def.checks.find((Q)=>Q.kind==="cuid")}get isCUID2(){return!!this._def.checks.find((Q)=>Q.kind==="cuid2")}get isULID(){return!!this._def.checks.find((Q)=>Q.kind==="ulid")}get isIP(){return!!this._def.checks.find((Q)=>Q.kind==="ip")}get isCIDR(){return!!this._def.checks.find((Q)=>Q.kind==="cidr")}get isBase64(){return!!this._def.checks.find((Q)=>Q.kind==="base64")}get isBase64url(){return!!this._def.checks.find((Q)=>Q.kind==="base64url")}get minLength(){let Q=null;for(let W of this._def.checks)if(W.kind==="min"){if(Q===null||W.value>Q)Q=W.value}return Q}get maxLength(){let Q=null;for(let W of this._def.checks)if(W.kind==="max"){if(Q===null||W.value<Q)Q=W.value}return Q}}V1.create=(Q)=>{return new V1({checks:[],typeName:P.ZodString,coerce:Q?.coerce??!1,...m(Q)})};function oK(Q,W){let $=(Q.toString().split(".")[1]||"").length,Y=(W.toString().split(".")[1]||"").length,J=$>Y?$:Y,X=Number.parseInt(Q.toFixed(J).replace(".","")),G=Number.parseInt(W.toFixed(J).replace(".",""));return X%G/10**J}class a1 extends d{constructor(){super(...arguments);this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(Q){if(this._def.coerce)Q.data=Number(Q.data);if(this._getType(Q)!==I.number){let J=this._getOrReturnCtx(Q);return S(J,{code:E.invalid_type,expected:I.number,received:J.parsedType}),h}let $=void 0,Y=new b0;for(let J of this._def.checks)if(J.kind==="int"){if(!o.isInteger(Q.data))$=this._getOrReturnCtx(Q,$),S($,{code:E.invalid_type,expected:"integer",received:"float",message:J.message}),Y.dirty()}else if(J.kind==="min"){if(J.inclusive?Q.data<J.value:Q.data<=J.value)$=this._getOrReturnCtx(Q,$),S($,{code:E.too_small,minimum:J.value,type:"number",inclusive:J.inclusive,exact:!1,message:J.message}),Y.dirty()}else if(J.kind==="max"){if(J.inclusive?Q.data>J.value:Q.data>=J.value)$=this._getOrReturnCtx(Q,$),S($,{code:E.too_big,maximum:J.value,type:"number",inclusive:J.inclusive,exact:!1,message:J.message}),Y.dirty()}else if(J.kind==="multipleOf"){if(oK(Q.data,J.value)!==0)$=this._getOrReturnCtx(Q,$),S($,{code:E.not_multiple_of,multipleOf:J.value,message:J.message}),Y.dirty()}else if(J.kind==="finite"){if(!Number.isFinite(Q.data))$=this._getOrReturnCtx(Q,$),S($,{code:E.not_finite,message:J.message}),Y.dirty()}else o.assertNever(J);return{status:Y.value,value:Q.data}}gte(Q,W){return this.setLimit("min",Q,!0,T.toString(W))}gt(Q,W){return this.setLimit("min",Q,!1,T.toString(W))}lte(Q,W){return this.setLimit("max",Q,!0,T.toString(W))}lt(Q,W){return this.setLimit("max",Q,!1,T.toString(W))}setLimit(Q,W,$,Y){return new a1({...this._def,checks:[...this._def.checks,{kind:Q,value:W,inclusive:$,message:T.toString(Y)}]})}_addCheck(Q){return new a1({...this._def,checks:[...this._def.checks,Q]})}int(Q){return this._addCheck({kind:"int",message:T.toString(Q)})}positive(Q){return this._addCheck({kind:"min",value:0,inclusive:!1,message:T.toString(Q)})}negative(Q){return this._addCheck({kind:"max",value:0,inclusive:!1,message:T.toString(Q)})}nonpositive(Q){return this._addCheck({kind:"max",value:0,inclusive:!0,message:T.toString(Q)})}nonnegative(Q){return this._addCheck({kind:"min",value:0,inclusive:!0,message:T.toString(Q)})}multipleOf(Q,W){return this._addCheck({kind:"multipleOf",value:Q,message:T.toString(W)})}finite(Q){return this._addCheck({kind:"finite",message:T.toString(Q)})}safe(Q){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:T.toString(Q)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:T.toString(Q)})}get minValue(){let Q=null;for(let W of this._def.checks)if(W.kind==="min"){if(Q===null||W.value>Q)Q=W.value}return Q}get maxValue(){let Q=null;for(let W of this._def.checks)if(W.kind==="max"){if(Q===null||W.value<Q)Q=W.value}return Q}get isInt(){return!!this._def.checks.find((Q)=>Q.kind==="int"||Q.kind==="multipleOf"&&o.isInteger(Q.value))}get isFinite(){let Q=null,W=null;for(let $ of this._def.checks)if($.kind==="finite"||$.kind==="int"||$.kind==="multipleOf")return!0;else if($.kind==="min"){if(W===null||$.value>W)W=$.value}else if($.kind==="max"){if(Q===null||$.value<Q)Q=$.value}return Number.isFinite(W)&&Number.isFinite(Q)}}a1.create=(Q)=>{return new a1({checks:[],typeName:P.ZodNumber,coerce:Q?.coerce||!1,...m(Q)})};class t1 extends d{constructor(){super(...arguments);this.min=this.gte,this.max=this.lte}_parse(Q){if(this._def.coerce)try{Q.data=BigInt(Q.data)}catch{return this._getInvalidInput(Q)}if(this._getType(Q)!==I.bigint)return this._getInvalidInput(Q);let $=void 0,Y=new b0;for(let J of this._def.checks)if(J.kind==="min"){if(J.inclusive?Q.data<J.value:Q.data<=J.value)$=this._getOrReturnCtx(Q,$),S($,{code:E.too_small,type:"bigint",minimum:J.value,inclusive:J.inclusive,message:J.message}),Y.dirty()}else if(J.kind==="max"){if(J.inclusive?Q.data>J.value:Q.data>=J.value)$=this._getOrReturnCtx(Q,$),S($,{code:E.too_big,type:"bigint",maximum:J.value,inclusive:J.inclusive,message:J.message}),Y.dirty()}else if(J.kind==="multipleOf"){if(Q.data%J.value!==BigInt(0))$=this._getOrReturnCtx(Q,$),S($,{code:E.not_multiple_of,multipleOf:J.value,message:J.message}),Y.dirty()}else o.assertNever(J);return{status:Y.value,value:Q.data}}_getInvalidInput(Q){let W=this._getOrReturnCtx(Q);return S(W,{code:E.invalid_type,expected:I.bigint,received:W.parsedType}),h}gte(Q,W){return this.setLimit("min",Q,!0,T.toString(W))}gt(Q,W){return this.setLimit("min",Q,!1,T.toString(W))}lte(Q,W){return this.setLimit("max",Q,!0,T.toString(W))}lt(Q,W){return this.setLimit("max",Q,!1,T.toString(W))}setLimit(Q,W,$,Y){return new t1({...this._def,checks:[...this._def.checks,{kind:Q,value:W,inclusive:$,message:T.toString(Y)}]})}_addCheck(Q){return new t1({...this._def,checks:[...this._def.checks,Q]})}positive(Q){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:T.toString(Q)})}negative(Q){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:T.toString(Q)})}nonpositive(Q){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:T.toString(Q)})}nonnegative(Q){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:T.toString(Q)})}multipleOf(Q,W){return this._addCheck({kind:"multipleOf",value:Q,message:T.toString(W)})}get minValue(){let Q=null;for(let W of this._def.checks)if(W.kind==="min"){if(Q===null||W.value>Q)Q=W.value}return Q}get maxValue(){let Q=null;for(let W of this._def.checks)if(W.kind==="max"){if(Q===null||W.value<Q)Q=W.value}return Q}}t1.create=(Q)=>{return new t1({checks:[],typeName:P.ZodBigInt,coerce:Q?.coerce??!1,...m(Q)})};class s6 extends d{_parse(Q){if(this._def.coerce)Q.data=Boolean(Q.data);if(this._getType(Q)!==I.boolean){let $=this._getOrReturnCtx(Q);return S($,{code:E.invalid_type,expected:I.boolean,received:$.parsedType}),h}return x0(Q.data)}}s6.create=(Q)=>{return new s6({typeName:P.ZodBoolean,coerce:Q?.coerce||!1,...m(Q)})};class M6 extends d{_parse(Q){if(this._def.coerce)Q.data=new Date(Q.data);if(this._getType(Q)!==I.date){let J=this._getOrReturnCtx(Q);return S(J,{code:E.invalid_type,expected:I.date,received:J.parsedType}),h}if(Number.isNaN(Q.data.getTime())){let J=this._getOrReturnCtx(Q);return S(J,{code:E.invalid_date}),h}let $=new b0,Y=void 0;for(let J of this._def.checks)if(J.kind==="min"){if(Q.data.getTime()<J.value)Y=this._getOrReturnCtx(Q,Y),S(Y,{code:E.too_small,message:J.message,inclusive:!0,exact:!1,minimum:J.value,type:"date"}),$.dirty()}else if(J.kind==="max"){if(Q.data.getTime()>J.value)Y=this._getOrReturnCtx(Q,Y),S(Y,{code:E.too_big,message:J.message,inclusive:!0,exact:!1,maximum:J.value,type:"date"}),$.dirty()}else o.assertNever(J);return{status:$.value,value:new Date(Q.data.getTime())}}_addCheck(Q){return new M6({...this._def,checks:[...this._def.checks,Q]})}min(Q,W){return this._addCheck({kind:"min",value:Q.getTime(),message:T.toString(W)})}max(Q,W){return this._addCheck({kind:"max",value:Q.getTime(),message:T.toString(W)})}get minDate(){let Q=null;for(let W of this._def.checks)if(W.kind==="min"){if(Q===null||W.value>Q)Q=W.value}return Q!=null?new Date(Q):null}get maxDate(){let Q=null;for(let W of this._def.checks)if(W.kind==="max"){if(Q===null||W.value<Q)Q=W.value}return Q!=null?new Date(Q):null}}M6.create=(Q)=>{return new M6({checks:[],coerce:Q?.coerce||!1,typeName:P.ZodDate,...m(Q)})};class f4 extends d{_parse(Q){if(this._getType(Q)!==I.symbol){let $=this._getOrReturnCtx(Q);return S($,{code:E.invalid_type,expected:I.symbol,received:$.parsedType}),h}return x0(Q.data)}}f4.create=(Q)=>{return new f4({typeName:P.ZodSymbol,...m(Q)})};class e6 extends d{_parse(Q){if(this._getType(Q)!==I.undefined){let $=this._getOrReturnCtx(Q);return S($,{code:E.invalid_type,expected:I.undefined,received:$.parsedType}),h}return x0(Q.data)}}e6.create=(Q)=>{return new e6({typeName:P.ZodUndefined,...m(Q)})};class Q4 extends d{_parse(Q){if(this._getType(Q)!==I.null){let $=this._getOrReturnCtx(Q);return S($,{code:E.invalid_type,expected:I.null,received:$.parsedType}),h}return x0(Q.data)}}Q4.create=(Q)=>{return new Q4({typeName:P.ZodNull,...m(Q)})};class j6 extends d{constructor(){super(...arguments);this._any=!0}_parse(Q){return x0(Q.data)}}j6.create=(Q)=>{return new j6({typeName:P.ZodAny,...m(Q)})};class r1 extends d{constructor(){super(...arguments);this._unknown=!0}_parse(Q){return x0(Q.data)}}r1.create=(Q)=>{return new r1({typeName:P.ZodUnknown,...m(Q)})};class I1 extends d{_parse(Q){let W=this._getOrReturnCtx(Q);return S(W,{code:E.invalid_type,expected:I.never,received:W.parsedType}),h}}I1.create=(Q)=>{return new I1({typeName:P.ZodNever,...m(Q)})};class u4 extends d{_parse(Q){if(this._getType(Q)!==I.undefined){let $=this._getOrReturnCtx(Q);return S($,{code:E.invalid_type,expected:I.void,received:$.parsedType}),h}return x0(Q.data)}}u4.create=(Q)=>{return new u4({typeName:P.ZodVoid,...m(Q)})};class F1 extends d{_parse(Q){let{ctx:W,status:$}=this._processInputParams(Q),Y=this._def;if(W.parsedType!==I.array)return S(W,{code:E.invalid_type,expected:I.array,received:W.parsedType}),h;if(Y.exactLength!==null){let X=W.data.length>Y.exactLength.value,G=W.data.length<Y.exactLength.value;if(X||G)S(W,{code:X?E.too_big:E.too_small,minimum:G?Y.exactLength.value:void 0,maximum:X?Y.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:Y.exactLength.message}),$.dirty()}if(Y.minLength!==null){if(W.data.length<Y.minLength.value)S(W,{code:E.too_small,minimum:Y.minLength.value,type:"array",inclusive:!0,exact:!1,message:Y.minLength.message}),$.dirty()}if(Y.maxLength!==null){if(W.data.length>Y.maxLength.value)S(W,{code:E.too_big,maximum:Y.maxLength.value,type:"array",inclusive:!0,exact:!1,message:Y.maxLength.message}),$.dirty()}if(W.common.async)return Promise.all([...W.data].map((X,G)=>{return Y.type._parseAsync(new L1(W,X,W.path,G))})).then((X)=>{return b0.mergeArray($,X)});let J=[...W.data].map((X,G)=>{return Y.type._parseSync(new L1(W,X,W.path,G))});return b0.mergeArray($,J)}get element(){return this._def.type}min(Q,W){return new F1({...this._def,minLength:{value:Q,message:T.toString(W)}})}max(Q,W){return new F1({...this._def,maxLength:{value:Q,message:T.toString(W)}})}length(Q,W){return new F1({...this._def,exactLength:{value:Q,message:T.toString(W)}})}nonempty(Q){return this.min(1,Q)}}F1.create=(Q,W)=>{return new F1({type:Q,minLength:null,maxLength:null,exactLength:null,typeName:P.ZodArray,...m(W)})};function a6(Q){if(Q instanceof O0){let W={};for(let $ in Q.shape){let Y=Q.shape[$];W[$]=e0.create(a6(Y))}return new O0({...Q._def,shape:()=>W})}else if(Q instanceof F1)return new F1({...Q._def,type:a6(Q.element)});else if(Q instanceof e0)return e0.create(a6(Q.unwrap()));else if(Q instanceof h1)return h1.create(a6(Q.unwrap()));else if(Q instanceof S1)return S1.create(Q.items.map((W)=>a6(W)));else return Q}class O0 extends d{constructor(){super(...arguments);this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let Q=this._def.shape(),W=o.objectKeys(Q);return this._cached={shape:Q,keys:W},this._cached}_parse(Q){if(this._getType(Q)!==I.object){let B=this._getOrReturnCtx(Q);return S(B,{code:E.invalid_type,expected:I.object,received:B.parsedType}),h}let{status:$,ctx:Y}=this._processInputParams(Q),{shape:J,keys:X}=this._getCached(),G=[];if(!(this._def.catchall instanceof I1&&this._def.unknownKeys==="strip")){for(let B in Y.data)if(!X.includes(B))G.push(B)}let H=[];for(let B of X){let K=J[B],F=Y.data[B];H.push({key:{status:"valid",value:B},value:K._parse(new L1(Y,F,Y.path,B)),alwaysSet:B in Y.data})}if(this._def.catchall instanceof I1){let B=this._def.unknownKeys;if(B==="passthrough")for(let K of G)H.push({key:{status:"valid",value:K},value:{status:"valid",value:Y.data[K]}});else if(B==="strict"){if(G.length>0)S(Y,{code:E.unrecognized_keys,keys:G}),$.dirty()}else if(B==="strip");else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let B=this._def.catchall;for(let K of G){let F=Y.data[K];H.push({key:{status:"valid",value:K},value:B._parse(new L1(Y,F,Y.path,K)),alwaysSet:K in Y.data})}}if(Y.common.async)return Promise.resolve().then(async()=>{let B=[];for(let K of H){let F=await K.key,L=await K.value;B.push({key:F,value:L,alwaysSet:K.alwaysSet})}return B}).then((B)=>{return b0.mergeObjectSync($,B)});else return b0.mergeObjectSync($,H)}get shape(){return this._def.shape()}strict(Q){return T.errToObj,new O0({...this._def,unknownKeys:"strict",...Q!==void 0?{errorMap:(W,$)=>{let Y=this._def.errorMap?.(W,$).message??$.defaultError;if(W.code==="unrecognized_keys")return{message:T.errToObj(Q).message??Y};return{message:Y}}}:{}})}strip(){return new O0({...this._def,unknownKeys:"strip"})}passthrough(){return new O0({...this._def,unknownKeys:"passthrough"})}extend(Q){return new O0({...this._def,shape:()=>({...this._def.shape(),...Q})})}merge(Q){return new O0({unknownKeys:Q._def.unknownKeys,catchall:Q._def.catchall,shape:()=>({...this._def.shape(),...Q._def.shape()}),typeName:P.ZodObject})}setKey(Q,W){return this.augment({[Q]:W})}catchall(Q){return new O0({...this._def,catchall:Q})}pick(Q){let W={};for(let $ of o.objectKeys(Q))if(Q[$]&&this.shape[$])W[$]=this.shape[$];return new O0({...this._def,shape:()=>W})}omit(Q){let W={};for(let $ of o.objectKeys(this.shape))if(!Q[$])W[$]=this.shape[$];return new O0({...this._def,shape:()=>W})}deepPartial(){return a6(this)}partial(Q){let W={};for(let $ of o.objectKeys(this.shape)){let Y=this.shape[$];if(Q&&!Q[$])W[$]=Y;else W[$]=Y.optional()}return new O0({...this._def,shape:()=>W})}required(Q){let W={};for(let $ of o.objectKeys(this.shape))if(Q&&!Q[$])W[$]=this.shape[$];else{let J=this.shape[$];while(J instanceof e0)J=J._def.innerType;W[$]=J}return new O0({...this._def,shape:()=>W})}keyof(){return f7(o.objectKeys(this.shape))}}O0.create=(Q,W)=>{return new O0({shape:()=>Q,unknownKeys:"strip",catchall:I1.create(),typeName:P.ZodObject,...m(W)})};O0.strictCreate=(Q,W)=>{return new O0({shape:()=>Q,unknownKeys:"strict",catchall:I1.create(),typeName:P.ZodObject,...m(W)})};O0.lazycreate=(Q,W)=>{return new O0({shape:Q,unknownKeys:"strip",catchall:I1.create(),typeName:P.ZodObject,...m(W)})};class W4 extends d{_parse(Q){let{ctx:W}=this._processInputParams(Q),$=this._def.options;function Y(J){for(let G of J)if(G.result.status==="valid")return G.result;for(let G of J)if(G.result.status==="dirty")return W.common.issues.push(...G.ctx.common.issues),G.result;let X=J.map((G)=>new i0(G.ctx.common.issues));return S(W,{code:E.invalid_union,unionErrors:X}),h}if(W.common.async)return Promise.all($.map(async(J)=>{let X={...W,common:{...W.common,issues:[]},parent:null};return{result:await J._parseAsync({data:W.data,path:W.path,parent:X}),ctx:X}})).then(Y);else{let J=void 0,X=[];for(let H of $){let B={...W,common:{...W.common,issues:[]},parent:null},K=H._parseSync({data:W.data,path:W.path,parent:B});if(K.status==="valid")return K;else if(K.status==="dirty"&&!J)J={result:K,ctx:B};if(B.common.issues.length)X.push(B.common.issues)}if(J)return W.common.issues.push(...J.ctx.common.issues),J.result;let G=X.map((H)=>new i0(H));return S(W,{code:E.invalid_union,unionErrors:G}),h}}get options(){return this._def.options}}W4.create=(Q,W)=>{return new W4({options:Q,typeName:P.ZodUnion,...m(W)})};var g1=(Q)=>{if(Q instanceof Y4)return g1(Q.schema);else if(Q instanceof q1)return g1(Q.innerType());else if(Q instanceof J4)return[Q.value];else if(Q instanceof s1)return Q.options;else if(Q instanceof X4)return o.objectValues(Q.enum);else if(Q instanceof G4)return g1(Q._def.innerType);else if(Q instanceof e6)return[void 0];else if(Q instanceof Q4)return[null];else if(Q instanceof e0)return[void 0,...g1(Q.unwrap())];else if(Q instanceof h1)return[null,...g1(Q.unwrap())];else if(Q instanceof s9)return g1(Q.unwrap());else if(Q instanceof B4)return g1(Q.unwrap());else if(Q instanceof H4)return g1(Q._def.innerType);else return[]};class t9 extends d{_parse(Q){let{ctx:W}=this._processInputParams(Q);if(W.parsedType!==I.object)return S(W,{code:E.invalid_type,expected:I.object,received:W.parsedType}),h;let $=this.discriminator,Y=W.data[$],J=this.optionsMap.get(Y);if(!J)return S(W,{code:E.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[$]}),h;if(W.common.async)return J._parseAsync({data:W.data,path:W.path,parent:W});else return J._parseSync({data:W.data,path:W.path,parent:W})}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(Q,W,$){let Y=new Map;for(let J of W){let X=g1(J.shape[Q]);if(!X.length)throw Error(`A discriminator value for key \`${Q}\` could not be extracted from all schema options`);for(let G of X){if(Y.has(G))throw Error(`Discriminator property ${String(Q)} has duplicate value ${String(G)}`);Y.set(G,J)}}return new t9({typeName:P.ZodDiscriminatedUnion,discriminator:Q,options:W,optionsMap:Y,...m($)})}}function cQ(Q,W){let $=R1(Q),Y=R1(W);if(Q===W)return{valid:!0,data:Q};else if($===I.object&&Y===I.object){let J=o.objectKeys(W),X=o.objectKeys(Q).filter((H)=>J.indexOf(H)!==-1),G={...Q,...W};for(let H of X){let B=cQ(Q[H],W[H]);if(!B.valid)return{valid:!1};G[H]=B.data}return{valid:!0,data:G}}else if($===I.array&&Y===I.array){if(Q.length!==W.length)return{valid:!1};let J=[];for(let X=0;X<Q.length;X++){let G=Q[X],H=W[X],B=cQ(G,H);if(!B.valid)return{valid:!1};J.push(B.data)}return{valid:!0,data:J}}else if($===I.date&&Y===I.date&&+Q===+W)return{valid:!0,data:Q};else return{valid:!1}}class $4 extends d{_parse(Q){let{status:W,ctx:$}=this._processInputParams(Q),Y=(J,X)=>{if(r9(J)||r9(X))return h;let G=cQ(J.value,X.value);if(!G.valid)return S($,{code:E.invalid_intersection_types}),h;if(a9(J)||a9(X))W.dirty();return{status:W.value,value:G.data}};if($.common.async)return Promise.all([this._def.left._parseAsync({data:$.data,path:$.path,parent:$}),this._def.right._parseAsync({data:$.data,path:$.path,parent:$})]).then(([J,X])=>Y(J,X));else return Y(this._def.left._parseSync({data:$.data,path:$.path,parent:$}),this._def.right._parseSync({data:$.data,path:$.path,parent:$}))}}$4.create=(Q,W,$)=>{return new $4({left:Q,right:W,typeName:P.ZodIntersection,...m($)})};class S1 extends d{_parse(Q){let{status:W,ctx:$}=this._processInputParams(Q);if($.parsedType!==I.array)return S($,{code:E.invalid_type,expected:I.array,received:$.parsedType}),h;if($.data.length<this._def.items.length)return S($,{code:E.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),h;if(!this._def.rest&&$.data.length>this._def.items.length)S($,{code:E.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),W.dirty();let J=[...$.data].map((X,G)=>{let H=this._def.items[G]||this._def.rest;if(!H)return null;return H._parse(new L1($,X,$.path,G))}).filter((X)=>!!X);if($.common.async)return Promise.all(J).then((X)=>{return b0.mergeArray(W,X)});else return b0.mergeArray(W,J)}get items(){return this._def.items}rest(Q){return new S1({...this._def,rest:Q})}}S1.create=(Q,W)=>{if(!Array.isArray(Q))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new S1({items:Q,typeName:P.ZodTuple,rest:null,...m(W)})};class l4 extends d{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(Q){let{status:W,ctx:$}=this._processInputParams(Q);if($.parsedType!==I.object)return S($,{code:E.invalid_type,expected:I.object,received:$.parsedType}),h;let Y=[],J=this._def.keyType,X=this._def.valueType;for(let G in $.data)Y.push({key:J._parse(new L1($,G,$.path,G)),value:X._parse(new L1($,$.data[G],$.path,G)),alwaysSet:G in $.data});if($.common.async)return b0.mergeObjectAsync(W,Y);else return b0.mergeObjectSync(W,Y)}get element(){return this._def.valueType}static create(Q,W,$){if(W instanceof d)return new l4({keyType:Q,valueType:W,typeName:P.ZodRecord,...m($)});return new l4({keyType:V1.create(),valueType:Q,typeName:P.ZodRecord,...m(W)})}}class m4 extends d{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(Q){let{status:W,ctx:$}=this._processInputParams(Q);if($.parsedType!==I.map)return S($,{code:E.invalid_type,expected:I.map,received:$.parsedType}),h;let Y=this._def.keyType,J=this._def.valueType,X=[...$.data.entries()].map(([G,H],B)=>{return{key:Y._parse(new L1($,G,$.path,[B,"key"])),value:J._parse(new L1($,H,$.path,[B,"value"]))}});if($.common.async){let G=new Map;return Promise.resolve().then(async()=>{for(let H of X){let B=await H.key,K=await H.value;if(B.status==="aborted"||K.status==="aborted")return h;if(B.status==="dirty"||K.status==="dirty")W.dirty();G.set(B.value,K.value)}return{status:W.value,value:G}})}else{let G=new Map;for(let H of X){let{key:B,value:K}=H;if(B.status==="aborted"||K.status==="aborted")return h;if(B.status==="dirty"||K.status==="dirty")W.dirty();G.set(B.value,K.value)}return{status:W.value,value:G}}}}m4.create=(Q,W,$)=>{return new m4({valueType:W,keyType:Q,typeName:P.ZodMap,...m($)})};class z6 extends d{_parse(Q){let{status:W,ctx:$}=this._processInputParams(Q);if($.parsedType!==I.set)return S($,{code:E.invalid_type,expected:I.set,received:$.parsedType}),h;let Y=this._def;if(Y.minSize!==null){if($.data.size<Y.minSize.value)S($,{code:E.too_small,minimum:Y.minSize.value,type:"set",inclusive:!0,exact:!1,message:Y.minSize.message}),W.dirty()}if(Y.maxSize!==null){if($.data.size>Y.maxSize.value)S($,{code:E.too_big,maximum:Y.maxSize.value,type:"set",inclusive:!0,exact:!1,message:Y.maxSize.message}),W.dirty()}let J=this._def.valueType;function X(H){let B=new Set;for(let K of H){if(K.status==="aborted")return h;if(K.status==="dirty")W.dirty();B.add(K.value)}return{status:W.value,value:B}}let G=[...$.data.values()].map((H,B)=>J._parse(new L1($,H,$.path,B)));if($.common.async)return Promise.all(G).then((H)=>X(H));else return X(G)}min(Q,W){return new z6({...this._def,minSize:{value:Q,message:T.toString(W)}})}max(Q,W){return new z6({...this._def,maxSize:{value:Q,message:T.toString(W)}})}size(Q,W){return this.min(Q,W).max(Q,W)}nonempty(Q){return this.min(1,Q)}}z6.create=(Q,W)=>{return new z6({valueType:Q,minSize:null,maxSize:null,typeName:P.ZodSet,...m(W)})};class t6 extends d{constructor(){super(...arguments);this.validate=this.implement}_parse(Q){let{ctx:W}=this._processInputParams(Q);if(W.parsedType!==I.function)return S(W,{code:E.invalid_type,expected:I.function,received:W.parsedType}),h;function $(G,H){return h4({data:G,path:W.path,errorMaps:[W.common.contextualErrorMap,W.schemaErrorMap,o6(),y1].filter((B)=>!!B),issueData:{code:E.invalid_arguments,argumentsError:H}})}function Y(G,H){return h4({data:G,path:W.path,errorMaps:[W.common.contextualErrorMap,W.schemaErrorMap,o6(),y1].filter((B)=>!!B),issueData:{code:E.invalid_return_type,returnTypeError:H}})}let J={errorMap:W.common.contextualErrorMap},X=W.data;if(this._def.returns instanceof E6){let G=this;return x0(async function(...H){let B=new i0([]),K=await G._def.args.parseAsync(H,J).catch((U)=>{throw B.addIssue($(H,U)),B}),F=await Reflect.apply(X,this,K);return await G._def.returns._def.type.parseAsync(F,J).catch((U)=>{throw B.addIssue(Y(F,U)),B})})}else{let G=this;return x0(function(...H){let B=G._def.args.safeParse(H,J);if(!B.success)throw new i0([$(H,B.error)]);let K=Reflect.apply(X,this,B.data),F=G._def.returns.safeParse(K,J);if(!F.success)throw new i0([Y(K,F.error)]);return F.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...Q){return new t6({...this._def,args:S1.create(Q).rest(r1.create())})}returns(Q){return new t6({...this._def,returns:Q})}implement(Q){return this.parse(Q)}strictImplement(Q){return this.parse(Q)}static create(Q,W,$){return new t6({args:Q?Q:S1.create([]).rest(r1.create()),returns:W||r1.create(),typeName:P.ZodFunction,...m($)})}}class Y4 extends d{get schema(){return this._def.getter()}_parse(Q){let{ctx:W}=this._processInputParams(Q);return this._def.getter()._parse({data:W.data,path:W.path,parent:W})}}Y4.create=(Q,W)=>{return new Y4({getter:Q,typeName:P.ZodLazy,...m(W)})};class J4 extends d{_parse(Q){if(Q.data!==this._def.value){let W=this._getOrReturnCtx(Q);return S(W,{received:W.data,code:E.invalid_literal,expected:this._def.value}),h}return{status:"valid",value:Q.data}}get value(){return this._def.value}}J4.create=(Q,W)=>{return new J4({value:Q,typeName:P.ZodLiteral,...m(W)})};function f7(Q,W){return new s1({values:Q,typeName:P.ZodEnum,...m(W)})}class s1 extends d{_parse(Q){if(typeof Q.data!=="string"){let W=this._getOrReturnCtx(Q),$=this._def.values;return S(W,{expected:o.joinValues($),received:W.parsedType,code:E.invalid_type}),h}if(!this._cache)this._cache=new Set(this._def.values);if(!this._cache.has(Q.data)){let W=this._getOrReturnCtx(Q),$=this._def.values;return S(W,{received:W.data,code:E.invalid_enum_value,options:$}),h}return x0(Q.data)}get options(){return this._def.values}get enum(){let Q={};for(let W of this._def.values)Q[W]=W;return Q}get Values(){let Q={};for(let W of this._def.values)Q[W]=W;return Q}get Enum(){let Q={};for(let W of this._def.values)Q[W]=W;return Q}extract(Q,W=this._def){return s1.create(Q,{...this._def,...W})}exclude(Q,W=this._def){return s1.create(this.options.filter(($)=>!Q.includes($)),{...this._def,...W})}}s1.create=f7;class X4 extends d{_parse(Q){let W=o.getValidEnumValues(this._def.values),$=this._getOrReturnCtx(Q);if($.parsedType!==I.string&&$.parsedType!==I.number){let Y=o.objectValues(W);return S($,{expected:o.joinValues(Y),received:$.parsedType,code:E.invalid_type}),h}if(!this._cache)this._cache=new Set(o.getValidEnumValues(this._def.values));if(!this._cache.has(Q.data)){let Y=o.objectValues(W);return S($,{received:$.data,code:E.invalid_enum_value,options:Y}),h}return x0(Q.data)}get enum(){return this._def.values}}X4.create=(Q,W)=>{return new X4({values:Q,typeName:P.ZodNativeEnum,...m(W)})};class E6 extends d{unwrap(){return this._def.type}_parse(Q){let{ctx:W}=this._processInputParams(Q);if(W.parsedType!==I.promise&&W.common.async===!1)return S(W,{code:E.invalid_type,expected:I.promise,received:W.parsedType}),h;let $=W.parsedType===I.promise?W.data:Promise.resolve(W.data);return x0($.then((Y)=>{return this._def.type.parseAsync(Y,{path:W.path,errorMap:W.common.contextualErrorMap})}))}}E6.create=(Q,W)=>{return new E6({type:Q,typeName:P.ZodPromise,...m(W)})};class q1 extends d{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===P.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(Q){let{status:W,ctx:$}=this._processInputParams(Q),Y=this._def.effect||null,J={addIssue:(X)=>{if(S($,X),X.fatal)W.abort();else W.dirty()},get path(){return $.path}};if(J.addIssue=J.addIssue.bind(J),Y.type==="preprocess"){let X=Y.transform($.data,J);if($.common.async)return Promise.resolve(X).then(async(G)=>{if(W.value==="aborted")return h;let H=await this._def.schema._parseAsync({data:G,path:$.path,parent:$});if(H.status==="aborted")return h;if(H.status==="dirty")return N6(H.value);if(W.value==="dirty")return N6(H.value);return H});else{if(W.value==="aborted")return h;let G=this._def.schema._parseSync({data:X,path:$.path,parent:$});if(G.status==="aborted")return h;if(G.status==="dirty")return N6(G.value);if(W.value==="dirty")return N6(G.value);return G}}if(Y.type==="refinement"){let X=(G)=>{let H=Y.refinement(G,J);if($.common.async)return Promise.resolve(H);if(H instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return G};if($.common.async===!1){let G=this._def.schema._parseSync({data:$.data,path:$.path,parent:$});if(G.status==="aborted")return h;if(G.status==="dirty")W.dirty();return X(G.value),{status:W.value,value:G.value}}else return this._def.schema._parseAsync({data:$.data,path:$.path,parent:$}).then((G)=>{if(G.status==="aborted")return h;if(G.status==="dirty")W.dirty();return X(G.value).then(()=>{return{status:W.value,value:G.value}})})}if(Y.type==="transform")if($.common.async===!1){let X=this._def.schema._parseSync({data:$.data,path:$.path,parent:$});if(!o1(X))return h;let G=Y.transform(X.value,J);if(G instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:W.value,value:G}}else return this._def.schema._parseAsync({data:$.data,path:$.path,parent:$}).then((X)=>{if(!o1(X))return h;return Promise.resolve(Y.transform(X.value,J)).then((G)=>({status:W.value,value:G}))});o.assertNever(Y)}}q1.create=(Q,W,$)=>{return new q1({schema:Q,typeName:P.ZodEffects,effect:W,...m($)})};q1.createWithPreprocess=(Q,W,$)=>{return new q1({schema:W,effect:{type:"preprocess",transform:Q},typeName:P.ZodEffects,...m($)})};class e0 extends d{_parse(Q){if(this._getType(Q)===I.undefined)return x0(void 0);return this._def.innerType._parse(Q)}unwrap(){return this._def.innerType}}e0.create=(Q,W)=>{return new e0({innerType:Q,typeName:P.ZodOptional,...m(W)})};class h1 extends d{_parse(Q){if(this._getType(Q)===I.null)return x0(null);return this._def.innerType._parse(Q)}unwrap(){return this._def.innerType}}h1.create=(Q,W)=>{return new h1({innerType:Q,typeName:P.ZodNullable,...m(W)})};class G4 extends d{_parse(Q){let{ctx:W}=this._processInputParams(Q),$=W.data;if(W.parsedType===I.undefined)$=this._def.defaultValue();return this._def.innerType._parse({data:$,path:W.path,parent:W})}removeDefault(){return this._def.innerType}}G4.create=(Q,W)=>{return new G4({innerType:Q,typeName:P.ZodDefault,defaultValue:typeof W.default==="function"?W.default:()=>W.default,...m(W)})};class H4 extends d{_parse(Q){let{ctx:W}=this._processInputParams(Q),$={...W,common:{...W.common,issues:[]}},Y=this._def.innerType._parse({data:$.data,path:$.path,parent:{...$}});if(r6(Y))return Y.then((J)=>{return{status:"valid",value:J.status==="valid"?J.value:this._def.catchValue({get error(){return new i0($.common.issues)},input:$.data})}});else return{status:"valid",value:Y.status==="valid"?Y.value:this._def.catchValue({get error(){return new i0($.common.issues)},input:$.data})}}removeCatch(){return this._def.innerType}}H4.create=(Q,W)=>{return new H4({innerType:Q,typeName:P.ZodCatch,catchValue:typeof W.catch==="function"?W.catch:()=>W.catch,...m(W)})};class c4 extends d{_parse(Q){if(this._getType(Q)!==I.nan){let $=this._getOrReturnCtx(Q);return S($,{code:E.invalid_type,expected:I.nan,received:$.parsedType}),h}return{status:"valid",value:Q.data}}}c4.create=(Q)=>{return new c4({typeName:P.ZodNaN,...m(Q)})};var rK=Symbol("zod_brand");class s9 extends d{_parse(Q){let{ctx:W}=this._processInputParams(Q),$=W.data;return this._def.type._parse({data:$,path:W.path,parent:W})}unwrap(){return this._def.type}}class p4 extends d{_parse(Q){let{status:W,ctx:$}=this._processInputParams(Q);if($.common.async)return(async()=>{let J=await this._def.in._parseAsync({data:$.data,path:$.path,parent:$});if(J.status==="aborted")return h;if(J.status==="dirty")return W.dirty(),N6(J.value);else return this._def.out._parseAsync({data:J.value,path:$.path,parent:$})})();else{let Y=this._def.in._parseSync({data:$.data,path:$.path,parent:$});if(Y.status==="aborted")return h;if(Y.status==="dirty")return W.dirty(),{status:"dirty",value:Y.value};else return this._def.out._parseSync({data:Y.value,path:$.path,parent:$})}}static create(Q,W){return new p4({in:Q,out:W,typeName:P.ZodPipeline})}}class B4 extends d{_parse(Q){let W=this._def.innerType._parse(Q),$=(Y)=>{if(o1(Y))Y.value=Object.freeze(Y.value);return Y};return r6(W)?W.then((Y)=>$(Y)):$(W)}unwrap(){return this._def.innerType}}B4.create=(Q,W)=>{return new B4({innerType:Q,typeName:P.ZodReadonly,...m(W)})};function x7(Q,W){let $=typeof Q==="function"?Q(W):typeof Q==="string"?{message:Q}:Q;return typeof $==="string"?{message:$}:$}function u7(Q,W={},$){if(Q)return j6.create().superRefine((Y,J)=>{let X=Q(Y);if(X instanceof Promise)return X.then((G)=>{if(!G){let H=x7(W,Y),B=H.fatal??$??!0;J.addIssue({code:"custom",...H,fatal:B})}});if(!X){let G=x7(W,Y),H=G.fatal??$??!0;J.addIssue({code:"custom",...G,fatal:H})}return});return j6.create()}var aK={object:O0.lazycreate},P;(function(Q){Q.ZodString="ZodString",Q.ZodNumber="ZodNumber",Q.ZodNaN="ZodNaN",Q.ZodBigInt="ZodBigInt",Q.ZodBoolean="ZodBoolean",Q.ZodDate="ZodDate",Q.ZodSymbol="ZodSymbol",Q.ZodUndefined="ZodUndefined",Q.ZodNull="ZodNull",Q.ZodAny="ZodAny",Q.ZodUnknown="ZodUnknown",Q.ZodNever="ZodNever",Q.ZodVoid="ZodVoid",Q.ZodArray="ZodArray",Q.ZodObject="ZodObject",Q.ZodUnion="ZodUnion",Q.ZodDiscriminatedUnion="ZodDiscriminatedUnion",Q.ZodIntersection="ZodIntersection",Q.ZodTuple="ZodTuple",Q.ZodRecord="ZodRecord",Q.ZodMap="ZodMap",Q.ZodSet="ZodSet",Q.ZodFunction="ZodFunction",Q.ZodLazy="ZodLazy",Q.ZodLiteral="ZodLiteral",Q.ZodEnum="ZodEnum",Q.ZodEffects="ZodEffects",Q.ZodNativeEnum="ZodNativeEnum",Q.ZodOptional="ZodOptional",Q.ZodNullable="ZodNullable",Q.ZodDefault="ZodDefault",Q.ZodCatch="ZodCatch",Q.ZodPromise="ZodPromise",Q.ZodBranded="ZodBranded",Q.ZodPipeline="ZodPipeline",Q.ZodReadonly="ZodReadonly"})(P||(P={}));var tK=(Q,W={message:`Input not instance of ${Q.name}`})=>u7(($)=>$ instanceof Q,W),l7=V1.create,m7=a1.create,sK=c4.create,eK=t1.create,c7=s6.create,QV=M6.create,WV=f4.create,$V=e6.create,YV=Q4.create,JV=j6.create,XV=r1.create,GV=I1.create,HV=u4.create,BV=F1.create,pQ=O0.create,KV=O0.strictCreate,VV=W4.create,FV=t9.create,LV=$4.create,qV=S1.create,UV=l4.create,AV=m4.create,DV=z6.create,OV=t6.create,wV=Y4.create,NV=J4.create,MV=s1.create,jV=X4.create,zV=E6.create,EV=q1.create,PV=e0.create,RV=h1.create,IV=q1.createWithPreprocess,SV=p4.create,bV=()=>l7().optional(),CV=()=>m7().optional(),ZV=()=>c7().optional(),vV={string:(Q)=>V1.create({...Q,coerce:!0}),number:(Q)=>a1.create({...Q,coerce:!0}),boolean:(Q)=>s6.create({...Q,coerce:!0}),bigint:(Q)=>t1.create({...Q,coerce:!0}),date:(Q)=>M6.create({...Q,coerce:!0})};var TV=h;var kV=Object.freeze({status:"aborted"});function M(Q,W,$){function Y(H,B){var K;Object.defineProperty(H,"_zod",{value:H._zod??{},enumerable:!1}),(K=H._zod).traits??(K.traits=new Set),H._zod.traits.add(Q),W(H,B);for(let F in G.prototype)if(!(F in H))Object.defineProperty(H,F,{value:G.prototype[F].bind(H)});H._zod.constr=G,H._zod.def=B}let J=$?.Parent??Object;class X extends J{}Object.defineProperty(X,"name",{value:Q});function G(H){var B;let K=$?.Parent?new X:this;Y(K,H),(B=K._zod).deferred??(B.deferred=[]);for(let F of K._zod.deferred)F();return K}return Object.defineProperty(G,"init",{value:Y}),Object.defineProperty(G,Symbol.hasInstance,{value:(H)=>{if($?.Parent&&H instanceof $.Parent)return!0;return H?._zod?.traits?.has(Q)}}),Object.defineProperty(G,"name",{value:Q}),G}var _V=Symbol("zod_brand");class e1 extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}var e9={};function Q1(Q){if(Q)Object.assign(e9,Q);return e9}var r={};uQ(r,{unwrapMessage:()=>d4,stringifyPrimitive:()=>$8,required:()=>tV,randomString:()=>mV,propertyKeyTypes:()=>aQ,promiseAllObject:()=>lV,primitiveTypes:()=>p7,prefixIssues:()=>b1,pick:()=>iV,partial:()=>aV,optionalKeys:()=>tQ,omit:()=>nV,numKeys:()=>cV,nullish:()=>o4,normalizeParams:()=>f,merge:()=>rV,jsonStringifyReplacer:()=>iQ,joinValues:()=>Q8,issue:()=>eQ,isPlainObject:()=>V4,isObject:()=>K4,getSizableOrigin:()=>i7,getParsedType:()=>pV,getLengthableOrigin:()=>a4,getEnumValues:()=>i4,getElementAtPath:()=>uV,floatSafeRemainder:()=>nQ,finalizeIssue:()=>U1,extend:()=>oV,escapeRegex:()=>Q6,esc:()=>P6,defineLazy:()=>G0,createTransparentProxy:()=>dV,clone:()=>W1,cleanRegex:()=>r4,cleanEnum:()=>sV,captureStackTrace:()=>W8,cached:()=>n4,assignProp:()=>oQ,assertNotEqual:()=>yV,assertNever:()=>hV,assertIs:()=>gV,assertEqual:()=>xV,assert:()=>fV,allowsEval:()=>rQ,aborted:()=>R6,NUMBER_FORMAT_RANGES:()=>sQ,Class:()=>n7,BIGINT_FORMAT_RANGES:()=>d7});function xV(Q){return Q}function yV(Q){return Q}function gV(Q){}function hV(Q){throw Error()}function fV(Q){}function i4(Q){let W=Object.values(Q).filter((Y)=>typeof Y==="number");return Object.entries(Q).filter(([Y,J])=>W.indexOf(+Y)===-1).map(([Y,J])=>J)}function Q8(Q,W="|"){return Q.map(($)=>$8($)).join(W)}function iQ(Q,W){if(typeof W==="bigint")return W.toString();return W}function n4(Q){return{get value(){{let $=Q();return Object.defineProperty(this,"value",{value:$}),$}throw Error("cached value already set")}}}function o4(Q){return Q===null||Q===void 0}function r4(Q){let W=Q.startsWith("^")?1:0,$=Q.endsWith("$")?Q.length-1:Q.length;return Q.slice(W,$)}function nQ(Q,W){let $=(Q.toString().split(".")[1]||"").length,Y=(W.toString().split(".")[1]||"").length,J=$>Y?$:Y,X=Number.parseInt(Q.toFixed(J).replace(".","")),G=Number.parseInt(W.toFixed(J).replace(".",""));return X%G/10**J}function G0(Q,W,$){Object.defineProperty(Q,W,{get(){{let J=$();return Q[W]=J,J}throw Error("cached value already set")},set(J){Object.defineProperty(Q,W,{value:J})},configurable:!0})}function oQ(Q,W,$){Object.defineProperty(Q,W,{value:$,writable:!0,enumerable:!0,configurable:!0})}function uV(Q,W){if(!W)return Q;return W.reduce(($,Y)=>$?.[Y],Q)}function lV(Q){let W=Object.keys(Q),$=W.map((Y)=>Q[Y]);return Promise.all($).then((Y)=>{let J={};for(let X=0;X<W.length;X++)J[W[X]]=Y[X];return J})}function mV(Q=10){let $="";for(let Y=0;Y<Q;Y++)$+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)];return $}function P6(Q){return JSON.stringify(Q)}var W8=Error.captureStackTrace?Error.captureStackTrace:(...Q)=>{};function K4(Q){return typeof Q==="object"&&Q!==null&&!Array.isArray(Q)}var rQ=n4(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return new Function(""),!0}catch(Q){return!1}});function V4(Q){if(K4(Q)===!1)return!1;let W=Q.constructor;if(W===void 0)return!0;let $=W.prototype;if(K4($)===!1)return!1;if(Object.prototype.hasOwnProperty.call($,"isPrototypeOf")===!1)return!1;return!0}function cV(Q){let W=0;for(let $ in Q)if(Object.prototype.hasOwnProperty.call(Q,$))W++;return W}var pV=(Q)=>{let W=typeof Q;switch(W){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(Q)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":if(Array.isArray(Q))return"array";if(Q===null)return"null";if(Q.then&&typeof Q.then==="function"&&Q.catch&&typeof Q.catch==="function")return"promise";if(typeof Map<"u"&&Q instanceof Map)return"map";if(typeof Set<"u"&&Q instanceof Set)return"set";if(typeof Date<"u"&&Q instanceof Date)return"date";if(typeof File<"u"&&Q instanceof File)return"file";return"object";default:throw Error(`Unknown data type: ${W}`)}},aQ=new Set(["string","number","symbol"]),p7=new Set(["string","number","bigint","boolean","symbol","undefined"]);function Q6(Q){return Q.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function W1(Q,W,$){let Y=new Q._zod.constr(W??Q._zod.def);if(!W||$?.parent)Y._zod.parent=Q;return Y}function f(Q){let W=Q;if(!W)return{};if(typeof W==="string")return{error:()=>W};if(W?.message!==void 0){if(W?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");W.error=W.message}if(delete W.message,typeof W.error==="string")return{...W,error:()=>W.error};return W}function dV(Q){let W;return new Proxy({},{get($,Y,J){return W??(W=Q()),Reflect.get(W,Y,J)},set($,Y,J,X){return W??(W=Q()),Reflect.set(W,Y,J,X)},has($,Y){return W??(W=Q()),Reflect.has(W,Y)},deleteProperty($,Y){return W??(W=Q()),Reflect.deleteProperty(W,Y)},ownKeys($){return W??(W=Q()),Reflect.ownKeys(W)},getOwnPropertyDescriptor($,Y){return W??(W=Q()),Reflect.getOwnPropertyDescriptor(W,Y)},defineProperty($,Y,J){return W??(W=Q()),Reflect.defineProperty(W,Y,J)}})}function $8(Q){if(typeof Q==="bigint")return Q.toString()+"n";if(typeof Q==="string")return`"${Q}"`;return`${Q}`}function tQ(Q){return Object.keys(Q).filter((W)=>{return Q[W]._zod.optin==="optional"&&Q[W]._zod.optout==="optional"})}var sQ={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-340282346638528860000000000000000000000,340282346638528860000000000000000000000],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},d7={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function iV(Q,W){let $={},Y=Q._zod.def;for(let J in W){if(!(J in Y.shape))throw Error(`Unrecognized key: "${J}"`);if(!W[J])continue;$[J]=Y.shape[J]}return W1(Q,{...Q._zod.def,shape:$,checks:[]})}function nV(Q,W){let $={...Q._zod.def.shape},Y=Q._zod.def;for(let J in W){if(!(J in Y.shape))throw Error(`Unrecognized key: "${J}"`);if(!W[J])continue;delete $[J]}return W1(Q,{...Q._zod.def,shape:$,checks:[]})}function oV(Q,W){if(!V4(W))throw Error("Invalid input to extend: expected a plain object");let $={...Q._zod.def,get shape(){let Y={...Q._zod.def.shape,...W};return oQ(this,"shape",Y),Y},checks:[]};return W1(Q,$)}function rV(Q,W){return W1(Q,{...Q._zod.def,get shape(){let $={...Q._zod.def.shape,...W._zod.def.shape};return oQ(this,"shape",$),$},catchall:W._zod.def.catchall,checks:[]})}function aV(Q,W,$){let Y=W._zod.def.shape,J={...Y};if($)for(let X in $){if(!(X in Y))throw Error(`Unrecognized key: "${X}"`);if(!$[X])continue;J[X]=Q?new Q({type:"optional",innerType:Y[X]}):Y[X]}else for(let X in Y)J[X]=Q?new Q({type:"optional",innerType:Y[X]}):Y[X];return W1(W,{...W._zod.def,shape:J,checks:[]})}function tV(Q,W,$){let Y=W._zod.def.shape,J={...Y};if($)for(let X in $){if(!(X in J))throw Error(`Unrecognized key: "${X}"`);if(!$[X])continue;J[X]=new Q({type:"nonoptional",innerType:Y[X]})}else for(let X in Y)J[X]=new Q({type:"nonoptional",innerType:Y[X]});return W1(W,{...W._zod.def,shape:J,checks:[]})}function R6(Q,W=0){for(let $=W;$<Q.issues.length;$++)if(Q.issues[$]?.continue!==!0)return!0;return!1}function b1(Q,W){return W.map(($)=>{var Y;return(Y=$).path??(Y.path=[]),$.path.unshift(Q),$})}function d4(Q){return typeof Q==="string"?Q:Q?.message}function U1(Q,W,$){let Y={...Q,path:Q.path??[]};if(!Q.message){let J=d4(Q.inst?._zod.def?.error?.(Q))??d4(W?.error?.(Q))??d4($.customError?.(Q))??d4($.localeError?.(Q))??"Invalid input";Y.message=J}if(delete Y.inst,delete Y.continue,!W?.reportInput)delete Y.input;return Y}function i7(Q){if(Q instanceof Set)return"set";if(Q instanceof Map)return"map";if(Q instanceof File)return"file";return"unknown"}function a4(Q){if(Array.isArray(Q))return"array";if(typeof Q==="string")return"string";return"unknown"}function eQ(...Q){let[W,$,Y]=Q;if(typeof W==="string")return{message:W,code:"custom",input:$,inst:Y};return{...W}}function sV(Q){return Object.entries(Q).filter(([W,$])=>{return Number.isNaN(Number.parseInt(W,10))}).map((W)=>W[1])}class n7{constructor(...Q){}}var o7=(Q,W)=>{Q.name="$ZodError",Object.defineProperty(Q,"_zod",{value:Q._zod,enumerable:!1}),Object.defineProperty(Q,"issues",{value:W,enumerable:!1}),Object.defineProperty(Q,"message",{get(){return JSON.stringify(W,iQ,2)},enumerable:!0}),Object.defineProperty(Q,"toString",{value:()=>Q.message,enumerable:!1})},Y8=M("$ZodError",o7),t4=M("$ZodError",o7,{Parent:Error});function QW(Q,W=($)=>$.message){let $={},Y=[];for(let J of Q.issues)if(J.path.length>0)$[J.path[0]]=$[J.path[0]]||[],$[J.path[0]].push(W(J));else Y.push(W(J));return{formErrors:Y,fieldErrors:$}}function WW(Q,W){let $=W||function(X){return X.message},Y={_errors:[]},J=(X)=>{for(let G of X.issues)if(G.code==="invalid_union"&&G.errors.length)G.errors.map((H)=>J({issues:H}));else if(G.code==="invalid_key")J({issues:G.issues});else if(G.code==="invalid_element")J({issues:G.issues});else if(G.path.length===0)Y._errors.push($(G));else{let H=Y,B=0;while(B<G.path.length){let K=G.path[B];if(B!==G.path.length-1)H[K]=H[K]||{_errors:[]};else H[K]=H[K]||{_errors:[]},H[K]._errors.push($(G));H=H[K],B++}}};return J(Q),Y}var $W=(Q)=>(W,$,Y,J)=>{let X=Y?Object.assign(Y,{async:!1}):{async:!1},G=W._zod.run({value:$,issues:[]},X);if(G instanceof Promise)throw new e1;if(G.issues.length){let H=new(J?.Err??Q)(G.issues.map((B)=>U1(B,X,Q1())));throw W8(H,J?.callee),H}return G.value},YW=$W(t4),JW=(Q)=>async(W,$,Y,J)=>{let X=Y?Object.assign(Y,{async:!0}):{async:!0},G=W._zod.run({value:$,issues:[]},X);if(G instanceof Promise)G=await G;if(G.issues.length){let H=new(J?.Err??Q)(G.issues.map((B)=>U1(B,X,Q1())));throw W8(H,J?.callee),H}return G.value},XW=JW(t4),GW=(Q)=>(W,$,Y)=>{let J=Y?{...Y,async:!1}:{async:!1},X=W._zod.run({value:$,issues:[]},J);if(X instanceof Promise)throw new e1;return X.issues.length?{success:!1,error:new(Q??Y8)(X.issues.map((G)=>U1(G,J,Q1())))}:{success:!0,data:X.value}},I6=GW(t4),HW=(Q)=>async(W,$,Y)=>{let J=Y?Object.assign(Y,{async:!0}):{async:!0},X=W._zod.run({value:$,issues:[]},J);if(X instanceof Promise)X=await X;return X.issues.length?{success:!1,error:new Q(X.issues.map((G)=>U1(G,J,Q1())))}:{success:!0,data:X.value}},S6=HW(t4);var r7=/^[cC][^\s-]{8,}$/,a7=/^[0-9a-z]+$/,t7=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,s7=/^[0-9a-vA-V]{20}$/,e7=/^[A-Za-z0-9]{27}$/,QJ=/^[a-zA-Z0-9_-]{21}$/,WJ=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/;var $J=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,BW=(Q)=>{if(!Q)return/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/;return new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${Q}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`)};var YJ=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;function JJ(){return new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")}var XJ=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,GJ=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,HJ=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,BJ=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,KJ=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,KW=/^[A-Za-z0-9_-]*$/,VJ=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/;var FJ=/^\+(?:[0-9]){6,14}[0-9]$/,LJ="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",qJ=new RegExp(`^${LJ}$`);function UJ(Q){return typeof Q.precision==="number"?Q.precision===-1?"(?:[01]\\d|2[0-3]):[0-5]\\d":Q.precision===0?"(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d":`(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d\\.\\d{${Q.precision}}`:"(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?"}function AJ(Q){return new RegExp(`^${UJ(Q)}$`)}function DJ(Q){let W=UJ({precision:Q.precision}),$=["Z"];if(Q.local)$.push("");if(Q.offset)$.push("([+-]\\d{2}:\\d{2})");let Y=`${W}(?:${$.join("|")})`;return new RegExp(`^${LJ}T(?:${Y})$`)}var OJ=(Q)=>{let W=Q?`[\\s\\S]{${Q?.minimum??0},${Q?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${W}$`)};var wJ=/^\d+$/,NJ=/^-?\d+(?:\.\d+)?/i,MJ=/true|false/i,jJ=/null/i;var zJ=/^[^A-Z]*$/,EJ=/^[^a-z]*$/;var C0=M("$ZodCheck",(Q,W)=>{var $;Q._zod??(Q._zod={}),Q._zod.def=W,($=Q._zod).onattach??($.onattach=[])}),PJ={number:"number",bigint:"bigint",object:"date"},VW=M("$ZodCheckLessThan",(Q,W)=>{C0.init(Q,W);let $=PJ[typeof W.value];Q._zod.onattach.push((Y)=>{let J=Y._zod.bag,X=(W.inclusive?J.maximum:J.exclusiveMaximum)??Number.POSITIVE_INFINITY;if(W.value<X)if(W.inclusive)J.maximum=W.value;else J.exclusiveMaximum=W.value}),Q._zod.check=(Y)=>{if(W.inclusive?Y.value<=W.value:Y.value<W.value)return;Y.issues.push({origin:$,code:"too_big",maximum:W.value,input:Y.value,inclusive:W.inclusive,inst:Q,continue:!W.abort})}}),FW=M("$ZodCheckGreaterThan",(Q,W)=>{C0.init(Q,W);let $=PJ[typeof W.value];Q._zod.onattach.push((Y)=>{let J=Y._zod.bag,X=(W.inclusive?J.minimum:J.exclusiveMinimum)??Number.NEGATIVE_INFINITY;if(W.value>X)if(W.inclusive)J.minimum=W.value;else J.exclusiveMinimum=W.value}),Q._zod.check=(Y)=>{if(W.inclusive?Y.value>=W.value:Y.value>W.value)return;Y.issues.push({origin:$,code:"too_small",minimum:W.value,input:Y.value,inclusive:W.inclusive,inst:Q,continue:!W.abort})}}),RJ=M("$ZodCheckMultipleOf",(Q,W)=>{C0.init(Q,W),Q._zod.onattach.push(($)=>{var Y;(Y=$._zod.bag).multipleOf??(Y.multipleOf=W.value)}),Q._zod.check=($)=>{if(typeof $.value!==typeof W.value)throw Error("Cannot mix number and bigint in multiple_of check.");if(typeof $.value==="bigint"?$.value%W.value===BigInt(0):nQ($.value,W.value)===0)return;$.issues.push({origin:typeof $.value,code:"not_multiple_of",divisor:W.value,input:$.value,inst:Q,continue:!W.abort})}}),IJ=M("$ZodCheckNumberFormat",(Q,W)=>{C0.init(Q,W),W.format=W.format||"float64";let $=W.format?.includes("int"),Y=$?"int":"number",[J,X]=sQ[W.format];Q._zod.onattach.push((G)=>{let H=G._zod.bag;if(H.format=W.format,H.minimum=J,H.maximum=X,$)H.pattern=wJ}),Q._zod.check=(G)=>{let H=G.value;if($){if(!Number.isInteger(H)){G.issues.push({expected:Y,format:W.format,code:"invalid_type",input:H,inst:Q});return}if(!Number.isSafeInteger(H)){if(H>0)G.issues.push({input:H,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:Q,origin:Y,continue:!W.abort});else G.issues.push({input:H,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:Q,origin:Y,continue:!W.abort});return}}if(H<J)G.issues.push({origin:"number",input:H,code:"too_small",minimum:J,inclusive:!0,inst:Q,continue:!W.abort});if(H>X)G.issues.push({origin:"number",input:H,code:"too_big",maximum:X,inst:Q})}});var SJ=M("$ZodCheckMaxLength",(Q,W)=>{var $;C0.init(Q,W),($=Q._zod.def).when??($.when=(Y)=>{let J=Y.value;return!o4(J)&&J.length!==void 0}),Q._zod.onattach.push((Y)=>{let J=Y._zod.bag.maximum??Number.POSITIVE_INFINITY;if(W.maximum<J)Y._zod.bag.maximum=W.maximum}),Q._zod.check=(Y)=>{let J=Y.value;if(J.length<=W.maximum)return;let G=a4(J);Y.issues.push({origin:G,code:"too_big",maximum:W.maximum,inclusive:!0,input:J,inst:Q,continue:!W.abort})}}),bJ=M("$ZodCheckMinLength",(Q,W)=>{var $;C0.init(Q,W),($=Q._zod.def).when??($.when=(Y)=>{let J=Y.value;return!o4(J)&&J.length!==void 0}),Q._zod.onattach.push((Y)=>{let J=Y._zod.bag.minimum??Number.NEGATIVE_INFINITY;if(W.minimum>J)Y._zod.bag.minimum=W.minimum}),Q._zod.check=(Y)=>{let J=Y.value;if(J.length>=W.minimum)return;let G=a4(J);Y.issues.push({origin:G,code:"too_small",minimum:W.minimum,inclusive:!0,input:J,inst:Q,continue:!W.abort})}}),CJ=M("$ZodCheckLengthEquals",(Q,W)=>{var $;C0.init(Q,W),($=Q._zod.def).when??($.when=(Y)=>{let J=Y.value;return!o4(J)&&J.length!==void 0}),Q._zod.onattach.push((Y)=>{let J=Y._zod.bag;J.minimum=W.length,J.maximum=W.length,J.length=W.length}),Q._zod.check=(Y)=>{let J=Y.value,X=J.length;if(X===W.length)return;let G=a4(J),H=X>W.length;Y.issues.push({origin:G,...H?{code:"too_big",maximum:W.length}:{code:"too_small",minimum:W.length},inclusive:!0,exact:!0,input:Y.value,inst:Q,continue:!W.abort})}}),s4=M("$ZodCheckStringFormat",(Q,W)=>{var $,Y;if(C0.init(Q,W),Q._zod.onattach.push((J)=>{let X=J._zod.bag;if(X.format=W.format,W.pattern)X.patterns??(X.patterns=new Set),X.patterns.add(W.pattern)}),W.pattern)($=Q._zod).check??($.check=(J)=>{if(W.pattern.lastIndex=0,W.pattern.test(J.value))return;J.issues.push({origin:"string",code:"invalid_format",format:W.format,input:J.value,...W.pattern?{pattern:W.pattern.toString()}:{},inst:Q,continue:!W.abort})});else(Y=Q._zod).check??(Y.check=()=>{})}),ZJ=M("$ZodCheckRegex",(Q,W)=>{s4.init(Q,W),Q._zod.check=($)=>{if(W.pattern.lastIndex=0,W.pattern.test($.value))return;$.issues.push({origin:"string",code:"invalid_format",format:"regex",input:$.value,pattern:W.pattern.toString(),inst:Q,continue:!W.abort})}}),vJ=M("$ZodCheckLowerCase",(Q,W)=>{W.pattern??(W.pattern=zJ),s4.init(Q,W)}),TJ=M("$ZodCheckUpperCase",(Q,W)=>{W.pattern??(W.pattern=EJ),s4.init(Q,W)}),kJ=M("$ZodCheckIncludes",(Q,W)=>{C0.init(Q,W);let $=Q6(W.includes),Y=new RegExp(typeof W.position==="number"?`^.{${W.position}}${$}`:$);W.pattern=Y,Q._zod.onattach.push((J)=>{let X=J._zod.bag;X.patterns??(X.patterns=new Set),X.patterns.add(Y)}),Q._zod.check=(J)=>{if(J.value.includes(W.includes,W.position))return;J.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:W.includes,input:J.value,inst:Q,continue:!W.abort})}}),_J=M("$ZodCheckStartsWith",(Q,W)=>{C0.init(Q,W);let $=new RegExp(`^${Q6(W.prefix)}.*`);W.pattern??(W.pattern=$),Q._zod.onattach.push((Y)=>{let J=Y._zod.bag;J.patterns??(J.patterns=new Set),J.patterns.add($)}),Q._zod.check=(Y)=>{if(Y.value.startsWith(W.prefix))return;Y.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:W.prefix,input:Y.value,inst:Q,continue:!W.abort})}}),xJ=M("$ZodCheckEndsWith",(Q,W)=>{C0.init(Q,W);let $=new RegExp(`.*${Q6(W.suffix)}$`);W.pattern??(W.pattern=$),Q._zod.onattach.push((Y)=>{let J=Y._zod.bag;J.patterns??(J.patterns=new Set),J.patterns.add($)}),Q._zod.check=(Y)=>{if(Y.value.endsWith(W.suffix))return;Y.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:W.suffix,input:Y.value,inst:Q,continue:!W.abort})}});var yJ=M("$ZodCheckOverwrite",(Q,W)=>{C0.init(Q,W),Q._zod.check=($)=>{$.value=W.tx($.value)}});class LW{constructor(Q=[]){if(this.content=[],this.indent=0,this)this.args=Q}indented(Q){this.indent+=1,Q(this),this.indent-=1}write(Q){if(typeof Q==="function"){Q(this,{execution:"sync"}),Q(this,{execution:"async"});return}let $=Q.split(`
`).filter((X)=>X),Y=Math.min(...$.map((X)=>X.length-X.trimStart().length)),J=$.map((X)=>X.slice(Y)).map((X)=>" ".repeat(this.indent*2)+X);for(let X of J)this.content.push(X)}compile(){let Q=Function,W=this?.args,Y=[...(this?.content??[""]).map((J)=>`  ${J}`)];return new Q(...W,Y.join(`
`))}}var hJ={major:4,minor:0,patch:0};var Y0=M("$ZodType",(Q,W)=>{var $;Q??(Q={}),Q._zod.def=W,Q._zod.bag=Q._zod.bag||{},Q._zod.version=hJ;let Y=[...Q._zod.def.checks??[]];if(Q._zod.traits.has("$ZodCheck"))Y.unshift(Q);for(let J of Y)for(let X of J._zod.onattach)X(Q);if(Y.length===0)($=Q._zod).deferred??($.deferred=[]),Q._zod.deferred?.push(()=>{Q._zod.run=Q._zod.parse});else{let J=(X,G,H)=>{let B=R6(X),K;for(let F of G){if(F._zod.def.when){if(!F._zod.def.when(X))continue}else if(B)continue;let L=X.issues.length,U=F._zod.check(X);if(U instanceof Promise&&H?.async===!1)throw new e1;if(K||U instanceof Promise)K=(K??Promise.resolve()).then(async()=>{if(await U,X.issues.length===L)return;if(!B)B=R6(X,L)});else{if(X.issues.length===L)continue;if(!B)B=R6(X,L)}}if(K)return K.then(()=>{return X});return X};Q._zod.run=(X,G)=>{let H=Q._zod.parse(X,G);if(H instanceof Promise){if(G.async===!1)throw new e1;return H.then((B)=>J(B,Y,G))}return J(H,Y,G)}}Q["~standard"]={validate:(J)=>{try{let X=I6(Q,J);return X.success?{value:X.data}:{issues:X.error?.issues}}catch(X){return S6(Q,J).then((G)=>G.success?{value:G.data}:{issues:G.error?.issues})}},vendor:"zod",version:1}}),e4=M("$ZodString",(Q,W)=>{Y0.init(Q,W),Q._zod.pattern=[...Q?._zod.bag?.patterns??[]].pop()??OJ(Q._zod.bag),Q._zod.parse=($,Y)=>{if(W.coerce)try{$.value=String($.value)}catch(J){}if(typeof $.value==="string")return $;return $.issues.push({expected:"string",code:"invalid_type",input:$.value,inst:Q}),$}}),H0=M("$ZodStringFormat",(Q,W)=>{s4.init(Q,W),e4.init(Q,W)}),UW=M("$ZodGUID",(Q,W)=>{W.pattern??(W.pattern=$J),H0.init(Q,W)}),AW=M("$ZodUUID",(Q,W)=>{if(W.version){let Y={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[W.version];if(Y===void 0)throw Error(`Invalid UUID version: "${W.version}"`);W.pattern??(W.pattern=BW(Y))}else W.pattern??(W.pattern=BW());H0.init(Q,W)}),DW=M("$ZodEmail",(Q,W)=>{W.pattern??(W.pattern=YJ),H0.init(Q,W)}),OW=M("$ZodURL",(Q,W)=>{H0.init(Q,W),Q._zod.check=($)=>{try{let Y=$.value,J=new URL(Y),X=J.href;if(W.hostname){if(W.hostname.lastIndex=0,!W.hostname.test(J.hostname))$.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:VJ.source,input:$.value,inst:Q,continue:!W.abort})}if(W.protocol){if(W.protocol.lastIndex=0,!W.protocol.test(J.protocol.endsWith(":")?J.protocol.slice(0,-1):J.protocol))$.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:W.protocol.source,input:$.value,inst:Q,continue:!W.abort})}if(!Y.endsWith("/")&&X.endsWith("/"))$.value=X.slice(0,-1);else $.value=X;return}catch(Y){$.issues.push({code:"invalid_format",format:"url",input:$.value,inst:Q,continue:!W.abort})}}}),wW=M("$ZodEmoji",(Q,W)=>{W.pattern??(W.pattern=JJ()),H0.init(Q,W)}),NW=M("$ZodNanoID",(Q,W)=>{W.pattern??(W.pattern=QJ),H0.init(Q,W)}),MW=M("$ZodCUID",(Q,W)=>{W.pattern??(W.pattern=r7),H0.init(Q,W)}),jW=M("$ZodCUID2",(Q,W)=>{W.pattern??(W.pattern=a7),H0.init(Q,W)}),zW=M("$ZodULID",(Q,W)=>{W.pattern??(W.pattern=t7),H0.init(Q,W)}),EW=M("$ZodXID",(Q,W)=>{W.pattern??(W.pattern=s7),H0.init(Q,W)}),PW=M("$ZodKSUID",(Q,W)=>{W.pattern??(W.pattern=e7),H0.init(Q,W)}),oJ=M("$ZodISODateTime",(Q,W)=>{W.pattern??(W.pattern=DJ(W)),H0.init(Q,W)}),rJ=M("$ZodISODate",(Q,W)=>{W.pattern??(W.pattern=qJ),H0.init(Q,W)}),aJ=M("$ZodISOTime",(Q,W)=>{W.pattern??(W.pattern=AJ(W)),H0.init(Q,W)}),tJ=M("$ZodISODuration",(Q,W)=>{W.pattern??(W.pattern=WJ),H0.init(Q,W)}),RW=M("$ZodIPv4",(Q,W)=>{W.pattern??(W.pattern=XJ),H0.init(Q,W),Q._zod.onattach.push(($)=>{let Y=$._zod.bag;Y.format="ipv4"})}),IW=M("$ZodIPv6",(Q,W)=>{W.pattern??(W.pattern=GJ),H0.init(Q,W),Q._zod.onattach.push(($)=>{let Y=$._zod.bag;Y.format="ipv6"}),Q._zod.check=($)=>{try{new URL(`http://[${$.value}]`)}catch{$.issues.push({code:"invalid_format",format:"ipv6",input:$.value,inst:Q,continue:!W.abort})}}}),SW=M("$ZodCIDRv4",(Q,W)=>{W.pattern??(W.pattern=HJ),H0.init(Q,W)}),bW=M("$ZodCIDRv6",(Q,W)=>{W.pattern??(W.pattern=BJ),H0.init(Q,W),Q._zod.check=($)=>{let[Y,J]=$.value.split("/");try{if(!J)throw Error();let X=Number(J);if(`${X}`!==J)throw Error();if(X<0||X>128)throw Error();new URL(`http://[${Y}]`)}catch{$.issues.push({code:"invalid_format",format:"cidrv6",input:$.value,inst:Q,continue:!W.abort})}}});function sJ(Q){if(Q==="")return!0;if(Q.length%4!==0)return!1;try{return atob(Q),!0}catch{return!1}}var CW=M("$ZodBase64",(Q,W)=>{W.pattern??(W.pattern=KJ),H0.init(Q,W),Q._zod.onattach.push(($)=>{$._zod.bag.contentEncoding="base64"}),Q._zod.check=($)=>{if(sJ($.value))return;$.issues.push({code:"invalid_format",format:"base64",input:$.value,inst:Q,continue:!W.abort})}});function QF(Q){if(!KW.test(Q))return!1;let W=Q.replace(/[-_]/g,(Y)=>Y==="-"?"+":"/"),$=W.padEnd(Math.ceil(W.length/4)*4,"=");return sJ($)}var ZW=M("$ZodBase64URL",(Q,W)=>{W.pattern??(W.pattern=KW),H0.init(Q,W),Q._zod.onattach.push(($)=>{$._zod.bag.contentEncoding="base64url"}),Q._zod.check=($)=>{if(QF($.value))return;$.issues.push({code:"invalid_format",format:"base64url",input:$.value,inst:Q,continue:!W.abort})}}),vW=M("$ZodE164",(Q,W)=>{W.pattern??(W.pattern=FJ),H0.init(Q,W)});function WF(Q,W=null){try{let $=Q.split(".");if($.length!==3)return!1;let[Y]=$;if(!Y)return!1;let J=JSON.parse(atob(Y));if("typ"in J&&J?.typ!=="JWT")return!1;if(!J.alg)return!1;if(W&&(!("alg"in J)||J.alg!==W))return!1;return!0}catch{return!1}}var TW=M("$ZodJWT",(Q,W)=>{H0.init(Q,W),Q._zod.check=($)=>{if(WF($.value,W.alg))return;$.issues.push({code:"invalid_format",format:"jwt",input:$.value,inst:Q,continue:!W.abort})}});var G8=M("$ZodNumber",(Q,W)=>{Y0.init(Q,W),Q._zod.pattern=Q._zod.bag.pattern??NJ,Q._zod.parse=($,Y)=>{if(W.coerce)try{$.value=Number($.value)}catch(G){}let J=$.value;if(typeof J==="number"&&!Number.isNaN(J)&&Number.isFinite(J))return $;let X=typeof J==="number"?Number.isNaN(J)?"NaN":!Number.isFinite(J)?"Infinity":void 0:void 0;return $.issues.push({expected:"number",code:"invalid_type",input:J,inst:Q,...X?{received:X}:{}}),$}}),kW=M("$ZodNumber",(Q,W)=>{IJ.init(Q,W),G8.init(Q,W)}),_W=M("$ZodBoolean",(Q,W)=>{Y0.init(Q,W),Q._zod.pattern=MJ,Q._zod.parse=($,Y)=>{if(W.coerce)try{$.value=Boolean($.value)}catch(X){}let J=$.value;if(typeof J==="boolean")return $;return $.issues.push({expected:"boolean",code:"invalid_type",input:J,inst:Q}),$}});var xW=M("$ZodNull",(Q,W)=>{Y0.init(Q,W),Q._zod.pattern=jJ,Q._zod.values=new Set([null]),Q._zod.parse=($,Y)=>{let J=$.value;if(J===null)return $;return $.issues.push({expected:"null",code:"invalid_type",input:J,inst:Q}),$}});var yW=M("$ZodUnknown",(Q,W)=>{Y0.init(Q,W),Q._zod.parse=($)=>$}),gW=M("$ZodNever",(Q,W)=>{Y0.init(Q,W),Q._zod.parse=($,Y)=>{return $.issues.push({expected:"never",code:"invalid_type",input:$.value,inst:Q}),$}});function fJ(Q,W,$){if(Q.issues.length)W.issues.push(...b1($,Q.issues));W.value[$]=Q.value}var hW=M("$ZodArray",(Q,W)=>{Y0.init(Q,W),Q._zod.parse=($,Y)=>{let J=$.value;if(!Array.isArray(J))return $.issues.push({expected:"array",code:"invalid_type",input:J,inst:Q}),$;$.value=Array(J.length);let X=[];for(let G=0;G<J.length;G++){let H=J[G],B=W.element._zod.run({value:H,issues:[]},Y);if(B instanceof Promise)X.push(B.then((K)=>fJ(K,$,G)));else fJ(B,$,G)}if(X.length)return Promise.all(X).then(()=>$);return $}});function X8(Q,W,$){if(Q.issues.length)W.issues.push(...b1($,Q.issues));W.value[$]=Q.value}function uJ(Q,W,$,Y){if(Q.issues.length)if(Y[$]===void 0)if($ in Y)W.value[$]=void 0;else W.value[$]=Q.value;else W.issues.push(...b1($,Q.issues));else if(Q.value===void 0){if($ in Y)W.value[$]=void 0}else W.value[$]=Q.value}var H8=M("$ZodObject",(Q,W)=>{Y0.init(Q,W);let $=n4(()=>{let L=Object.keys(W.shape);for(let q of L)if(!(W.shape[q]instanceof Y0))throw Error(`Invalid element at key "${q}": expected a Zod schema`);let U=tQ(W.shape);return{shape:W.shape,keys:L,keySet:new Set(L),numKeys:L.length,optionalKeys:new Set(U)}});G0(Q._zod,"propValues",()=>{let L=W.shape,U={};for(let q in L){let A=L[q]._zod;if(A.values){U[q]??(U[q]=new Set);for(let D of A.values)U[q].add(D)}}return U});let Y=(L)=>{let U=new LW(["shape","payload","ctx"]),q=$.value,A=(j)=>{let z=P6(j);return`shape[${z}]._zod.run({ value: input[${z}], issues: [] }, ctx)`};U.write("const input = payload.value;");let D=Object.create(null),O=0;for(let j of q.keys)D[j]=`key_${O++}`;U.write("const newResult = {}");for(let j of q.keys)if(q.optionalKeys.has(j)){let z=D[j];U.write(`const ${z} = ${A(j)};`);let C=P6(j);U.write(`
        if (${z}.issues.length) {
          if (input[${C}] === undefined) {
            if (${C} in input) {
              newResult[${C}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${z}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${C}, ...iss.path] : [${C}],
              }))
            );
          }
        } else if (${z}.value === undefined) {
          if (${C} in input) newResult[${C}] = undefined;
        } else {
          newResult[${C}] = ${z}.value;
        }
        `)}else{let z=D[j];U.write(`const ${z} = ${A(j)};`),U.write(`
          if (${z}.issues.length) payload.issues = payload.issues.concat(${z}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${P6(j)}, ...iss.path] : [${P6(j)}]
          })));`),U.write(`newResult[${P6(j)}] = ${z}.value`)}U.write("payload.value = newResult;"),U.write("return payload;");let w=U.compile();return(j,z)=>w(L,j,z)},J,X=K4,G=!e9.jitless,B=G&&rQ.value,K=W.catchall,F;Q._zod.parse=(L,U)=>{F??(F=$.value);let q=L.value;if(!X(q))return L.issues.push({expected:"object",code:"invalid_type",input:q,inst:Q}),L;let A=[];if(G&&B&&U?.async===!1&&U.jitless!==!0){if(!J)J=Y(W.shape);L=J(L,U)}else{L.value={};let z=F.shape;for(let C of F.keys){let b=z[C],D0=b._zod.run({value:q[C],issues:[]},U),S0=b._zod.optin==="optional"&&b._zod.optout==="optional";if(D0 instanceof Promise)A.push(D0.then((x1)=>S0?uJ(x1,L,C,q):X8(x1,L,C)));else if(S0)uJ(D0,L,C,q);else X8(D0,L,C)}}if(!K)return A.length?Promise.all(A).then(()=>L):L;let D=[],O=F.keySet,w=K._zod,j=w.def.type;for(let z of Object.keys(q)){if(O.has(z))continue;if(j==="never"){D.push(z);continue}let C=w.run({value:q[z],issues:[]},U);if(C instanceof Promise)A.push(C.then((b)=>X8(b,L,z)));else X8(C,L,z)}if(D.length)L.issues.push({code:"unrecognized_keys",keys:D,input:q,inst:Q});if(!A.length)return L;return Promise.all(A).then(()=>{return L})}});function lJ(Q,W,$,Y){for(let J of Q)if(J.issues.length===0)return W.value=J.value,W;return W.issues.push({code:"invalid_union",input:W.value,inst:$,errors:Q.map((J)=>J.issues.map((X)=>U1(X,Y,Q1())))}),W}var B8=M("$ZodUnion",(Q,W)=>{Y0.init(Q,W),G0(Q._zod,"optin",()=>W.options.some(($)=>$._zod.optin==="optional")?"optional":void 0),G0(Q._zod,"optout",()=>W.options.some(($)=>$._zod.optout==="optional")?"optional":void 0),G0(Q._zod,"values",()=>{if(W.options.every(($)=>$._zod.values))return new Set(W.options.flatMap(($)=>Array.from($._zod.values)));return}),G0(Q._zod,"pattern",()=>{if(W.options.every(($)=>$._zod.pattern)){let $=W.options.map((Y)=>Y._zod.pattern);return new RegExp(`^(${$.map((Y)=>r4(Y.source)).join("|")})$`)}return}),Q._zod.parse=($,Y)=>{let J=!1,X=[];for(let G of W.options){let H=G._zod.run({value:$.value,issues:[]},Y);if(H instanceof Promise)X.push(H),J=!0;else{if(H.issues.length===0)return H;X.push(H)}}if(!J)return lJ(X,$,Q,Y);return Promise.all(X).then((G)=>{return lJ(G,$,Q,Y)})}}),fW=M("$ZodDiscriminatedUnion",(Q,W)=>{B8.init(Q,W);let $=Q._zod.parse;G0(Q._zod,"propValues",()=>{let J={};for(let X of W.options){let G=X._zod.propValues;if(!G||Object.keys(G).length===0)throw Error(`Invalid discriminated union option at index "${W.options.indexOf(X)}"`);for(let[H,B]of Object.entries(G)){if(!J[H])J[H]=new Set;for(let K of B)J[H].add(K)}}return J});let Y=n4(()=>{let J=W.options,X=new Map;for(let G of J){let H=G._zod.propValues[W.discriminator];if(!H||H.size===0)throw Error(`Invalid discriminated union option at index "${W.options.indexOf(G)}"`);for(let B of H){if(X.has(B))throw Error(`Duplicate discriminator value "${String(B)}"`);X.set(B,G)}}return X});Q._zod.parse=(J,X)=>{let G=J.value;if(!K4(G))return J.issues.push({code:"invalid_type",expected:"object",input:G,inst:Q}),J;let H=Y.value.get(G?.[W.discriminator]);if(H)return H._zod.run(J,X);if(W.unionFallback)return $(J,X);return J.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:G,path:[W.discriminator],inst:Q}),J}}),uW=M("$ZodIntersection",(Q,W)=>{Y0.init(Q,W),Q._zod.parse=($,Y)=>{let J=$.value,X=W.left._zod.run({value:J,issues:[]},Y),G=W.right._zod.run({value:J,issues:[]},Y);if(X instanceof Promise||G instanceof Promise)return Promise.all([X,G]).then(([B,K])=>{return mJ($,B,K)});return mJ($,X,G)}});function qW(Q,W){if(Q===W)return{valid:!0,data:Q};if(Q instanceof Date&&W instanceof Date&&+Q===+W)return{valid:!0,data:Q};if(V4(Q)&&V4(W)){let $=Object.keys(W),Y=Object.keys(Q).filter((X)=>$.indexOf(X)!==-1),J={...Q,...W};for(let X of Y){let G=qW(Q[X],W[X]);if(!G.valid)return{valid:!1,mergeErrorPath:[X,...G.mergeErrorPath]};J[X]=G.data}return{valid:!0,data:J}}if(Array.isArray(Q)&&Array.isArray(W)){if(Q.length!==W.length)return{valid:!1,mergeErrorPath:[]};let $=[];for(let Y=0;Y<Q.length;Y++){let J=Q[Y],X=W[Y],G=qW(J,X);if(!G.valid)return{valid:!1,mergeErrorPath:[Y,...G.mergeErrorPath]};$.push(G.data)}return{valid:!0,data:$}}return{valid:!1,mergeErrorPath:[]}}function mJ(Q,W,$){if(W.issues.length)Q.issues.push(...W.issues);if($.issues.length)Q.issues.push(...$.issues);if(R6(Q))return Q;let Y=qW(W.value,$.value);if(!Y.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(Y.mergeErrorPath)}`);return Q.value=Y.data,Q}var lW=M("$ZodRecord",(Q,W)=>{Y0.init(Q,W),Q._zod.parse=($,Y)=>{let J=$.value;if(!V4(J))return $.issues.push({expected:"record",code:"invalid_type",input:J,inst:Q}),$;let X=[];if(W.keyType._zod.values){let G=W.keyType._zod.values;$.value={};for(let B of G)if(typeof B==="string"||typeof B==="number"||typeof B==="symbol"){let K=W.valueType._zod.run({value:J[B],issues:[]},Y);if(K instanceof Promise)X.push(K.then((F)=>{if(F.issues.length)$.issues.push(...b1(B,F.issues));$.value[B]=F.value}));else{if(K.issues.length)$.issues.push(...b1(B,K.issues));$.value[B]=K.value}}let H;for(let B in J)if(!G.has(B))H=H??[],H.push(B);if(H&&H.length>0)$.issues.push({code:"unrecognized_keys",input:J,inst:Q,keys:H})}else{$.value={};for(let G of Reflect.ownKeys(J)){if(G==="__proto__")continue;let H=W.keyType._zod.run({value:G,issues:[]},Y);if(H instanceof Promise)throw Error("Async schemas not supported in object keys currently");if(H.issues.length){$.issues.push({origin:"record",code:"invalid_key",issues:H.issues.map((K)=>U1(K,Y,Q1())),input:G,path:[G],inst:Q}),$.value[H.value]=H.value;continue}let B=W.valueType._zod.run({value:J[G],issues:[]},Y);if(B instanceof Promise)X.push(B.then((K)=>{if(K.issues.length)$.issues.push(...b1(G,K.issues));$.value[H.value]=K.value}));else{if(B.issues.length)$.issues.push(...b1(G,B.issues));$.value[H.value]=B.value}}}if(X.length)return Promise.all(X).then(()=>$);return $}});var mW=M("$ZodEnum",(Q,W)=>{Y0.init(Q,W);let $=i4(W.entries);Q._zod.values=new Set($),Q._zod.pattern=new RegExp(`^(${$.filter((Y)=>aQ.has(typeof Y)).map((Y)=>typeof Y==="string"?Q6(Y):Y.toString()).join("|")})$`),Q._zod.parse=(Y,J)=>{let X=Y.value;if(Q._zod.values.has(X))return Y;return Y.issues.push({code:"invalid_value",values:$,input:X,inst:Q}),Y}}),cW=M("$ZodLiteral",(Q,W)=>{Y0.init(Q,W),Q._zod.values=new Set(W.values),Q._zod.pattern=new RegExp(`^(${W.values.map(($)=>typeof $==="string"?Q6($):$?$.toString():String($)).join("|")})$`),Q._zod.parse=($,Y)=>{let J=$.value;if(Q._zod.values.has(J))return $;return $.issues.push({code:"invalid_value",values:W.values,input:J,inst:Q}),$}});var pW=M("$ZodTransform",(Q,W)=>{Y0.init(Q,W),Q._zod.parse=($,Y)=>{let J=W.transform($.value,$);if(Y.async)return(J instanceof Promise?J:Promise.resolve(J)).then((G)=>{return $.value=G,$});if(J instanceof Promise)throw new e1;return $.value=J,$}}),dW=M("$ZodOptional",(Q,W)=>{Y0.init(Q,W),Q._zod.optin="optional",Q._zod.optout="optional",G0(Q._zod,"values",()=>{return W.innerType._zod.values?new Set([...W.innerType._zod.values,void 0]):void 0}),G0(Q._zod,"pattern",()=>{let $=W.innerType._zod.pattern;return $?new RegExp(`^(${r4($.source)})?$`):void 0}),Q._zod.parse=($,Y)=>{if(W.innerType._zod.optin==="optional")return W.innerType._zod.run($,Y);if($.value===void 0)return $;return W.innerType._zod.run($,Y)}}),iW=M("$ZodNullable",(Q,W)=>{Y0.init(Q,W),G0(Q._zod,"optin",()=>W.innerType._zod.optin),G0(Q._zod,"optout",()=>W.innerType._zod.optout),G0(Q._zod,"pattern",()=>{let $=W.innerType._zod.pattern;return $?new RegExp(`^(${r4($.source)}|null)$`):void 0}),G0(Q._zod,"values",()=>{return W.innerType._zod.values?new Set([...W.innerType._zod.values,null]):void 0}),Q._zod.parse=($,Y)=>{if($.value===null)return $;return W.innerType._zod.run($,Y)}}),nW=M("$ZodDefault",(Q,W)=>{Y0.init(Q,W),Q._zod.optin="optional",G0(Q._zod,"values",()=>W.innerType._zod.values),Q._zod.parse=($,Y)=>{if($.value===void 0)return $.value=W.defaultValue,$;let J=W.innerType._zod.run($,Y);if(J instanceof Promise)return J.then((X)=>cJ(X,W));return cJ(J,W)}});function cJ(Q,W){if(Q.value===void 0)Q.value=W.defaultValue;return Q}var oW=M("$ZodPrefault",(Q,W)=>{Y0.init(Q,W),Q._zod.optin="optional",G0(Q._zod,"values",()=>W.innerType._zod.values),Q._zod.parse=($,Y)=>{if($.value===void 0)$.value=W.defaultValue;return W.innerType._zod.run($,Y)}}),rW=M("$ZodNonOptional",(Q,W)=>{Y0.init(Q,W),G0(Q._zod,"values",()=>{let $=W.innerType._zod.values;return $?new Set([...$].filter((Y)=>Y!==void 0)):void 0}),Q._zod.parse=($,Y)=>{let J=W.innerType._zod.run($,Y);if(J instanceof Promise)return J.then((X)=>pJ(X,Q));return pJ(J,Q)}});function pJ(Q,W){if(!Q.issues.length&&Q.value===void 0)Q.issues.push({code:"invalid_type",expected:"nonoptional",input:Q.value,inst:W});return Q}var aW=M("$ZodCatch",(Q,W)=>{Y0.init(Q,W),Q._zod.optin="optional",G0(Q._zod,"optout",()=>W.innerType._zod.optout),G0(Q._zod,"values",()=>W.innerType._zod.values),Q._zod.parse=($,Y)=>{let J=W.innerType._zod.run($,Y);if(J instanceof Promise)return J.then((X)=>{if($.value=X.value,X.issues.length)$.value=W.catchValue({...$,error:{issues:X.issues.map((G)=>U1(G,Y,Q1()))},input:$.value}),$.issues=[];return $});if($.value=J.value,J.issues.length)$.value=W.catchValue({...$,error:{issues:J.issues.map((X)=>U1(X,Y,Q1()))},input:$.value}),$.issues=[];return $}});var tW=M("$ZodPipe",(Q,W)=>{Y0.init(Q,W),G0(Q._zod,"values",()=>W.in._zod.values),G0(Q._zod,"optin",()=>W.in._zod.optin),G0(Q._zod,"optout",()=>W.out._zod.optout),Q._zod.parse=($,Y)=>{let J=W.in._zod.run($,Y);if(J instanceof Promise)return J.then((X)=>dJ(X,W,Y));return dJ(J,W,Y)}});function dJ(Q,W,$){if(R6(Q))return Q;return W.out._zod.run({value:Q.value,issues:Q.issues},$)}var sW=M("$ZodReadonly",(Q,W)=>{Y0.init(Q,W),G0(Q._zod,"propValues",()=>W.innerType._zod.propValues),G0(Q._zod,"values",()=>W.innerType._zod.values),G0(Q._zod,"optin",()=>W.innerType._zod.optin),G0(Q._zod,"optout",()=>W.innerType._zod.optout),Q._zod.parse=($,Y)=>{let J=W.innerType._zod.run($,Y);if(J instanceof Promise)return J.then(iJ);return iJ(J)}});function iJ(Q){return Q.value=Object.freeze(Q.value),Q}var eW=M("$ZodCustom",(Q,W)=>{C0.init(Q,W),Y0.init(Q,W),Q._zod.parse=($,Y)=>{return $},Q._zod.check=($)=>{let Y=$.value,J=W.fn(Y);if(J instanceof Promise)return J.then((X)=>nJ(X,$,Y,Q));nJ(J,$,Y,Q);return}});function nJ(Q,W,$,Y){if(!Q){let J={code:"custom",input:$,inst:Y,path:[...Y._zod.def.path??[]],continue:!Y._zod.def.abort};if(Y._zod.def.params)J.params=Y._zod.def.params;W.issues.push(eQ(J))}}var $F=(Q)=>{let W=typeof Q;switch(W){case"number":return Number.isNaN(Q)?"NaN":"number";case"object":{if(Array.isArray(Q))return"array";if(Q===null)return"null";if(Object.getPrototypeOf(Q)!==Object.prototype&&Q.constructor)return Q.constructor.name}}return W},YF=()=>{let Q={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function W(Y){return Q[Y]??null}let $={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return(Y)=>{switch(Y.code){case"invalid_type":return`Invalid input: expected ${Y.expected}, received ${$F(Y.input)}`;case"invalid_value":if(Y.values.length===1)return`Invalid input: expected ${$8(Y.values[0])}`;return`Invalid option: expected one of ${Q8(Y.values,"|")}`;case"too_big":{let J=Y.inclusive?"<=":"<",X=W(Y.origin);if(X)return`Too big: expected ${Y.origin??"value"} to have ${J}${Y.maximum.toString()} ${X.unit??"elements"}`;return`Too big: expected ${Y.origin??"value"} to be ${J}${Y.maximum.toString()}`}case"too_small":{let J=Y.inclusive?">=":">",X=W(Y.origin);if(X)return`Too small: expected ${Y.origin} to have ${J}${Y.minimum.toString()} ${X.unit}`;return`Too small: expected ${Y.origin} to be ${J}${Y.minimum.toString()}`}case"invalid_format":{let J=Y;if(J.format==="starts_with")return`Invalid string: must start with "${J.prefix}"`;if(J.format==="ends_with")return`Invalid string: must end with "${J.suffix}"`;if(J.format==="includes")return`Invalid string: must include "${J.includes}"`;if(J.format==="regex")return`Invalid string: must match pattern ${J.pattern}`;return`Invalid ${$[J.format]??Y.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${Y.divisor}`;case"unrecognized_keys":return`Unrecognized key${Y.keys.length>1?"s":""}: ${Q8(Y.keys,", ")}`;case"invalid_key":return`Invalid key in ${Y.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${Y.origin}`;default:return"Invalid input"}}};function Q$(){return{localeError:YF()}}var JF=Symbol("ZodOutput"),XF=Symbol("ZodInput");class K8{constructor(){this._map=new Map,this._idmap=new Map}add(Q,...W){let $=W[0];if(this._map.set(Q,$),$&&typeof $==="object"&&"id"in $){if(this._idmap.has($.id))throw Error(`ID ${$.id} already exists in the registry`);this._idmap.set($.id,Q)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(Q){let W=this._map.get(Q);if(W&&typeof W==="object"&&"id"in W)this._idmap.delete(W.id);return this._map.delete(Q),this}get(Q){let W=Q._zod.parent;if(W){let $={...this.get(W)??{}};return delete $.id,{...$,...this._map.get(Q)}}return this._map.get(Q)}has(Q){return this._map.has(Q)}}function eJ(){return new K8}var W6=eJ();function W$(Q,W){return new Q({type:"string",...f(W)})}function $$(Q,W){return new Q({type:"string",format:"email",check:"string_format",abort:!1,...f(W)})}function V8(Q,W){return new Q({type:"string",format:"guid",check:"string_format",abort:!1,...f(W)})}function Y$(Q,W){return new Q({type:"string",format:"uuid",check:"string_format",abort:!1,...f(W)})}function J$(Q,W){return new Q({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...f(W)})}function X$(Q,W){return new Q({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...f(W)})}function G$(Q,W){return new Q({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...f(W)})}function H$(Q,W){return new Q({type:"string",format:"url",check:"string_format",abort:!1,...f(W)})}function B$(Q,W){return new Q({type:"string",format:"emoji",check:"string_format",abort:!1,...f(W)})}function K$(Q,W){return new Q({type:"string",format:"nanoid",check:"string_format",abort:!1,...f(W)})}function V$(Q,W){return new Q({type:"string",format:"cuid",check:"string_format",abort:!1,...f(W)})}function F$(Q,W){return new Q({type:"string",format:"cuid2",check:"string_format",abort:!1,...f(W)})}function L$(Q,W){return new Q({type:"string",format:"ulid",check:"string_format",abort:!1,...f(W)})}function q$(Q,W){return new Q({type:"string",format:"xid",check:"string_format",abort:!1,...f(W)})}function U$(Q,W){return new Q({type:"string",format:"ksuid",check:"string_format",abort:!1,...f(W)})}function A$(Q,W){return new Q({type:"string",format:"ipv4",check:"string_format",abort:!1,...f(W)})}function D$(Q,W){return new Q({type:"string",format:"ipv6",check:"string_format",abort:!1,...f(W)})}function O$(Q,W){return new Q({type:"string",format:"cidrv4",check:"string_format",abort:!1,...f(W)})}function w$(Q,W){return new Q({type:"string",format:"cidrv6",check:"string_format",abort:!1,...f(W)})}function N$(Q,W){return new Q({type:"string",format:"base64",check:"string_format",abort:!1,...f(W)})}function M$(Q,W){return new Q({type:"string",format:"base64url",check:"string_format",abort:!1,...f(W)})}function j$(Q,W){return new Q({type:"string",format:"e164",check:"string_format",abort:!1,...f(W)})}function z$(Q,W){return new Q({type:"string",format:"jwt",check:"string_format",abort:!1,...f(W)})}function QX(Q,W){return new Q({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...f(W)})}function WX(Q,W){return new Q({type:"string",format:"date",check:"string_format",...f(W)})}function $X(Q,W){return new Q({type:"string",format:"time",check:"string_format",precision:null,...f(W)})}function YX(Q,W){return new Q({type:"string",format:"duration",check:"string_format",...f(W)})}function E$(Q,W){return new Q({type:"number",checks:[],...f(W)})}function P$(Q,W){return new Q({type:"number",check:"number_format",abort:!1,format:"safeint",...f(W)})}function R$(Q,W){return new Q({type:"boolean",...f(W)})}function I$(Q,W){return new Q({type:"null",...f(W)})}function S$(Q){return new Q({type:"unknown"})}function b$(Q,W){return new Q({type:"never",...f(W)})}function F8(Q,W){return new VW({check:"less_than",...f(W),value:Q,inclusive:!1})}function Q9(Q,W){return new VW({check:"less_than",...f(W),value:Q,inclusive:!0})}function L8(Q,W){return new FW({check:"greater_than",...f(W),value:Q,inclusive:!1})}function W9(Q,W){return new FW({check:"greater_than",...f(W),value:Q,inclusive:!0})}function q8(Q,W){return new RJ({check:"multiple_of",...f(W),value:Q})}function U8(Q,W){return new SJ({check:"max_length",...f(W),maximum:Q})}function F4(Q,W){return new bJ({check:"min_length",...f(W),minimum:Q})}function A8(Q,W){return new CJ({check:"length_equals",...f(W),length:Q})}function C$(Q,W){return new ZJ({check:"string_format",format:"regex",...f(W),pattern:Q})}function Z$(Q){return new vJ({check:"string_format",format:"lowercase",...f(Q)})}function v$(Q){return new TJ({check:"string_format",format:"uppercase",...f(Q)})}function T$(Q,W){return new kJ({check:"string_format",format:"includes",...f(W),includes:Q})}function k$(Q,W){return new _J({check:"string_format",format:"starts_with",...f(W),prefix:Q})}function _$(Q,W){return new xJ({check:"string_format",format:"ends_with",...f(W),suffix:Q})}function b6(Q){return new yJ({check:"overwrite",tx:Q})}function x$(Q){return b6((W)=>W.normalize(Q))}function y$(){return b6((Q)=>Q.trim())}function g$(){return b6((Q)=>Q.toLowerCase())}function h$(){return b6((Q)=>Q.toUpperCase())}function JX(Q,W,$){return new Q({type:"array",element:W,...f($)})}function f$(Q,W,$){let Y=f($);return Y.abort??(Y.abort=!0),new Q({type:"custom",check:"custom",fn:W,...Y})}function u$(Q,W,$){return new Q({type:"custom",check:"custom",fn:W,...f($)})}class l${constructor(Q){this.counter=0,this.metadataRegistry=Q?.metadata??W6,this.target=Q?.target??"draft-2020-12",this.unrepresentable=Q?.unrepresentable??"throw",this.override=Q?.override??(()=>{}),this.io=Q?.io??"output",this.seen=new Map}process(Q,W={path:[],schemaPath:[]}){var $;let Y=Q._zod.def,J={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},X=this.seen.get(Q);if(X){if(X.count++,W.schemaPath.includes(Q))X.cycle=W.path;return X.schema}let G={schema:{},count:1,cycle:void 0,path:W.path};this.seen.set(Q,G);let H=Q._zod.toJSONSchema?.();if(H)G.schema=H;else{let F={...W,schemaPath:[...W.schemaPath,Q],path:W.path},L=Q._zod.parent;if(L)G.ref=L,this.process(L,F),this.seen.get(L).isParent=!0;else{let U=G.schema;switch(Y.type){case"string":{let q=U;q.type="string";let{minimum:A,maximum:D,format:O,patterns:w,contentEncoding:j}=Q._zod.bag;if(typeof A==="number")q.minLength=A;if(typeof D==="number")q.maxLength=D;if(O){if(q.format=J[O]??O,q.format==="")delete q.format}if(j)q.contentEncoding=j;if(w&&w.size>0){let z=[...w];if(z.length===1)q.pattern=z[0].source;else if(z.length>1)G.schema.allOf=[...z.map((C)=>({...this.target==="draft-7"?{type:"string"}:{},pattern:C.source}))]}break}case"number":{let q=U,{minimum:A,maximum:D,format:O,multipleOf:w,exclusiveMaximum:j,exclusiveMinimum:z}=Q._zod.bag;if(typeof O==="string"&&O.includes("int"))q.type="integer";else q.type="number";if(typeof z==="number")q.exclusiveMinimum=z;if(typeof A==="number"){if(q.minimum=A,typeof z==="number")if(z>=A)delete q.minimum;else delete q.exclusiveMinimum}if(typeof j==="number")q.exclusiveMaximum=j;if(typeof D==="number"){if(q.maximum=D,typeof j==="number")if(j<=D)delete q.maximum;else delete q.exclusiveMaximum}if(typeof w==="number")q.multipleOf=w;break}case"boolean":{let q=U;q.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw Error("Symbols cannot be represented in JSON Schema");break}case"null":{U.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw Error("Void cannot be represented in JSON Schema");break}case"never":{U.not={};break}case"date":{if(this.unrepresentable==="throw")throw Error("Date cannot be represented in JSON Schema");break}case"array":{let q=U,{minimum:A,maximum:D}=Q._zod.bag;if(typeof A==="number")q.minItems=A;if(typeof D==="number")q.maxItems=D;q.type="array",q.items=this.process(Y.element,{...F,path:[...F.path,"items"]});break}case"object":{let q=U;q.type="object",q.properties={};let A=Y.shape;for(let w in A)q.properties[w]=this.process(A[w],{...F,path:[...F.path,"properties",w]});let D=new Set(Object.keys(A)),O=new Set([...D].filter((w)=>{let j=Y.shape[w]._zod;if(this.io==="input")return j.optin===void 0;else return j.optout===void 0}));if(O.size>0)q.required=Array.from(O);if(Y.catchall?._zod.def.type==="never")q.additionalProperties=!1;else if(!Y.catchall){if(this.io==="output")q.additionalProperties=!1}else if(Y.catchall)q.additionalProperties=this.process(Y.catchall,{...F,path:[...F.path,"additionalProperties"]});break}case"union":{let q=U;q.anyOf=Y.options.map((A,D)=>this.process(A,{...F,path:[...F.path,"anyOf",D]}));break}case"intersection":{let q=U,A=this.process(Y.left,{...F,path:[...F.path,"allOf",0]}),D=this.process(Y.right,{...F,path:[...F.path,"allOf",1]}),O=(j)=>("allOf"in j)&&Object.keys(j).length===1,w=[...O(A)?A.allOf:[A],...O(D)?D.allOf:[D]];q.allOf=w;break}case"tuple":{let q=U;q.type="array";let A=Y.items.map((w,j)=>this.process(w,{...F,path:[...F.path,"prefixItems",j]}));if(this.target==="draft-2020-12")q.prefixItems=A;else q.items=A;if(Y.rest){let w=this.process(Y.rest,{...F,path:[...F.path,"items"]});if(this.target==="draft-2020-12")q.items=w;else q.additionalItems=w}if(Y.rest)q.items=this.process(Y.rest,{...F,path:[...F.path,"items"]});let{minimum:D,maximum:O}=Q._zod.bag;if(typeof D==="number")q.minItems=D;if(typeof O==="number")q.maxItems=O;break}case"record":{let q=U;q.type="object",q.propertyNames=this.process(Y.keyType,{...F,path:[...F.path,"propertyNames"]}),q.additionalProperties=this.process(Y.valueType,{...F,path:[...F.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw Error("Set cannot be represented in JSON Schema");break}case"enum":{let q=U,A=i4(Y.entries);if(A.every((D)=>typeof D==="number"))q.type="number";if(A.every((D)=>typeof D==="string"))q.type="string";q.enum=A;break}case"literal":{let q=U,A=[];for(let D of Y.values)if(D===void 0){if(this.unrepresentable==="throw")throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof D==="bigint")if(this.unrepresentable==="throw")throw Error("BigInt literals cannot be represented in JSON Schema");else A.push(Number(D));else A.push(D);if(A.length===0);else if(A.length===1){let D=A[0];q.type=D===null?"null":typeof D,q.const=D}else{if(A.every((D)=>typeof D==="number"))q.type="number";if(A.every((D)=>typeof D==="string"))q.type="string";if(A.every((D)=>typeof D==="boolean"))q.type="string";if(A.every((D)=>D===null))q.type="null";q.enum=A}break}case"file":{let q=U,A={type:"string",format:"binary",contentEncoding:"binary"},{minimum:D,maximum:O,mime:w}=Q._zod.bag;if(D!==void 0)A.minLength=D;if(O!==void 0)A.maxLength=O;if(w)if(w.length===1)A.contentMediaType=w[0],Object.assign(q,A);else q.anyOf=w.map((j)=>{return{...A,contentMediaType:j}});else Object.assign(q,A);break}case"transform":{if(this.unrepresentable==="throw")throw Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{let q=this.process(Y.innerType,F);U.anyOf=[q,{type:"null"}];break}case"nonoptional":{this.process(Y.innerType,F),G.ref=Y.innerType;break}case"success":{let q=U;q.type="boolean";break}case"default":{this.process(Y.innerType,F),G.ref=Y.innerType,U.default=JSON.parse(JSON.stringify(Y.defaultValue));break}case"prefault":{if(this.process(Y.innerType,F),G.ref=Y.innerType,this.io==="input")U._prefault=JSON.parse(JSON.stringify(Y.defaultValue));break}case"catch":{this.process(Y.innerType,F),G.ref=Y.innerType;let q;try{q=Y.catchValue(void 0)}catch{throw Error("Dynamic catch values are not supported in JSON Schema")}U.default=q;break}case"nan":{if(this.unrepresentable==="throw")throw Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{let q=U,A=Q._zod.pattern;if(!A)throw Error("Pattern not found in template literal");q.type="string",q.pattern=A.source;break}case"pipe":{let q=this.io==="input"?Y.in._zod.def.type==="transform"?Y.out:Y.in:Y.out;this.process(q,F),G.ref=q;break}case"readonly":{this.process(Y.innerType,F),G.ref=Y.innerType,U.readOnly=!0;break}case"promise":{this.process(Y.innerType,F),G.ref=Y.innerType;break}case"optional":{this.process(Y.innerType,F),G.ref=Y.innerType;break}case"lazy":{let q=Q._zod.innerType;this.process(q,F),G.ref=q;break}case"custom":{if(this.unrepresentable==="throw")throw Error("Custom types cannot be represented in JSON Schema");break}default:}}}let B=this.metadataRegistry.get(Q);if(B)Object.assign(G.schema,B);if(this.io==="input"&&P0(Q))delete G.schema.examples,delete G.schema.default;if(this.io==="input"&&G.schema._prefault)($=G.schema).default??($.default=G.schema._prefault);return delete G.schema._prefault,this.seen.get(Q).schema}emit(Q,W){let $={cycles:W?.cycles??"ref",reused:W?.reused??"inline",external:W?.external??void 0},Y=this.seen.get(Q);if(!Y)throw Error("Unprocessed schema. This is a bug in Zod.");let J=(K)=>{let F=this.target==="draft-2020-12"?"$defs":"definitions";if($.external){let A=$.external.registry.get(K[0])?.id,D=$.external.uri??((w)=>w);if(A)return{ref:D(A)};let O=K[1].defId??K[1].schema.id??`schema${this.counter++}`;return K[1].defId=O,{defId:O,ref:`${D("__shared")}#/${F}/${O}`}}if(K[1]===Y)return{ref:"#"};let U=`${"#"}/${F}/`,q=K[1].schema.id??`__schema${this.counter++}`;return{defId:q,ref:U+q}},X=(K)=>{if(K[1].schema.$ref)return;let F=K[1],{ref:L,defId:U}=J(K);if(F.def={...F.schema},U)F.defId=U;let q=F.schema;for(let A in q)delete q[A];q.$ref=L};if($.cycles==="throw")for(let K of this.seen.entries()){let F=K[1];if(F.cycle)throw Error(`Cycle detected: #/${F.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let K of this.seen.entries()){let F=K[1];if(Q===K[0]){X(K);continue}if($.external){let U=$.external.registry.get(K[0])?.id;if(Q!==K[0]&&U){X(K);continue}}if(this.metadataRegistry.get(K[0])?.id){X(K);continue}if(F.cycle){X(K);continue}if(F.count>1){if($.reused==="ref"){X(K);continue}}}let G=(K,F)=>{let L=this.seen.get(K),U=L.def??L.schema,q={...U};if(L.ref===null)return;let A=L.ref;if(L.ref=null,A){G(A,F);let D=this.seen.get(A).schema;if(D.$ref&&F.target==="draft-7")U.allOf=U.allOf??[],U.allOf.push(D);else Object.assign(U,D),Object.assign(U,q)}if(!L.isParent)this.override({zodSchema:K,jsonSchema:U,path:L.path??[]})};for(let K of[...this.seen.entries()].reverse())G(K[0],{target:this.target});let H={};if(this.target==="draft-2020-12")H.$schema="https://json-schema.org/draft/2020-12/schema";else if(this.target==="draft-7")H.$schema="http://json-schema.org/draft-07/schema#";else console.warn(`Invalid target: ${this.target}`);if($.external?.uri){let K=$.external.registry.get(Q)?.id;if(!K)throw Error("Schema is missing an `id` property");H.$id=$.external.uri(K)}Object.assign(H,Y.def);let B=$.external?.defs??{};for(let K of this.seen.entries()){let F=K[1];if(F.def&&F.defId)B[F.defId]=F.def}if($.external);else if(Object.keys(B).length>0)if(this.target==="draft-2020-12")H.$defs=B;else H.definitions=B;try{return JSON.parse(JSON.stringify(H))}catch(K){throw Error("Error converting schema to JSON.")}}}function m$(Q,W){if(Q instanceof K8){let Y=new l$(W),J={};for(let H of Q._idmap.entries()){let[B,K]=H;Y.process(K)}let X={},G={registry:Q,uri:W?.uri,defs:J};for(let H of Q._idmap.entries()){let[B,K]=H;X[B]=Y.emit(K,{...W,external:G})}if(Object.keys(J).length>0){let H=Y.target==="draft-2020-12"?"$defs":"definitions";X.__shared={[H]:J}}return{schemas:X}}let $=new l$(W);return $.process(Q),$.emit(Q,W)}function P0(Q,W){let $=W??{seen:new Set};if($.seen.has(Q))return!1;$.seen.add(Q);let J=Q._zod.def;switch(J.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return P0(J.element,$);case"object":{for(let X in J.shape)if(P0(J.shape[X],$))return!0;return!1}case"union":{for(let X of J.options)if(P0(X,$))return!0;return!1}case"intersection":return P0(J.left,$)||P0(J.right,$);case"tuple":{for(let X of J.items)if(P0(X,$))return!0;if(J.rest&&P0(J.rest,$))return!0;return!1}case"record":return P0(J.keyType,$)||P0(J.valueType,$);case"map":return P0(J.keyType,$)||P0(J.valueType,$);case"set":return P0(J.valueType,$);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return P0(J.innerType,$);case"lazy":return P0(J.getter(),$);case"default":return P0(J.innerType,$);case"prefault":return P0(J.innerType,$);case"custom":return!1;case"transform":return!0;case"pipe":return P0(J.in,$)||P0(J.out,$);case"success":return!1;case"catch":return!1;default:}throw Error(`Unknown schema type: ${J.type}`)}var uF=M("ZodMiniType",(Q,W)=>{if(!Q._zod)throw Error("Uninitialized schema in ZodMiniType.");Y0.init(Q,W),Q.def=W,Q.parse=($,Y)=>YW(Q,$,Y,{callee:Q.parse}),Q.safeParse=($,Y)=>I6(Q,$,Y),Q.parseAsync=async($,Y)=>XW(Q,$,Y,{callee:Q.parseAsync}),Q.safeParseAsync=async($,Y)=>S6(Q,$,Y),Q.check=(...$)=>{return Q.clone({...W,checks:[...W.checks??[],...$.map((Y)=>typeof Y==="function"?{_zod:{check:Y,def:{check:"custom"},onattach:[]}}:Y)]})},Q.clone=($,Y)=>W1(Q,$,Y),Q.brand=()=>Q,Q.register=($,Y)=>{return $.add(Q,Y),Q}});var lF=M("ZodMiniObject",(Q,W)=>{H8.init(Q,W),uF.init(Q,W),r.defineLazy(Q,"shape",()=>W.shape)});function c$(Q,W){let $={type:"object",get shape(){return r.assignProp(this,"shape",{...Q}),this.shape},...r.normalizeParams(W)};return new lF($)}function J1(Q){return!!Q._zod}function Z6(Q){let W=Object.values(Q);if(W.length===0)return c$({});let $=W.every(J1),Y=W.every((J)=>!J1(J));if($)return c$(Q);if(Y)return pQ(Q);throw Error("Mixed Zod versions detected in object shape.")}function $6(Q,W){if(J1(Q))return I6(Q,W);return Q.safeParse(W)}async function D8(Q,W){if(J1(Q))return await S6(Q,W);return await Q.safeParseAsync(W)}function Y6(Q){if(!Q)return;let W;if(J1(Q))W=Q._zod?.def?.shape;else W=Q.shape;if(!W)return;if(typeof W==="function")try{return W()}catch{return}return W}function L4(Q){if(!Q)return;if(typeof Q==="object"){let W=Q,$=Q;if(!W._def&&!$._zod){let Y=Object.values(Q);if(Y.length>0&&Y.every((J)=>typeof J==="object"&&J!==null&&(J._def!==void 0||J._zod!==void 0||typeof J.parse==="function")))return Z6(Q)}}if(J1(Q)){let $=Q._zod?.def;if($&&($.type==="object"||$.shape!==void 0))return Q}else if(Q.shape!==void 0)return Q;return}function O8(Q){if(Q&&typeof Q==="object"){if("message"in Q&&typeof Q.message==="string")return Q.message;if("issues"in Q&&Array.isArray(Q.issues)&&Q.issues.length>0){let W=Q.issues[0];if(W&&typeof W==="object"&&"message"in W)return String(W.message)}try{return JSON.stringify(Q)}catch{return String(Q)}}return String(Q)}function GX(Q){return Q.description}function HX(Q){if(J1(Q))return Q._zod?.def?.type==="optional";let W=Q;if(typeof Q.isOptional==="function")return Q.isOptional();return W._def?.typeName==="ZodOptional"}function w8(Q){if(J1(Q)){let X=Q._zod?.def;if(X){if(X.value!==void 0)return X.value;if(Array.isArray(X.values)&&X.values.length>0)return X.values[0]}}let $=Q._def;if($){if($.value!==void 0)return $.value;if(Array.isArray($.values)&&$.values.length>0)return $.values[0]}let Y=Q.value;if(Y!==void 0)return Y;return}var $9={};uQ($9,{time:()=>i$,duration:()=>n$,datetime:()=>p$,date:()=>d$,ZodISOTime:()=>VX,ZodISODuration:()=>FX,ZodISODateTime:()=>BX,ZodISODate:()=>KX});var BX=M("ZodISODateTime",(Q,W)=>{oJ.init(Q,W),L0.init(Q,W)});function p$(Q){return QX(BX,Q)}var KX=M("ZodISODate",(Q,W)=>{rJ.init(Q,W),L0.init(Q,W)});function d$(Q){return WX(KX,Q)}var VX=M("ZodISOTime",(Q,W)=>{aJ.init(Q,W),L0.init(Q,W)});function i$(Q){return $X(VX,Q)}var FX=M("ZodISODuration",(Q,W)=>{tJ.init(Q,W),L0.init(Q,W)});function n$(Q){return YX(FX,Q)}var LX=(Q,W)=>{Y8.init(Q,W),Q.name="ZodError",Object.defineProperties(Q,{format:{value:($)=>WW(Q,$)},flatten:{value:($)=>QW(Q,$)},addIssue:{value:($)=>Q.issues.push($)},addIssues:{value:($)=>Q.issues.push(...$)},isEmpty:{get(){return Q.issues.length===0}}})},Gz=M("ZodError",LX),Y9=M("ZodError",LX,{Parent:Error});var qX=$W(Y9),UX=JW(Y9),AX=GW(Y9),DX=HW(Y9);var N0=M("ZodType",(Q,W)=>{return Y0.init(Q,W),Q.def=W,Object.defineProperty(Q,"_def",{value:W}),Q.check=(...$)=>{return Q.clone({...W,checks:[...W.checks??[],...$.map((Y)=>typeof Y==="function"?{_zod:{check:Y,def:{check:"custom"},onattach:[]}}:Y)]})},Q.clone=($,Y)=>W1(Q,$,Y),Q.brand=()=>Q,Q.register=($,Y)=>{return $.add(Q,Y),Q},Q.parse=($,Y)=>qX(Q,$,Y,{callee:Q.parse}),Q.safeParse=($,Y)=>AX(Q,$,Y),Q.parseAsync=async($,Y)=>UX(Q,$,Y,{callee:Q.parseAsync}),Q.safeParseAsync=async($,Y)=>DX(Q,$,Y),Q.spa=Q.safeParseAsync,Q.refine=($,Y)=>Q.check(hL($,Y)),Q.superRefine=($)=>Q.check(fL($)),Q.overwrite=($)=>Q.check(b6($)),Q.optional=()=>w0(Q),Q.nullable=()=>NX(Q),Q.nullish=()=>w0(NX(Q)),Q.nonoptional=($)=>vL(Q,$),Q.array=()=>a(Q),Q.or=($)=>B0([Q,$]),Q.and=($)=>M8(Q,$),Q.transform=($)=>r$(Q,PX($)),Q.default=($)=>bL(Q,$),Q.prefault=($)=>ZL(Q,$),Q.catch=($)=>kL(Q,$),Q.pipe=($)=>r$(Q,$),Q.readonly=()=>yL(Q),Q.describe=($)=>{let Y=Q.clone();return W6.add(Y,{description:$}),Y},Object.defineProperty(Q,"description",{get(){return W6.get(Q)?.description},configurable:!0}),Q.meta=(...$)=>{if($.length===0)return W6.get(Q);let Y=Q.clone();return W6.add(Y,$[0]),Y},Q.isOptional=()=>Q.safeParse(void 0).success,Q.isNullable=()=>Q.safeParse(null).success,Q}),MX=M("_ZodString",(Q,W)=>{e4.init(Q,W),N0.init(Q,W);let $=Q._zod.bag;Q.format=$.format??null,Q.minLength=$.minimum??null,Q.maxLength=$.maximum??null,Q.regex=(...Y)=>Q.check(C$(...Y)),Q.includes=(...Y)=>Q.check(T$(...Y)),Q.startsWith=(...Y)=>Q.check(k$(...Y)),Q.endsWith=(...Y)=>Q.check(_$(...Y)),Q.min=(...Y)=>Q.check(F4(...Y)),Q.max=(...Y)=>Q.check(U8(...Y)),Q.length=(...Y)=>Q.check(A8(...Y)),Q.nonempty=(...Y)=>Q.check(F4(1,...Y)),Q.lowercase=(Y)=>Q.check(Z$(Y)),Q.uppercase=(Y)=>Q.check(v$(Y)),Q.trim=()=>Q.check(y$()),Q.normalize=(...Y)=>Q.check(x$(...Y)),Q.toLowerCase=()=>Q.check(g$()),Q.toUpperCase=()=>Q.check(h$())}),aF=M("ZodString",(Q,W)=>{e4.init(Q,W),MX.init(Q,W),Q.email=($)=>Q.check($$(tF,$)),Q.url=($)=>Q.check(H$(sF,$)),Q.jwt=($)=>Q.check(z$(qL,$)),Q.emoji=($)=>Q.check(B$(eF,$)),Q.guid=($)=>Q.check(V8(OX,$)),Q.uuid=($)=>Q.check(Y$(N8,$)),Q.uuidv4=($)=>Q.check(J$(N8,$)),Q.uuidv6=($)=>Q.check(X$(N8,$)),Q.uuidv7=($)=>Q.check(G$(N8,$)),Q.nanoid=($)=>Q.check(K$(QL,$)),Q.guid=($)=>Q.check(V8(OX,$)),Q.cuid=($)=>Q.check(V$(WL,$)),Q.cuid2=($)=>Q.check(F$($L,$)),Q.ulid=($)=>Q.check(L$(YL,$)),Q.base64=($)=>Q.check(N$(VL,$)),Q.base64url=($)=>Q.check(M$(FL,$)),Q.xid=($)=>Q.check(q$(JL,$)),Q.ksuid=($)=>Q.check(U$(XL,$)),Q.ipv4=($)=>Q.check(A$(GL,$)),Q.ipv6=($)=>Q.check(D$(HL,$)),Q.cidrv4=($)=>Q.check(O$(BL,$)),Q.cidrv6=($)=>Q.check(w$(KL,$)),Q.e164=($)=>Q.check(j$(LL,$)),Q.datetime=($)=>Q.check(p$($)),Q.date=($)=>Q.check(d$($)),Q.time=($)=>Q.check(i$($)),Q.duration=($)=>Q.check(n$($))});function N(Q){return W$(aF,Q)}var L0=M("ZodStringFormat",(Q,W)=>{H0.init(Q,W),MX.init(Q,W)}),tF=M("ZodEmail",(Q,W)=>{DW.init(Q,W),L0.init(Q,W)});var OX=M("ZodGUID",(Q,W)=>{UW.init(Q,W),L0.init(Q,W)});var N8=M("ZodUUID",(Q,W)=>{AW.init(Q,W),L0.init(Q,W)});var sF=M("ZodURL",(Q,W)=>{OW.init(Q,W),L0.init(Q,W)});var eF=M("ZodEmoji",(Q,W)=>{wW.init(Q,W),L0.init(Q,W)});var QL=M("ZodNanoID",(Q,W)=>{NW.init(Q,W),L0.init(Q,W)});var WL=M("ZodCUID",(Q,W)=>{MW.init(Q,W),L0.init(Q,W)});var $L=M("ZodCUID2",(Q,W)=>{jW.init(Q,W),L0.init(Q,W)});var YL=M("ZodULID",(Q,W)=>{zW.init(Q,W),L0.init(Q,W)});var JL=M("ZodXID",(Q,W)=>{EW.init(Q,W),L0.init(Q,W)});var XL=M("ZodKSUID",(Q,W)=>{PW.init(Q,W),L0.init(Q,W)});var GL=M("ZodIPv4",(Q,W)=>{RW.init(Q,W),L0.init(Q,W)});var HL=M("ZodIPv6",(Q,W)=>{IW.init(Q,W),L0.init(Q,W)});var BL=M("ZodCIDRv4",(Q,W)=>{SW.init(Q,W),L0.init(Q,W)});var KL=M("ZodCIDRv6",(Q,W)=>{bW.init(Q,W),L0.init(Q,W)});var VL=M("ZodBase64",(Q,W)=>{CW.init(Q,W),L0.init(Q,W)});var FL=M("ZodBase64URL",(Q,W)=>{ZW.init(Q,W),L0.init(Q,W)});var LL=M("ZodE164",(Q,W)=>{vW.init(Q,W),L0.init(Q,W)});var qL=M("ZodJWT",(Q,W)=>{TW.init(Q,W),L0.init(Q,W)});var jX=M("ZodNumber",(Q,W)=>{G8.init(Q,W),N0.init(Q,W),Q.gt=(Y,J)=>Q.check(L8(Y,J)),Q.gte=(Y,J)=>Q.check(W9(Y,J)),Q.min=(Y,J)=>Q.check(W9(Y,J)),Q.lt=(Y,J)=>Q.check(F8(Y,J)),Q.lte=(Y,J)=>Q.check(Q9(Y,J)),Q.max=(Y,J)=>Q.check(Q9(Y,J)),Q.int=(Y)=>Q.check(wX(Y)),Q.safe=(Y)=>Q.check(wX(Y)),Q.positive=(Y)=>Q.check(L8(0,Y)),Q.nonnegative=(Y)=>Q.check(W9(0,Y)),Q.negative=(Y)=>Q.check(F8(0,Y)),Q.nonpositive=(Y)=>Q.check(Q9(0,Y)),Q.multipleOf=(Y,J)=>Q.check(q8(Y,J)),Q.step=(Y,J)=>Q.check(q8(Y,J)),Q.finite=()=>Q;let $=Q._zod.bag;Q.minValue=Math.max($.minimum??Number.NEGATIVE_INFINITY,$.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,Q.maxValue=Math.min($.maximum??Number.POSITIVE_INFINITY,$.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,Q.isInt=($.format??"").includes("int")||Number.isSafeInteger($.multipleOf??0.5),Q.isFinite=!0,Q.format=$.format??null});function $0(Q){return E$(jX,Q)}var UL=M("ZodNumberFormat",(Q,W)=>{kW.init(Q,W),jX.init(Q,W)});function wX(Q){return P$(UL,Q)}var AL=M("ZodBoolean",(Q,W)=>{_W.init(Q,W),N0.init(Q,W)});function I0(Q){return R$(AL,Q)}var DL=M("ZodNull",(Q,W)=>{xW.init(Q,W),N0.init(Q,W)});function a$(Q){return I$(DL,Q)}var OL=M("ZodUnknown",(Q,W)=>{yW.init(Q,W),N0.init(Q,W)});function q0(){return S$(OL)}var wL=M("ZodNever",(Q,W)=>{gW.init(Q,W),N0.init(Q,W)});function NL(Q){return b$(wL,Q)}var ML=M("ZodArray",(Q,W)=>{hW.init(Q,W),N0.init(Q,W),Q.element=W.element,Q.min=($,Y)=>Q.check(F4($,Y)),Q.nonempty=($)=>Q.check(F4(1,$)),Q.max=($,Y)=>Q.check(U8($,Y)),Q.length=($,Y)=>Q.check(A8($,Y)),Q.unwrap=()=>Q.element});function a(Q,W){return JX(ML,Q,W)}var zX=M("ZodObject",(Q,W)=>{H8.init(Q,W),N0.init(Q,W),r.defineLazy(Q,"shape",()=>W.shape),Q.keyof=()=>n0(Object.keys(Q._zod.def.shape)),Q.catchall=($)=>Q.clone({...Q._zod.def,catchall:$}),Q.passthrough=()=>Q.clone({...Q._zod.def,catchall:q0()}),Q.loose=()=>Q.clone({...Q._zod.def,catchall:q0()}),Q.strict=()=>Q.clone({...Q._zod.def,catchall:NL()}),Q.strip=()=>Q.clone({...Q._zod.def,catchall:void 0}),Q.extend=($)=>{return r.extend(Q,$)},Q.merge=($)=>r.merge(Q,$),Q.pick=($)=>r.pick(Q,$),Q.omit=($)=>r.omit(Q,$),Q.partial=(...$)=>r.partial(RX,Q,$[0]),Q.required=(...$)=>r.required(IX,Q,$[0])});function v(Q,W){let $={type:"object",get shape(){return r.assignProp(this,"shape",{...Q}),this.shape},...r.normalizeParams(W)};return new zX($)}function m0(Q,W){return new zX({type:"object",get shape(){return r.assignProp(this,"shape",{...Q}),this.shape},catchall:q0(),...r.normalizeParams(W)})}var EX=M("ZodUnion",(Q,W)=>{B8.init(Q,W),N0.init(Q,W),Q.options=W.options});function B0(Q,W){return new EX({type:"union",options:Q,...r.normalizeParams(W)})}var jL=M("ZodDiscriminatedUnion",(Q,W)=>{EX.init(Q,W),fW.init(Q,W)});function t$(Q,W,$){return new jL({type:"union",options:W,discriminator:Q,...r.normalizeParams($)})}var zL=M("ZodIntersection",(Q,W)=>{uW.init(Q,W),N0.init(Q,W)});function M8(Q,W){return new zL({type:"intersection",left:Q,right:W})}var EL=M("ZodRecord",(Q,W)=>{lW.init(Q,W),N0.init(Q,W),Q.keyType=W.keyType,Q.valueType=W.valueType});function U0(Q,W,$){return new EL({type:"record",keyType:Q,valueType:W,...r.normalizeParams($)})}var o$=M("ZodEnum",(Q,W)=>{mW.init(Q,W),N0.init(Q,W),Q.enum=W.entries,Q.options=Object.values(W.entries);let $=new Set(Object.keys(W.entries));Q.extract=(Y,J)=>{let X={};for(let G of Y)if($.has(G))X[G]=W.entries[G];else throw Error(`Key ${G} not found in enum`);return new o$({...W,checks:[],...r.normalizeParams(J),entries:X})},Q.exclude=(Y,J)=>{let X={...W.entries};for(let G of Y)if($.has(G))delete X[G];else throw Error(`Key ${G} not found in enum`);return new o$({...W,checks:[],...r.normalizeParams(J),entries:X})}});function n0(Q,W){let $=Array.isArray(Q)?Object.fromEntries(Q.map((Y)=>[Y,Y])):Q;return new o$({type:"enum",entries:$,...r.normalizeParams(W)})}var PL=M("ZodLiteral",(Q,W)=>{cW.init(Q,W),N0.init(Q,W),Q.values=new Set(W.values),Object.defineProperty(Q,"value",{get(){if(W.values.length>1)throw Error("This schema contains multiple valid literal values. Use `.values` instead.");return W.values[0]}})});function _(Q,W){return new PL({type:"literal",values:Array.isArray(Q)?Q:[Q],...r.normalizeParams(W)})}var RL=M("ZodTransform",(Q,W)=>{pW.init(Q,W),N0.init(Q,W),Q._zod.parse=($,Y)=>{$.addIssue=(X)=>{if(typeof X==="string")$.issues.push(r.issue(X,$.value,W));else{let G=X;if(G.fatal)G.continue=!1;G.code??(G.code="custom"),G.input??(G.input=$.value),G.inst??(G.inst=Q),G.continue??(G.continue=!0),$.issues.push(r.issue(G))}};let J=W.transform($.value,$);if(J instanceof Promise)return J.then((X)=>{return $.value=X,$});return $.value=J,$}});function PX(Q){return new RL({type:"transform",transform:Q})}var RX=M("ZodOptional",(Q,W)=>{dW.init(Q,W),N0.init(Q,W),Q.unwrap=()=>Q._zod.def.innerType});function w0(Q){return new RX({type:"optional",innerType:Q})}var IL=M("ZodNullable",(Q,W)=>{iW.init(Q,W),N0.init(Q,W),Q.unwrap=()=>Q._zod.def.innerType});function NX(Q){return new IL({type:"nullable",innerType:Q})}var SL=M("ZodDefault",(Q,W)=>{nW.init(Q,W),N0.init(Q,W),Q.unwrap=()=>Q._zod.def.innerType,Q.removeDefault=Q.unwrap});function bL(Q,W){return new SL({type:"default",innerType:Q,get defaultValue(){return typeof W==="function"?W():W}})}var CL=M("ZodPrefault",(Q,W)=>{oW.init(Q,W),N0.init(Q,W),Q.unwrap=()=>Q._zod.def.innerType});function ZL(Q,W){return new CL({type:"prefault",innerType:Q,get defaultValue(){return typeof W==="function"?W():W}})}var IX=M("ZodNonOptional",(Q,W)=>{rW.init(Q,W),N0.init(Q,W),Q.unwrap=()=>Q._zod.def.innerType});function vL(Q,W){return new IX({type:"nonoptional",innerType:Q,...r.normalizeParams(W)})}var TL=M("ZodCatch",(Q,W)=>{aW.init(Q,W),N0.init(Q,W),Q.unwrap=()=>Q._zod.def.innerType,Q.removeCatch=Q.unwrap});function kL(Q,W){return new TL({type:"catch",innerType:Q,catchValue:typeof W==="function"?W:()=>W})}var _L=M("ZodPipe",(Q,W)=>{tW.init(Q,W),N0.init(Q,W),Q.in=W.in,Q.out=W.out});function r$(Q,W){return new _L({type:"pipe",in:Q,out:W})}var xL=M("ZodReadonly",(Q,W)=>{sW.init(Q,W),N0.init(Q,W)});function yL(Q){return new xL({type:"readonly",innerType:Q})}var SX=M("ZodCustom",(Q,W)=>{eW.init(Q,W),N0.init(Q,W)});function gL(Q){let W=new C0({check:"custom"});return W._zod.check=Q,W}function bX(Q,W){return f$(SX,Q??(()=>!0),W)}function hL(Q,W={}){return u$(SX,Q,W)}function fL(Q){let W=gL(($)=>{return $.addIssue=(Y)=>{if(typeof Y==="string")$.issues.push(r.issue(Y,$.value,W._zod.def));else{let J=Y;if(J.fatal)J.continue=!1;J.code??(J.code="custom"),J.input??(J.input=$.value),J.inst??(J.inst=W),J.continue??(J.continue=!W._zod.def.abort),$.issues.push(r.issue(J))}},Q($.value,$)});return W}function s$(Q,W){return r$(PX(Q),W)}Q1(Q$());var e$="2025-11-25",CX="2025-03-26",J9=[e$,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],J6="io.modelcontextprotocol/related-task",z8="2.0",Z0=bX((Q)=>Q!==null&&(typeof Q==="object"||typeof Q==="function")),ZX=B0([N(),$0().int()]),vX=N(),Mz=m0({ttl:B0([$0(),a$()]).optional(),pollInterval:$0().optional()}),uL=v({ttl:$0().optional()}),lL=v({taskId:N()}),QY=m0({progressToken:ZX.optional(),[J6]:lL.optional()}),$1=v({_meta:QY.optional()}),X9=$1.extend({task:uL.optional()}),TX=(Q)=>X9.safeParse(Q).success,v0=v({method:N(),params:$1.loose().optional()}),X1=v({_meta:QY.optional()}),G1=v({method:N(),params:X1.loose().optional()}),T0=m0({_meta:QY.optional()}),E8=B0([N(),$0().int()]),kX=v({jsonrpc:_(z8),id:E8,...v0.shape}).strict(),X6=(Q)=>kX.safeParse(Q).success,_X=v({jsonrpc:_(z8),...G1.shape}).strict(),xX=(Q)=>_X.safeParse(Q).success,WY=v({jsonrpc:_(z8),id:E8,result:T0}).strict(),f1=(Q)=>WY.safeParse(Q).success;var y;(function(Q){Q[Q.ConnectionClosed=-32000]="ConnectionClosed",Q[Q.RequestTimeout=-32001]="RequestTimeout",Q[Q.ParseError=-32700]="ParseError",Q[Q.InvalidRequest=-32600]="InvalidRequest",Q[Q.MethodNotFound=-32601]="MethodNotFound",Q[Q.InvalidParams=-32602]="InvalidParams",Q[Q.InternalError=-32603]="InternalError",Q[Q.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(y||(y={}));var $Y=v({jsonrpc:_(z8),id:E8.optional(),error:v({code:$0().int(),message:N(),data:q0().optional()})}).strict();var U4=(Q)=>$Y.safeParse(Q).success;var YY=B0([kX,_X,WY,$Y]),jz=B0([WY,$Y]),P8=T0.strict(),mL=X1.extend({requestId:E8.optional(),reason:N().optional()}),R8=G1.extend({method:_("notifications/cancelled"),params:mL}),cL=v({src:N(),mimeType:N().optional(),sizes:a(N()).optional(),theme:n0(["light","dark"]).optional()}),G9=v({icons:a(cL).optional()}),q4=v({name:N(),title:N().optional()}),yX=q4.extend({...q4.shape,...G9.shape,version:N(),websiteUrl:N().optional(),description:N().optional()}),pL=M8(v({applyDefaults:I0().optional()}),U0(N(),q0())),dL=s$((Q)=>{if(Q&&typeof Q==="object"&&!Array.isArray(Q)){if(Object.keys(Q).length===0)return{form:{}}}return Q},M8(v({form:pL.optional(),url:Z0.optional()}),U0(N(),q0()).optional())),iL=m0({list:Z0.optional(),cancel:Z0.optional(),requests:m0({sampling:m0({createMessage:Z0.optional()}).optional(),elicitation:m0({create:Z0.optional()}).optional()}).optional()}),nL=m0({list:Z0.optional(),cancel:Z0.optional(),requests:m0({tools:m0({call:Z0.optional()}).optional()}).optional()}),oL=v({experimental:U0(N(),Z0).optional(),sampling:v({context:Z0.optional(),tools:Z0.optional()}).optional(),elicitation:dL.optional(),roots:v({listChanged:I0().optional()}).optional(),tasks:iL.optional()}),rL=$1.extend({protocolVersion:N(),capabilities:oL,clientInfo:yX}),I8=v0.extend({method:_("initialize"),params:rL}),JY=(Q)=>I8.safeParse(Q).success,aL=v({experimental:U0(N(),Z0).optional(),logging:Z0.optional(),completions:Z0.optional(),prompts:v({listChanged:I0().optional()}).optional(),resources:v({subscribe:I0().optional(),listChanged:I0().optional()}).optional(),tools:v({listChanged:I0().optional()}).optional(),tasks:nL.optional()}),tL=T0.extend({protocolVersion:N(),capabilities:aL,serverInfo:yX,instructions:N().optional()}),XY=G1.extend({method:_("notifications/initialized"),params:X1.optional()});var S8=v0.extend({method:_("ping"),params:$1.optional()}),sL=v({progress:$0(),total:w0($0()),message:w0(N())}),eL=v({...X1.shape,...sL.shape,progressToken:ZX}),b8=G1.extend({method:_("notifications/progress"),params:eL}),Qq=$1.extend({cursor:vX.optional()}),H9=v0.extend({params:Qq.optional()}),B9=T0.extend({nextCursor:vX.optional()}),Wq=n0(["working","input_required","completed","failed","cancelled"]),K9=v({taskId:N(),status:Wq,ttl:B0([$0(),a$()]),createdAt:N(),lastUpdatedAt:N(),pollInterval:w0($0()),statusMessage:w0(N())}),A4=T0.extend({task:K9}),$q=X1.merge(K9),V9=G1.extend({method:_("notifications/tasks/status"),params:$q}),C8=v0.extend({method:_("tasks/get"),params:$1.extend({taskId:N()})}),Z8=T0.merge(K9),v8=v0.extend({method:_("tasks/result"),params:$1.extend({taskId:N()})}),zz=T0.loose(),T8=H9.extend({method:_("tasks/list")}),k8=B9.extend({tasks:a(K9)}),_8=v0.extend({method:_("tasks/cancel"),params:$1.extend({taskId:N()})}),gX=T0.merge(K9),hX=v({uri:N(),mimeType:w0(N()),_meta:U0(N(),q0()).optional()}),fX=hX.extend({text:N()}),GY=N().refine((Q)=>{try{return atob(Q),!0}catch{return!1}},{message:"Invalid Base64 string"}),uX=hX.extend({blob:GY}),F9=n0(["user","assistant"]),D4=v({audience:a(F9).optional(),priority:$0().min(0).max(1).optional(),lastModified:$9.datetime({offset:!0}).optional()}),lX=v({...q4.shape,...G9.shape,uri:N(),description:w0(N()),mimeType:w0(N()),annotations:D4.optional(),_meta:w0(m0({}))}),Yq=v({...q4.shape,...G9.shape,uriTemplate:N(),description:w0(N()),mimeType:w0(N()),annotations:D4.optional(),_meta:w0(m0({}))}),x8=H9.extend({method:_("resources/list")}),Jq=B9.extend({resources:a(lX)}),y8=H9.extend({method:_("resources/templates/list")}),Xq=B9.extend({resourceTemplates:a(Yq)}),HY=$1.extend({uri:N()}),Gq=HY,g8=v0.extend({method:_("resources/read"),params:Gq}),Hq=T0.extend({contents:a(B0([fX,uX]))}),Bq=G1.extend({method:_("notifications/resources/list_changed"),params:X1.optional()}),Kq=HY,Vq=v0.extend({method:_("resources/subscribe"),params:Kq}),Fq=HY,Lq=v0.extend({method:_("resources/unsubscribe"),params:Fq}),qq=X1.extend({uri:N()}),Uq=G1.extend({method:_("notifications/resources/updated"),params:qq}),Aq=v({name:N(),description:w0(N()),required:w0(I0())}),Dq=v({...q4.shape,...G9.shape,description:w0(N()),arguments:w0(a(Aq)),_meta:w0(m0({}))}),h8=H9.extend({method:_("prompts/list")}),Oq=B9.extend({prompts:a(Dq)}),wq=$1.extend({name:N(),arguments:U0(N(),N()).optional()}),f8=v0.extend({method:_("prompts/get"),params:wq}),BY=v({type:_("text"),text:N(),annotations:D4.optional(),_meta:U0(N(),q0()).optional()}),KY=v({type:_("image"),data:GY,mimeType:N(),annotations:D4.optional(),_meta:U0(N(),q0()).optional()}),VY=v({type:_("audio"),data:GY,mimeType:N(),annotations:D4.optional(),_meta:U0(N(),q0()).optional()}),Nq=v({type:_("tool_use"),name:N(),id:N(),input:U0(N(),q0()),_meta:U0(N(),q0()).optional()}),Mq=v({type:_("resource"),resource:B0([fX,uX]),annotations:D4.optional(),_meta:U0(N(),q0()).optional()}),jq=lX.extend({type:_("resource_link")}),FY=B0([BY,KY,VY,jq,Mq]),zq=v({role:F9,content:FY}),Eq=T0.extend({description:N().optional(),messages:a(zq)}),Pq=G1.extend({method:_("notifications/prompts/list_changed"),params:X1.optional()}),Rq=v({title:N().optional(),readOnlyHint:I0().optional(),destructiveHint:I0().optional(),idempotentHint:I0().optional(),openWorldHint:I0().optional()}),Iq=v({taskSupport:n0(["required","optional","forbidden"]).optional()}),mX=v({...q4.shape,...G9.shape,description:N().optional(),inputSchema:v({type:_("object"),properties:U0(N(),Z0).optional(),required:a(N()).optional()}).catchall(q0()),outputSchema:v({type:_("object"),properties:U0(N(),Z0).optional(),required:a(N()).optional()}).catchall(q0()).optional(),annotations:Rq.optional(),execution:Iq.optional(),_meta:U0(N(),q0()).optional()}),u8=H9.extend({method:_("tools/list")}),Sq=B9.extend({tools:a(mX)}),l8=T0.extend({content:a(FY).default([]),structuredContent:U0(N(),q0()).optional(),isError:I0().optional()}),Ez=l8.or(T0.extend({toolResult:q0()})),bq=X9.extend({name:N(),arguments:U0(N(),q0()).optional()}),O4=v0.extend({method:_("tools/call"),params:bq}),Cq=G1.extend({method:_("notifications/tools/list_changed"),params:X1.optional()}),Pz=v({autoRefresh:I0().default(!0),debounceMs:$0().int().nonnegative().default(300)}),L9=n0(["debug","info","notice","warning","error","critical","alert","emergency"]),Zq=$1.extend({level:L9}),LY=v0.extend({method:_("logging/setLevel"),params:Zq}),vq=X1.extend({level:L9,logger:N().optional(),data:q0()}),Tq=G1.extend({method:_("notifications/message"),params:vq}),kq=v({name:N().optional()}),_q=v({hints:a(kq).optional(),costPriority:$0().min(0).max(1).optional(),speedPriority:$0().min(0).max(1).optional(),intelligencePriority:$0().min(0).max(1).optional()}),xq=v({mode:n0(["auto","required","none"]).optional()}),yq=v({type:_("tool_result"),toolUseId:N().describe("The unique identifier for the corresponding tool call."),content:a(FY).default([]),structuredContent:v({}).loose().optional(),isError:I0().optional(),_meta:U0(N(),q0()).optional()}),gq=t$("type",[BY,KY,VY]),j8=t$("type",[BY,KY,VY,Nq,yq]),hq=v({role:F9,content:B0([j8,a(j8)]),_meta:U0(N(),q0()).optional()}),fq=X9.extend({messages:a(hq),modelPreferences:_q.optional(),systemPrompt:N().optional(),includeContext:n0(["none","thisServer","allServers"]).optional(),temperature:$0().optional(),maxTokens:$0().int(),stopSequences:a(N()).optional(),metadata:Z0.optional(),tools:a(mX).optional(),toolChoice:xq.optional()}),uq=v0.extend({method:_("sampling/createMessage"),params:fq}),qY=T0.extend({model:N(),stopReason:w0(n0(["endTurn","stopSequence","maxTokens"]).or(N())),role:F9,content:gq}),UY=T0.extend({model:N(),stopReason:w0(n0(["endTurn","stopSequence","maxTokens","toolUse"]).or(N())),role:F9,content:B0([j8,a(j8)])}),lq=v({type:_("boolean"),title:N().optional(),description:N().optional(),default:I0().optional()}),mq=v({type:_("string"),title:N().optional(),description:N().optional(),minLength:$0().optional(),maxLength:$0().optional(),format:n0(["email","uri","date","date-time"]).optional(),default:N().optional()}),cq=v({type:n0(["number","integer"]),title:N().optional(),description:N().optional(),minimum:$0().optional(),maximum:$0().optional(),default:$0().optional()}),pq=v({type:_("string"),title:N().optional(),description:N().optional(),enum:a(N()),default:N().optional()}),dq=v({type:_("string"),title:N().optional(),description:N().optional(),oneOf:a(v({const:N(),title:N()})),default:N().optional()}),iq=v({type:_("string"),title:N().optional(),description:N().optional(),enum:a(N()),enumNames:a(N()).optional(),default:N().optional()}),nq=B0([pq,dq]),oq=v({type:_("array"),title:N().optional(),description:N().optional(),minItems:$0().optional(),maxItems:$0().optional(),items:v({type:_("string"),enum:a(N())}),default:a(N()).optional()}),rq=v({type:_("array"),title:N().optional(),description:N().optional(),minItems:$0().optional(),maxItems:$0().optional(),items:v({anyOf:a(v({const:N(),title:N()}))}),default:a(N()).optional()}),aq=B0([oq,rq]),tq=B0([iq,nq,aq]),sq=B0([tq,lq,mq,cq]),eq=X9.extend({mode:_("form").optional(),message:N(),requestedSchema:v({type:_("object"),properties:U0(N(),sq),required:a(N()).optional()})}),QU=X9.extend({mode:_("url"),message:N(),elicitationId:N(),url:N().url()}),WU=B0([eq,QU]),$U=v0.extend({method:_("elicitation/create"),params:WU}),YU=X1.extend({elicitationId:N()}),JU=G1.extend({method:_("notifications/elicitation/complete"),params:YU}),m8=T0.extend({action:n0(["accept","decline","cancel"]),content:s$((Q)=>Q===null?void 0:Q,U0(N(),B0([N(),$0(),I0(),a(N())])).optional())}),XU=v({type:_("ref/resource"),uri:N()});var GU=v({type:_("ref/prompt"),name:N()}),HU=$1.extend({ref:B0([GU,XU]),argument:v({name:N(),value:N()}),context:v({arguments:U0(N(),N()).optional()}).optional()}),c8=v0.extend({method:_("completion/complete"),params:HU});function cX(Q){if(Q.params.ref.type!=="ref/prompt")throw TypeError(`Expected CompleteRequestPrompt, but got ${Q.params.ref.type}`)}function pX(Q){if(Q.params.ref.type!=="ref/resource")throw TypeError(`Expected CompleteRequestResourceTemplate, but got ${Q.params.ref.type}`)}var BU=T0.extend({completion:m0({values:a(N()).max(100),total:w0($0().int()),hasMore:w0(I0())})}),KU=v({uri:N().startsWith("file://"),name:N().optional(),_meta:U0(N(),q0()).optional()}),VU=v0.extend({method:_("roots/list"),params:$1.optional()}),AY=T0.extend({roots:a(KU)}),FU=G1.extend({method:_("notifications/roots/list_changed"),params:X1.optional()}),Rz=B0([S8,I8,c8,LY,f8,h8,x8,y8,g8,Vq,Lq,O4,u8,C8,v8,T8,_8]),Iz=B0([R8,b8,XY,FU,V9]),Sz=B0([P8,qY,UY,m8,AY,Z8,k8,A4]),bz=B0([S8,uq,$U,VU,C8,v8,T8,_8]),Cz=B0([R8,b8,Tq,Uq,Bq,Cq,Pq,V9,JU]),Zz=B0([P8,tL,BU,Eq,Oq,Jq,Xq,Hq,l8,Sq,Z8,k8,A4]);class k extends Error{constructor(Q,W,$){super(`MCP error ${Q}: ${W}`);this.code=Q,this.data=$,this.name="McpError"}static fromError(Q,W,$){if(Q===y.UrlElicitationRequired&&$){let Y=$;if(Y.elicitations)return new dX(Y.elicitations,W)}return new k(Q,W,$)}}class dX extends k{constructor(Q,W=`URL elicitation${Q.length>1?"s":""} required`){super(y.UrlElicitationRequired,W,{elicitations:Q})}get elicitations(){return this.data?.elicitations??[]}}function G6(Q){return Q==="completed"||Q==="failed"||Q==="cancelled"}var nX=Symbol("Let zodToJsonSchema decide on which parser to use");var iX={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},oX=(Q)=>typeof Q==="string"?{...iX,name:Q}:{...iX,...Q};var rX=(Q)=>{let W=oX(Q),$=W.name!==void 0?[...W.basePath,W.definitionPath,W.name]:W.basePath;return{...W,flags:{hasReferencedOpenAiAnyType:!1},currentPath:$,propertyPath:void 0,seen:new Map(Object.entries(W.definitions).map(([Y,J])=>[J._def,{def:J._def,path:[...W.basePath,W.definitionPath,Y],jsonSchema:void 0}]))}};function DY(Q,W,$,Y){if(!Y?.errorMessages)return;if($)Q.errorMessage={...Q.errorMessage,[W]:$}}function t(Q,W,$,Y,J){Q[W]=$,DY(Q,W,Y,J)}var p8=(Q,W)=>{let $=0;for(;$<Q.length&&$<W.length;$++)if(Q[$]!==W[$])break;return[(Q.length-$).toString(),...W.slice($)].join("/")};function A0(Q){if(Q.target!=="openAi")return{};let W=[...Q.basePath,Q.definitionPath,Q.openAiAnyTypeName];return Q.flags.hasReferencedOpenAiAnyType=!0,{$ref:Q.$refStrategy==="relative"?p8(W,Q.currentPath):W.join("/")}}function aX(Q,W){let $={type:"array"};if(Q.type?._def&&Q.type?._def?.typeName!==P.ZodAny)$.items=u(Q.type._def,{...W,currentPath:[...W.currentPath,"items"]});if(Q.minLength)t($,"minItems",Q.minLength.value,Q.minLength.message,W);if(Q.maxLength)t($,"maxItems",Q.maxLength.value,Q.maxLength.message,W);if(Q.exactLength)t($,"minItems",Q.exactLength.value,Q.exactLength.message,W),t($,"maxItems",Q.exactLength.value,Q.exactLength.message,W);return $}function tX(Q,W){let $={type:"integer",format:"int64"};if(!Q.checks)return $;for(let Y of Q.checks)switch(Y.kind){case"min":if(W.target==="jsonSchema7")if(Y.inclusive)t($,"minimum",Y.value,Y.message,W);else t($,"exclusiveMinimum",Y.value,Y.message,W);else{if(!Y.inclusive)$.exclusiveMinimum=!0;t($,"minimum",Y.value,Y.message,W)}break;case"max":if(W.target==="jsonSchema7")if(Y.inclusive)t($,"maximum",Y.value,Y.message,W);else t($,"exclusiveMaximum",Y.value,Y.message,W);else{if(!Y.inclusive)$.exclusiveMaximum=!0;t($,"maximum",Y.value,Y.message,W)}break;case"multipleOf":t($,"multipleOf",Y.value,Y.message,W);break}return $}function sX(){return{type:"boolean"}}function d8(Q,W){return u(Q.type._def,W)}var eX=(Q,W)=>{return u(Q.innerType._def,W)};function OY(Q,W,$){let Y=$??W.dateStrategy;if(Array.isArray(Y))return{anyOf:Y.map((J,X)=>OY(Q,W,J))};switch(Y){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return LU(Q,W)}}var LU=(Q,W)=>{let $={type:"integer",format:"unix-time"};if(W.target==="openApi3")return $;for(let Y of Q.checks)switch(Y.kind){case"min":t($,"minimum",Y.value,Y.message,W);break;case"max":t($,"maximum",Y.value,Y.message,W);break}return $};function Q3(Q,W){return{...u(Q.innerType._def,W),default:Q.defaultValue()}}function W3(Q,W){return W.effectStrategy==="input"?u(Q.schema._def,W):A0(W)}function $3(Q){return{type:"string",enum:Array.from(Q.values)}}var qU=(Q)=>{if("type"in Q&&Q.type==="string")return!1;return"allOf"in Q};function Y3(Q,W){let $=[u(Q.left._def,{...W,currentPath:[...W.currentPath,"allOf","0"]}),u(Q.right._def,{...W,currentPath:[...W.currentPath,"allOf","1"]})].filter((X)=>!!X),Y=W.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,J=[];return $.forEach((X)=>{if(qU(X)){if(J.push(...X.allOf),X.unevaluatedProperties===void 0)Y=void 0}else{let G=X;if("additionalProperties"in X&&X.additionalProperties===!1){let{additionalProperties:H,...B}=X;G=B}else Y=void 0;J.push(G)}}),J.length?{allOf:J,...Y}:void 0}function J3(Q,W){let $=typeof Q.value;if($!=="bigint"&&$!=="number"&&$!=="boolean"&&$!=="string")return{type:Array.isArray(Q.value)?"array":"object"};if(W.target==="openApi3")return{type:$==="bigint"?"integer":$,enum:[Q.value]};return{type:$==="bigint"?"integer":$,const:Q.value}}var wY=void 0,A1={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>{if(wY===void 0)wY=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u");return wY},uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function i8(Q,W){let $={type:"string"};if(Q.checks)for(let Y of Q.checks)switch(Y.kind){case"min":t($,"minLength",typeof $.minLength==="number"?Math.max($.minLength,Y.value):Y.value,Y.message,W);break;case"max":t($,"maxLength",typeof $.maxLength==="number"?Math.min($.maxLength,Y.value):Y.value,Y.message,W);break;case"email":switch(W.emailStrategy){case"format:email":D1($,"email",Y.message,W);break;case"format:idn-email":D1($,"idn-email",Y.message,W);break;case"pattern:zod":c0($,A1.email,Y.message,W);break}break;case"url":D1($,"uri",Y.message,W);break;case"uuid":D1($,"uuid",Y.message,W);break;case"regex":c0($,Y.regex,Y.message,W);break;case"cuid":c0($,A1.cuid,Y.message,W);break;case"cuid2":c0($,A1.cuid2,Y.message,W);break;case"startsWith":c0($,RegExp(`^${NY(Y.value,W)}`),Y.message,W);break;case"endsWith":c0($,RegExp(`${NY(Y.value,W)}$`),Y.message,W);break;case"datetime":D1($,"date-time",Y.message,W);break;case"date":D1($,"date",Y.message,W);break;case"time":D1($,"time",Y.message,W);break;case"duration":D1($,"duration",Y.message,W);break;case"length":t($,"minLength",typeof $.minLength==="number"?Math.max($.minLength,Y.value):Y.value,Y.message,W),t($,"maxLength",typeof $.maxLength==="number"?Math.min($.maxLength,Y.value):Y.value,Y.message,W);break;case"includes":{c0($,RegExp(NY(Y.value,W)),Y.message,W);break}case"ip":{if(Y.version!=="v6")D1($,"ipv4",Y.message,W);if(Y.version!=="v4")D1($,"ipv6",Y.message,W);break}case"base64url":c0($,A1.base64url,Y.message,W);break;case"jwt":c0($,A1.jwt,Y.message,W);break;case"cidr":{if(Y.version!=="v6")c0($,A1.ipv4Cidr,Y.message,W);if(Y.version!=="v4")c0($,A1.ipv6Cidr,Y.message,W);break}case"emoji":c0($,A1.emoji(),Y.message,W);break;case"ulid":{c0($,A1.ulid,Y.message,W);break}case"base64":{switch(W.base64Strategy){case"format:binary":{D1($,"binary",Y.message,W);break}case"contentEncoding:base64":{t($,"contentEncoding","base64",Y.message,W);break}case"pattern:zod":{c0($,A1.base64,Y.message,W);break}}break}case"nanoid":c0($,A1.nanoid,Y.message,W);case"toLowerCase":case"toUpperCase":case"trim":break;default:((J)=>{})(Y)}return $}function NY(Q,W){return W.patternStrategy==="escape"?AU(Q):Q}var UU=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function AU(Q){let W="";for(let $=0;$<Q.length;$++){if(!UU.has(Q[$]))W+="\\";W+=Q[$]}return W}function D1(Q,W,$,Y){if(Q.format||Q.anyOf?.some((J)=>J.format)){if(!Q.anyOf)Q.anyOf=[];if(Q.format){if(Q.anyOf.push({format:Q.format,...Q.errorMessage&&Y.errorMessages&&{errorMessage:{format:Q.errorMessage.format}}}),delete Q.format,Q.errorMessage){if(delete Q.errorMessage.format,Object.keys(Q.errorMessage).length===0)delete Q.errorMessage}}Q.anyOf.push({format:W,...$&&Y.errorMessages&&{errorMessage:{format:$}}})}else t(Q,"format",W,$,Y)}function c0(Q,W,$,Y){if(Q.pattern||Q.allOf?.some((J)=>J.pattern)){if(!Q.allOf)Q.allOf=[];if(Q.pattern){if(Q.allOf.push({pattern:Q.pattern,...Q.errorMessage&&Y.errorMessages&&{errorMessage:{pattern:Q.errorMessage.pattern}}}),delete Q.pattern,Q.errorMessage){if(delete Q.errorMessage.pattern,Object.keys(Q.errorMessage).length===0)delete Q.errorMessage}}Q.allOf.push({pattern:X3(W,Y),...$&&Y.errorMessages&&{errorMessage:{pattern:$}}})}else t(Q,"pattern",X3(W,Y),$,Y)}function X3(Q,W){if(!W.applyRegexFlags||!Q.flags)return Q.source;let $={i:Q.flags.includes("i"),m:Q.flags.includes("m"),s:Q.flags.includes("s")},Y=$.i?Q.source.toLowerCase():Q.source,J="",X=!1,G=!1,H=!1;for(let B=0;B<Y.length;B++){if(X){J+=Y[B],X=!1;continue}if($.i){if(G){if(Y[B].match(/[a-z]/)){if(H)J+=Y[B],J+=`${Y[B-2]}-${Y[B]}`.toUpperCase(),H=!1;else if(Y[B+1]==="-"&&Y[B+2]?.match(/[a-z]/))J+=Y[B],H=!0;else J+=`${Y[B]}${Y[B].toUpperCase()}`;continue}}else if(Y[B].match(/[a-z]/)){J+=`[${Y[B]}${Y[B].toUpperCase()}]`;continue}}if($.m){if(Y[B]==="^"){J+=`(^|(?<=[\r
]))`;continue}else if(Y[B]==="$"){J+=`($|(?=[\r
]))`;continue}}if($.s&&Y[B]==="."){J+=G?`${Y[B]}\r
`:`[${Y[B]}\r
]`;continue}if(J+=Y[B],Y[B]==="\\")X=!0;else if(G&&Y[B]==="]")G=!1;else if(!G&&Y[B]==="[")G=!0}try{new RegExp(J)}catch{return console.warn(`Could not convert regex pattern at ${W.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),Q.source}return J}function n8(Q,W){if(W.target==="openAi")console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead.");if(W.target==="openApi3"&&Q.keyType?._def.typeName===P.ZodEnum)return{type:"object",required:Q.keyType._def.values,properties:Q.keyType._def.values.reduce((Y,J)=>({...Y,[J]:u(Q.valueType._def,{...W,currentPath:[...W.currentPath,"properties",J]})??A0(W)}),{}),additionalProperties:W.rejectedAdditionalProperties};let $={type:"object",additionalProperties:u(Q.valueType._def,{...W,currentPath:[...W.currentPath,"additionalProperties"]})??W.allowedAdditionalProperties};if(W.target==="openApi3")return $;if(Q.keyType?._def.typeName===P.ZodString&&Q.keyType._def.checks?.length){let{type:Y,...J}=i8(Q.keyType._def,W);return{...$,propertyNames:J}}else if(Q.keyType?._def.typeName===P.ZodEnum)return{...$,propertyNames:{enum:Q.keyType._def.values}};else if(Q.keyType?._def.typeName===P.ZodBranded&&Q.keyType._def.type._def.typeName===P.ZodString&&Q.keyType._def.type._def.checks?.length){let{type:Y,...J}=d8(Q.keyType._def,W);return{...$,propertyNames:J}}return $}function G3(Q,W){if(W.mapStrategy==="record")return n8(Q,W);let $=u(Q.keyType._def,{...W,currentPath:[...W.currentPath,"items","items","0"]})||A0(W),Y=u(Q.valueType._def,{...W,currentPath:[...W.currentPath,"items","items","1"]})||A0(W);return{type:"array",maxItems:125,items:{type:"array",items:[$,Y],minItems:2,maxItems:2}}}function H3(Q){let W=Q.values,Y=Object.keys(Q.values).filter((X)=>{return typeof W[W[X]]!=="number"}).map((X)=>W[X]),J=Array.from(new Set(Y.map((X)=>typeof X)));return{type:J.length===1?J[0]==="string"?"string":"number":["string","number"],enum:Y}}function B3(Q){return Q.target==="openAi"?void 0:{not:A0({...Q,currentPath:[...Q.currentPath,"not"]})}}function K3(Q){return Q.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var q9={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function F3(Q,W){if(W.target==="openApi3")return V3(Q,W);let $=Q.options instanceof Map?Array.from(Q.options.values()):Q.options;if($.every((Y)=>(Y._def.typeName in q9)&&(!Y._def.checks||!Y._def.checks.length))){let Y=$.reduce((J,X)=>{let G=q9[X._def.typeName];return G&&!J.includes(G)?[...J,G]:J},[]);return{type:Y.length>1?Y:Y[0]}}else if($.every((Y)=>Y._def.typeName==="ZodLiteral"&&!Y.description)){let Y=$.reduce((J,X)=>{let G=typeof X._def.value;switch(G){case"string":case"number":case"boolean":return[...J,G];case"bigint":return[...J,"integer"];case"object":if(X._def.value===null)return[...J,"null"];case"symbol":case"undefined":case"function":default:return J}},[]);if(Y.length===$.length){let J=Y.filter((X,G,H)=>H.indexOf(X)===G);return{type:J.length>1?J:J[0],enum:$.reduce((X,G)=>{return X.includes(G._def.value)?X:[...X,G._def.value]},[])}}}else if($.every((Y)=>Y._def.typeName==="ZodEnum"))return{type:"string",enum:$.reduce((Y,J)=>[...Y,...J._def.values.filter((X)=>!Y.includes(X))],[])};return V3(Q,W)}var V3=(Q,W)=>{let $=(Q.options instanceof Map?Array.from(Q.options.values()):Q.options).map((Y,J)=>u(Y._def,{...W,currentPath:[...W.currentPath,"anyOf",`${J}`]})).filter((Y)=>!!Y&&(!W.strictUnions||typeof Y==="object"&&Object.keys(Y).length>0));return $.length?{anyOf:$}:void 0};function L3(Q,W){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(Q.innerType._def.typeName)&&(!Q.innerType._def.checks||!Q.innerType._def.checks.length)){if(W.target==="openApi3")return{type:q9[Q.innerType._def.typeName],nullable:!0};return{type:[q9[Q.innerType._def.typeName],"null"]}}if(W.target==="openApi3"){let Y=u(Q.innerType._def,{...W,currentPath:[...W.currentPath]});if(Y&&"$ref"in Y)return{allOf:[Y],nullable:!0};return Y&&{...Y,nullable:!0}}let $=u(Q.innerType._def,{...W,currentPath:[...W.currentPath,"anyOf","0"]});return $&&{anyOf:[$,{type:"null"}]}}function q3(Q,W){let $={type:"number"};if(!Q.checks)return $;for(let Y of Q.checks)switch(Y.kind){case"int":$.type="integer",DY($,"type",Y.message,W);break;case"min":if(W.target==="jsonSchema7")if(Y.inclusive)t($,"minimum",Y.value,Y.message,W);else t($,"exclusiveMinimum",Y.value,Y.message,W);else{if(!Y.inclusive)$.exclusiveMinimum=!0;t($,"minimum",Y.value,Y.message,W)}break;case"max":if(W.target==="jsonSchema7")if(Y.inclusive)t($,"maximum",Y.value,Y.message,W);else t($,"exclusiveMaximum",Y.value,Y.message,W);else{if(!Y.inclusive)$.exclusiveMaximum=!0;t($,"maximum",Y.value,Y.message,W)}break;case"multipleOf":t($,"multipleOf",Y.value,Y.message,W);break}return $}function U3(Q,W){let $=W.target==="openAi",Y={type:"object",properties:{}},J=[],X=Q.shape();for(let H in X){let B=X[H];if(B===void 0||B._def===void 0)continue;let K=OU(B);if(K&&$){if(B._def.typeName==="ZodOptional")B=B._def.innerType;if(!B.isNullable())B=B.nullable();K=!1}let F=u(B._def,{...W,currentPath:[...W.currentPath,"properties",H],propertyPath:[...W.currentPath,"properties",H]});if(F===void 0)continue;if(Y.properties[H]=F,!K)J.push(H)}if(J.length)Y.required=J;let G=DU(Q,W);if(G!==void 0)Y.additionalProperties=G;return Y}function DU(Q,W){if(Q.catchall._def.typeName!=="ZodNever")return u(Q.catchall._def,{...W,currentPath:[...W.currentPath,"additionalProperties"]});switch(Q.unknownKeys){case"passthrough":return W.allowedAdditionalProperties;case"strict":return W.rejectedAdditionalProperties;case"strip":return W.removeAdditionalStrategy==="strict"?W.allowedAdditionalProperties:W.rejectedAdditionalProperties}}function OU(Q){try{return Q.isOptional()}catch{return!0}}var A3=(Q,W)=>{if(W.currentPath.toString()===W.propertyPath?.toString())return u(Q.innerType._def,W);let $=u(Q.innerType._def,{...W,currentPath:[...W.currentPath,"anyOf","1"]});return $?{anyOf:[{not:A0(W)},$]}:A0(W)};var D3=(Q,W)=>{if(W.pipeStrategy==="input")return u(Q.in._def,W);else if(W.pipeStrategy==="output")return u(Q.out._def,W);let $=u(Q.in._def,{...W,currentPath:[...W.currentPath,"allOf","0"]}),Y=u(Q.out._def,{...W,currentPath:[...W.currentPath,"allOf",$?"1":"0"]});return{allOf:[$,Y].filter((J)=>J!==void 0)}};function O3(Q,W){return u(Q.type._def,W)}function w3(Q,W){let Y={type:"array",uniqueItems:!0,items:u(Q.valueType._def,{...W,currentPath:[...W.currentPath,"items"]})};if(Q.minSize)t(Y,"minItems",Q.minSize.value,Q.minSize.message,W);if(Q.maxSize)t(Y,"maxItems",Q.maxSize.value,Q.maxSize.message,W);return Y}function N3(Q,W){if(Q.rest)return{type:"array",minItems:Q.items.length,items:Q.items.map(($,Y)=>u($._def,{...W,currentPath:[...W.currentPath,"items",`${Y}`]})).reduce(($,Y)=>Y===void 0?$:[...$,Y],[]),additionalItems:u(Q.rest._def,{...W,currentPath:[...W.currentPath,"additionalItems"]})};else return{type:"array",minItems:Q.items.length,maxItems:Q.items.length,items:Q.items.map(($,Y)=>u($._def,{...W,currentPath:[...W.currentPath,"items",`${Y}`]})).reduce(($,Y)=>Y===void 0?$:[...$,Y],[])}}function M3(Q){return{not:A0(Q)}}function j3(Q){return A0(Q)}var z3=(Q,W)=>{return u(Q.innerType._def,W)};var E3=(Q,W,$)=>{switch(W){case P.ZodString:return i8(Q,$);case P.ZodNumber:return q3(Q,$);case P.ZodObject:return U3(Q,$);case P.ZodBigInt:return tX(Q,$);case P.ZodBoolean:return sX();case P.ZodDate:return OY(Q,$);case P.ZodUndefined:return M3($);case P.ZodNull:return K3($);case P.ZodArray:return aX(Q,$);case P.ZodUnion:case P.ZodDiscriminatedUnion:return F3(Q,$);case P.ZodIntersection:return Y3(Q,$);case P.ZodTuple:return N3(Q,$);case P.ZodRecord:return n8(Q,$);case P.ZodLiteral:return J3(Q,$);case P.ZodEnum:return $3(Q);case P.ZodNativeEnum:return H3(Q);case P.ZodNullable:return L3(Q,$);case P.ZodOptional:return A3(Q,$);case P.ZodMap:return G3(Q,$);case P.ZodSet:return w3(Q,$);case P.ZodLazy:return()=>Q.getter()._def;case P.ZodPromise:return O3(Q,$);case P.ZodNaN:case P.ZodNever:return B3($);case P.ZodEffects:return W3(Q,$);case P.ZodAny:return A0($);case P.ZodUnknown:return j3($);case P.ZodDefault:return Q3(Q,$);case P.ZodBranded:return d8(Q,$);case P.ZodReadonly:return z3(Q,$);case P.ZodCatch:return eX(Q,$);case P.ZodPipeline:return D3(Q,$);case P.ZodFunction:case P.ZodVoid:case P.ZodSymbol:return;default:return((Y)=>{return})(W)}};function u(Q,W,$=!1){let Y=W.seen.get(Q);if(W.override){let H=W.override?.(Q,W,Y,$);if(H!==nX)return H}if(Y&&!$){let H=wU(Y,W);if(H!==void 0)return H}let J={def:Q,path:W.currentPath,jsonSchema:void 0};W.seen.set(Q,J);let X=E3(Q,Q.typeName,W),G=typeof X==="function"?u(X(),W):X;if(G)NU(Q,W,G);if(W.postProcess){let H=W.postProcess(G,Q,W);return J.jsonSchema=G,H}return J.jsonSchema=G,G}var wU=(Q,W)=>{switch(W.$refStrategy){case"root":return{$ref:Q.path.join("/")};case"relative":return{$ref:p8(W.currentPath,Q.path)};case"none":case"seen":{if(Q.path.length<W.currentPath.length&&Q.path.every(($,Y)=>W.currentPath[Y]===$))return console.warn(`Recursive reference detected at ${W.currentPath.join("/")}! Defaulting to any`),A0(W);return W.$refStrategy==="seen"?A0(W):void 0}}},NU=(Q,W,$)=>{if(Q.description){if($.description=Q.description,W.markdownDescription)$.markdownDescription=Q.description}return $};var MY=(Q,W)=>{let $=rX(W),Y=typeof W==="object"&&W.definitions?Object.entries(W.definitions).reduce((B,[K,F])=>({...B,[K]:u(F._def,{...$,currentPath:[...$.basePath,$.definitionPath,K]},!0)??A0($)}),{}):void 0,J=typeof W==="string"?W:W?.nameStrategy==="title"?void 0:W?.name,X=u(Q._def,J===void 0?$:{...$,currentPath:[...$.basePath,$.definitionPath,J]},!1)??A0($),G=typeof W==="object"&&W.name!==void 0&&W.nameStrategy==="title"?W.name:void 0;if(G!==void 0)X.title=G;if($.flags.hasReferencedOpenAiAnyType){if(!Y)Y={};if(!Y[$.openAiAnyTypeName])Y[$.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:$.$refStrategy==="relative"?"1":[...$.basePath,$.definitionPath,$.openAiAnyTypeName].join("/")}}}let H=J===void 0?Y?{...X,[$.definitionPath]:Y}:X:{$ref:[...$.$refStrategy==="relative"?[]:$.basePath,$.definitionPath,J].join("/"),[$.definitionPath]:{...Y,[J]:X}};if($.target==="jsonSchema7")H.$schema="http://json-schema.org/draft-07/schema#";else if($.target==="jsonSchema2019-09"||$.target==="openAi")H.$schema="https://json-schema.org/draft/2019-09/schema#";if($.target==="openAi"&&(("anyOf"in H)||("oneOf"in H)||("allOf"in H)||("type"in H)&&Array.isArray(H.type)))console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property.");return H};function MU(Q){if(!Q)return"draft-7";if(Q==="jsonSchema7"||Q==="draft-7")return"draft-7";if(Q==="jsonSchema2019-09"||Q==="draft-2020-12")return"draft-2020-12";return"draft-7"}function jY(Q,W){if(J1(Q))return m$(Q,{target:MU(W?.target),io:W?.pipeStrategy??"input"});return MY(Q,{strictUnions:W?.strictUnions??!0,pipeStrategy:W?.pipeStrategy??"input"})}function zY(Q){let $=Y6(Q)?.method;if(!$)throw Error("Schema is missing a method literal");let Y=w8($);if(typeof Y!=="string")throw Error("Schema method literal must be a string");return Y}function EY(Q,W){let $=$6(Q,W);if(!$.success)throw $.error;return $.data}var jU=60000;class PY{constructor(Q){if(this._options=Q,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(R8,(W)=>{this._oncancel(W)}),this.setNotificationHandler(b8,(W)=>{this._onprogress(W)}),this.setRequestHandler(S8,(W)=>({})),this._taskStore=Q?.taskStore,this._taskMessageQueue=Q?.taskMessageQueue,this._taskStore)this.setRequestHandler(C8,async(W,$)=>{let Y=await this._taskStore.getTask(W.params.taskId,$.sessionId);if(!Y)throw new k(y.InvalidParams,"Failed to retrieve task: Task not found");return{...Y}}),this.setRequestHandler(v8,async(W,$)=>{let Y=async()=>{let J=W.params.taskId;if(this._taskMessageQueue){let G;while(G=await this._taskMessageQueue.dequeue(J,$.sessionId)){if(G.type==="response"||G.type==="error"){let H=G.message,B=H.id,K=this._requestResolvers.get(B);if(K)if(this._requestResolvers.delete(B),G.type==="response")K(H);else{let F=H,L=new k(F.error.code,F.error.message,F.error.data);K(L)}else{let F=G.type==="response"?"Response":"Error";this._onerror(Error(`${F} handler missing for request ${B}`))}continue}await this._transport?.send(G.message,{relatedRequestId:$.requestId})}}let X=await this._taskStore.getTask(J,$.sessionId);if(!X)throw new k(y.InvalidParams,`Task not found: ${J}`);if(!G6(X.status))return await this._waitForTaskUpdate(J,$.signal),await Y();if(G6(X.status)){let G=await this._taskStore.getTaskResult(J,$.sessionId);return this._clearTaskQueue(J),{...G,_meta:{...G._meta,[J6]:{taskId:J}}}}return await Y()};return await Y()}),this.setRequestHandler(T8,async(W,$)=>{try{let{tasks:Y,nextCursor:J}=await this._taskStore.listTasks(W.params?.cursor,$.sessionId);return{tasks:Y,nextCursor:J,_meta:{}}}catch(Y){throw new k(y.InvalidParams,`Failed to list tasks: ${Y instanceof Error?Y.message:String(Y)}`)}}),this.setRequestHandler(_8,async(W,$)=>{try{let Y=await this._taskStore.getTask(W.params.taskId,$.sessionId);if(!Y)throw new k(y.InvalidParams,`Task not found: ${W.params.taskId}`);if(G6(Y.status))throw new k(y.InvalidParams,`Cannot cancel task in terminal status: ${Y.status}`);await this._taskStore.updateTaskStatus(W.params.taskId,"cancelled","Client cancelled task execution.",$.sessionId),this._clearTaskQueue(W.params.taskId);let J=await this._taskStore.getTask(W.params.taskId,$.sessionId);if(!J)throw new k(y.InvalidParams,`Task not found after cancellation: ${W.params.taskId}`);return{_meta:{},...J}}catch(Y){if(Y instanceof k)throw Y;throw new k(y.InvalidRequest,`Failed to cancel task: ${Y instanceof Error?Y.message:String(Y)}`)}})}async _oncancel(Q){if(!Q.params.requestId)return;this._requestHandlerAbortControllers.get(Q.params.requestId)?.abort(Q.params.reason)}_setupTimeout(Q,W,$,Y,J=!1){this._timeoutInfo.set(Q,{timeoutId:setTimeout(Y,W),startTime:Date.now(),timeout:W,maxTotalTimeout:$,resetTimeoutOnProgress:J,onTimeout:Y})}_resetTimeout(Q){let W=this._timeoutInfo.get(Q);if(!W)return!1;let $=Date.now()-W.startTime;if(W.maxTotalTimeout&&$>=W.maxTotalTimeout)throw this._timeoutInfo.delete(Q),k.fromError(y.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:W.maxTotalTimeout,totalElapsed:$});return clearTimeout(W.timeoutId),W.timeoutId=setTimeout(W.onTimeout,W.timeout),!0}_cleanupTimeout(Q){let W=this._timeoutInfo.get(Q);if(W)clearTimeout(W.timeoutId),this._timeoutInfo.delete(Q)}async connect(Q){this._transport=Q;let W=this.transport?.onclose;this._transport.onclose=()=>{W?.(),this._onclose()};let $=this.transport?.onerror;this._transport.onerror=(J)=>{$?.(J),this._onerror(J)};let Y=this._transport?.onmessage;this._transport.onmessage=(J,X)=>{if(Y?.(J,X),f1(J)||U4(J))this._onresponse(J);else if(X6(J))this._onrequest(J,X);else if(xX(J))this._onnotification(J);else this._onerror(Error(`Unknown message type: ${JSON.stringify(J)}`))},await this._transport.start()}_onclose(){let Q=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();let W=k.fromError(y.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(let $ of Q.values())$(W)}_onerror(Q){this.onerror?.(Q)}_onnotification(Q){let W=this._notificationHandlers.get(Q.method)??this.fallbackNotificationHandler;if(W===void 0)return;Promise.resolve().then(()=>W(Q)).catch(($)=>this._onerror(Error(`Uncaught error in notification handler: ${$}`)))}_onrequest(Q,W){let $=this._requestHandlers.get(Q.method)??this.fallbackRequestHandler,Y=this._transport,J=Q.params?._meta?.[J6]?.taskId;if($===void 0){let K={jsonrpc:"2.0",id:Q.id,error:{code:y.MethodNotFound,message:"Method not found"}};if(J&&this._taskMessageQueue)this._enqueueTaskMessage(J,{type:"error",message:K,timestamp:Date.now()},Y?.sessionId).catch((F)=>this._onerror(Error(`Failed to enqueue error response: ${F}`)));else Y?.send(K).catch((F)=>this._onerror(Error(`Failed to send an error response: ${F}`)));return}let X=new AbortController;this._requestHandlerAbortControllers.set(Q.id,X);let G=TX(Q.params)?Q.params.task:void 0,H=this._taskStore?this.requestTaskStore(Q,Y?.sessionId):void 0,B={signal:X.signal,sessionId:Y?.sessionId,_meta:Q.params?._meta,sendNotification:async(K)=>{let F={relatedRequestId:Q.id};if(J)F.relatedTask={taskId:J};await this.notification(K,F)},sendRequest:async(K,F,L)=>{let U={...L,relatedRequestId:Q.id};if(J&&!U.relatedTask)U.relatedTask={taskId:J};let q=U.relatedTask?.taskId??J;if(q&&H)await H.updateTaskStatus(q,"input_required");return await this.request(K,F,U)},authInfo:W?.authInfo,requestId:Q.id,requestInfo:W?.requestInfo,taskId:J,taskStore:H,taskRequestedTtl:G?.ttl,closeSSEStream:W?.closeSSEStream,closeStandaloneSSEStream:W?.closeStandaloneSSEStream};Promise.resolve().then(()=>{if(G)this.assertTaskHandlerCapability(Q.method)}).then(()=>$(Q,B)).then(async(K)=>{if(X.signal.aborted)return;let F={result:K,jsonrpc:"2.0",id:Q.id};if(J&&this._taskMessageQueue)await this._enqueueTaskMessage(J,{type:"response",message:F,timestamp:Date.now()},Y?.sessionId);else await Y?.send(F)},async(K)=>{if(X.signal.aborted)return;let F={jsonrpc:"2.0",id:Q.id,error:{code:Number.isSafeInteger(K.code)?K.code:y.InternalError,message:K.message??"Internal error",...K.data!==void 0&&{data:K.data}}};if(J&&this._taskMessageQueue)await this._enqueueTaskMessage(J,{type:"error",message:F,timestamp:Date.now()},Y?.sessionId);else await Y?.send(F)}).catch((K)=>this._onerror(Error(`Failed to send response: ${K}`))).finally(()=>{this._requestHandlerAbortControllers.delete(Q.id)})}_onprogress(Q){let{progressToken:W,...$}=Q.params,Y=Number(W),J=this._progressHandlers.get(Y);if(!J){this._onerror(Error(`Received a progress notification for an unknown token: ${JSON.stringify(Q)}`));return}let X=this._responseHandlers.get(Y),G=this._timeoutInfo.get(Y);if(G&&X&&G.resetTimeoutOnProgress)try{this._resetTimeout(Y)}catch(H){this._responseHandlers.delete(Y),this._progressHandlers.delete(Y),this._cleanupTimeout(Y),X(H);return}J($)}_onresponse(Q){let W=Number(Q.id),$=this._requestResolvers.get(W);if($){if(this._requestResolvers.delete(W),f1(Q))$(Q);else{let X=new k(Q.error.code,Q.error.message,Q.error.data);$(X)}return}let Y=this._responseHandlers.get(W);if(Y===void 0){this._onerror(Error(`Received a response for an unknown message ID: ${JSON.stringify(Q)}`));return}this._responseHandlers.delete(W),this._cleanupTimeout(W);let J=!1;if(f1(Q)&&Q.result&&typeof Q.result==="object"){let X=Q.result;if(X.task&&typeof X.task==="object"){let G=X.task;if(typeof G.taskId==="string")J=!0,this._taskProgressTokens.set(G.taskId,W)}}if(!J)this._progressHandlers.delete(W);if(f1(Q))Y(Q);else{let X=k.fromError(Q.error.code,Q.error.message,Q.error.data);Y(X)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(Q,W,$){let{task:Y}=$??{};if(!Y){try{yield{type:"result",result:await this.request(Q,W,$)}}catch(X){yield{type:"error",error:X instanceof k?X:new k(y.InternalError,String(X))}}return}let J;try{let X=await this.request(Q,A4,$);if(X.task)J=X.task.taskId,yield{type:"taskCreated",task:X.task};else throw new k(y.InternalError,"Task creation did not return a task");while(!0){let G=await this.getTask({taskId:J},$);if(yield{type:"taskStatus",task:G},G6(G.status)){if(G.status==="completed")yield{type:"result",result:await this.getTaskResult({taskId:J},W,$)};else if(G.status==="failed")yield{type:"error",error:new k(y.InternalError,`Task ${J} failed`)};else if(G.status==="cancelled")yield{type:"error",error:new k(y.InternalError,`Task ${J} was cancelled`)};return}if(G.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:J},W,$)};return}let H=G.pollInterval??this._options?.defaultTaskPollInterval??1000;await new Promise((B)=>setTimeout(B,H)),$?.signal?.throwIfAborted()}}catch(X){yield{type:"error",error:X instanceof k?X:new k(y.InternalError,String(X))}}}request(Q,W,$){let{relatedRequestId:Y,resumptionToken:J,onresumptiontoken:X,task:G,relatedTask:H}=$??{};return new Promise((B,K)=>{let F=(w)=>{K(w)};if(!this._transport){F(Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{if(this.assertCapabilityForMethod(Q.method),G)this.assertTaskCapability(Q.method)}catch(w){F(w);return}$?.signal?.throwIfAborted();let L=this._requestMessageId++,U={...Q,jsonrpc:"2.0",id:L};if($?.onprogress)this._progressHandlers.set(L,$.onprogress),U.params={...Q.params,_meta:{...Q.params?._meta||{},progressToken:L}};if(G)U.params={...U.params,task:G};if(H)U.params={...U.params,_meta:{...U.params?._meta||{},[J6]:H}};let q=(w)=>{this._responseHandlers.delete(L),this._progressHandlers.delete(L),this._cleanupTimeout(L),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:L,reason:String(w)}},{relatedRequestId:Y,resumptionToken:J,onresumptiontoken:X}).catch((z)=>this._onerror(Error(`Failed to send cancellation: ${z}`)));let j=w instanceof k?w:new k(y.RequestTimeout,String(w));K(j)};this._responseHandlers.set(L,(w)=>{if($?.signal?.aborted)return;if(w instanceof Error)return K(w);try{let j=$6(W,w.result);if(!j.success)K(j.error);else B(j.data)}catch(j){K(j)}}),$?.signal?.addEventListener("abort",()=>{q($?.signal?.reason)});let A=$?.timeout??jU,D=()=>q(k.fromError(y.RequestTimeout,"Request timed out",{timeout:A}));this._setupTimeout(L,A,$?.maxTotalTimeout,D,$?.resetTimeoutOnProgress??!1);let O=H?.taskId;if(O){let w=(j)=>{let z=this._responseHandlers.get(L);if(z)z(j);else this._onerror(Error(`Response handler missing for side-channeled request ${L}`))};this._requestResolvers.set(L,w),this._enqueueTaskMessage(O,{type:"request",message:U,timestamp:Date.now()}).catch((j)=>{this._cleanupTimeout(L),K(j)})}else this._transport.send(U,{relatedRequestId:Y,resumptionToken:J,onresumptiontoken:X}).catch((w)=>{this._cleanupTimeout(L),K(w)})})}async getTask(Q,W){return this.request({method:"tasks/get",params:Q},Z8,W)}async getTaskResult(Q,W,$){return this.request({method:"tasks/result",params:Q},W,$)}async listTasks(Q,W){return this.request({method:"tasks/list",params:Q},k8,W)}async cancelTask(Q,W){return this.request({method:"tasks/cancel",params:Q},gX,W)}async notification(Q,W){if(!this._transport)throw Error("Not connected");this.assertNotificationCapability(Q.method);let $=W?.relatedTask?.taskId;if($){let G={...Q,jsonrpc:"2.0",params:{...Q.params,_meta:{...Q.params?._meta||{},[J6]:W.relatedTask}}};await this._enqueueTaskMessage($,{type:"notification",message:G,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(Q.method)&&!Q.params&&!W?.relatedRequestId&&!W?.relatedTask){if(this._pendingDebouncedNotifications.has(Q.method))return;this._pendingDebouncedNotifications.add(Q.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(Q.method),!this._transport)return;let G={...Q,jsonrpc:"2.0"};if(W?.relatedTask)G={...G,params:{...G.params,_meta:{...G.params?._meta||{},[J6]:W.relatedTask}}};this._transport?.send(G,W).catch((H)=>this._onerror(H))});return}let X={...Q,jsonrpc:"2.0"};if(W?.relatedTask)X={...X,params:{...X.params,_meta:{...X.params?._meta||{},[J6]:W.relatedTask}}};await this._transport.send(X,W)}setRequestHandler(Q,W){let $=zY(Q);this.assertRequestHandlerCapability($),this._requestHandlers.set($,(Y,J)=>{let X=EY(Q,Y);return Promise.resolve(W(X,J))})}removeRequestHandler(Q){this._requestHandlers.delete(Q)}assertCanSetRequestHandler(Q){if(this._requestHandlers.has(Q))throw Error(`A request handler for ${Q} already exists, which would be overridden`)}setNotificationHandler(Q,W){let $=zY(Q);this._notificationHandlers.set($,(Y)=>{let J=EY(Q,Y);return Promise.resolve(W(J))})}removeNotificationHandler(Q){this._notificationHandlers.delete(Q)}_cleanupTaskProgressHandler(Q){let W=this._taskProgressTokens.get(Q);if(W!==void 0)this._progressHandlers.delete(W),this._taskProgressTokens.delete(Q)}async _enqueueTaskMessage(Q,W,$){if(!this._taskStore||!this._taskMessageQueue)throw Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let Y=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(Q,W,$,Y)}async _clearTaskQueue(Q,W){if(this._taskMessageQueue){let $=await this._taskMessageQueue.dequeueAll(Q,W);for(let Y of $)if(Y.type==="request"&&X6(Y.message)){let J=Y.message.id,X=this._requestResolvers.get(J);if(X)X(new k(y.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(J);else this._onerror(Error(`Resolver missing for request ${J} during task ${Q} cleanup`))}}}async _waitForTaskUpdate(Q,W){let $=this._options?.defaultTaskPollInterval??1000;try{let Y=await this._taskStore?.getTask(Q);if(Y?.pollInterval)$=Y.pollInterval}catch{}return new Promise((Y,J)=>{if(W.aborted){J(new k(y.InvalidRequest,"Request cancelled"));return}let X=setTimeout(Y,$);W.addEventListener("abort",()=>{clearTimeout(X),J(new k(y.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(Q,W){let $=this._taskStore;if(!$)throw Error("No task store configured");return{createTask:async(Y)=>{if(!Q)throw Error("No request provided");return await $.createTask(Y,Q.id,{method:Q.method,params:Q.params},W)},getTask:async(Y)=>{let J=await $.getTask(Y,W);if(!J)throw new k(y.InvalidParams,"Failed to retrieve task: Task not found");return J},storeTaskResult:async(Y,J,X)=>{await $.storeTaskResult(Y,J,X,W);let G=await $.getTask(Y,W);if(G){let H=V9.parse({method:"notifications/tasks/status",params:G});if(await this.notification(H),G6(G.status))this._cleanupTaskProgressHandler(Y)}},getTaskResult:(Y)=>{return $.getTaskResult(Y,W)},updateTaskStatus:async(Y,J,X)=>{let G=await $.getTask(Y,W);if(!G)throw new k(y.InvalidParams,`Task "${Y}" not found - it may have been cleaned up`);if(G6(G.status))throw new k(y.InvalidParams,`Cannot update task "${Y}" from terminal status "${G.status}" to "${J}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await $.updateTaskStatus(Y,J,X,W);let H=await $.getTask(Y,W);if(H){let B=V9.parse({method:"notifications/tasks/status",params:H});if(await this.notification(B),G6(H.status))this._cleanupTaskProgressHandler(Y)}},listTasks:(Y)=>{return $.listTasks(Y,W)}}}}function P3(Q){return Q!==null&&typeof Q==="object"&&!Array.isArray(Q)}function R3(Q,W){let $={...Q};for(let Y in W){let J=Y,X=W[J];if(X===void 0)continue;let G=$[J];if(P3(G)&&P3(X))$[J]={...G,...X};else $[J]=X}return $}var IB=v7(e5(),1),SB=v7(RB(),1);function FM(){let Q=new IB.default({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return SB.default(Q),Q}class H7{constructor(Q){this._ajv=Q??FM()}getValidator(Q){let W="$id"in Q&&typeof Q.$id==="string"?this._ajv.getSchema(Q.$id)??this._ajv.compile(Q):this._ajv.compile(Q);return($)=>{if(W($))return{valid:!0,data:$,errorMessage:void 0};else return{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(W.errors)}}}}class B7{constructor(Q){this._server=Q}requestStream(Q,W,$){return this._server.requestStream(Q,W,$)}async getTask(Q,W){return this._server.getTask({taskId:Q},W)}async getTaskResult(Q,W,$){return this._server.getTaskResult({taskId:Q},W,$)}async listTasks(Q,W){return this._server.listTasks(Q?{cursor:Q}:void 0,W)}async cancelTask(Q,W){return this._server.cancelTask({taskId:Q},W)}}function bB(Q,W,$){if(!Q)throw Error(`${$} does not support task creation (required for ${W})`);switch(W){case"tools/call":if(!Q.tools?.call)throw Error(`${$} does not support task creation for tools/call (required for ${W})`);break;default:break}}function CB(Q,W,$){if(!Q)throw Error(`${$} does not support task creation (required for ${W})`);switch(W){case"sampling/createMessage":if(!Q.sampling?.createMessage)throw Error(`${$} does not support task creation for sampling/createMessage (required for ${W})`);break;case"elicitation/create":if(!Q.elicitation?.create)throw Error(`${$} does not support task creation for elicitation/create (required for ${W})`);break;default:break}}class K7 extends PY{constructor(Q,W){super(W);if(this._serverInfo=Q,this._loggingLevels=new Map,this.LOG_LEVEL_SEVERITY=new Map(L9.options.map(($,Y)=>[$,Y])),this.isMessageIgnored=($,Y)=>{let J=this._loggingLevels.get(Y);return J?this.LOG_LEVEL_SEVERITY.get($)<this.LOG_LEVEL_SEVERITY.get(J):!1},this._capabilities=W?.capabilities??{},this._instructions=W?.instructions,this._jsonSchemaValidator=W?.jsonSchemaValidator??new H7,this.setRequestHandler(I8,($)=>this._oninitialize($)),this.setNotificationHandler(XY,()=>this.oninitialized?.()),this._capabilities.logging)this.setRequestHandler(LY,async($,Y)=>{let J=Y.sessionId||Y.requestInfo?.headers["mcp-session-id"]||void 0,{level:X}=$.params,G=L9.safeParse(X);if(G.success)this._loggingLevels.set(J,G.data);return{}})}get experimental(){if(!this._experimental)this._experimental={tasks:new B7(this)};return this._experimental}registerCapabilities(Q){if(this.transport)throw Error("Cannot register capabilities after connecting to transport");this._capabilities=R3(this._capabilities,Q)}setRequestHandler(Q,W){let Y=Y6(Q)?.method;if(!Y)throw Error("Schema is missing a method literal");let J;if(J1(Y)){let G=Y;J=G._zod?.def?.value??G.value}else{let G=Y;J=G._def?.value??G.value}if(typeof J!=="string")throw Error("Schema method literal must be a string");if(J==="tools/call"){let G=async(H,B)=>{let K=$6(O4,H);if(!K.success){let q=K.error instanceof Error?K.error.message:String(K.error);throw new k(y.InvalidParams,`Invalid tools/call request: ${q}`)}let{params:F}=K.data,L=await Promise.resolve(W(H,B));if(F.task){let q=$6(A4,L);if(!q.success){let A=q.error instanceof Error?q.error.message:String(q.error);throw new k(y.InvalidParams,`Invalid task creation result: ${A}`)}return q.data}let U=$6(l8,L);if(!U.success){let q=U.error instanceof Error?U.error.message:String(U.error);throw new k(y.InvalidParams,`Invalid tools/call result: ${q}`)}return U.data};return super.setRequestHandler(Q,G)}return super.setRequestHandler(Q,W)}assertCapabilityForMethod(Q){switch(Q){case"sampling/createMessage":if(!this._clientCapabilities?.sampling)throw Error(`Client does not support sampling (required for ${Q})`);break;case"elicitation/create":if(!this._clientCapabilities?.elicitation)throw Error(`Client does not support elicitation (required for ${Q})`);break;case"roots/list":if(!this._clientCapabilities?.roots)throw Error(`Client does not support listing roots (required for ${Q})`);break;case"ping":break}}assertNotificationCapability(Q){switch(Q){case"notifications/message":if(!this._capabilities.logging)throw Error(`Server does not support logging (required for ${Q})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw Error(`Server does not support notifying about resources (required for ${Q})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw Error(`Server does not support notifying of tool list changes (required for ${Q})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw Error(`Server does not support notifying of prompt list changes (required for ${Q})`);break;case"notifications/elicitation/complete":if(!this._clientCapabilities?.elicitation?.url)throw Error(`Client does not support URL elicitation (required for ${Q})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(Q){if(!this._capabilities)return;switch(Q){case"completion/complete":if(!this._capabilities.completions)throw Error(`Server does not support completions (required for ${Q})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw Error(`Server does not support logging (required for ${Q})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw Error(`Server does not support prompts (required for ${Q})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw Error(`Server does not support resources (required for ${Q})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw Error(`Server does not support tools (required for ${Q})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw Error(`Server does not support tasks capability (required for ${Q})`);break;case"ping":case"initialize":break}}assertTaskCapability(Q){CB(this._clientCapabilities?.tasks?.requests,Q,"Client")}assertTaskHandlerCapability(Q){if(!this._capabilities)return;bB(this._capabilities.tasks?.requests,Q,"Server")}async _oninitialize(Q){let W=Q.params.protocolVersion;return this._clientCapabilities=Q.params.capabilities,this._clientVersion=Q.params.clientInfo,{protocolVersion:J9.includes(W)?W:e$,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},P8)}async createMessage(Q,W){if(Q.tools||Q.toolChoice){if(!this._clientCapabilities?.sampling?.tools)throw Error("Client does not support sampling tools capability.")}if(Q.messages.length>0){let $=Q.messages[Q.messages.length-1],Y=Array.isArray($.content)?$.content:[$.content],J=Y.some((B)=>B.type==="tool_result"),X=Q.messages.length>1?Q.messages[Q.messages.length-2]:void 0,G=X?Array.isArray(X.content)?X.content:[X.content]:[],H=G.some((B)=>B.type==="tool_use");if(J){if(Y.some((B)=>B.type!=="tool_result"))throw Error("The last message must contain only tool_result content if any is present");if(!H)throw Error("tool_result blocks are not matching any tool_use from the previous message")}if(H){let B=new Set(G.filter((F)=>F.type==="tool_use").map((F)=>F.id)),K=new Set(Y.filter((F)=>F.type==="tool_result").map((F)=>F.toolUseId));if(B.size!==K.size||![...B].every((F)=>K.has(F)))throw Error("ids of tool_result blocks and tool_use blocks from previous message do not match")}}if(Q.tools)return this.request({method:"sampling/createMessage",params:Q},UY,W);return this.request({method:"sampling/createMessage",params:Q},qY,W)}async elicitInput(Q,W){switch(Q.mode??"form"){case"url":{if(!this._clientCapabilities?.elicitation?.url)throw Error("Client does not support url elicitation.");let Y=Q;return this.request({method:"elicitation/create",params:Y},m8,W)}case"form":{if(!this._clientCapabilities?.elicitation?.form)throw Error("Client does not support form elicitation.");let Y=Q.mode==="form"?Q:{...Q,mode:"form"},J=await this.request({method:"elicitation/create",params:Y},m8,W);if(J.action==="accept"&&J.content&&Y.requestedSchema)try{let G=this._jsonSchemaValidator.getValidator(Y.requestedSchema)(J.content);if(!G.valid)throw new k(y.InvalidParams,`Elicitation response content does not match requested schema: ${G.errorMessage}`)}catch(X){if(X instanceof k)throw X;throw new k(y.InternalError,`Error validating elicitation response: ${X instanceof Error?X.message:String(X)}`)}return J}}}createElicitationCompletionNotifier(Q,W){if(!this._clientCapabilities?.elicitation?.url)throw Error("Client does not support URL elicitation (required for notifications/elicitation/complete)");return()=>this.notification({method:"notifications/elicitation/complete",params:{elicitationId:Q}},W)}async listRoots(Q,W){return this.request({method:"roots/list",params:Q},AY,W)}async sendLoggingMessage(Q,W){if(this._capabilities.logging){if(!this.isMessageIgnored(Q.level,W))return this.notification({method:"notifications/message",params:Q})}}async sendResourceUpdated(Q){return this.notification({method:"notifications/resources/updated",params:Q})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}}var vB=Symbol.for("mcp.completable");function V7(Q){return!!Q&&typeof Q==="object"&&vB in Q}function TB(Q){return Q[vB]?.complete}var ZB;(function(Q){Q.Completable="McpCompletable"})(ZB||(ZB={}));class p1{static isTemplate(Q){return/\{[^}\s]+\}/.test(Q)}static validateLength(Q,W,$){if(Q.length>W)throw Error(`${$} exceeds maximum length of ${W} characters (got ${Q.length})`)}get variableNames(){return this.parts.flatMap((Q)=>typeof Q==="string"?[]:Q.names)}constructor(Q){p1.validateLength(Q,1e6,"Template"),this.template=Q,this.parts=this.parse(Q)}toString(){return this.template}parse(Q){let W=[],$="",Y=0,J=0;while(Y<Q.length)if(Q[Y]==="{"){if($)W.push($),$="";let X=Q.indexOf("}",Y);if(X===-1)throw Error("Unclosed template expression");if(J++,J>1e4)throw Error("Template contains too many expressions (max 10000)");let G=Q.slice(Y+1,X),H=this.getOperator(G),B=G.includes("*"),K=this.getNames(G),F=K[0];for(let L of K)p1.validateLength(L,1e6,"Variable name");W.push({name:F,operator:H,names:K,exploded:B}),Y=X+1}else $+=Q[Y],Y++;if($)W.push($);return W}getOperator(Q){return["+","#",".","/","?","&"].find(($)=>Q.startsWith($))||""}getNames(Q){let W=this.getOperator(Q);return Q.slice(W.length).split(",").map(($)=>$.replace("*","").trim()).filter(($)=>$.length>0)}encodeValue(Q,W){if(p1.validateLength(Q,1e6,"Variable value"),W==="+"||W==="#")return encodeURI(Q);return encodeURIComponent(Q)}expandPart(Q,W){if(Q.operator==="?"||Q.operator==="&"){let X=Q.names.map((H)=>{let B=W[H];if(B===void 0)return"";let K=Array.isArray(B)?B.map((F)=>this.encodeValue(F,Q.operator)).join(","):this.encodeValue(B.toString(),Q.operator);return`${H}=${K}`}).filter((H)=>H.length>0);if(X.length===0)return"";return(Q.operator==="?"?"?":"&")+X.join("&")}if(Q.names.length>1){let X=Q.names.map((G)=>W[G]).filter((G)=>G!==void 0);if(X.length===0)return"";return X.map((G)=>Array.isArray(G)?G[0]:G).join(",")}let $=W[Q.name];if($===void 0)return"";let J=(Array.isArray($)?$:[$]).map((X)=>this.encodeValue(X,Q.operator));switch(Q.operator){case"":return J.join(",");case"+":return J.join(",");case"#":return"#"+J.join(",");case".":return"."+J.join(".");case"/":return"/"+J.join("/");default:return J.join(",")}}expand(Q){let W="",$=!1;for(let Y of this.parts){if(typeof Y==="string"){W+=Y;continue}let J=this.expandPart(Y,Q);if(!J)continue;if((Y.operator==="?"||Y.operator==="&")&&$)W+=J.replace("?","&");else W+=J;if(Y.operator==="?"||Y.operator==="&")$=!0}return W}escapeRegExp(Q){return Q.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}partToRegExp(Q){let W=[];for(let J of Q.names)p1.validateLength(J,1e6,"Variable name");if(Q.operator==="?"||Q.operator==="&"){for(let J=0;J<Q.names.length;J++){let X=Q.names[J],G=J===0?"\\"+Q.operator:"&";W.push({pattern:G+this.escapeRegExp(X)+"=([^&]+)",name:X})}return W}let $,Y=Q.name;switch(Q.operator){case"":$=Q.exploded?"([^/]+(?:,[^/]+)*)":"([^/,]+)";break;case"+":case"#":$="(.+)";break;case".":$="\\.([^/,]+)";break;case"/":$="/"+(Q.exploded?"([^/]+(?:,[^/]+)*)":"([^/,]+)");break;default:$="([^/]+)"}return W.push({pattern:$,name:Y}),W}match(Q){p1.validateLength(Q,1e6,"URI");let W="^",$=[];for(let G of this.parts)if(typeof G==="string")W+=this.escapeRegExp(G);else{let H=this.partToRegExp(G);for(let{pattern:B,name:K}of H)W+=B,$.push({name:K,exploded:G.exploded})}W+="$",p1.validateLength(W,1e6,"Generated regex pattern");let Y=new RegExp(W),J=Q.match(Y);if(!J)return null;let X={};for(let G=0;G<$.length;G++){let{name:H,exploded:B}=$[G],K=J[G+1],F=H.replace("*","");if(B&&K.includes(","))X[F]=K.split(",");else X[F]=K}return X}}var LM=/^[A-Za-z0-9._-]{1,128}$/;function qM(Q){let W=[];if(Q.length===0)return{isValid:!1,warnings:["Tool name cannot be empty"]};if(Q.length>128)return{isValid:!1,warnings:[`Tool name exceeds maximum length of 128 characters (current: ${Q.length})`]};if(Q.includes(" "))W.push("Tool name contains spaces, which may cause parsing issues");if(Q.includes(","))W.push("Tool name contains commas, which may cause parsing issues");if(Q.startsWith("-")||Q.endsWith("-"))W.push("Tool name starts or ends with a dash, which may cause parsing issues in some contexts");if(Q.startsWith(".")||Q.endsWith("."))W.push("Tool name starts or ends with a dot, which may cause parsing issues in some contexts");if(!LM.test(Q)){let $=Q.split("").filter((Y)=>!/[A-Za-z0-9._-]/.test(Y)).filter((Y,J,X)=>X.indexOf(Y)===J);return W.push(`Tool name contains invalid characters: ${$.map((Y)=>`"${Y}"`).join(", ")}`,"Allowed characters are: A-Z, a-z, 0-9, underscore (_), dash (-), and dot (.)"),{isValid:!1,warnings:W}}return{isValid:!0,warnings:W}}function UM(Q,W){if(W.length>0){console.warn(`Tool name validation warning for "${Q}":`);for(let $ of W)console.warn(`  - ${$}`);console.warn("Tool registration will proceed, but this may cause compatibility issues."),console.warn("Consider updating the tool name to conform to the MCP tool naming standard."),console.warn("See SEP: Specify Format for Tool Names (https://github.com/modelcontextprotocol/modelcontextprotocol/issues/986) for more details.")}}function F7(Q){let W=qM(Q);return UM(Q,W.warnings),W.isValid}class L7{constructor(Q){this._mcpServer=Q}registerToolTask(Q,W,$){let Y={taskSupport:"required",...W.execution};if(Y.taskSupport==="forbidden")throw Error(`Cannot register task-based tool '${Q}' with taskSupport 'forbidden'. Use registerTool() instead.`);return this._mcpServer._createRegisteredTool(Q,W.title,W.description,W.inputSchema,W.outputSchema,W.annotations,Y,W._meta,$)}}class U7{constructor(Q,W){this._registeredResources={},this._registeredResourceTemplates={},this._registeredTools={},this._registeredPrompts={},this._toolHandlersInitialized=!1,this._completionHandlerInitialized=!1,this._resourceHandlersInitialized=!1,this._promptHandlersInitialized=!1,this.server=new K7(Q,W)}get experimental(){if(!this._experimental)this._experimental={tasks:new L7(this)};return this._experimental}async connect(Q){return await this.server.connect(Q)}async close(){await this.server.close()}setToolRequestHandlers(){if(this._toolHandlersInitialized)return;this.server.assertCanSetRequestHandler(O6(u8)),this.server.assertCanSetRequestHandler(O6(O4)),this.server.registerCapabilities({tools:{listChanged:!0}}),this.server.setRequestHandler(u8,()=>({tools:Object.entries(this._registeredTools).filter(([,Q])=>Q.enabled).map(([Q,W])=>{let $={name:Q,title:W.title,description:W.description,inputSchema:(()=>{let Y=L4(W.inputSchema);return Y?jY(Y,{strictUnions:!0,pipeStrategy:"input"}):AM})(),annotations:W.annotations,execution:W.execution,_meta:W._meta};if(W.outputSchema){let Y=L4(W.outputSchema);if(Y)$.outputSchema=jY(Y,{strictUnions:!0,pipeStrategy:"output"})}return $})})),this.server.setRequestHandler(O4,async(Q,W)=>{try{let $=this._registeredTools[Q.params.name];if(!$)throw new k(y.InvalidParams,`Tool ${Q.params.name} not found`);if(!$.enabled)throw new k(y.InvalidParams,`Tool ${Q.params.name} disabled`);let Y=!!Q.params.task,J=$.execution?.taskSupport,X="createTask"in $.handler;if((J==="required"||J==="optional")&&!X)throw new k(y.InternalError,`Tool ${Q.params.name} has taskSupport '${J}' but was not registered with registerToolTask`);if(J==="required"&&!Y)throw new k(y.MethodNotFound,`Tool ${Q.params.name} requires task augmentation (taskSupport: 'required')`);if(J==="optional"&&!Y&&X)return await this.handleAutomaticTaskPolling($,Q,W);let G=await this.validateToolInput($,Q.params.arguments,Q.params.name),H=await this.executeToolHandler($,G,W);if(Y)return H;return await this.validateToolOutput($,H,Q.params.name),H}catch($){if($ instanceof k){if($.code===y.UrlElicitationRequired)throw $}return this.createToolError($ instanceof Error?$.message:String($))}}),this._toolHandlersInitialized=!0}createToolError(Q){return{content:[{type:"text",text:Q}],isError:!0}}async validateToolInput(Q,W,$){if(!Q.inputSchema)return;let J=L4(Q.inputSchema)??Q.inputSchema,X=await D8(J,W);if(!X.success){let G="error"in X?X.error:"Unknown error",H=O8(G);throw new k(y.InvalidParams,`Input validation error: Invalid arguments for tool ${$}: ${H}`)}return X.data}async validateToolOutput(Q,W,$){if(!Q.outputSchema)return;if(!("content"in W))return;if(W.isError)return;if(!W.structuredContent)throw new k(y.InvalidParams,`Output validation error: Tool ${$} has an output schema but no structured content was provided`);let Y=L4(Q.outputSchema),J=await D8(Y,W.structuredContent);if(!J.success){let X="error"in J?J.error:"Unknown error",G=O8(X);throw new k(y.InvalidParams,`Output validation error: Invalid structured content for tool ${$}: ${G}`)}}async executeToolHandler(Q,W,$){let Y=Q.handler;if("createTask"in Y){if(!$.taskStore)throw Error("No task store provided.");let X={...$,taskStore:$.taskStore};if(Q.inputSchema)return await Promise.resolve(Y.createTask(W,X));else return await Promise.resolve(Y.createTask(X))}if(Q.inputSchema)return await Promise.resolve(Y(W,$));else return await Promise.resolve(Y($))}async handleAutomaticTaskPolling(Q,W,$){if(!$.taskStore)throw Error("No task store provided for task-capable tool.");let Y=await this.validateToolInput(Q,W.params.arguments,W.params.name),J=Q.handler,X={...$,taskStore:$.taskStore},G=Y?await Promise.resolve(J.createTask(Y,X)):await Promise.resolve(J.createTask(X)),H=G.task.taskId,B=G.task,K=B.pollInterval??5000;while(B.status!=="completed"&&B.status!=="failed"&&B.status!=="cancelled"){await new Promise((L)=>setTimeout(L,K));let F=await $.taskStore.getTask(H);if(!F)throw new k(y.InternalError,`Task ${H} not found during polling`);B=F}return await $.taskStore.getTaskResult(H)}setCompletionRequestHandler(){if(this._completionHandlerInitialized)return;this.server.assertCanSetRequestHandler(O6(c8)),this.server.registerCapabilities({completions:{}}),this.server.setRequestHandler(c8,async(Q)=>{switch(Q.params.ref.type){case"ref/prompt":return cX(Q),this.handlePromptCompletion(Q,Q.params.ref);case"ref/resource":return pX(Q),this.handleResourceCompletion(Q,Q.params.ref);default:throw new k(y.InvalidParams,`Invalid completion reference: ${Q.params.ref}`)}}),this._completionHandlerInitialized=!0}async handlePromptCompletion(Q,W){let $=this._registeredPrompts[W.name];if(!$)throw new k(y.InvalidParams,`Prompt ${W.name} not found`);if(!$.enabled)throw new k(y.InvalidParams,`Prompt ${W.name} disabled`);if(!$.argsSchema)return f9;let J=Y6($.argsSchema)?.[Q.params.argument.name];if(!V7(J))return f9;let X=TB(J);if(!X)return f9;let G=await X(Q.params.argument.value,Q.params.context);return _B(G)}async handleResourceCompletion(Q,W){let $=Object.values(this._registeredResourceTemplates).find((X)=>X.resourceTemplate.uriTemplate.toString()===W.uri);if(!$){if(this._registeredResources[W.uri])return f9;throw new k(y.InvalidParams,`Resource template ${Q.params.ref.uri} not found`)}let Y=$.resourceTemplate.completeCallback(Q.params.argument.name);if(!Y)return f9;let J=await Y(Q.params.argument.value,Q.params.context);return _B(J)}setResourceRequestHandlers(){if(this._resourceHandlersInitialized)return;this.server.assertCanSetRequestHandler(O6(x8)),this.server.assertCanSetRequestHandler(O6(y8)),this.server.assertCanSetRequestHandler(O6(g8)),this.server.registerCapabilities({resources:{listChanged:!0}}),this.server.setRequestHandler(x8,async(Q,W)=>{let $=Object.entries(this._registeredResources).filter(([J,X])=>X.enabled).map(([J,X])=>({uri:J,name:X.name,...X.metadata})),Y=[];for(let J of Object.values(this._registeredResourceTemplates)){if(!J.resourceTemplate.listCallback)continue;let X=await J.resourceTemplate.listCallback(W);for(let G of X.resources)Y.push({...J.metadata,...G})}return{resources:[...$,...Y]}}),this.server.setRequestHandler(y8,async()=>{return{resourceTemplates:Object.entries(this._registeredResourceTemplates).map(([W,$])=>({name:W,uriTemplate:$.resourceTemplate.uriTemplate.toString(),...$.metadata}))}}),this.server.setRequestHandler(g8,async(Q,W)=>{let $=new URL(Q.params.uri),Y=this._registeredResources[$.toString()];if(Y){if(!Y.enabled)throw new k(y.InvalidParams,`Resource ${$} disabled`);return Y.readCallback($,W)}for(let J of Object.values(this._registeredResourceTemplates)){let X=J.resourceTemplate.uriTemplate.match($.toString());if(X)return J.readCallback($,X,W)}throw new k(y.InvalidParams,`Resource ${$} not found`)}),this._resourceHandlersInitialized=!0}setPromptRequestHandlers(){if(this._promptHandlersInitialized)return;this.server.assertCanSetRequestHandler(O6(h8)),this.server.assertCanSetRequestHandler(O6(f8)),this.server.registerCapabilities({prompts:{listChanged:!0}}),this.server.setRequestHandler(h8,()=>({prompts:Object.entries(this._registeredPrompts).filter(([,Q])=>Q.enabled).map(([Q,W])=>{return{name:Q,title:W.title,description:W.description,arguments:W.argsSchema?OM(W.argsSchema):void 0}})})),this.server.setRequestHandler(f8,async(Q,W)=>{let $=this._registeredPrompts[Q.params.name];if(!$)throw new k(y.InvalidParams,`Prompt ${Q.params.name} not found`);if(!$.enabled)throw new k(y.InvalidParams,`Prompt ${Q.params.name} disabled`);if($.argsSchema){let Y=L4($.argsSchema),J=await D8(Y,Q.params.arguments);if(!J.success){let H="error"in J?J.error:"Unknown error",B=O8(H);throw new k(y.InvalidParams,`Invalid arguments for prompt ${Q.params.name}: ${B}`)}let X=J.data,G=$.callback;return await Promise.resolve(G(X,W))}else{let Y=$.callback;return await Promise.resolve(Y(W))}}),this._promptHandlersInitialized=!0}resource(Q,W,...$){let Y;if(typeof $[0]==="object")Y=$.shift();let J=$[0];if(typeof W==="string"){if(this._registeredResources[W])throw Error(`Resource ${W} is already registered`);let X=this._createRegisteredResource(Q,void 0,W,Y,J);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),X}else{if(this._registeredResourceTemplates[Q])throw Error(`Resource template ${Q} is already registered`);let X=this._createRegisteredResourceTemplate(Q,void 0,W,Y,J);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),X}}registerResource(Q,W,$,Y){if(typeof W==="string"){if(this._registeredResources[W])throw Error(`Resource ${W} is already registered`);let J=this._createRegisteredResource(Q,$.title,W,$,Y);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),J}else{if(this._registeredResourceTemplates[Q])throw Error(`Resource template ${Q} is already registered`);let J=this._createRegisteredResourceTemplate(Q,$.title,W,$,Y);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),J}}_createRegisteredResource(Q,W,$,Y,J){let X={name:Q,title:W,metadata:Y,readCallback:J,enabled:!0,disable:()=>X.update({enabled:!1}),enable:()=>X.update({enabled:!0}),remove:()=>X.update({uri:null}),update:(G)=>{if(typeof G.uri<"u"&&G.uri!==$){if(delete this._registeredResources[$],G.uri)this._registeredResources[G.uri]=X}if(typeof G.name<"u")X.name=G.name;if(typeof G.title<"u")X.title=G.title;if(typeof G.metadata<"u")X.metadata=G.metadata;if(typeof G.callback<"u")X.readCallback=G.callback;if(typeof G.enabled<"u")X.enabled=G.enabled;this.sendResourceListChanged()}};return this._registeredResources[$]=X,X}_createRegisteredResourceTemplate(Q,W,$,Y,J){let X={resourceTemplate:$,title:W,metadata:Y,readCallback:J,enabled:!0,disable:()=>X.update({enabled:!1}),enable:()=>X.update({enabled:!0}),remove:()=>X.update({name:null}),update:(B)=>{if(typeof B.name<"u"&&B.name!==Q){if(delete this._registeredResourceTemplates[Q],B.name)this._registeredResourceTemplates[B.name]=X}if(typeof B.title<"u")X.title=B.title;if(typeof B.template<"u")X.resourceTemplate=B.template;if(typeof B.metadata<"u")X.metadata=B.metadata;if(typeof B.callback<"u")X.readCallback=B.callback;if(typeof B.enabled<"u")X.enabled=B.enabled;this.sendResourceListChanged()}};this._registeredResourceTemplates[Q]=X;let G=$.uriTemplate.variableNames;if(Array.isArray(G)&&G.some((B)=>!!$.completeCallback(B)))this.setCompletionRequestHandler();return X}_createRegisteredPrompt(Q,W,$,Y,J){let X={title:W,description:$,argsSchema:Y===void 0?void 0:Z6(Y),callback:J,enabled:!0,disable:()=>X.update({enabled:!1}),enable:()=>X.update({enabled:!0}),remove:()=>X.update({name:null}),update:(G)=>{if(typeof G.name<"u"&&G.name!==Q){if(delete this._registeredPrompts[Q],G.name)this._registeredPrompts[G.name]=X}if(typeof G.title<"u")X.title=G.title;if(typeof G.description<"u")X.description=G.description;if(typeof G.argsSchema<"u")X.argsSchema=Z6(G.argsSchema);if(typeof G.callback<"u")X.callback=G.callback;if(typeof G.enabled<"u")X.enabled=G.enabled;this.sendPromptListChanged()}};if(this._registeredPrompts[Q]=X,Y){if(Object.values(Y).some((H)=>{let B=H instanceof e0?H._def?.innerType:H;return V7(B)}))this.setCompletionRequestHandler()}return X}_createRegisteredTool(Q,W,$,Y,J,X,G,H,B){F7(Q);let K={title:W,description:$,inputSchema:kB(Y),outputSchema:kB(J),annotations:X,execution:G,_meta:H,handler:B,enabled:!0,disable:()=>K.update({enabled:!1}),enable:()=>K.update({enabled:!0}),remove:()=>K.update({name:null}),update:(F)=>{if(typeof F.name<"u"&&F.name!==Q){if(typeof F.name==="string")F7(F.name);if(delete this._registeredTools[Q],F.name)this._registeredTools[F.name]=K}if(typeof F.title<"u")K.title=F.title;if(typeof F.description<"u")K.description=F.description;if(typeof F.paramsSchema<"u")K.inputSchema=Z6(F.paramsSchema);if(typeof F.outputSchema<"u")K.outputSchema=Z6(F.outputSchema);if(typeof F.callback<"u")K.handler=F.callback;if(typeof F.annotations<"u")K.annotations=F.annotations;if(typeof F._meta<"u")K._meta=F._meta;if(typeof F.enabled<"u")K.enabled=F.enabled;this.sendToolListChanged()}};return this._registeredTools[Q]=K,this.setToolRequestHandlers(),this.sendToolListChanged(),K}tool(Q,...W){if(this._registeredTools[Q])throw Error(`Tool ${Q} is already registered`);let $,Y,J,X;if(typeof W[0]==="string")$=W.shift();if(W.length>1){let H=W[0];if(q7(H)){if(Y=W.shift(),W.length>1&&typeof W[0]==="object"&&W[0]!==null&&!q7(W[0]))X=W.shift()}else if(typeof H==="object"&&H!==null)X=W.shift()}let G=W[0];return this._createRegisteredTool(Q,void 0,$,Y,J,X,{taskSupport:"forbidden"},void 0,G)}registerTool(Q,W,$){if(this._registeredTools[Q])throw Error(`Tool ${Q} is already registered`);let{title:Y,description:J,inputSchema:X,outputSchema:G,annotations:H,_meta:B}=W;return this._createRegisteredTool(Q,Y,J,X,G,H,{taskSupport:"forbidden"},B,$)}prompt(Q,...W){if(this._registeredPrompts[Q])throw Error(`Prompt ${Q} is already registered`);let $;if(typeof W[0]==="string")$=W.shift();let Y;if(W.length>1)Y=W.shift();let J=W[0],X=this._createRegisteredPrompt(Q,void 0,$,Y,J);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),X}registerPrompt(Q,W,$){if(this._registeredPrompts[Q])throw Error(`Prompt ${Q} is already registered`);let{title:Y,description:J,argsSchema:X}=W,G=this._createRegisteredPrompt(Q,Y,J,X,$);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),G}isConnected(){return this.server.transport!==void 0}async sendLoggingMessage(Q,W){return this.server.sendLoggingMessage(Q,W)}sendResourceListChanged(){if(this.isConnected())this.server.sendResourceListChanged()}sendToolListChanged(){if(this.isConnected())this.server.sendToolListChanged()}sendPromptListChanged(){if(this.isConnected())this.server.sendPromptListChanged()}}class TQ{constructor(Q,W){this._callbacks=W,this._uriTemplate=typeof Q==="string"?new p1(Q):Q}get uriTemplate(){return this._uriTemplate}get listCallback(){return this._callbacks.list}completeCallback(Q){return this._callbacks.complete?.[Q]}}var AM={type:"object",properties:{}};function xB(Q){return Q!==null&&typeof Q==="object"&&"parse"in Q&&typeof Q.parse==="function"&&"safeParse"in Q&&typeof Q.safeParse==="function"}function DM(Q){return"_def"in Q||"_zod"in Q||xB(Q)}function q7(Q){if(typeof Q!=="object"||Q===null)return!1;if(DM(Q))return!1;if(Object.keys(Q).length===0)return!0;return Object.values(Q).some(xB)}function kB(Q){if(!Q)return;if(q7(Q))return Z6(Q);return Q}function OM(Q){let W=Y6(Q);if(!W)return[];return Object.entries(W).map(([$,Y])=>{let J=GX(Y),X=HX(Y);return{name:$,description:J,required:!X}})}function O6(Q){let $=Y6(Q)?.method;if(!$)throw Error("Schema is missing a method literal");let Y=w8($);if(typeof Y==="string")return Y;throw Error("Schema method literal must be a string")}function _B(Q){return{completion:{values:Q.slice(0,100),total:Q.length,hasMore:Q.length>100}}}var f9={completion:{values:[],hasMore:!1}};var A7=null;function u9(){return new U7({name:"Blockbench MCP",version:n6})}function l9(){if(!A7)A7=u9();return A7}var jI=l9();var h6={},f6={},k4={},D7={};function yB(Q){let W=Q._def;if(W.typeName==="ZodObject")return W.shape?.()??{};if(W.typeName==="ZodEffects"&&W.schema)return yB(W.schema);return{}}function R(Q,W,$="stable",Y=!0){if(h6[Q])throw Error(`Tool with name "${Q}" already exists.`);let J=yB(W.parameters),X={title:W.annotations?.title??W.description,description:W.description,inputSchema:J,execute:W.execute,annotations:W.annotations};if(D7[Q]=X,Y){let G=l9();G.registerTool.bind(G)(Q,{title:X.title,description:X.description,inputSchema:J},async(B,K)=>{let L={reportProgress:()=>{}},U=await W.execute(B,L);if(typeof U==="string")return{content:[{type:"text",text:U}]};if(U&&typeof U==="object"&&"content"in U)return U;return{content:[{type:"text",text:JSON.stringify(U)}]}})}return h6[Q]={name:Q,description:X.title,enabled:Y,status:$},h6[Q]}function gB(){return D7}function wM(){return Object.fromEntries(Object.entries(D7).filter(([Q])=>h6[Q]?.enabled))}function hB(Q){let W=wM(),$=Q;for(let[Y,J]of Object.entries(W))$.registerTool(Y,{title:J.title,description:J.description,inputSchema:J.inputSchema},async(X,G)=>{let B={reportProgress:()=>{}},K=await J.execute(X,B);if(typeof K==="string")return{content:[{type:"text",text:K}]};if(K&&typeof K==="object"&&"content"in K)return K;return{content:[{type:"text",text:JSON.stringify(K)}]}})}var fB={};function d1(Q,W){if(k4[Q])throw Error(`Resource with name "${Q}" already exists.`);let $={name:Q,uriTemplate:W.uriTemplate,metadata:{title:W.title,description:W.description},listCallback:W.listCallback,readCallback:W.readCallback};fB[Q]=$;let Y=l9();return Y.registerResource.bind(Y)(Q,new TQ(W.uriTemplate,{list:W.listCallback}),{title:W.title,description:W.description},async(X,G)=>{let H=Object.fromEntries(Object.entries(G).map(([B,K])=>{if(Array.isArray(K))return[B,K[0]??""];return[B,K]}));return W.readCallback(X,H)}),k4[Q]={name:Q,description:W.description,uriTemplate:W.uriTemplate},k4[Q]}function uB(Q){let W=Q;for(let[$,Y]of Object.entries(fB))W.registerResource($,new TQ(Y.uriTemplate,{list:Y.listCallback}),Y.metadata,async(J,X)=>{let G=Object.fromEntries(Object.entries(X).map(([H,B])=>{if(Array.isArray(B))return[H,B[0]??""];return[H,B]}));return Y.readCallback(J,G)})}var O7={};function w6(Q,W,$="stable",Y=!0){if(f6[Q])throw Error(`Prompt with name "${Q}" already exists.`);if(Y&&W.generate&&W.argsSchema){let J={name:Q,title:W.title||W.description,description:W.description,argsSchema:W.argsSchema.shape,generate:async(X)=>{return await W.generate(X)}};O7[Q]=J,l9().registerPrompt(Q,{title:J.title,description:J.description,argsSchema:J.argsSchema},J.generate)}return f6[Q]={name:Q,arguments:W.argsSchema?.shape||{},description:W.description,enabled:Y,status:$},f6[Q]}function lB(){return O7}function mB(Q){let W=Q;for(let[$,Y]of Object.entries(O7))W.registerPrompt($,{title:Y.title,description:Y.description,argsSchema:Y.argsSchema},Y.generate)}function _4(Q,W="image/png"){let $=typeof Q==="string"?Q:Q.url,Y=$;if($.startsWith("data:")){let J=$.match(/^data:([^;]+);base64,(.+)$/);if(J)W=J[1]||W,Y=J[2]}return{content:[{type:"image",data:Y,mimeType:W}]}}function E0(Q){return(Project?.textures??Texture.all).find(({id:$,name:Y,uuid:J})=>$===Q||Y===Q||J===Q)||null}function f0(Q){let W=Group.all.find(($)=>$.name===Q);if(!W)throw Error(`Bone/group "${Q}" not found. Use the list_outline tool to see available groups and bones.`);return W}function u6(Q){let W=Mesh.all.find(($)=>$.uuid===Q||$.name===Q);if(!W)throw Error(`Mesh "${Q}" not found. Use the list_outline tool to see available meshes.`);return W}function E1(Q){let W=Outliner.root.find(($)=>$.uuid===Q||$.name===Q);if(!W)throw Error(`Element "${Q}" not found. Use the list_outline tool to see available elements.`);return W}function u0(Q){let W=E0(Q);if(!W)throw Error(`Texture "${Q}" not found. Use the list_textures tool to see available textures.`);return W}function m9(Q){let W=TextureGroup.all.find(($)=>$.uuid===Q||$.name===Q);if(!W)throw Error(`Material/texture group "${Q}" not found. Use the list_materials tool to see available materials.`);return W}function c9(Q,W){let $=Q.find((Y)=>Y.pbr_channel===W);return $?{name:$.name,uuid:$.uuid,hasTexture:!0}:{hasTexture:!1}}function i1(Q){if(Q)return u6(Q);let W=Mesh.selected[0];if(!W)throw Error("No mesh selected and no mesh_id provided. Select a mesh or provide a mesh_id. Use the list_outline tool to see available meshes.");return W}function w7(Q){let W=Project;if(!W||Q!==void 0)W=ModelProject.all.find((J)=>J.name===Q||J.uuid===Q||J.selected);if(!W)throw Error("No project found in the Blockbench editor.");if(!W.selected)W.select();let $=Preview.selected;if(!$)throw Error("No preview available for the selected project.");let Y;if(Canvas.withoutGizmos(()=>{$.render(),Y=$.canvas.toDataURL()}),!Y)throw Error("Failed to capture preview screenshot.");return _4(Y,"image/png")}async function l6(){return new Promise((Q,W)=>{let $=!1,Y=setTimeout(()=>{if(!$)$=!0,W(Error("App screenshot timed out after 5 seconds."))},5000);Screencam.fullScreen({},(J)=>{if(!$)if($=!0,clearTimeout(Y),J)Q(_4(J,"image/png"));else W(Error("Failed to capture app screenshot - no data returned."))})})}function cB(){R("capture_screenshot",{description:"Returns the image data of the current view.",annotations:{title:"Capture Screenshot",readOnlyHint:!0},parameters:V.object({project:V.string().optional().describe("Project name or UUID.")}),async execute({project:Q}){return w7(Q)}},K0),R("capture_app_screenshot",{description:"Returns the image data of the Blockbench app.",annotations:{title:"Capture App Screenshot",readOnlyHint:!0},parameters:V.object({}),async execute(){return l6()}},K0),R("set_camera_angle",{description:"Sets the camera angle to the specified value.",annotations:{title:"Set Camera Angle",destructiveHint:!0},parameters:V.object({position:V.array(V.number()).length(3).describe("Camera position."),target:V.array(V.number()).length(3).optional().describe("Camera target position."),rotation:V.array(V.number()).length(3).optional().describe("Camera rotation."),projection:V.enum(["unset","orthographic","perspective"]).describe("Camera projection type.")}),async execute(Q){let W=Preview.selected;if(!W)throw Error("No preview found in the Blockbench editor.");return W.loadAnglePreset({...Q}),await w7()}},g)}function pB(){R("create_animation",{description:"Creates a new animation with keyframes for bones.",annotations:{title:"Create Animation",destructiveHint:!0},parameters:V.object({name:V.string().describe("Name of the animation"),loop:V.boolean().default(!1).describe("Whether the animation should loop"),animation_length:V.number().optional().describe("Length of the animation in seconds"),bones:V.record(V.array(V.object({time:V.number(),position:V.array(V.number()).length(3).optional(),rotation:V.array(V.number()).length(3).optional(),scale:V.union([V.array(V.number()).length(3),V.number()]).optional()}))).describe("Keyframes for each bone"),particle_effects:V.record(V.string().describe("Effect name")).optional().describe("Particle effects with timestamps as keys")}),async execute({name:Q,loop:W,animation_length:$,bones:Y,particle_effects:J}){let X={loop:W,...$&&{animation_length:$},bones:Object.fromEntries(Object.entries(Y).map(([G,H])=>{let B=H.reduce((K,F)=>{let L=F.time.toString();if(F.position)(K.position??={})[L]=F.position;if(F.rotation)(K.rotation??={})[L]=F.rotation;if(F.scale)(K.scale??={})[L]=F.scale;return K},{});return[G,B]})),...J&&{particle_effects:J}};return Animator.loadFile({content:JSON.stringify({format_version:"1.8.0",animations:{[`animation.${Q}`]:X}})}),`Created animation "${Q}" with keyframes for ${Object.keys(Y).length} bones${J?` and ${Object.keys(J).length} particle effects`:""}`}},K0),R("manage_keyframes",{description:"Creates, deletes, or edits keyframes in the animation timeline for specific bones and channels.",annotations:{title:"Manage Keyframes",destructiveHint:!0},parameters:V.object({animation_id:V.string().optional().describe("Animation UUID or name. If not provided, uses current animation."),action:V.enum(["create","delete","edit","select"]).describe("Action to perform on keyframes."),bone_name:V.string().describe("Name of the bone/group to manage keyframes for."),channel:V.enum(["rotation","position","scale"]).describe("Animation channel to modify."),keyframes:V.array(V.object({time:V.number().describe("Time in seconds for the keyframe."),values:V.union([V.array(V.number()).length(3),V.number()]).optional().describe("Values for the keyframe. [x,y,z] for position/rotation, number for uniform scale."),interpolation:V.enum(["linear","catmullrom","bezier","step"]).optional().default("linear").describe("Interpolation type for the keyframe."),bezier_handles:V.object({left_time:V.number().optional(),left_value:V.array(V.number()).length(3).optional(),right_time:V.number().optional(),right_value:V.array(V.number()).length(3).optional()}).optional().describe("Bezier handle positions for bezier interpolation.")})).describe("Keyframe data for the action.")}),async execute({animation_id:Q,action:W,bone_name:$,channel:Y,keyframes:J}){let X=Q?Animation.all.find((B)=>B.uuid===Q||B.name===Q):Animation.selected;if(!X)throw Error("No animation found or selected.");let G=f0($),H=X.animators[G.uuid];if(!H)H=new BoneAnimator(G.uuid,X,$),X.animators[G.uuid]=H;switch(Undo.initEdit({animations:[X],keyframes:[]}),W){case"create":J.forEach((B)=>{let K=H.createKeyframe({time:B.time,channel:Y,values:B.values,interpolation:B.interpolation},B.time,Y,!1);if(B.interpolation==="bezier"&&B.bezier_handles){if(B.bezier_handles.left_time!==void 0)K.bezier_left_time=B.bezier_handles.left_time;if(B.bezier_handles.left_value)K.bezier_left_value=B.bezier_handles.left_value;if(B.bezier_handles.right_time!==void 0)K.bezier_right_time=B.bezier_handles.right_time;if(B.bezier_handles.right_value)K.bezier_right_value=B.bezier_handles.right_value}});break;case"delete":J.forEach((B)=>{let K=H[Y]?.find((F)=>Math.abs(F.time-B.time)<0.001);if(K)K.remove()});break;case"edit":J.forEach((B)=>{let K=H[Y]?.find((F)=>Math.abs(F.time-B.time)<0.001);if(K){if(B.values)K.set("values",B.values);if(B.interpolation)K.interpolation=B.interpolation;if(B.interpolation==="bezier"&&B.bezier_handles){if(B.bezier_handles.left_time!==void 0)K.bezier_left_time=B.bezier_handles.left_time;if(B.bezier_handles.left_value)K.bezier_left_value=B.bezier_handles.left_value;if(B.bezier_handles.right_time!==void 0)K.bezier_right_time=B.bezier_handles.right_time;if(B.bezier_handles.right_value)K.bezier_right_value=B.bezier_handles.right_value}}});break;case"select":Timeline.selected.empty(),J.forEach((B)=>{let K=H[Y]?.find((F)=>Math.abs(F.time-B.time)<0.001);if(K)K.select()});break}return Undo.finishEdit(`${W} keyframes`),Animator.preview(),`Successfully performed ${W} on ${J.length} keyframes for ${$}.${Y}`}},g),R("animation_graph_editor",{description:"Controls animation curves in the graph editor for fine-tuning animations.",annotations:{title:"Animation Graph Editor",destructiveHint:!0},parameters:V.object({animation_id:V.string().optional().describe("Animation UUID or name. If not provided, uses current animation."),bone_name:V.string().describe("Name of the bone/group to modify curves for."),channel:V.enum(["rotation","position","scale"]).describe("Animation channel to modify."),axis:V.enum(["x","y","z","all"]).default("all").describe("Axis to modify curves for."),action:V.enum(["smooth","linear","ease_in","ease_out","ease_in_out","stepped","custom"]).describe("Type of curve modification to apply."),keyframe_range:V.object({start:V.number().describe("Start time of the range."),end:V.number().describe("End time of the range.")}).optional().describe("Time range to apply the curve modification. If not provided, applies to all keyframes."),custom_curve:V.object({control_point_1:V.array(V.number()).length(2).describe("First control point [time, value]."),control_point_2:V.array(V.number()).length(2).describe("Second control point [time, value].")}).optional().describe("Custom bezier curve control points (only for 'custom' action).")}),async execute({animation_id:Q,bone_name:W,channel:$,axis:Y,action:J,keyframe_range:X,custom_curve:G}){let H=Q?Animation.all.find((L)=>L.uuid===Q||L.name===Q):Animation.selected;if(!H)throw Error("No animation found or selected.");let B=f0(W),K=H.animators[B.uuid];if(!K||!K[$])throw Error(`No keyframes found for ${W}.${$}`);Undo.initEdit({animations:[H],keyframes:K[$]});let F=K[$].filter((L)=>{if(!X)return!0;return L.time>=X.start&&L.time<=X.end});return F.forEach((L,U)=>{switch(J){case"linear":L.interpolation="linear";break;case"stepped":L.interpolation="step";break;case"smooth":L.interpolation="catmullrom";break;case"ease_in":case"ease_out":case"ease_in_out":L.interpolation="bezier";let q=F[U+1];if(q){let A=q.time-L.time;if(L.bezier_left_time=0,L.bezier_right_time=A,J==="ease_in")L.bezier_right_time=A*0.6;else if(J==="ease_out")L.bezier_left_time=A*0.4;else L.bezier_left_time=A*0.3,L.bezier_right_time=A*0.7}break;case"custom":if(!G)throw Error("custom_curve is required for 'custom' action.");L.interpolation="bezier",L.bezier_left_time=G.control_point_1[0],L.bezier_left_value=[G.control_point_1[1],G.control_point_1[1],G.control_point_1[1]],L.bezier_right_time=G.control_point_2[0],L.bezier_right_value=[G.control_point_2[1],G.control_point_2[1],G.control_point_2[1]];break}}),Undo.finishEdit("Modify animation curves"),Animator.preview(),updateKeyframeSelection(),`Applied ${J} curve to ${F.length} keyframes in ${W}.${$}`}},g),R("bone_rigging",{description:"Creates and manipulates the bone structure (rig) of a model for animation.",annotations:{title:"Bone Rigging",destructiveHint:!0},parameters:V.object({action:V.enum(["create","parent","unparent","delete","rename","set_pivot","set_ik","mirror"]).describe("Action to perform on the bone structure."),bone_data:V.object({name:V.string().describe("Name of the bone."),parent:V.string().optional().describe("Parent bone name."),origin:V.array(V.number()).length(3).optional().describe("Pivot point of the bone."),rotation:V.array(V.number()).length(3).optional().describe("Initial rotation of the bone."),children:V.array(V.string()).optional().describe("Names of elements to add to this bone."),ik_enabled:V.boolean().optional().describe("Enable inverse kinematics for this bone."),ik_target:V.string().optional().describe("Target bone for IK chain."),mirror_axis:V.enum(["x","y","z"]).optional().describe("Axis to mirror the bone across.")}).describe("Bone configuration data.")}),async execute({action:Q,bone_data:W}){Undo.initEdit({outliner:!0,elements:[],groups:[]});let $="";switch(Q){case"create":{let Y=new Group({name:W.name,origin:W.origin||[0,0,0],rotation:W.rotation||[0,0,0]}).init();if(W.parent){let J=Group.all.find((X)=>X.name===W.parent);if(J)Y.addTo(J)}if(W.children)W.children.forEach((J)=>{let X=Outliner.elements.find((G)=>G.name===J);if(X)X.addTo(Y)});if(W.ik_enabled&&W.ik_target)Y.ik_enabled=!0,Y.ik_target=W.ik_target;$=`Created bone "${Y.name}" with UUID ${Y.uuid}`;break}case"parent":{let Y=f0(W.name),J=W.parent?Group.all.find((X)=>X.name===W.parent):"root";Y.addTo(J),$=`Parented "${W.name}" to "${W.parent||"root"}"`;break}case"unparent":{f0(W.name).addTo("root"),$=`Unparented "${W.name}"`;break}case"delete":{f0(W.name).remove(),$=`Deleted bone "${W.name}"`;break}case"rename":{let Y=f0(W.name),J=W.children?.[0]||"new_name";Y.name=J,$=`Renamed bone to "${J}"`;break}case"set_pivot":{let Y=f0(W.name);if(W.origin)Y.origin=W.origin;$=`Set pivot point for "${W.name}"`;break}case"set_ik":{let Y=f0(W.name);if(Y.ik_enabled=W.ik_enabled||!1,W.ik_target)Y.ik_target=W.ik_target;$=`Updated IK settings for "${W.name}"`;break}case"mirror":{let Y=f0(W.name),J=W.mirror_axis||"x",X=Y.duplicate(),G=J==="x"?0:J==="y"?1:2;X.origin[G]*=-1,X.name=Y.name.includes("left")?Y.name.replace("left","right"):Y.name.includes("right")?Y.name.replace("right","left"):Y.name+"_mirrored",$=`Mirrored bone "${W.name}" across ${J} axis`;break}}return Undo.finishEdit(`Bone rigging: ${Q}`),Canvas.updateAll(),$}},g),R("animation_timeline",{description:"Controls the animation timeline, including playback, time scrubbing, and timeline settings.",annotations:{title:"Animation Timeline",destructiveHint:!0},parameters:V.object({action:V.enum(["play","pause","stop","set_time","set_length","set_fps","loop","select_range"]).describe("Timeline action to perform."),time:V.number().optional().describe("Time in seconds (for set_time action)."),length:V.number().optional().describe("Animation length in seconds (for set_length action)."),fps:V.number().min(1).max(120).optional().describe("Frames per second (for set_fps action)."),loop_mode:V.enum(["once","loop","hold"]).optional().describe("Loop mode for the animation."),range:V.object({start:V.number(),end:V.number()}).optional().describe("Time range for selection.")}),async execute({action:Q,time:W,length:$,fps:Y,loop_mode:J,range:X}){if(!Animation.selected)throw Error("No animation selected.");let G="";switch(Q){case"play":Timeline.start(),G="Started animation playback";break;case"pause":Timeline.pause(),G="Paused animation playback";break;case"stop":Timeline.setTime(0),Timeline.pause(),G="Stopped animation playback";break;case"set_time":if(W===void 0)throw Error("Time parameter required for set_time action.");Timeline.setTime(W),G=`Set timeline to ${W} seconds`;break;case"set_length":if($===void 0)throw Error("Length parameter required for set_length action.");Animation.selected.length=$,G=`Set animation length to ${$} seconds`;break;case"set_fps":if(Y===void 0)throw Error("FPS parameter required for set_fps action.");Animation.selected.snapping=Y,G=`Set animation FPS to ${Y}`;break;case"loop":if(J)Animation.selected.loop=J;G=`Set loop mode to ${J||Animation.selected.loop}`;break;case"select_range":if(!X)throw Error("Range parameter required for select_range action.");Timeline.keyframes.forEach((H)=>{if(H.time>=X.start&&H.time<=X.end)H.select();else H.selected=!1}),G=`Selected keyframes between ${X.start} and ${X.end} seconds`;break}return Animator.preview(),G}},g),R("batch_keyframe_operations",{description:"Performs batch operations on multiple keyframes at once.",annotations:{title:"Batch Keyframe Operations",destructiveHint:!0},parameters:V.object({selection:V.enum(["all","selected","range","pattern"]).default("selected").describe("Which keyframes to operate on."),range:V.object({start:V.number(),end:V.number()}).optional().describe("Time range for keyframe selection."),pattern:V.object({interval:V.number().describe("Time interval between keyframes."),offset:V.number().optional().default(0).describe("Time offset for the pattern.")}).optional().describe("Pattern-based selection."),operation:V.enum(["offset","scale","reverse","mirror","smooth","bake"]).describe("Operation to perform on keyframes."),parameters:V.object({offset_time:V.number().optional().describe("Time offset to apply."),offset_values:V.array(V.number()).length(3).optional().describe("Value offset to apply."),scale_factor:V.number().optional().describe("Scale factor for time or values."),scale_pivot:V.number().optional().describe("Pivot point for scaling."),mirror_axis:V.enum(["x","y","z"]).optional().describe("Axis to mirror values across."),bake_interval:V.number().optional().describe("Interval for baking keyframes.")}).optional().describe("Operation-specific parameters.")}),async execute({selection:Q,range:W,pattern:$,operation:Y,parameters:J={}}){if(!Animation.selected)throw Error("No animation selected.");let X=[];switch(Q){case"all":X=Timeline.keyframes;break;case"selected":X=Timeline.selected;break;case"range":if(!W)throw Error("Range required for range selection.");X=Timeline.keyframes.filter((G)=>G.time>=W.start&&G.time<=W.end);break;case"pattern":if(!$)throw Error("Pattern required for pattern selection.");X=Timeline.keyframes.filter((G)=>{let H=G.time-$.offset;return Math.abs(H%$.interval)<0.001});break}if(X.length===0)throw Error("No keyframes found matching selection criteria.");switch(Undo.initEdit({keyframes:X}),Y){case"offset":X.forEach((A)=>{if(J.offset_time!==void 0)A.time+=J.offset_time;if(J.offset_values){let D=A.getArray();A.set("values",[D[0]+J.offset_values[0],D[1]+J.offset_values[1],D[2]+J.offset_values[2]])}});break;case"scale":let G=J.scale_pivot||0,H=J.scale_factor||1;X.forEach((A)=>{A.time=G+(A.time-G)*H});break;case"reverse":let B=X.map((A)=>A.time),K=Math.min(...B),F=Math.max(...B);X.forEach((A)=>{A.time=F-(A.time-K)});break;case"mirror":if(!J.mirror_axis)throw Error("Mirror axis required for mirror operation.");let L=J.mirror_axis==="x"?0:J.mirror_axis==="y"?1:2;X.forEach((A)=>{let D=A.getArray();D[L]*=-1,A.set("values",D)});break;case"smooth":X.forEach((A)=>{A.interpolation="catmullrom"});break;case"bake":let U=J.bake_interval||1/Animation.selected.snapping;new Set(X.map((A)=>A.animator)).forEach((A)=>{["rotation","position","scale"].forEach((O)=>{let w=A[O];if(!w||w.length<2)return;let j=Math.min(...w.map((C)=>C.time)),z=Math.max(...w.map((C)=>C.time));for(let C=j;C<=z;C+=U)if(!w.find((b)=>Math.abs(b.time-C)<0.001))Timeline.time=C,A.fillValues(A.createKeyframe({time:C,channel:O,values:A.interpolate(O,!0)},C,O,!1),null,!1)})});break}return Undo.finishEdit(`Batch keyframe operation: ${Y}`),Animator.preview(),`Performed ${Y} on ${X.length} keyframes`}},g),R("animation_copy_paste",{description:"Copies and pastes animation data between bones or animations.",annotations:{title:"Animation Copy/Paste",destructiveHint:!0},parameters:V.object({action:V.enum(["copy","paste","mirror_paste"]).describe("Copy or paste action."),source:V.object({animation:V.string().optional().describe("Source animation name or UUID."),bone:V.string().describe("Source bone name."),channels:V.array(V.enum(["rotation","position","scale"])).optional().default(["rotation","position","scale"]).describe("Channels to copy."),time_range:V.object({start:V.number(),end:V.number()}).optional().describe("Time range to copy. If not provided, copies all keyframes.")}).optional().describe("Source data for copy operation."),target:V.object({animation:V.string().optional().describe("Target animation name or UUID."),bone:V.string().describe("Target bone name."),time_offset:V.number().optional().default(0).describe("Time offset for pasted keyframes."),mirror_axis:V.enum(["x","y","z"]).optional().describe("Axis to mirror across for mirror_paste.")}).optional().describe("Target data for paste operation.")}),async execute({action:Q,source:W,target:$}){if(!global.animationClipboard)global.animationClipboard=null;switch(Q){case"copy":{if(!W)throw Error("Source data required for copy operation.");let Y=W.animation?Animation.all.find((H)=>H.uuid===W.animation||H.name===W.animation):Animation.selected;if(!Y)throw Error("Source animation not found.");let J=f0(W.bone),X=Y.animators[J.uuid];if(!X)throw Error(`No animation data for bone "${W.bone}".`);let G={bone_name:W.bone,channels:{}};return W.channels.forEach((H)=>{if(!X[H])return;let B=X[H];if(W.time_range)B=B.filter((K)=>K.time>=W.time_range.start&&K.time<=W.time_range.end);G.channels[H]=B.map((K)=>({time:K.time,values:K.getArray(),interpolation:K.interpolation,bezier_left_time:K.bezier_left_time,bezier_left_value:K.bezier_left_value,bezier_right_time:K.bezier_right_time,bezier_right_value:K.bezier_right_value}))}),global.animationClipboard=G,`Copied animation data from "${W.bone}" (${Object.keys(G.channels).join(", ")})`}case"paste":case"mirror_paste":{if(!$)throw Error("Target data required for paste operation.");if(!global.animationClipboard)throw Error("No animation data in clipboard. Copy first.");let Y=$.animation?Animation.all.find((K)=>K.uuid===$.animation||K.name===$.animation):Animation.selected;if(!Y)throw Error("Target animation not found.");let J=f0($.bone),X=Y.animators[J.uuid];if(!X)X=new BoneAnimator(J.uuid,Y,$.bone),Y.animators[J.uuid]=X;Undo.initEdit({animations:[Y],keyframes:[]});let G=global.animationClipboard,H=Q==="mirror_paste"?$.mirror_axis||"x":null,B=H==="x"?0:H==="y"?1:H==="z"?2:-1;return Object.entries(G.channels).forEach(([K,F])=>{F.forEach((L)=>{let U=[...L.values];if(H&&(K==="rotation"||K==="position"))U[B]*=-1;let q=X.createKeyframe({time:L.time+($.time_offset||0),channel:K,values:U,interpolation:L.interpolation},L.time+($.time_offset||0),K,!1);if(L.interpolation==="bezier"){if(L.bezier_left_time!==void 0)q.bezier_left_time=L.bezier_left_time;if(L.bezier_left_value)q.bezier_left_value=L.bezier_left_value;if(L.bezier_right_time!==void 0)q.bezier_right_time=L.bezier_right_time;if(L.bezier_right_value)q.bezier_right_value=L.bezier_right_value}})}),Undo.finishEdit(`${Q} animation data`),Animator.preview(),`Pasted animation data to "${$.bone}"${H?` (mirrored on ${H} axis)`:""}`}}}},g)}var N7=V.object({name:V.string(),origin:V.array(V.number()).length(3).describe("Pivot point of the cube.").optional().default([0,0,0]),from:V.array(V.number()).length(3).describe("Starting point of the cube.").optional().default([0,0,0]),to:V.array(V.number()).length(3).describe("Ending point of the cube.").optional().default([1,1,1]),rotation:V.array(V.number()).length(3).describe("Rotation of the cube.").optional().default([0,0,0])}),dB=V.object({name:V.string(),position:V.array(V.number()).length(3).describe("Position of the mesh.").optional().default([0,0,0]),rotation:V.array(V.number()).length(3).describe("Rotation of the mesh.").optional().default([0,0,0]),scale:V.array(V.number()).length(3).describe("Scale of the mesh.").optional().default([1,1,1]),vertices:V.array(V.array(V.number()).length(3).describe("Vertex coordinates in the mesh.")).describe("Vertices of the mesh.").optional().default([])});function iB(){R("place_cube",{description:"Places a cube of the given size at the specified position. Texture and group are optional.",annotations:{title:"Place Cube",destructiveHint:!0},parameters:V.object({elements:V.array(N7).min(1).describe("Array of cubes to place."),texture:V.string().optional().describe("Texture ID or name to apply to the cube."),group:V.string().optional().describe("Group/bone to which the cube belongs."),faces:V.union([V.array(V.enum(["north","south","east","west","up","down"])).describe("Array of faces to apply the texture to."),V.boolean().optional().describe("Whether to apply the texture to all faces. Set to `true` to enable auto UV mapping."),V.array(V.object({face:V.enum(["north","south","east","west","up","down"]).describe("Face to apply the texture to."),uv:V.array(V.number()).length(4).describe("Custom UV mapping for the face.")})).describe("Array of faces with custom UV mapping.")]).optional().default(!0).describe("Faces to apply the texture to. Set to `true` to enable auto UV mapping.")}),async execute({elements:Q,texture:W,faces:$,group:Y},{reportProgress:J}){Undo.initEdit({elements:[],outliner:!0,collections:[]});let X=Q.length,G=W?E0(W):Texture.getDefault();if(!G)throw Error(`No texture found for "${W}".`);let B=getAllGroups().find((L)=>L.name===Y||L.uuid===Y),K=$===!0||Array.isArray($)&&$.every((L)=>typeof L==="string"),F=Q.map((L,U)=>{let q=new Cube({autouv:K?1:0,name:L.name,from:L.from,to:L.to,origin:L.origin,rotation:L.rotation}).init();if(q.addTo(B),!K&&Array.isArray($))$.forEach(({face:A,uv:D})=>{q.faces[A].extend({uv:D})});else q.applyTexture(G,$!==!1?$:void 0),q.mapAutoUV();return J({progress:U,total:X}),q});return Undo.finishEdit("Agent placed cubes"),Canvas.updateAll(),await Promise.resolve(JSON.stringify(F.map((L)=>`Added cube ${L.name} with ID ${L.uuid}`)))}},K0),R("modify_cube",{description:"Modifies the cube with the given ID. Auto UV setting: saved as an integer, where 0 means disabled, 1 means enabled, and 2 means relative auto UV (cube position affects UV)",annotations:{title:"Modify Cube",destructiveHint:!0},parameters:V.object({id:V.string().optional().describe("ID or name of the cube to modify. Defaults to selected, which could be more than one."),...N7.shape,name:V.string().optional().describe("New name of the cube."),autouv:V.enum(["0","1","2"]).optional().describe("Auto UV setting. 0 = disabled, 1 = enabled, 2 = relative auto UV."),uv_offset:V.array(V.number()).length(2).optional().describe("UV offset for the texture."),mirror_uv:V.boolean().optional().describe("Whether to mirror the UVs."),shade:V.boolean().optional().describe("Whether to apply shading to the cube."),inflate:V.number().optional().describe("Inflation amount for the cube."),color:V.number().optional().describe("Single digit to represent a color from a palette."),visibility:V.boolean().optional().describe("Whether the cube is visible or not.")}),async execute({id:Q,name:W,origin:$,from:Y,to:J,rotation:X,uv_offset:G,autouv:H,mirror_uv:B,shade:K,inflate:F,color:L,visibility:U}){let q=Outliner.root.filter((A)=>A instanceof Cube&&(A.uuid===Q||A.name===Q))??Cube.selected;if(!q.length)throw Error(`Cube with ID "${Q}" not found.`);return Undo.initEdit({elements:Array.isArray(q)?q:[q],outliner:!0,collections:[]}),q.forEach((A)=>{let D=$??A.origin,O=Y??A.from,w=J??A.to,j=X??A.rotation,z=G??A.uv_offset;A.extend({name:W??A.name,origin:D,from:O,to:w,rotation:j,uv_offset:z,autouv:H?Number(H):A.autouv,mirror_uv:Boolean(B??A.mirror_uv),inflate:F??A.inflate,color:L??A.color,visibility:U??A.visibility,shade:K??A.shade})}),Undo.finishEdit("Agent modified cubes"),Canvas.updateAll(),`Modified cubes ${q.map((A)=>A.name).join(", ")} with IDs ${q.map((A)=>A.uuid).join(", ")}`}},K0)}function nB(){R("remove_element",{description:"Removes the element with the given ID.",annotations:{title:"Remove Element",destructiveHint:!0},parameters:V.object({id:V.string().describe("ID or name of the element to remove.")}),async execute({id:Q}){let W=E1(Q);return Undo.initEdit({elements:[],outliner:!0,collections:[]}),W.remove(),Undo.finishEdit("Agent removed element"),Canvas.updateAll(),`Removed element with ID ${Q}`}},g),R("add_group",{description:"Adds a new group with the given name and options.",annotations:{title:"Add Group",destructiveHint:!0},parameters:V.object({name:V.string(),origin:V.array(V.number()).length(3),rotation:V.array(V.number()).length(3),parent:V.string().optional().default("root"),visibility:V.boolean().optional().default(!0),autouv:V.enum(["0","1","2"]).optional().default("0").describe("Auto UV setting. 0 = disabled, 1 = enabled, 2 = relative auto UV."),selected:V.boolean().optional().default(!1),shade:V.boolean().optional().default(!1)}),async execute({name:Q,origin:W,rotation:$,parent:Y,visibility:J,autouv:X,selected:G,shade:H}){Undo.initEdit({elements:[],outliner:!0,collections:[]});let B=new Group({name:Q,origin:W,rotation:$,autouv:Number(X),visibility:Boolean(J),selected:Boolean(G),shade:Boolean(H)}).init();return B.addTo(getAllGroups().find((K)=>K.name===Y||K.uuid===Y)),Undo.finishEdit("Agent added group"),Canvas.updateAll(),`Added group ${B.name} with ID ${B.uuid}`}},K0),R("list_outline",{description:"Returns a list of all groups and their children in the Blockbench editor.",annotations:{title:"List Outline",readOnlyHint:!0},parameters:V.object({}),async execute(){let Q=Outliner.elements;return JSON.stringify(Q.map((W)=>{let{name:$,uuid:Y}=W;return{name:$,uuid:Y}}),null,2)}},K0),R("duplicate_element",{description:"Duplicates a cube, mesh or group by ID or name.  You may offset the duplicate or assign a new name.",annotations:{title:"Duplicate Element",destructiveHint:!0},parameters:V.object({id:V.string().describe("ID or name of the element to duplicate."),offset:V.array(V.number()).length(3).optional().default([0,0,0]),newName:V.string().optional()}),async execute({id:Q,offset:W,newName:$}){let Y=E1(Q);function J(K,F){let L=new Cube({name:$||`${K.name}_copy`,from:K.from.map((U,q)=>U+W[q]),to:K.to.map((U,q)=>U+W[q]),origin:K.origin.map((U,q)=>U+W[q]),rotation:K.rotation,autouv:K.autouv,uv_offset:K.uv_offset,mirror_uv:K.mirror_uv,shade:K.shade,inflate:K.inflate,color:K.color,visibility:K.visibility}).init();return L.addTo(F),L}function X(K,F){let L=new Group({name:$||`${K.name}_copy`,origin:K.origin.map((U,q)=>U+W[q]),rotation:K.rotation,autouv:K.autouv,selected:K.selected,shade:K.shade,visibility:K.visibility}).init();return L.addTo(F),K.children.forEach((U)=>H(U,L)),L}function G(K,F){let L=new Mesh({name:$||`${K.name}_copy`,vertices:{},origin:K.origin.map((q,A)=>q+W[A]),rotation:K.rotation}).init(),U={};if(Object.entries(K.vertices).forEach(([q,A])=>{U[q]=L.addVertices([A[0]+W[0],A[1]+W[1],A[2]+W[2]])[0]}),K.faces.forEach((q)=>{L.addFaces(new MeshFace(L,{vertices:q.vertices.map((A)=>U[A]),uv:q.uv}))}),L.addTo(F),K.material)L.applyTexture(K.material);return L}function H(K,F){if(K instanceof Cube)return J(K,F);if(K instanceof Group)return X(K,F);if(K instanceof Mesh)return G(K,F);throw Error("Unsupported element type.")}Undo.initEdit({elements:[],outliner:!0,collections:[]});let B=H(Y,Y.parent??Outliner);return Undo.finishEdit("Agent duplicated element"),Canvas.updateAll(),`Duplicated "${Y.name}" as "${B.name}" (ID: ${B.uuid}).`}},g),R("rename_element",{description:"Renames a cube, mesh or group by ID or name.",annotations:{title:"Rename Element",destructiveHint:!0},parameters:V.object({id:V.string().describe("ID or name of the element to rename."),new_name:V.string().describe("New name to assign.")}),async execute({id:Q,new_name:W}){let $=E1(Q);return Undo.initEdit({elements:[$],outliner:!0,collections:[]}),$.extend({name:W}),Undo.finishEdit("Agent renamed element"),Canvas.updateAll(),`Renamed element "${Q}" to "${W}".`}},g)}function oB(){R("from_geo_json",{description:"Imports a model from a GeoJSON file.",annotations:{title:"Import GeoJSON",destructiveHint:!0},parameters:V.object({geojson:V.string().describe("Path to the GeoJSON file or data URL, or the GeoJSON string itself.")}),async execute({geojson:Q}){if(!Q.startsWith("{")&&!Q.startsWith("["))Q=await fetch(Q).then((W)=>W.text());if(typeof Q!=="string")throw Error("Invalid GeoJSON input. Expected a string.");return Codecs.bedrock.parse(JSON.parse(Q),""),new Promise((W)=>{setTimeout(async()=>{W(await l6())},3000)})}},K0)}function rB(){R("place_mesh",{description:"Places a mesh at the specified position. Texture and group are optional.",annotations:{title:"Place Mesh",destructiveHint:!0},parameters:V.object({elements:V.array(dB).min(1).describe("Array of meshes to place."),texture:V.string().optional().describe("Texture ID or name to apply to the mesh."),group:V.string().optional().describe("Group/bone to which the mesh belongs.")}),async execute({elements:Q,texture:W,group:$},{reportProgress:Y}){Undo.initEdit({elements:[],outliner:!0,collections:[]});let J=Q.length,X=W?E0(W):Texture.getDefault();if(!X)throw Error(`No texture found for "${W}".`);let H=getAllGroups().find((K)=>K.name===$||K.uuid===$),B=Q.map((K,F)=>{let L=new Mesh({name:K.name,vertices:{}}).init();return K.vertices.forEach((U)=>{L.addVertices(U)}),L.addTo(H),L.applyTexture(X),Y({progress:F,total:J}),L});return Undo.finishEdit("Agent placed meshes"),Canvas.updateAll(),await Promise.resolve(JSON.stringify(B.map((K)=>`Added mesh ${K.name} with ID ${K.uuid}`)))}},g),R("extrude_mesh",{description:"Extrudes selected faces or edges of a mesh.",annotations:{title:"Extrude Mesh",destructiveHint:!0},parameters:V.object({mesh_id:V.string().optional().describe("ID or name of the mesh. If not provided, uses selected mesh."),distance:V.number().default(1).describe("Distance to extrude."),mode:V.enum(["faces","edges","vertices"]).default("faces").describe("What to extrude: faces, edges, or vertices.")}),async execute({mesh_id:Q,distance:W,mode:$}){let Y=i1(Q),J=$==="faces"?BarItems.extrude_mesh_selection:$==="edges"?BarItems.extrude_mesh_selection:BarItems.extrude_mesh_selection;if(!J)throw Error(`Extrude tool for ${$} not found.`);return J.click({},W),`Extruded ${$} of mesh "${Y.name}" by ${W} units`}},g),R("subdivide_mesh",{description:"Subdivides selected faces of a mesh to create more geometry.",annotations:{title:"Subdivide Mesh",destructiveHint:!0},parameters:V.object({mesh_id:V.string().optional().describe("ID or name of the mesh. If not provided, uses selected mesh."),cuts:V.number().min(1).max(10).default(1).describe("Number of subdivision cuts to make.")}),async execute({mesh_id:Q,cuts:W}){let $=i1(Q),Y=BarItems.loop_cut;if(!Y)throw Error("Loop cut tool not found.");return Y.click({},void 0,void 0,W),`Subdivided mesh "${$.name}" with ${W} cuts`}},g),R("create_sphere",{description:"Creates a sphere mesh at the specified position with the given parameters. The sphere is created as a mesh with vertices and faces using spherical coordinates.",annotations:{title:"Create Sphere",destructiveHint:!0},parameters:V.object({elements:V.array(V.object({name:V.string().describe("Name of the sphere."),position:V.array(V.number()).length(3).describe("Position of the sphere center."),diameter:V.number().min(1).max(64).default(16).describe("Diameter of the sphere."),sides:V.number().min(3).max(48).default(12).describe("Number of horizontal divisions (affects sphere quality)."),rotation:V.array(V.number()).length(3).optional().default([0,0,0]).describe("Rotation of the sphere."),align_edges:V.boolean().optional().default(!0).describe("Whether to align edges for better geometry.")})).min(1).describe("Array of spheres to create."),texture:V.string().optional().describe("Texture ID or name to apply to the sphere."),group:V.string().optional().describe("Group/bone to which the sphere belongs.")}),async execute({elements:Q,texture:W,group:$},{reportProgress:Y}){Undo.initEdit({elements:[],outliner:!0,collections:[]});let J=Q.length,X=W?E0(W):Texture.getDefault();if(!X)throw Error(`No texture found for "${W}".`);let H=getAllGroups().find((K)=>K.name===$||K.uuid===$),B=Q.map((K,F)=>{let L=new Mesh({name:K.name,vertices:{},origin:K.position,rotation:K.rotation||[0,0,0]}).init(),U=K.diameter/2,q=Math.round(K.sides/2)*2,[A]=L.addVertices([0,-U,0]),[D]=L.addVertices([0,U,0]),O=[],w=K.align_edges?0.5:0;for(let j=0;j<K.sides;j++){let z=Math.sin((j+w)/K.sides*Math.PI*2),C=Math.cos((j+w)/K.sides*Math.PI*2),b=[];for(let D0=1;D0<q/2;D0++){let S0=Math.sin(D0/q*Math.PI*2)*U,x1=z*S0,j0=Math.cos(D0/q*Math.PI*2)*U,R0=C*S0;b.push(...L.addVertices([x1,j0,R0]))}O.push(b)}for(let j=0;j<K.sides;j++){let z=O[j],C=O[j+1]||O[0];for(let b=0;b<q/2;b++){if(b==0){L.addFaces(new MeshFace(L,{vertices:[z[b],C[b],D],uv:{}}));continue}if(!z[b]){L.addFaces(new MeshFace(L,{vertices:[C[b-1],z[b-1],A],uv:{}}));continue}L.addFaces(new MeshFace(L,{vertices:[z[b],C[b],z[b-1],C[b-1]],uv:{}}))}}if(L.addTo(H),X)L.applyTexture(X);return Y({progress:F,total:J}),L});return Undo.finishEdit("Agent created spheres"),Canvas.updateAll(),await Promise.resolve(JSON.stringify(B.map((K)=>`Added sphere ${K.name} with ID ${K.uuid}`)))}},K0),R("select_mesh_elements",{description:"Selects vertices, edges, or faces of a mesh for manipulation.",annotations:{title:"Select Mesh Elements",destructiveHint:!0},parameters:V.object({mesh_id:V.string().describe("ID or name of the mesh to select elements from."),mode:V.enum(["vertex","edge","face"]).describe("Selection mode."),elements:V.array(V.union([V.string().describe("Vertex key, edge as 'vkey1-vkey2', or face key"),V.number().describe("Index of the element")])).optional().describe("Specific elements to select. If not provided, selects all."),action:V.enum(["select","add","remove","toggle"]).default("select").describe("Selection action: select (replace), add, remove, or toggle.")}),async execute({mesh_id:Q,mode:W,elements:$,action:Y}){let J=u6(Q);Undo.initEdit({elements:[J],selection:!0,collections:[]}),BarItems.selection_mode.set(W);let X=Project?.mesh_selection[J.uuid]??{vertices:[],edges:[],faces:[]};if(Y==="select")X.vertices=[],X.edges.length=0,X.faces=[];if(!$||$.length===0){if(W==="vertex")X.vertices=Object.keys(J.vertices);else if(W==="face")X.faces=Object.keys(J.faces);else if(W==="edge"){let G=[],H=new Set;for(let K in J.faces){let L=J.faces[K].getEdges();for(let[U,q]of L){let A=U<q?`${U}-${q}`:`${q}-${U}`;if(!H.has(A))H.add(A),G.push([U,q])}}let B=X.edges;B.length=0,B.push(...G)}}else $.forEach((G)=>{if(W==="vertex"){let H=String(G);if(Y==="add"||Y==="select"){if(!X.vertices.includes(H))X.vertices.push(H)}else if(Y==="remove")X.vertices=X.vertices.filter((B)=>B!==H);else if(Y==="toggle")if(X.vertices.includes(H))X.vertices=X.vertices.filter((B)=>B!==H);else X.vertices.push(H)}else if(W==="face"){let H=String(G);if(Y==="add"||Y==="select"){if(!X.faces.includes(H))X.faces.push(H)}else if(Y==="remove")X.faces=X.faces.filter((B)=>B!==H);else if(Y==="toggle")if(X.faces.includes(H))X.faces=X.faces.filter((B)=>B!==H);else X.faces.push(H)}else if(W==="edge"){let H=String(G).split("-");if(H.length===2){let B=[H[0],H[1]],K=X.edges;if(Y==="add"||Y==="select")K.push(B);else if(Y==="remove"){let F=K.filter((L)=>!(L[0]===B[0]&&L[1]===B[1])&&!(L[0]===B[1]&&L[1]===B[0]));K.length=0,K.push(...F)}else if(Y==="toggle")if(K.some((L)=>L[0]===B[0]&&L[1]===B[1]||L[0]===B[1]&&L[1]===B[0])){let L=K.filter((U)=>!(U[0]===B[0]&&U[1]===B[1])&&!(U[0]===B[1]&&U[1]===B[0]));K.length=0,K.push(...L)}else K.push(B)}}});return J.select(),Canvas.updateView({elements:[J],selection:!0}),Undo.finishEdit("Select mesh elements"),JSON.stringify({mesh:J.name,mode:W,selected:{vertices:X.vertices.length,edges:X.edges.length,faces:X.faces.length}})}},g),R("move_mesh_vertices",{description:"Moves selected vertices of a mesh by the specified offset.",annotations:{title:"Move Mesh Vertices",destructiveHint:!0},parameters:V.object({mesh_id:V.string().optional().describe("ID or name of the mesh. If not provided, uses selected mesh."),offset:V.array(V.number()).length(3).describe("Offset to move vertices by [x, y, z]."),vertices:V.array(V.string()).optional().describe("Specific vertex keys to move. If not provided, moves all selected vertices.")}),async execute({mesh_id:Q,offset:W,vertices:$}){let Y=i1(Q);Undo.initEdit({elements:[Y],element_aspects:{geometry:!0,uv:!0,faces:!0}});let J=$||Y.getSelectedVertices();return J.forEach((X)=>{if(Y.vertices[X])Y.vertices[X][0]+=W[0],Y.vertices[X][1]+=W[1],Y.vertices[X][2]+=W[2]}),Y.preview_controller.updateGeometry(Y),Undo.finishEdit("Move mesh vertices"),Canvas.updateView({elements:[Y],element_aspects:{geometry:!0,uv:!0,faces:!0}}),`Moved ${J.length} vertices of mesh "${Y.name}"`}},g),R("delete_mesh_elements",{description:"Deletes selected vertices, edges, or faces from a mesh.",annotations:{title:"Delete Mesh Elements",destructiveHint:!0},parameters:V.object({mesh_id:V.string().optional().describe("ID or name of the mesh. If not provided, uses selected mesh."),mode:V.enum(["vertices","edges","faces"]).default("faces").describe("What to delete: vertices, edges, or faces."),keep_vertices:V.boolean().default(!1).describe("When deleting faces/edges, whether to keep the vertices.")}),async execute({mesh_id:Q,mode:W,keep_vertices:$}){let Y=i1(Q),J=BarItems.delete_mesh_selection;if(!J)throw Error("Delete mesh selection tool not found.");return J.click({},$),`Deleted selected ${W} from mesh "${Y.name}"`}},g),R("merge_mesh_vertices",{description:"Merges vertices that are within a specified distance of each other.",annotations:{title:"Merge Mesh Vertices",destructiveHint:!0},parameters:V.object({mesh_id:V.string().describe("ID or name of the mesh."),threshold:V.number().min(0).max(10).default(0.1).describe("Maximum distance between vertices to merge."),selected_only:V.boolean().default(!0).describe("Whether to only merge selected vertices.")}),async execute({mesh_id:Q,threshold:W,selected_only:$}){let Y=u6(Q);Undo.initEdit({elements:[Y],element_aspects:{geometry:!0,uv:!0,faces:!0}});let J=$?Y.getSelectedVertices():Object.keys(Y.vertices),X=0,G={};for(let H=0;H<J.length;H++){let B=J[H];if(G[B])continue;for(let K=H+1;K<J.length;K++){let F=J[K];if(G[F])continue;let L=Y.vertices[B],U=Y.vertices[F];if(Math.sqrt((L[0]-U[0])**2+(L[1]-U[1])**2+(L[2]-U[2])**2)<=W)G[F]=B,X++}}return Object.entries(G).forEach(([H,B])=>{for(let K in Y.faces){let F=Y.faces[K],L=F.vertices.indexOf(H);if(L!==-1)F.vertices[L]=B,F.uv[B]=F.uv[H]||[0,0],delete F.uv[H]}delete Y.vertices[H]}),Y.preview_controller.updateGeometry(Y),Undo.finishEdit("Merge mesh vertices"),Canvas.updateView({elements:[Y],element_aspects:{geometry:!0,uv:!0,faces:!0}}),`Merged ${X} vertices in mesh "${Y.name}"`}},g),R("create_mesh_face",{description:"Creates a new face from selected vertices.",annotations:{title:"Create Mesh Face",destructiveHint:!0},parameters:V.object({mesh_id:V.string().optional().describe("ID or name of the mesh. If not provided, uses selected mesh."),vertices:V.array(V.string()).min(3).max(4).describe("Vertex keys to create face from. Must be 3 or 4 vertices."),texture:V.string().optional().describe("Texture ID or name to apply to the new face.")}),async execute({mesh_id:Q,vertices:W,texture:$}){let Y=i1(Q);Undo.initEdit({elements:[Y],element_aspects:{geometry:!0,uv:!0,faces:!0}});let J=new MeshFace(Y,{vertices:W,texture:$?E0($)?.uuid:void 0}),[X]=Y.addFaces(J);return UVEditor.setAutoSize(null,!0,[X]),Y.preview_controller.updateGeometry(Y),Y.preview_controller.updateUV(Y),Undo.finishEdit("Create mesh face"),Canvas.updateView({elements:[Y],element_aspects:{geometry:!0,uv:!0,faces:!0}}),`Created face with ${W.length} vertices in mesh "${Y.name}"`}},g),R("create_cylinder",{description:"Creates one or more cylinder meshes with optional end caps.",annotations:{title:"Create Cylinder",destructiveHint:!0},parameters:V.object({elements:V.array(V.object({name:V.string(),position:V.array(V.number()).length(3),height:V.number().min(1).max(64).default(16),diameter:V.number().min(1).max(64).default(16),sides:V.number().min(3).max(64).default(12),rotation:V.array(V.number()).length(3).optional().default([0,0,0]),capped:V.boolean().optional().default(!0)})).min(1),texture:V.string().optional(),group:V.string().optional()}),async execute({elements:Q,texture:W,group:$},{reportProgress:Y}){Undo.initEdit({elements:[],outliner:!0,collections:[]});let J=Q.length,X=W?E0(W):Texture.getDefault();if(!X)throw Error(`Texture "${W}" not found.`);let G=getAllGroups().find((B)=>B.name===$||B.uuid===$),H=Q.map((B,K)=>{let F=new Mesh({name:B.name,vertices:{},origin:B.position,rotation:B.rotation||[0,0,0]}).init(),L=B.diameter/2,U=B.height,q=Math.round(B.sides),A=F.addVertices([0,U/2,0])[0],D=F.addVertices([0,-U/2,0])[0],O=[],w=[];for(let j=0;j<q;j++){let z=j/q*Math.PI*2,C=Math.cos(z)*L,b=Math.sin(z)*L;O.push(F.addVertices([C,U/2,b])[0]),w.push(F.addVertices([C,-U/2,b])[0])}for(let j=0;j<q;j++){let z=(j+1)%q;if(F.addFaces(new MeshFace(F,{vertices:[w[j],w[z],O[z],O[j]],uv:{}})),B.capped)F.addFaces(new MeshFace(F,{vertices:[O[j],O[z],A],uv:{}})),F.addFaces(new MeshFace(F,{vertices:[w[z],w[j],D],uv:{}}))}if(F.addTo(G),X)F.applyTexture(X);return Y({progress:K,total:J}),F});return Undo.finishEdit("Agent created cylinders"),Canvas.updateAll(),JSON.stringify(H.map((B)=>`Added cylinder ${B.name} (ID ${B.uuid})`))}},g),R("knife_tool",{description:"Uses the knife tool to cut custom edges into mesh faces.",annotations:{title:"Knife Tool",destructiveHint:!0},parameters:V.object({mesh_id:V.string().describe("ID or name of the mesh to cut."),points:V.array(V.object({position:V.array(V.number()).length(3).describe("3D position of the cut point."),face:V.string().optional().describe("Face key to attach the point to.")})).min(2).describe("Points defining the cut path.")}),async execute({mesh_id:Q,points:W}){let $=u6(Q);Undo.initEdit({elements:[$],element_aspects:{geometry:!0,uv:!0,faces:!0}});let Y=new KnifeToolContext($);return W.forEach((J)=>{Y.points.push({position:new THREE.Vector3(...J.position),fkey:J.face,type:J.face?"face":"edge"})}),Y.apply(),Undo.finishEdit("Knife cut mesh"),Canvas.updateView({elements:[$],element_aspects:{geometry:!0,uv:!0,faces:!0}}),`Applied knife cut to mesh "${$.name}" with ${W.length} points`}},g)}function aB(){R("paint_fill_tool",{description:"Uses the fill/bucket tool to fill areas with color.",annotations:{title:"Paint Fill Tool",destructiveHint:!0},parameters:V.object({texture_id:V.string().optional().describe("Texture ID or name. If not provided, uses selected texture."),x:V.number().describe("X coordinate to start fill."),y:V.number().describe("Y coordinate to start fill."),color:V.string().optional().describe("Fill color as hex string."),opacity:V.number().min(0).max(255).optional().describe("Fill opacity (0-255)."),tolerance:V.number().min(0).max(100).optional().describe("Color tolerance for fill."),fill_mode:V.enum(["color","color_connected","face","element","selected_elements","selection"]).optional().default("color_connected").describe("Fill mode."),blend_mode:V.enum(["default","set_opacity","color","behind","multiply","add","screen","overlay","difference"]).optional().describe("Fill blend mode.")}),async execute({texture_id:Q,x:W,y:$,color:Y,opacity:J,tolerance:X,fill_mode:G,blend_mode:H}){let B=Q?E0(Q):Texture.getDefault();if(!B)throw Error(Q?`Texture with ID "${Q}" not found.`:"No texture available.");if(Undo.initEdit({textures:[B],bitmap:!0}),Y)ColorPanel.set(Y);if(J!==void 0)BarItems.slider_brush_opacity.set(J);if(G)BarItems.fill_mode.set(G);if(H)BarItems.blend_mode.set(H);return BarItems.fill_tool.select(),Painter.startPaintTool(B,W,$,{}),Painter.stopPaintTool(),Undo.finishEdit("Fill tool"),Canvas.updateAll(),`Filled area at (${W}, ${$}) on texture "${B.name}"`}},g),R("draw_shape_tool",{description:"Draws geometric shapes on textures.",annotations:{title:"Draw Shape Tool",destructiveHint:!0},parameters:V.object({texture_id:V.string().optional().describe("Texture ID or name. If not provided, uses selected texture."),shape:V.enum(["rectangle","rectangle_h","ellipse","ellipse_h"]).describe("Shape to draw. '_h' suffix means hollow."),start:V.object({x:V.number().describe("Start X coordinate."),y:V.number().describe("Start Y coordinate.")}),end:V.object({x:V.number().describe("End X coordinate."),y:V.number().describe("End Y coordinate.")}),color:V.string().optional().describe("Shape color as hex string."),line_width:V.number().min(1).max(50).optional().describe("Line width for hollow shapes."),opacity:V.number().min(0).max(255).optional().describe("Shape opacity (0-255)."),blend_mode:V.enum(["default","set_opacity","color","behind","multiply","add","screen","overlay","difference"]).optional().describe("Shape blend mode.")}),async execute({texture_id:Q,shape:W,start:$,end:Y,color:J,line_width:X,opacity:G,blend_mode:H}){let B=Q?E0(Q):Texture.getDefault();if(!B)throw Error(Q?`Texture with ID "${Q}" not found.`:"No texture available.");if(Undo.initEdit({textures:[B],bitmap:!0}),J)ColorPanel.set(J);if(G!==void 0)BarItems.slider_brush_opacity.set(G);if(X!==void 0)BarItems.slider_brush_size.set(X);if(H)BarItems.blend_mode.set(H);return BarItems.draw_shape_type.set(W),BarItems.draw_shape_tool.select(),Painter.startPaintTool(B,$.x,$.y,{}),Painter.useShapeTool(B,Y.x,Y.y,{}),Painter.stopPaintTool(),Undo.finishEdit("Draw shape"),Canvas.updateAll(),`Drew ${W} from (${$.x}, ${$.y}) to (${Y.x}, ${Y.y}) on texture "${B.name}"`}},g),R("gradient_tool",{description:"Applies gradients to textures.",annotations:{title:"Gradient Tool",destructiveHint:!0},parameters:V.object({texture_id:V.string().optional().describe("Texture ID or name. If not provided, uses selected texture."),start:V.object({x:V.number().describe("Gradient start X coordinate."),y:V.number().describe("Gradient start Y coordinate.")}),end:V.object({x:V.number().describe("Gradient end X coordinate."),y:V.number().describe("Gradient end Y coordinate.")}),start_color:V.string().describe("Start color as hex string."),end_color:V.string().describe("End color as hex string."),opacity:V.number().min(0).max(255).optional().describe("Gradient opacity (0-255)."),blend_mode:V.enum(["default","set_opacity","color","behind","multiply","add","screen","overlay","difference"]).optional().describe("Gradient blend mode.")}),async execute({texture_id:Q,start:W,end:$,start_color:Y,end_color:J,opacity:X,blend_mode:G}){let H=Q?E0(Q):Texture.getDefault();if(!H)throw Error(Q?`Texture with ID "${Q}" not found.`:"No texture available.");if(Undo.initEdit({textures:[H],bitmap:!0}),ColorPanel.set(Y),ColorPanel.set(J,!0),X!==void 0)BarItems.slider_brush_opacity.set(X);if(G)BarItems.blend_mode.set(G);return BarItems.gradient_tool.select(),Painter.startPaintTool(H,W.x,W.y,{}),Painter.useGradientTool(H,$.x,$.y,{}),Painter.stopPaintTool(),Undo.finishEdit("Apply gradient"),Canvas.updateAll(),`Applied gradient from (${W.x}, ${W.y}) to (${$.x}, ${$.y}) on texture "${H.name}"`}},g),R("color_picker_tool",{description:"Picks colors from textures and sets them as the active color.",annotations:{title:"Color Picker Tool",readOnlyHint:!0},parameters:V.object({texture_id:V.string().optional().describe("Texture ID or name. If not provided, uses selected texture."),x:V.number().describe("X coordinate to pick color from."),y:V.number().describe("Y coordinate to pick color from."),set_as_secondary:V.boolean().optional().default(!1).describe("Set as secondary color instead of primary."),pick_opacity:V.boolean().optional().default(!1).describe("Also pick and apply the pixel's opacity.")}),async execute({texture_id:Q,x:W,y:$,set_as_secondary:Y,pick_opacity:J}){let X=Q?E0(Q):Texture.getDefault();if(!X)throw Error(Q?`Texture with ID "${Q}" not found.`:"No texture available.");Painter.colorPicker(X,W,$,{button:Y?2:0});let G=ColorPanel.get();if(J){let H=Painter.getPixelColor(X.ctx,W,$),B=Math.floor(H.getAlpha()*255);for(let K in BarItems){let F=BarItems[K];if(F.tool_settings&&F.tool_settings.brush_opacity>=0)F.tool_settings.brush_opacity=B}return`Picked color ${G} with opacity ${B} from (${W}, ${$}) on texture "${X.name}"`}return`Picked color ${G} from (${W}, ${$}) on texture "${X.name}"`}},g),R("copy_brush_tool",{description:"Uses the copy/clone brush to copy texture areas.",annotations:{title:"Copy Brush Tool",destructiveHint:!0},parameters:V.object({texture_id:V.string().optional().describe("Texture ID or name. If not provided, uses selected texture."),source:V.object({x:V.number().describe("Source X coordinate to copy from."),y:V.number().describe("Source Y coordinate to copy from.")}),target:V.object({x:V.number().describe("Target X coordinate to paste to."),y:V.number().describe("Target Y coordinate to paste to.")}),brush_size:V.number().min(1).max(100).optional().describe("Copy brush size."),opacity:V.number().min(0).max(255).optional().describe("Copy opacity (0-255)."),mode:V.enum(["copy","sample","pattern"]).optional().default("copy").describe("Copy brush mode.")}),async execute({texture_id:Q,source:W,target:$,brush_size:Y,opacity:J,mode:X}){let G=Q?E0(Q):Texture.getDefault();if(!G)throw Error(Q?`Texture with ID "${Q}" not found.`:"No texture available.");if(Undo.initEdit({textures:[G],bitmap:!0}),Y!==void 0)BarItems.slider_brush_size.set(Y);if(J!==void 0)BarItems.slider_brush_opacity.set(J);if(X)BarItems.copy_brush_mode.set(X);return BarItems.copy_brush.select(),Painter.startPaintTool(G,W.x,W.y,{},{ctrlOrCmd:!0}),Painter.startPaintTool(G,$.x,$.y,{}),Painter.stopPaintTool(),Undo.finishEdit("Copy brush"),Canvas.updateAll(),`Copied from (${W.x}, ${W.y}) to (${$.x}, ${$.y}) on texture "${G.name}"`}},g),R("eraser_tool",{description:"Erases parts of textures with customizable settings.",annotations:{title:"Eraser Tool",destructiveHint:!0},parameters:V.object({texture_id:V.string().optional().describe("Texture ID or name. If not provided, uses selected texture."),coordinates:V.array(V.object({x:V.number().describe("X coordinate to erase at."),y:V.number().describe("Y coordinate to erase at.")})).describe("Array of coordinates to erase at."),brush_size:V.number().min(1).max(100).optional().describe("Eraser brush size."),opacity:V.number().min(0).max(255).optional().describe("Eraser opacity (0-255)."),softness:V.number().min(0).max(100).optional().describe("Eraser softness percentage."),shape:V.enum(["square","circle"]).optional().describe("Eraser shape."),connect_strokes:V.boolean().optional().default(!0).describe("Whether to connect erase strokes with lines.")}),async execute({texture_id:Q,coordinates:W,brush_size:$,opacity:Y,softness:J,shape:X,connect_strokes:G}){let H=Q?E0(Q):Texture.getDefault();if(!H)throw Error(Q?`Texture with ID "${Q}" not found.`:"No texture available.");if(Undo.initEdit({textures:[H],bitmap:!0}),$!==void 0)BarItems.slider_brush_size.set($);if(Y!==void 0)BarItems.slider_brush_opacity.set(Y);if(J!==void 0)BarItems.slider_brush_softness.set(J);if(X!==void 0)BarItems.brush_shape.set(X);BarItems.eraser.select();for(let B=0;B<W.length;B++){let K=W[B];if(B===0||!G)Painter.startPaintTool(H,K.x,K.y,{});else Painter.movePaintTool(H,K.x,K.y,{})}return Painter.stopPaintTool(),Undo.finishEdit("Erase texture"),Canvas.updateAll(),`Erased ${W.length} points on texture "${H.name}"`}},g),R("paint_settings",{description:"Configures paint mode settings and preferences.",annotations:{title:"Paint Settings",destructiveHint:!0},parameters:V.object({mirror_painting:V.object({enabled:V.boolean().describe("Enable mirror painting."),axis:V.array(V.enum(["x","y","z"])).optional().describe("Mirror axes."),texture:V.boolean().optional().describe("Enable texture mirroring."),texture_center:V.object({x:V.number().describe("X coordinate of texture mirror center."),y:V.number().describe("Y coordinate of texture mirror center.")}).optional().describe("Texture mirror center.")}).optional().describe("Mirror painting settings."),lock_alpha:V.boolean().optional().describe("Lock alpha channel while painting."),pixel_perfect:V.boolean().optional().describe("Enable pixel perfect drawing."),paint_side_restrict:V.boolean().optional().describe("Restrict painting to current face side."),color_erase_mode:V.boolean().optional().describe("Enable color erase mode."),brush_opacity_modifier:V.enum(["none","pressure","tilt"]).optional().describe("Brush opacity modifier for stylus."),brush_size_modifier:V.enum(["none","pressure","tilt"]).optional().describe("Brush size modifier for stylus."),paint_with_stylus_only:V.boolean().optional().describe("Only allow painting with stylus input."),pick_color_opacity:V.boolean().optional().describe("Pick opacity when using color picker."),pick_combined_color:V.boolean().optional().describe("Pick combined layer colors.")}),async execute({mirror_painting:Q,lock_alpha:W,pixel_perfect:$,paint_side_restrict:Y,color_erase_mode:J,brush_opacity_modifier:X,brush_size_modifier:G,paint_with_stylus_only:H,pick_color_opacity:B,pick_combined_color:K}){let F=[];if(Q!==void 0){if(BarItems.mirror_painting.set(Q.enabled),Painter.mirror_painting=Q.enabled,F.push(`Mirror painting: ${Q.enabled}`),Q.enabled&&(Q.axis||Q.texture||Q.texture_center)){let L=Painter.mirror_painting_options;if(Q.axis)Q.axis.forEach((U)=>{L[U]=!0});if(Q.texture!==void 0)L.texture=Q.texture;if(Q.texture_center)L.texture_center=[Q.texture_center.x,Q.texture_center.y];F.push("Mirror options updated")}}if(W!==void 0)Painter.lock_alpha=W,F.push(`Lock alpha: ${W}`);if($!==void 0)BarItems.pixel_perfect_drawing.set($),F.push(`Pixel perfect: ${$}`);if(J!==void 0)BarItems.color_erase_mode.set(J),Painter.erase_mode=J,F.push(`Color erase mode: ${J}`);if(Y!==void 0)F.paint_side_restrict.value=Y,F.push(`Paint side restrict: ${Y}`);if(X!==void 0)F.brush_opacity_modifier.value=X,F.push(`Brush opacity modifier: ${X}`);if(G!==void 0)F.brush_size_modifier.value=G,F.push(`Brush size modifier: ${G}`);if(H!==void 0)F.paint_with_stylus_only.value=H,F.push(`Paint with stylus only: ${H}`);if(B!==void 0)F.pick_color_opacity.value=B,F.push(`Pick color opacity: ${B}`);if(K!==void 0)F.pick_combined_color.value=K,F.push(`Pick combined color: ${K}`);return`Updated paint settings: ${F.join(", ")}`}},g),R("paint_with_brush",{description:"Paints on textures using the brush tool with customizable settings.",annotations:{title:"Paint with Brush",destructiveHint:!0},parameters:V.object({texture_id:V.string().optional().describe("Texture ID or name. If not provided, uses selected texture."),coordinates:V.array(V.object({x:V.number().describe("X coordinate on texture."),y:V.number().describe("Y coordinate on texture.")})).describe("Array of coordinates to paint at."),brush_settings:V.object({size:V.number().min(1).max(100).optional().describe("Brush size."),opacity:V.number().min(0).max(255).optional().describe("Brush opacity (0-255)."),softness:V.number().min(0).max(100).optional().describe("Brush softness percentage."),shape:V.enum(["square","circle"]).optional().describe("Brush shape."),color:V.string().optional().describe("Brush color as hex string."),blend_mode:V.enum(["default","set_opacity","color","behind","multiply","add","screen","overlay","difference"]).optional().describe("Brush blend mode.")}).optional().describe("Brush settings to apply."),connect_strokes:V.boolean().optional().default(!0).describe("Whether to connect paint strokes with lines.")}),async execute({texture_id:Q,coordinates:W,brush_settings:$,connect_strokes:Y}){let J=Q?E0(Q):Texture.getDefault();if(!J)throw Error(Q?`Texture with ID "${Q}" not found.`:"No texture available.");Undo.initEdit({textures:[J],selected_texture:!0,bitmap:!0});let X=$?.color??"#000000",G=parseInt(X.slice(1,3),16),H=parseInt(X.slice(3,5),16),B=parseInt(X.slice(5,7),16),K=$?.opacity??255,F=$?.size??1,L=$?.softness??0,U=$?.shape??"square";return BarItems.slider_brush_size.value=F,BarItems.slider_brush_opacity.value=K,BarItems.slider_brush_softness.value=L,BarItems.brush_shape.value=U,ColorPanel.set(X),J.edit((q)=>{let A=q.getContext("2d");for(let D of W)if(U==="circle")Painter.editCircle(A,D.x,D.y,F,L,()=>({r:G,g:H,b:B,a:K}));else Painter.editSquare(A,D.x,D.y,F,L,()=>({r:G,g:H,b:B,a:K}))},{edit_name:"Paint with brush"}),Undo.finishEdit("Paint with brush"),Canvas.updateAll(),`Painted ${W.length} points on texture "${J.name}"`}},g),R("create_brush_preset",{description:"Creates a custom brush preset with specified settings.",annotations:{title:"Create Brush Preset",destructiveHint:!0},parameters:V.object({name:V.string().describe("Name of the brush preset."),size:V.number().min(1).max(100).optional().describe("Brush size."),opacity:V.number().min(0).max(255).optional().describe("Brush opacity (0-255)."),softness:V.number().min(0).max(100).optional().describe("Brush softness percentage."),shape:V.enum(["square","circle"]).optional().describe("Brush shape."),color:V.string().optional().describe("Brush color as hex string."),blend_mode:V.enum(["default","set_opacity","color","behind","multiply","add","screen","overlay","difference"]).optional().describe("Brush blend mode."),pixel_perfect:V.boolean().optional().describe("Enable pixel perfect drawing.")}),async execute({name:Q,size:W,opacity:$,softness:Y,shape:J,color:X,blend_mode:G,pixel_perfect:H}){let B={name:Q,size:W||null,opacity:$||null,softness:Y||null,shape:J||"square",color:X||null,blend_mode:G||"default",pixel_perfect:H||!1};return StateMemory.brush_presets.push(B),StateMemory.save("brush_presets"),`Created brush preset "${Q}" with settings: ${JSON.stringify(B)}`}},g),R("load_brush_preset",{description:"Loads and applies a brush preset by name.",annotations:{title:"Load Brush Preset",destructiveHint:!0},parameters:V.object({preset_name:V.string().describe("Name of the brush preset to load.")}),async execute({preset_name:Q}){let W=StateMemory.brush_presets.find(($)=>$.name===Q);if(!W)throw Error(`Brush preset "${Q}" not found.`);return Painter.loadBrushPreset(W),`Loaded brush preset "${Q}"`}},g),R("texture_selection",{description:"Creates, modifies, or manipulates texture selections for painting.",annotations:{title:"Texture Selection",destructiveHint:!0},parameters:V.object({action:V.enum(["select_rectangle","select_ellipse","select_all","clear_selection","invert_selection","expand_selection","contract_selection","feather_selection"]).describe("Selection action to perform."),texture_id:V.string().optional().describe("Texture ID or name. If not provided, uses selected texture."),coordinates:V.object({x1:V.number().describe("Start X coordinate."),y1:V.number().describe("Start Y coordinate."),x2:V.number().describe("End X coordinate."),y2:V.number().describe("End Y coordinate.")}).optional().describe("Selection area coordinates."),radius:V.number().optional().describe("Radius for expand/contract/feather operations."),mode:V.enum(["create","add","subtract","intersect"]).optional().default("create").describe("Selection mode.")}),async execute({action:Q,texture_id:W,coordinates:$,radius:Y,mode:J}){let X=W?E0(W):Texture.getDefault();if(!X)throw Error(W?`Texture with ID "${W}" not found.`:"No texture available.");Undo.initEdit({textures:[X],bitmap:!0});let G=X.selection;switch(Q){case"select_rectangle":if(!$)throw Error("Coordinates required for rectangle selection.");G.clear(),G.start_x=$.x1,G.start_y=$.y1,G.end_x=$.x2,G.end_y=$.y2,G.is_custom=!1;break;case"select_ellipse":if(!$)throw Error("Coordinates required for ellipse selection.");G.clear(),G.is_custom=!0;let H=($.x1+$.x2)/2,B=($.y1+$.y2)/2,K=Math.abs($.x2-$.x1)/2,F=Math.abs($.y2-$.y1)/2;for(let L=Math.floor(H-K);L<=Math.ceil(H+K);L++)for(let U=Math.floor(B-F);U<=Math.ceil(B+F);U++){let q=(L-H)/K,A=(U-B)/F;if(q*q+A*A<=1)G.set(L,U,!0)}break;case"select_all":G.selectAll();break;case"clear_selection":G.clear();break;case"invert_selection":G.invert();break;case"expand_selection":if(Y===void 0)throw Error("Radius required for expand selection.");G.expand(Y);break;case"contract_selection":if(Y===void 0)throw Error("Radius required for contract selection.");G.contract(Y);break;case"feather_selection":if(Y===void 0)throw Error("Radius required for feather selection.");G.feather(Y);break}return UVEditor.vue.updateTexture(),Undo.finishEdit("Texture selection"),`Applied ${Q} to texture "${X.name}"`}},g),R("texture_layer_management",{description:"Creates, manages, and manipulates texture layers.",annotations:{title:"Texture Layer Management",destructiveHint:!0},parameters:V.object({action:V.enum(["create_layer","delete_layer","duplicate_layer","merge_down","set_opacity","set_blend_mode","move_layer","rename_layer","flatten_layers"]).describe("Layer management action."),texture_id:V.string().optional().describe("Texture ID or name. If not provided, uses selected texture."),layer_name:V.string().optional().describe("Name of the layer."),opacity:V.number().min(0).max(100).optional().describe("Layer opacity percentage."),blend_mode:V.enum(["normal","multiply","screen","overlay","soft_light","hard_light","color_dodge","color_burn","darken","lighten","difference","exclusion"]).optional().describe("Layer blend mode."),target_index:V.number().optional().describe("Target position for moving layers.")}),async execute({action:Q,texture_id:W,layer_name:$,opacity:Y,blend_mode:J,target_index:X}){let G=W?E0(W):Texture.selected;if(!G)throw Error(W?`Texture with ID "${W}" not found.`:"No texture selected.");Undo.initEdit({textures:[G],layers:G.layers,bitmap:!0});let H="";switch(Q){case"create_layer":if(!G.layers_enabled)G.activateLayers(!0);let B=new TextureLayer({name:$||`Layer ${G.layers.length+1}`},G);B.setSize(G.width,G.height),B.addForEditing(),H=`Created layer "${B.name}"`;break;case"delete_layer":if(!TextureLayer.selected)throw Error("No layer selected.");let K=TextureLayer.selected;K.remove(),H=`Deleted layer "${K.name}"`;break;case"duplicate_layer":if(!TextureLayer.selected)throw Error("No layer selected.");let F=TextureLayer.selected,L=F.duplicate();L.name=`${F.name} copy`,H=`Duplicated layer "${L.name}"`;break;case"merge_down":if(!TextureLayer.selected)throw Error("No layer selected.");TextureLayer.selected.mergeDown(!0),H="Merged layer down";break;case"set_opacity":if(!TextureLayer.selected)throw Error("No layer selected.");if(Y===void 0)throw Error("Opacity value required.");TextureLayer.selected.opacity=Y/100,G.updateChangesAfterEdit(),H=`Set layer opacity to ${Y}%`;break;case"set_blend_mode":if(!TextureLayer.selected)throw Error("No layer selected.");if(!J)throw Error("Blend mode required.");TextureLayer.selected.blend_mode=J,G.updateChangesAfterEdit(),H=`Set layer blend mode to ${J}`;break;case"move_layer":if(!TextureLayer.selected)throw Error("No layer selected.");if(X===void 0)throw Error("Target index required.");let U=TextureLayer.selected;G.layers.remove(U),G.layers.splice(X,0,U),H=`Moved layer to position ${X}`;break;case"rename_layer":if(!TextureLayer.selected)throw Error("No layer selected.");if(!$)throw Error("New layer name required.");let q=TextureLayer.selected.name;TextureLayer.selected.name=$,H=`Renamed layer from "${q}" to "${$}"`;break;case"flatten_layers":if(!G.layers_enabled)throw Error("Texture has no layers to flatten.");G.flattenLayers(),H="Flattened all layers";break}return G.updateChangesAfterEdit(),Undo.finishEdit(`Layer management: ${Q}`),updateInterfacePanels(),H}},g)}function tB(){R("create_project",{description:"Creates a new project with the given name and project type.",annotations:{title:"Create Project",destructiveHint:!0,openWorldHint:!0},parameters:V.object({name:V.string(),format:V.enum(Object.keys(Formats)).default("bedrock_block")}),async execute({name:Q,format:W}){if(!newProject(Formats[W]))throw Error("Failed to create project.");return Project.name=Q,`Created project with name "${Q}" (UUID: ${Project?.uuid}) and format "${W}".`}},K0)}function sB(){R("create_texture",{description:"Creates a new texture with the given name and size.",annotations:{title:"Create Texture",destructiveHint:!0,openWorldHint:!0},parameters:V.object({name:V.string(),width:V.number().min(16).max(4096).default(16),height:V.number().min(16).max(4096).default(16),data:V.string().optional().describe("Path to the image file or data URL."),group:V.string().optional(),fill_color:V.union([V.array(V.number().min(0).max(255)).length(4).describe("RGBA color array [R, G, B, A]"),V.string().regex(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{8})$/,"HEX color string (e.g. #RRGGBB or #RRGGBBAA)"),V.string().regex(/^[a-z]{3,20}$/,"Color name (e.g. 'red', 'blue', 'green')")]).optional().describe("RGBA color to fill the texture, as tuple or HEX string."),layer_name:V.string().optional().describe("Name of the texture layer. Required if fill_color is set."),pbr_channel:V.enum(["color","normal","height","mer"]).optional().describe("PBR channel to use for the texture. Color, normal, height, or Metalness/Emissive/Roughness (MER) map."),render_mode:V.enum(["default","emissive","additive","layered"]).optional().default("default").describe("Render mode for the texture. Default, emissive, additive, or layered."),render_sides:V.enum(["auto","front","double"]).optional().default("auto").describe("Render sides for the texture. Auto, front, or double.")}).refine((Q)=>!(Q.data&&Q.fill_color),{message:"The 'data' and 'fill_color' properties cannot both be defined.",path:["data","fill_color"]}).refine((Q)=>!(Q.fill_color&&!Q.layer_name),{message:"The 'layer_name' property is required when 'fill_color' is set.",path:["layer_name","fill_color"]}).refine(({pbr_channel:Q,group:W})=>Q&&W||!Q,{message:"The 'group' property is required when 'pbr_channel' is set.",path:["group","pbr_channel"]}),async execute({name:Q,width:W,height:$,data:Y,pbr_channel:J,fill_color:X,group:G,layer_name:H}){Undo.initEdit({textures:[],collections:[]});let B=new Texture({name:Q,width:W,height:$,group:G,pbr_channel:J,internal:!0});if(Y){if(Y.startsWith("data:image/"))B.source=Y,B.width=W,B.height=$;else B=B.fromFile({name:Y.split(/[\/\\]/).pop()||Y,path:Y.replace(/^file:\/\//,"")});B.load(),B.fillParticle(),B.layers_enabled=!1}else{let{ctx:K}=B.getActiveCanvas();if(X){let F=Array.isArray(X)?tinycolor({r:Number(X[0]),g:Number(X[1]),b:Number(X[2]),a:Number(X[3]??255)}):tinycolor(X);K.fillStyle=F.toRgbString().toLowerCase(),K.fillRect(0,0,B.width,B.height)}else K.clearRect(0,0,B.width,B.height);B.updateSource(K.canvas.toDataURL("image/png",1)),B.updateLayerChanges(!0)}return B.add(),Undo.finishEdit("Agent created texture"),Canvas.updateAll(),_4({url:B.getDataURL()})}},g),R("apply_texture",{description:"Applies the given texture to the element with the specified ID.",annotations:{title:"Apply Texture",destructiveHint:!0},parameters:V.object({id:V.string().describe("ID or name of the element to apply the texture to."),texture:V.string().describe("ID or name of the texture to apply."),applyTo:V.enum(["all","blank","none"]).describe("Apply texture to element or group.").optional().default("blank")}),async execute({applyTo:Q,id:W,texture:$}){let Y=E1(W),J=$?u0($):Texture.getDefault();if(!J)throw Error("No default texture available. Use the create_texture tool to create one first.");return Undo.initEdit({elements:[],outliner:!0,collections:[]}),J.select(),Texture.selected?.apply(Q==="none"?!1:Q==="all"?!0:"blank"),J.updateChangesAfterEdit(),Undo.finishEdit("Agent applied texture"),Canvas.updateAll(),`Applied texture ${J.name} to element with ID ${W}`}},K0),R("add_texture_group",{description:"Adds a new texture group with the given name.",annotations:{title:"Add Texture Group",destructiveHint:!0},parameters:V.object({name:V.string(),textures:V.array(V.string()).optional().describe("Array of texture IDs or names to add to the group."),is_material:V.boolean().optional().default(!0).describe("Whether the texture group is a PBR material or not.")}),async execute({name:Q,textures:W,is_material:$}){Undo.initEdit({elements:[],outliner:!0,collections:[],textures:[]});let Y=new TextureGroup({name:Q,is_material:$}).add();if(W){let J=W.map((X)=>E0(X)).filter(Boolean);if(J.length===0)throw Error(`No textures found for "${W}".`);J.forEach((X)=>{X?.extend({group:Y.uuid})})}return Undo.finishEdit("Agent added texture group"),Canvas.updateAll(),`Added texture group ${Y.name} with ID ${Y.uuid}`}},g),R("list_textures",{description:"Returns a list of all textures in the Blockbench editor.",annotations:{title:"List Textures",readOnlyHint:!0},parameters:V.object({}),async execute(){let Q=Project?.textures??Texture.all;return JSON.stringify(Q.map((W)=>({name:W.name,uuid:W.uuid,id:W.id,group:W.group})))}},K0),R("get_texture",{description:"Returns the image data of the given texture or default texture.",annotations:{title:"Get Texture",readOnlyHint:!0},parameters:V.object({texture:V.string().optional().describe("Texture ID or name.")}),async execute({texture:Q}){if(!Q){let $=Texture.getDefault();if(!$)throw Error("No default texture available. Use the create_texture tool to create one first, or specify a texture ID.");return _4({url:$.getDataURL()})}let W=u0(Q);return _4({url:W.getDataURL()})}},K0),R("create_pbr_material",{description:"Creates a new PBR material (texture group with is_material=true) and optionally assigns textures to PBR channels. Use this for Minecraft Bedrock resource packs or any format supporting PBR.",annotations:{title:"Create PBR Material",destructiveHint:!0},parameters:V.object({name:V.string().describe("Name of the material."),color_texture:V.string().optional().describe("Texture ID/name for the color (albedo) channel."),normal_texture:V.string().optional().describe("Texture ID/name for the normal map channel."),height_texture:V.string().optional().describe("Texture ID/name for the height/displacement map channel."),mer_texture:V.string().optional().describe("Texture ID/name for the MER (Metalness/Emissive/Roughness) channel."),color_value:V.array(V.number().min(0).max(255)).length(4).optional().describe("Uniform RGBA color [R,G,B,A] when no color texture is provided."),mer_value:V.array(V.number().min(0).max(255)).length(3).optional().describe("Uniform MER values [Metalness, Emissive, Roughness] (0-255) when no MER texture is provided."),subsurface_value:V.number().min(0).max(255).optional().describe("Subsurface scattering value (0-255) for Bedrock 1.21.30+ materials.")}),async execute({name:Q,color_texture:W,normal_texture:$,height_texture:Y,mer_texture:J,color_value:X,mer_value:G,subsurface_value:H}){let B=[];if(W){let F=u0(W);B.push(F)}if($){let F=u0($);B.push(F)}if(Y){let F=u0(Y);B.push(F)}if(J){let F=u0(J);B.push(F)}Undo.initEdit({texture_groups:[],textures:B});let K=new TextureGroup({name:Q,is_material:!0});if(X)K.material_config.color_value=X;if(G)K.material_config.mer_value=G;if(H!==void 0)K.material_config.subsurface_value=H;if(K.material_config.saved=!1,K.add(),W)u0(W).extend({group:K.uuid,pbr_channel:"color"});if($)u0($).extend({group:K.uuid,pbr_channel:"normal"});if(Y)u0(Y).extend({group:K.uuid,pbr_channel:"height"});if(J)u0(J).extend({group:K.uuid,pbr_channel:"mer"});return K.updateMaterial(),Undo.finishEdit("Agent created PBR material"),Canvas.updateAll(),JSON.stringify({success:!0,material:{name:K.name,uuid:K.uuid,is_material:!0,channels:{color:W?!0:!!X,normal:!!$,height:!!Y,mer:J?!0:!!G}}})}},g),R("configure_material",{description:"Configures an existing PBR material's properties including channel assignments, uniform values, and subsurface scattering.",annotations:{title:"Configure Material",destructiveHint:!0},parameters:V.object({material:V.string().describe("Material name or UUID to configure."),color_texture:V.string().optional().describe("Texture ID/name for the color channel, or 'none' to use uniform color."),normal_texture:V.string().optional().describe("Texture ID/name for the normal map, or 'none' to remove."),height_texture:V.string().optional().describe("Texture ID/name for the height map, or 'none' to remove."),mer_texture:V.string().optional().describe("Texture ID/name for MER channel, or 'none' to use uniform values."),color_value:V.array(V.number().min(0).max(255)).length(4).optional().describe("Uniform RGBA color [R,G,B,A] when no color texture."),mer_value:V.array(V.number().min(0).max(255)).length(3).optional().describe("Uniform MER values [Metalness, Emissive, Roughness] (0-255)."),subsurface_value:V.number().min(0).max(255).optional().describe("Subsurface scattering value (0-255).")}),async execute({material:Q,color_texture:W,normal_texture:$,height_texture:Y,mer_texture:J,color_value:X,mer_value:G,subsurface_value:H}){let B=m9(Q),K=B.getTextures();if(Undo.initEdit({texture_groups:[B],textures:K}),W==="none")K.filter((F)=>F.pbr_channel==="color").forEach((F)=>F.group="");else if(W)K.filter((L)=>L.pbr_channel==="color").forEach((L)=>L.pbr_channel="color"),u0(W).extend({group:B.uuid,pbr_channel:"color"});if($==="none")K.filter((F)=>F.pbr_channel==="normal").forEach((F)=>F.group="");else if($)u0($).extend({group:B.uuid,pbr_channel:"normal"});if(Y==="none")K.filter((F)=>F.pbr_channel==="height").forEach((F)=>F.group="");else if(Y)u0(Y).extend({group:B.uuid,pbr_channel:"height"});if(J==="none")K.filter((F)=>F.pbr_channel==="mer").forEach((F)=>F.group="");else if(J)u0(J).extend({group:B.uuid,pbr_channel:"mer"});if(X)B.material_config.color_value=X;if(G)B.material_config.mer_value=G;if(H!==void 0)B.material_config.subsurface_value=H;return B.material_config.saved=!1,B.updateMaterial(),Undo.finishEdit("Agent configured material"),Canvas.updateAll(),`Configured material "${B.name}"`}},g),R("list_materials",{description:"Lists all PBR materials (texture groups with is_material=true) and their assigned textures per channel.",annotations:{title:"List Materials",readOnlyHint:!0},parameters:V.object({}),async execute(){let W=TextureGroup.all.filter(($)=>$.is_material).map(($)=>{let Y=$.getTextures();return{name:$.name,uuid:$.uuid,channels:{color:c9(Y,"color"),normal:c9(Y,"normal"),height:c9(Y,"height"),mer:c9(Y,"mer")},config:{color_value:$.material_config.color_value,mer_value:$.material_config.mer_value,subsurface_value:$.material_config.subsurface_value,saved:$.material_config.saved}}});return JSON.stringify(W,null,2)}},K0),R("get_material_info",{description:"Gets detailed information about a PBR material including the compiled texture_set.json preview for Bedrock export.",annotations:{title:"Get Material Info",readOnlyHint:!0},parameters:V.object({material:V.string().describe("Material name or UUID.")}),async execute({material:Q}){let W=m9(Q),$=W.getTextures(),Y=null;try{Y=W.material_config.compileForBedrock()}catch{}let J={name:W.name,uuid:W.uuid,is_material:W.is_material,textures:$.map((X)=>({name:X.name,uuid:X.uuid,pbr_channel:X.pbr_channel,width:X.width,height:X.height,render_mode:X.render_mode,render_sides:X.render_sides})),config:{color_value:W.material_config.color_value,mer_value:W.material_config.mer_value,subsurface_value:W.material_config.subsurface_value,saved:W.material_config.saved,file_path:W.material_config.getFilePath()},texture_set_json:Y};return JSON.stringify(J,null,2)}},K0),R("import_texture_set",{description:"Imports a Minecraft Bedrock texture_set.json file and creates a PBR material with the associated textures.",annotations:{title:"Import Texture Set",destructiveHint:!0,openWorldHint:!0},parameters:V.object({path:V.string().describe("Path to the .texture_set.json file to import.")}),async execute({path:Q}){if(!Q.endsWith(".texture_set.json"))throw Error("Path must end with '.texture_set.json'. Example: 'path/to/mytexture.texture_set.json'");if(!requireNativeModule("fs").existsSync(Q))throw Error(`File not found: ${Q}`);return importTextureSet({path:Q,name:Q.split(/[\/\\]/).pop()}),`Imported texture set from "${Q}". Check the textures panel for the new material.`}},g),R("assign_texture_channel",{description:"Assigns a texture to a specific PBR channel within a material.",annotations:{title:"Assign Texture Channel",destructiveHint:!0},parameters:V.object({material:V.string().describe("Material name or UUID."),texture:V.string().describe("Texture name or UUID to assign."),channel:V.enum(["color","normal","height","mer"]).describe("PBR channel to assign the texture to.")}),async execute({material:Q,texture:W,channel:$}){let Y=m9(Q),J=u0(W);return Undo.initEdit({texture_groups:[Y],textures:[J]}),Y.getTextures().filter((G)=>G.pbr_channel===$&&G.uuid!==J.uuid).forEach((G)=>{G.pbr_channel="color"}),J.extend({group:Y.uuid,pbr_channel:$}),Y.material_config.saved=!1,Y.updateMaterial(),Undo.finishEdit("Agent assigned texture channel"),Canvas.updateAll(),`Assigned texture "${J.name}" to ${$} channel of material "${Y.name}"`}},g),R("save_material_config",{description:"Saves the material's texture_set.json file to disk (Bedrock format). Requires the color texture to have a valid file path.",annotations:{title:"Save Material Config",destructiveHint:!0,openWorldHint:!0},parameters:V.object({material:V.string().describe("Material name or UUID to save.")}),async execute({material:Q}){let W=m9(Q),$=W.material_config.getFilePath();if(!$)throw Error("Cannot save: Material needs a color texture with a valid file path. Save the color texture first, then try again.");return W.material_config.save(),`Saved material config to "${$}"`}},g)}function eB(){R("trigger_action",{description:"Triggers an action in the Blockbench editor.",annotations:{title:"Trigger Action",destructiveHint:!0,openWorldHint:!0},parameters:V.object({action:V.enum(Object.keys(BarItems)).describe("Action to trigger."),confirmDialog:V.boolean().optional().default(!0).describe("Whether or not to automatically confirm any dialogs that appear as a result of the action."),confirmEvent:V.string().optional().describe("Stringified form of event arguments.")}),async execute({action:Q,confirmEvent:W,confirmDialog:$}){Undo.initEdit({elements:[],outliner:!0,collections:[]});let Y=W?JSON.parse(W):{};if(!(Q in BarItems))throw Error(`Action "${Q}" not found.`);let J=BarItems[Q];if(J&&J instanceof Action){let{event:G,...H}=Y;J.trigger(new Event(G||"click",{...H}))}if($)Dialog.open?.confirm();Undo.finishEdit("Agent triggered action");let X;try{X=await l6()}catch(G){X=`Action "${Q}" executed, but failed to capture app screenshot: ${G}`}return X}},g),R("risky_eval",{description:"Evaluates the given expression and logs it to the console. Do not pass `console` commands as they will not work.",annotations:{title:"Eval",destructiveHint:!0,openWorldHint:!0},parameters:V.object({code:V.string().refine((Q)=>!/console\.|\/\/|\/\*/.test(Q),{message:"Code must not include 'console.', '//' or '/* */' comments."}).describe("JavaScript code to evaluate. Do not pass `console` commands or comments.")}),async execute({code}){try{Undo.initEdit({elements:[],outliner:!0,collections:[]});let result=await eval(code.trim());if(result!==void 0)return JSON.stringify(result);return"(Code executed successfully, but no result was returned.)"}catch(Q){return`Error executing code: ${Q}`}finally{Undo.finishEdit("Agent executed code")}}},K0),R("emulate_clicks",{description:"Emulates clicks on the given interface elements.",annotations:{title:"Emulate Clicks",destructiveHint:!0,openWorldHint:!0},parameters:V.object({position:V.object({x:V.number(),y:V.number(),button:V.enum(["left","right"]).optional().default("left").describe("Mouse button to use.")}),drag:V.object({to:V.object({x:V.number(),y:V.number()}),duration:V.number().optional().default(100).describe("Duration of the drag in milliseconds.")}).optional().describe("Drag options. If set, will perform a drag from position to 'to'.")}),async execute({position:Q,drag:W}){let{x:$,y:Y,button:J}=Q,X=new MouseEvent("click",{clientX:$,clientY:Y,button:J==="left"?0:2});if(document.dispatchEvent(X),W){let{to:G,duration:H}=W,B=new MouseEvent("mousedown",{clientX:$,clientY:Y,button:J==="left"?0:2}),K=new MouseEvent("mouseup",{clientX:G.x,clientY:G.y,button:J==="left"?0:2});document.dispatchEvent(B),await new Promise((F)=>setTimeout(F,H)),document.dispatchEvent(K)}return await l6()}},g),R("fill_dialog",{description:"Fills the dialog with the given values.",annotations:{title:"Fill Dialog",destructiveHint:!0,openWorldHint:!0},parameters:V.object({values:V.string().describe("Stringified form of values to fill the dialog with."),confirm:V.boolean().optional().default(!0).describe("Whether to confirm or cancel the dialog after filling it. True to confirm, false to cancel.")}),async execute({values:Q,confirm:W}){if(!Dialog.stack.length)throw Error("No dialogs found in the Blockbench editor.");if(!Dialog.open)Dialog.stack[Dialog.stack.length-1]?.focus();let $=JSON.parse(Q),Y=Object.keys(Dialog.open?.getFormResult()??{}),J=Object.entries($).reduce((X,[G,H])=>{if(Y.includes(G))X[G]=H;return X});if(Dialog.open?.setFormValues(J,!0),W)Dialog.open?.confirm();else Dialog.open?.cancel();return JSON.stringify({result:`Current dialog stack is now ${Dialog.stack.length} deep.`,dialogs:Dialog.stack.map((X)=>({id:X.id,values:X.getFormResult()}))})}},g)}function QK(){R("set_mesh_uv",{description:"Sets UV coordinates for mesh faces or vertices.",annotations:{title:"Set Mesh UV",destructiveHint:!0},parameters:V.object({mesh_id:V.string().describe("ID or name of the mesh."),face_key:V.string().describe("Face key to set UV for."),uv_mapping:V.record(V.string(),V.array(V.number()).length(2)).describe("UV coordinates for each vertex of the face.")}),async execute({mesh_id:Q,face_key:W,uv_mapping:$}){let Y=u6(Q);Undo.initEdit({elements:[Y],uv_only:!0});let J=Y.faces[W];if(!J)throw Error(`Face with key "${W}" not found in mesh.`);return Object.entries($).forEach(([X,G])=>{if(J.vertices.includes(X))J.uv[X]=G}),Y.preview_controller.updateUV(Y),UVEditor.loadData(),Undo.finishEdit("Set mesh UV"),`Set UV mapping for face "${W}" of mesh "${Y.name}"`}},g),R("auto_uv_mesh",{description:"Automatically generates UV mapping for selected mesh faces.",annotations:{title:"Auto UV Mesh",destructiveHint:!0},parameters:V.object({mesh_id:V.string().optional().describe("ID or name of the mesh. If not provided, uses selected mesh."),mode:V.enum(["project","unwrap","cylinder","sphere"]).default("project").describe("UV mapping mode: project from view, unwrap, cylinder, or sphere mapping."),faces:V.array(V.string()).optional().describe("Specific face keys to UV map. If not provided, maps all selected faces.")}),async execute({mesh_id:Q,mode:W,faces:$}){let Y=i1(Q);Undo.initEdit({elements:[Y],uv_only:!0});let J=$||UVEditor.getSelectedFaces(Y);if(W==="project")BarItems.uv_project_from_view.click();else J.forEach((X)=>{let G=Y.faces[X];if(!G)return;if(W==="unwrap")UVEditor.setAutoSize(null,!0,[X]);else if(W==="cylinder")G.getSortedVertices().forEach((B,K)=>{let F=Y.vertices[B],U=(Math.atan2(F[0],F[2])+Math.PI)/(2*Math.PI)*Project.texture_width,q=(F[1]+8)/16*Project.texture_height;G.uv[B]=[U,q]});else if(W==="sphere")G.getSortedVertices().forEach((B)=>{let K=Y.vertices[B],F=Math.sqrt(K[0]**2+K[1]**2+K[2]**2),L=Math.acos(K[1]/F),q=(Math.atan2(K[0],K[2])+Math.PI)/(2*Math.PI)*Project.texture_width,A=L/Math.PI*Project.texture_height;G.uv[B]=[q,A]})});return Y.preview_controller.updateUV(Y),UVEditor.loadData(),Undo.finishEdit("Auto UV mesh"),`Applied ${W} UV mapping to ${J.length} faces of mesh "${Y.name}"`}},g),R("rotate_mesh_uv",{description:"Rotates UV coordinates of selected mesh faces.",annotations:{title:"Rotate Mesh UV",destructiveHint:!0},parameters:V.object({mesh_id:V.string().optional().describe("ID or name of the mesh. If not provided, uses selected mesh."),angle:V.enum(["-90","90","180"]).default("90").describe("Rotation angle in degrees."),faces:V.array(V.string()).optional().describe("Specific face keys to rotate UV for. If not provided, rotates all selected faces.")}),async execute({mesh_id:Q,angle:W,faces:$}){let Y=i1(Q);Undo.initEdit({elements:[Y],uv_only:!0});let J=parseInt(W);return UVEditor.rotate(J),Undo.finishEdit("Rotate mesh UV"),`Rotated UV by ${W} degrees for mesh "${Y.name}"`}},g)}var NM=["hytale_character","hytale_prop"],WK=["flat","standard","fullbright","reflective"],$K=["+X","-X","+Y","-Y","+Z","-Z"];function m6(){if(typeof Plugins>"u")return!1;return Plugins.installed?.some?.((Q)=>Q.id==="hytale_plugin"&&!Q.disabled)??!1}function M0(){if(typeof Format>"u"||!Format?.id)return!1;return NM.includes(Format.id)}function x4(){if(!M0())return null;if(Format.id==="hytale_character")return"character";if(Format.id==="hytale_prop")return"prop";return null}function y4(){let Q=x4();if(Q==="character")return 64;if(Q==="prop")return 32;return 16}function p9(){if(!m6())return[];if(typeof Collection>"u")return[];return(Collection.all??[]).filter((Q)=>Q.export_codec==="blockymodel")}function d9(){if(typeof Group>"u")return[];return(Group.all??[]).filter((Q)=>Q.is_piece===!0)}function c6(Q){return Q.shading_mode??"standard"}function p6(Q){return Q.double_sided??!1}function i9(){return 60}function MM(){return 255}function jM(){if(typeof Group>"u")return 0;if(typeof Cube>"u")return 0;let Q=0,W=Group.all??[],$=Cube.all??[];Q+=W.length;for(let Y of $){let J=Y.parent;if(J instanceof Group){if(J.children.filter((G)=>G instanceof Cube).length>1)Q+=1}else Q+=1}return Q}function n9(){let Q=jM(),W=MM(),$=Q<=W;return{valid:$,count:Q,max:W,message:$?void 0:`Node count (${Q}) exceeds Hytale limit of ${W} nodes.`}}function YK(){if(!m6()){console.log("[MCP] Hytale plugin not detected, skipping Hytale tools registration");return}console.log("[MCP] Hytale plugin detected, registering Hytale tools"),R("hytale_get_format_info",{description:"Returns information about the current Hytale format. Requires the Hytale plugin and a Hytale format project to be active.",annotations:{title:"Get Hytale Format Info",readOnlyHint:!0},parameters:V.object({}),async execute(){if(!M0())throw Error("Current project is not using a Hytale format. Create or open a Hytale character or prop project first.");let Q=x4(),W=y4(),$=n9();return JSON.stringify({formatType:Q,blockSize:W,animationFPS:i9(),nodeCount:$.count,maxNodes:$.max,nodeCountValid:$.valid,features:{boneRig:!0,animationFiles:!0,quaternionInterpolation:!0,uvRotation:!0,stretchCubes:!0,attachments:!0,quads:!0}})}},"experimental"),R("hytale_validate_model",{description:"Validates the current Hytale model against Hytale engine constraints (node count, UV sizes, etc.).",annotations:{title:"Validate Hytale Model",readOnlyHint:!0},parameters:V.object({}),async execute(){if(!M0())throw Error("Current project is not using a Hytale format.");let Q=n9(),W=[];if(!Q.valid)W.push(Q.message);let $=Project?.textures??[],Y=y4();for(let J of $)if(J.width!==Y||J.height<Y){if(J.height%Y!==0)W.push(`Texture "${J.name}" has invalid dimensions (${J.width}x${J.height}). Expected width ${Y} and height multiple of ${Y}.`)}return JSON.stringify({valid:W.length===0,nodeCount:Q.count,maxNodes:Q.max,issues:W,blockSize:Y,textureCount:$.length})}},"experimental"),R("hytale_set_cube_properties",{description:"Sets Hytale-specific properties on a cube: shading_mode (flat, standard, fullbright, reflective) and double_sided.",annotations:{title:"Set Hytale Cube Properties",destructiveHint:!1},parameters:V.object({cube_id:V.string().describe("ID or name of the cube to modify. Uses selected cube if not provided.").optional(),shading_mode:V.enum(WK).describe("Shading mode: flat (no lighting), standard (normal), fullbright (emissive), reflective").optional(),double_sided:V.boolean().describe("Whether to render both sides of faces").optional()}),async execute({cube_id:Q,shading_mode:W,double_sided:$}){if(!M0())throw Error("Current project is not using a Hytale format.");let Y;if(Q){let X=E1(Q);if(!(X instanceof Cube))throw Error(`Element "${Q}" is not a cube.`);Y=X}else{let X=Cube.selected[0];if(!X)throw Error("No cube selected and no cube_id provided.");Y=X}Undo.initEdit({elements:[Y]});let J=Y;if(W!==void 0)J.shading_mode=W;if($!==void 0)J.double_sided=$;return Undo.finishEdit("Set Hytale cube properties"),JSON.stringify({uuid:Y.uuid,name:Y.name,shading_mode:c6(Y),double_sided:p6(Y)})}},"experimental"),R("hytale_get_cube_properties",{description:"Gets Hytale-specific properties from a cube (shading_mode, double_sided).",annotations:{title:"Get Hytale Cube Properties",readOnlyHint:!0},parameters:V.object({cube_id:V.string().describe("ID or name of the cube. Uses selected cube if not provided.").optional()}),async execute({cube_id:Q}){if(!M0())throw Error("Current project is not using a Hytale format.");let W;if(Q){let $=E1(Q);if(!($ instanceof Cube))throw Error(`Element "${Q}" is not a cube.`);W=$}else{let $=Cube.selected[0];if(!$)throw Error("No cube selected and no cube_id provided.");W=$}return JSON.stringify({uuid:W.uuid,name:W.name,shading_mode:c6(W),double_sided:p6(W)})}},"experimental"),R("hytale_create_quad",{description:"Creates a Hytale quad (2D plane) with a specified normal direction. Quads are single-face elements useful for flat surfaces.",annotations:{title:"Create Hytale Quad",destructiveHint:!1},parameters:V.object({name:V.string().describe("Name for the quad"),position:V.array(V.number()).length(3).describe("Position [x, y, z]").default([0,0,0]),normal:V.enum($K).describe("Normal direction: +X, -X, +Y, -Y, +Z, -Z").default("+Y"),size:V.array(V.number()).length(2).describe("Size [width, height]").default([16,16]),group:V.string().describe("Parent group/bone name").optional(),double_sided:V.boolean().describe("Whether to render both sides").default(!0)}),async execute({name:Q,position:W,normal:$,size:Y,group:J,double_sided:X}){if(!M0())throw Error("Current project is not using a Hytale format.");let G;if(J)G=f0(J);let[H,B]=Y,[K,F,L]=W,U,q;switch($){case"+X":case"-X":U=[K,F,L],q=[K,F+B,L+H];break;case"+Y":case"-Y":U=[K,F,L],q=[K+H,F,L+B];break;case"+Z":case"-Z":U=[K,F,L],q=[K+H,F+B,L];break;default:U=[K,F,L],q=[K+H,F+B,L]}Undo.initEdit({outliner:!0,elements:[]});let A=new Cube({name:Q,from:U,to:q,autouv:1}).init(),D=A;if(D.double_sided=X,D.shading_mode="standard",G)A.addTo(G);return Undo.finishEdit("Create Hytale quad"),Canvas.updateAll(),JSON.stringify({uuid:A.uuid,name:A.name,normal:$,from:U,to:q,double_sided:X})}},"experimental"),R("hytale_list_attachments",{description:"Lists all attachment collections in the current Hytale project.",annotations:{title:"List Hytale Attachments",readOnlyHint:!0},parameters:V.object({}),async execute(){if(!M0())throw Error("Current project is not using a Hytale format.");let Q=p9();return JSON.stringify({count:Q.length,attachments:Q.map((W)=>({uuid:W.uuid,name:W.name,texture:W.texture??null,elementCount:W.children?.length??0}))})}},"experimental"),R("hytale_set_attachment_piece",{description:"Marks or unmarks a group as an attachment piece. Attachment pieces attach to like-named bones in the main model.",annotations:{title:"Set Attachment Piece",destructiveHint:!1},parameters:V.object({group_name:V.string().describe("Name of the group to mark as attachment piece"),is_piece:V.boolean().describe("Whether the group is an attachment piece")}),async execute({group_name:Q,is_piece:W}){if(!M0())throw Error("Current project is not using a Hytale format.");let $=f0(Q);return Undo.initEdit({outliner:!0}),$.is_piece=W,Undo.finishEdit("Set attachment piece"),JSON.stringify({uuid:$.uuid,name:$.name,is_piece:W})}},"experimental"),R("hytale_list_attachment_pieces",{description:"Lists all groups marked as attachment pieces.",annotations:{title:"List Attachment Pieces",readOnlyHint:!0},parameters:V.object({}),async execute(){if(!M0())throw Error("Current project is not using a Hytale format.");let Q=d9();return JSON.stringify({count:Q.length,pieces:Q.map((W)=>({uuid:W.uuid,name:W.name,origin:W.origin}))})}},"experimental"),R("hytale_create_visibility_keyframe",{description:"Creates a visibility keyframe for a bone. Hytale supports toggling node visibility at keyframes.",annotations:{title:"Create Visibility Keyframe",destructiveHint:!1},parameters:V.object({bone_name:V.string().describe("Name of the bone/group"),time:V.number().describe("Time in seconds for the keyframe"),visible:V.boolean().describe("Whether the bone is visible at this keyframe"),animation_id:V.string().describe("Animation UUID or name. Uses current animation if not provided.").optional()}),async execute({bone_name:Q,time:W,visible:$,animation_id:Y}){if(!M0())throw Error("Current project is not using a Hytale format.");let J;if(Y){if(J=Animation.all.find((H)=>H.uuid===Y||H.name===Y),!J)throw Error(`Animation "${Y}" not found.`)}else if(J=Animation.selected,!J)throw Error("No animation selected and no animation_id provided.");let X=J.getBoneAnimator(f0(Q));if(!X)throw Error(`Could not get animator for bone "${Q}".`);Undo.initEdit({animations:[J]});let G=X.addKeyframe({channel:"visibility",time:W,data_points:[{visible:$}]});if(Undo.finishEdit("Create visibility keyframe"),typeof updateKeyframeSelection==="function")updateKeyframeSelection();return JSON.stringify({success:!0,animation:J.name,bone:Q,time:W,visible:$,keyframe_uuid:G?.uuid})}},"experimental"),R("hytale_set_animation_loop",{description:'Sets the loop mode for a Hytale animation. Hytale supports "loop" (continuous) or "hold" (freeze on last frame).',annotations:{title:"Set Animation Loop Mode",destructiveHint:!1},parameters:V.object({animation_id:V.string().describe("Animation UUID or name. Uses current animation if not provided.").optional(),loop_mode:V.enum(["loop","hold","once"]).describe("Loop mode: loop (continuous), hold (freeze on last frame), once (play once)")}),async execute({animation_id:Q,loop_mode:W}){if(!M0())throw Error("Current project is not using a Hytale format.");let $;if(Q){if($=Animation.all.find((Y)=>Y.uuid===Q||Y.name===Q),!$)throw Error(`Animation "${Q}" not found.`)}else if($=Animation.selected,!$)throw Error("No animation selected and no animation_id provided.");return Undo.initEdit({animations:[$]}),$.loop=W,Undo.finishEdit("Set animation loop mode"),JSON.stringify({animation:$.name,uuid:$.uuid,loop_mode:W})}},"experimental"),R("hytale_set_cube_stretch",{description:"Sets the stretch values for a cube. Hytale uses stretch instead of float sizes for better UV handling.",annotations:{title:"Set Cube Stretch",destructiveHint:!1},parameters:V.object({cube_id:V.string().describe("ID or name of the cube. Uses selected cube if not provided.").optional(),stretch:V.array(V.number()).length(3).describe("Stretch values [x, y, z]")}),async execute({cube_id:Q,stretch:W}){if(!M0())throw Error("Current project is not using a Hytale format.");let $;if(Q){let Y=E1(Q);if(!(Y instanceof Cube))throw Error(`Element "${Q}" is not a cube.`);$=Y}else{let Y=Cube.selected[0];if(!Y)throw Error("No cube selected and no cube_id provided.");$=Y}return Undo.initEdit({elements:[$]}),$.stretch=[...W],Undo.finishEdit("Set cube stretch"),Canvas.updateAll(),JSON.stringify({uuid:$.uuid,name:$.name,stretch:W})}},"experimental"),R("hytale_get_cube_stretch",{description:"Gets the stretch values for a cube.",annotations:{title:"Get Cube Stretch",readOnlyHint:!0},parameters:V.object({cube_id:V.string().describe("ID or name of the cube. Uses selected cube if not provided.").optional()}),async execute({cube_id:Q}){if(!M0())throw Error("Current project is not using a Hytale format.");let W;if(Q){let Y=E1(Q);if(!(Y instanceof Cube))throw Error(`Element "${Q}" is not a cube.`);W=Y}else{let Y=Cube.selected[0];if(!Y)throw Error("No cube selected and no cube_id provided.");W=Y}let $=W.stretch??[1,1,1];return JSON.stringify({uuid:W.uuid,name:W.name,stretch:$})}},"experimental"),console.log("[MCP] Hytale tools registered successfully")}function JK(){if(!m6()){console.log("[MCP] Hytale plugin not detected, skipping Hytale resources registration");return}console.log("[MCP] Hytale plugin detected, registering Hytale resources"),d1("hytale-format",{uriTemplate:"hytale://format",title:"Hytale Format Information",description:"Returns comprehensive information about the current Hytale format, including format type, block size, node limits, and feature support.",async listCallback(){if(!M0())return{resources:[]};return{resources:[{uri:"hytale://format",name:`Hytale ${x4()} format`,description:`Block size: ${y4()}, FPS: ${i9()}`,mimeType:"application/json"}]}},async readCallback(Q){if(!M0())return{contents:[{uri:Q.href,text:JSON.stringify({active:!1,message:"No Hytale format project is currently active."}),mimeType:"application/json"}]};let W=x4(),$=y4(),Y=n9();return{contents:[{uri:Q.href,text:JSON.stringify({active:!0,formatType:W,formatId:W==="character"?"hytale_character":"hytale_prop",blockSize:$,animationFPS:i9(),nodeCount:Y.count,maxNodes:Y.max,nodeCountValid:Y.valid,features:{boneRig:!0,animationFiles:!0,quaternionInterpolation:!0,uvRotation:!0,stretchCubes:!0,attachments:!0,quads:!0,shadingModes:["flat","standard","fullbright","reflective"],doubleSided:!0,visibilityKeyframes:!0}}),mimeType:"application/json"}]}}}),d1("hytale-attachments",{uriTemplate:"hytale://attachments/{id}",title:"Hytale Attachments",description:"Returns information about attachment collections in the current Hytale project. Attachments are separate models that can be attached to bones.",async listCallback(){if(!M0())return{resources:[]};return{resources:p9().map((W)=>({uri:`hytale://attachments/${W.uuid}`,name:W.name,description:`Attachment collection${W.texture?" with texture":""}`,mimeType:"application/json"}))}},async readCallback(Q,{id:W}){if(!M0())return{contents:[{uri:Q.href,text:JSON.stringify({error:"No Hytale format project is currently active."}),mimeType:"application/json"}]};let $=p9();if(W){let Y=$.find((J)=>J.uuid===W||J.name===W);if(!Y)throw Error(`Attachment "${W}" not found.`);return{contents:[{uri:Q.href,text:JSON.stringify({uuid:Y.uuid,name:Y.name,texture:Y.texture??null,elementCount:Y.children?.length??0,exportCodec:Y.export_codec}),mimeType:"application/json"}]}}return{contents:[{uri:Q.href,text:JSON.stringify({count:$.length,attachments:$.map((Y)=>({uuid:Y.uuid,name:Y.name,texture:Y.texture??null,elementCount:Y.children?.length??0}))}),mimeType:"application/json"}]}}}),d1("hytale-pieces",{uriTemplate:"hytale://pieces/{id}",title:"Hytale Attachment Pieces",description:"Returns information about groups marked as attachment pieces. Attachment pieces connect to like-named bones in the main model.",async listCallback(){if(!M0())return{resources:[]};return{resources:d9().map((W)=>({uri:`hytale://pieces/${W.uuid}`,name:W.name,description:"Attachment piece bone",mimeType:"application/json"}))}},async readCallback(Q,{id:W}){if(!M0())return{contents:[{uri:Q.href,text:JSON.stringify({error:"No Hytale format project is currently active."}),mimeType:"application/json"}]};let $=d9();if(W){let Y=$.find((J)=>J.uuid===W||J.name===W);if(!Y)throw Error(`Attachment piece "${W}" not found.`);return{contents:[{uri:Q.href,text:JSON.stringify({uuid:Y.uuid,name:Y.name,origin:Y.origin,rotation:Y.rotation,is_piece:!0,childCount:Y.children?.length??0}),mimeType:"application/json"}]}}return{contents:[{uri:Q.href,text:JSON.stringify({count:$.length,pieces:$.map((Y)=>({uuid:Y.uuid,name:Y.name,origin:Y.origin}))}),mimeType:"application/json"}]}}}),d1("hytale-cubes",{uriTemplate:"hytale://cubes/{id}",title:"Hytale Cubes",description:"Returns information about cubes with Hytale-specific properties (shading_mode, double_sided, stretch).",async listCallback(){if(!M0())return{resources:[]};return{resources:(Cube.all??[]).map((W)=>({uri:`hytale://cubes/${W.uuid}`,name:W.name,description:`Shading: ${c6(W)}, Double-sided: ${p6(W)}`,mimeType:"application/json"}))}},async readCallback(Q,{id:W}){if(!M0())return{contents:[{uri:Q.href,text:JSON.stringify({error:"No Hytale format project is currently active."}),mimeType:"application/json"}]};let $=Cube.all??[];if(W){let Y=$.find((X)=>X.uuid===W||X.name===W);if(!Y)throw Error(`Cube "${W}" not found.`);let J=Y;return{contents:[{uri:Q.href,text:JSON.stringify({uuid:Y.uuid,name:Y.name,from:Y.from,to:Y.to,origin:Y.origin,rotation:Y.rotation,stretch:Y.stretch??[1,1,1],shading_mode:c6(Y),double_sided:p6(Y),autouv:Y.autouv,visibility:Y.visibility}),mimeType:"application/json"}]}}return{contents:[{uri:Q.href,text:JSON.stringify({count:$.length,cubes:$.map((Y)=>({uuid:Y.uuid,name:Y.name,shading_mode:c6(Y),double_sided:p6(Y),stretch:Y.stretch??[1,1,1]}))}),mimeType:"application/json"}]}}}),console.log("[MCP] Hytale resources registered successfully")}function XK(){if(!m6()){console.log("[MCP] Hytale plugin not detected, skipping Hytale prompts registration");return}console.log("[MCP] Hytale plugin detected, registering Hytale prompts"),w6("hytale_model_creation",{title:"Hytale Model Creation Guide",description:"Comprehensive guide for creating Hytale character and prop models. Covers format selection, node limits, shading modes, stretch, quads, and best practices.",argsSchema:V.object({format_type:V.enum(["character","prop","both"]).describe("Which format type to focus on").optional().default("both")}),async generate({format_type:Q}){let W=await`# Hytale Model Creation Guide

This guide covers creating 3D models for Hytale using Blockbench with the Hytale plugin.

## Format Selection

Hytale uses two model formats:

### Character Format (\`hytale_character\`)
- **Block Size**: 64 pixels
- **Use Case**: Humanoid/creature models with complex rigs
- **Features**: Full bone hierarchy, attachments, animations

### Prop Format (\`hytale_prop\`)
- **Block Size**: 32 pixels
- **Use Case**: Items, weapons, decorative objects
- **Features**: Simpler structure, optimized for props

## Key Concepts

### Node Limit
Hytale has a **maximum of 255 nodes** per model. Nodes include:
- Groups/bones
- Individual cubes (excluding the main shape cube of a group)

Use \`hytale_validate_model\` tool to check node count.

### Shading Modes
Cubes support four shading modes:
- \`standard\` - Normal lighting (default)
- \`flat\` - No lighting/shadows
- \`fullbright\` - Always fully lit (emissive effect)
- \`reflective\` - Reflective material

Set with \`hytale_set_cube_properties\` tool.

### Double-Sided Faces
Enable \`double_sided\` on cubes to render both front and back faces. Useful for:
- Thin planes/quads
- Cloth/fabric elements
- Transparency effects

### Stretch vs Size
Hytale prefers **stretch** over floating-point sizes:
- Stretch is a multiplier [x, y, z] applied to the base cube
- Better UV handling than fractional sizes
- Use \`hytale_set_cube_stretch\` / \`hytale_get_cube_stretch\` tools

### Quads
Hytale supports single-face quads (2D planes):
- Created with \`hytale_create_quad\` tool
- Specify normal direction: +X, -X, +Y, -Y, +Z, -Z
- Automatically double-sided by default

## Workflow

1. **Create Project**: Use \`create_project\` with format \`bedrock\` (Hytale uses similar format structure)
2. **Build Skeleton**: Create bone hierarchy using \`add_group\` with proper origins
3. **Add Geometry**: Use \`place_cube\` for cubes, \`hytale_create_quad\` for flat surfaces
4. **Set Properties**: Apply shading modes and double-sided as needed
5. **Validate**: Run \`hytale_validate_model\` before export

## Texture Guidelines

- Character textures: 64x64 or multiples for flipbooks
- Prop textures: 32x32 or multiples for flipbooks
- UV size must match texture resolution
- Use integer positions for pixel-perfect UVs

## Tips

- Keep node count under 255
- Use stretch for scaling instead of fractional sizes
- Group related cubes under bones for animation
- Mark attachment bones with \`is_piece: true\` using \`hytale_set_attachment_piece\`
`,$="";if(Q==="character")$=`
## Character-Specific Guidelines

You are creating a **Hytale Character** model (64px block size).

Key considerations:
- Complex bone hierarchies for humanoid/creature rigs
- Full animation support with all channels
- Attachment system for equipment
- Higher detail level (64px textures)

Typical bone structure:
\`\`\`
root
 body
    head
       [face details]
    arm_left
       hand_left
    arm_right
       hand_right
    leg_left
       foot_left
    leg_right
        foot_right
 [accessories]
\`\`\`
`;else if(Q==="prop")$=`
## Prop-Specific Guidelines

You are creating a **Hytale Prop** model (32px block size).

Key considerations:
- Simpler structure optimized for items/objects
- May have minimal or no animation
- Often single-bone or simple hierarchy
- Lower detail level (32px textures)

Common prop types:
- Weapons (sword, axe, bow)
- Tools (pickaxe, shovel)
- Items (food, potions, keys)
- Decorations (furniture, plants)
`;return{messages:[{role:"user",content:{type:"text",text:W+$}}]}}},"experimental"),w6("hytale_animation_workflow",{title:"Hytale Animation Workflow",description:"Guide for creating animations for Hytale models. Covers 60 FPS timing, quaternion rotations, visibility keyframes, loop modes, and common animation patterns.",argsSchema:V.object({animation_type:V.enum(["walk","idle","attack","general"]).describe("Type of animation to focus on").optional().default("general")}),async generate({animation_type:Q}){let W=await`# Hytale Animation Workflow

This guide covers creating animations for Hytale models using Blockbench with the Hytale plugin.

## Animation Basics

### Frame Rate
Hytale animations run at **60 FPS**. When setting keyframe times:
- 1 second = 60 frames
- 0.5 seconds = 30 frames
- Use decimal seconds in tools (e.g., 0.5, 1.0, 2.5)

### File Format
Animations are stored in \`.blockyanim\` files, separate from the model (\`.blockymodel\`).

## Animation Channels

Hytale supports these animation channels per bone:

### Position
- Channel: \`position\`
- Values: [x, y, z] offset from rest pose

### Rotation (Quaternion)
- Channel: \`rotation\`
- Hytale uses **quaternion interpolation** for smooth 3D rotations
- Avoids gimbal lock issues

### Scale (Stretch)
- Channel: \`scale\`
- Values: [x, y, z] scale factors
- Linked to cube stretch system

### Visibility (Hytale-specific)
- Channel: \`visibility\`
- Values: boolean (true/false)
- Toggle bone visibility at keyframes
- Use \`hytale_create_visibility_keyframe\` tool

## Interpolation Types

- \`linear\` - Constant rate between keyframes
- \`smooth\` - Catmull-Rom spline for natural easing (default for Hytale)

## Loop Modes

Set with \`hytale_set_animation_loop\`:

- \`loop\` - Continuous playback, restarts from beginning
- \`hold\` - Play once, freeze on last frame
- \`once\` - Play once, return to rest pose

## Workflow

### 1. Create Animation
\`\`\`
Use create_animation tool:
- name: "walk_cycle"
- animation_length: 1.0 (1 second)
- loop: true
\`\`\`

### 2. Add Keyframes
Use animation tools to add keyframes:
- \`manage_keyframes\` for position/rotation/scale
- \`hytale_create_visibility_keyframe\` for visibility toggles

### 3. Set Interpolation
Use \`animation_graph_editor\` to adjust curves:
- \`smooth\` for organic movements
- \`linear\` for mechanical movements
- \`stepped\` for snappy transitions

### 4. Multi-Bone Animation
Hytale supports **duplicate bone names**:
- Multiple bones with same name receive same animation
- Useful for symmetrical limbs (left_leg, left_leg)
- Animation is automatically copied

## Tips

### Visibility Animations
Use visibility keyframes for:
- Showing/hiding alternate body parts
- Weapon swapping effects
- Damage states

### Attachment Animations
Attachment pieces inherit parent bone animation:
- Mark bones as attachment pieces with \`is_piece: true\`
- Attachments connect to matching bone names

### Performance
- Keep keyframes sparse, interpolation fills gaps
- Use linear interpolation for simple movements
- Quaternion rotation prevents flip issues

## Common Patterns

### Walk Cycle (1 second loop)
1. Contact pose (0s): Extended legs
2. Passing pose (0.25s): Mid-stride
3. Contact pose (0.5s): Opposite leg forward
4. Passing pose (0.75s): Return to start

### Idle Animation (2-3 second loop)
- Subtle breathing (scale Y on chest)
- Slight head movement
- Small position shifts for life

### Attack Animation (0.5-1 second)
- Wind-up phase with anticipation
- Quick strike (linear interpolation)
- Recovery with easing
`,$="";if(Q==="walk")$=`
## Walk Cycle Focus

Creating a walk cycle animation:

1. **Timing** (1 second loop at 60 FPS)
   - Frame 0: Right foot forward (contact)
   - Frame 15: Right foot passing
   - Frame 30: Left foot forward (contact)
   - Frame 45: Left foot passing
   - Frame 60: Loop to frame 0

2. **Key Bones**
   - Legs: Primary motion drivers
   - Arms: Counter-swing to legs
   - Body: Slight up/down bob
   - Head: Subtle stabilization

3. **Interpolation**
   - Use \`smooth\` for organic feel
   - Slight ease-in/out on contacts
`;else if(Q==="idle")$=`
## Idle Animation Focus

Creating a breathing/idle animation:

1. **Timing** (2-3 second loop)
   - Slow, subtle movements
   - Natural breathing rhythm

2. **Key Elements**
   - Chest: Scale Y for breathing (1.0  1.02  1.0)
   - Head: Tiny rotation shifts
   - Arms: Minimal sway
   - Weight shifts: Subtle body position

3. **Tips**
   - Keep movements very small
   - Use smooth interpolation
   - Avoid mechanical repetition
`;else if(Q==="attack")$=`
## Attack Animation Focus

Creating a combat animation:

1. **Timing** (0.5-1 second)
   - Anticipation: 0.1-0.2s (wind-up)
   - Strike: 0.1s (fast action)
   - Recovery: 0.2-0.5s (return)

2. **Key Phases**
   - Wind-up: Draw weapon back
   - Strike: Quick forward motion
   - Impact: Slight pause/emphasis
   - Recovery: Return to ready pose

3. **Interpolation**
   - Anticipation: Smooth ease-in
   - Strike: Linear (fast)
   - Recovery: Smooth ease-out

4. **Tips**
   - Exaggerate wind-up for readability
   - Strike should be 2-3x faster than wind-up
   - Add slight overshoot on recovery
`;return{messages:[{role:"user",content:{type:"text",text:W+$}}]}}},"experimental"),w6("hytale_attachments",{title:"Hytale Attachments System",description:"Guide for creating and managing attachments in Hytale models. Covers attachment collections, piece bones, modular equipment, and best practices.",argsSchema:V.object({}),async generate(){return{messages:[{role:"user",content:{type:"text",text:await`# Hytale Attachments System

This guide covers the attachment system in Hytale models for creating modular equipment, accessories, and interchangeable parts.

## What Are Attachments?

Attachments are separate models that can be dynamically attached to bones in a base model. Common uses:
- Armor pieces
- Weapons and tools
- Accessories (hats, capes)
- Alternate body parts
- Equipment variations

## Key Concepts

### Attachment Collections
Attachments are organized as **Collections** in Blockbench:
- Each collection is a separate exportable unit
- Collections have their own textures
- Export codec: \`blockymodel\`

Use \`hytale_list_attachments\` to see all attachment collections.

### Attachment Pieces
Groups marked as **attachment pieces** define connection points:
- Set with \`hytale_set_attachment_piece\` tool
- Pieces attach to bones with matching names in the base model
- Origin point defines the attachment anchor

Use \`hytale_list_attachment_pieces\` to see marked pieces.

## Workflow

### Creating an Attachment

1. **Create Collection**
   - Use Blockbench's collection panel
   - Set export codec to \`blockymodel\`

2. **Build Geometry**
   - Add cubes/meshes to the collection
   - Structure under bones as needed

3. **Mark Piece Bones**
   \`\`\`
   hytale_set_attachment_piece:
   - group_name: "hand_right"
   - is_piece: true
   \`\`\`
   This bone will attach to \`hand_right\` in the base model.

4. **Assign Texture**
   - Each attachment can have its own texture
   - Texture is stored in collection metadata

### Attachment Naming Convention

For automatic attachment:
- Base model has bone: \`hand_right\`
- Attachment has piece bone: \`hand_right\`
- Attachment snaps to base bone at runtime

### Multiple Attachments

A single bone can have multiple possible attachments:
- Create separate collections for each variant
- All share the same piece bone name
- Game logic selects which to display

## Resources

### hytale://attachments
Lists all attachment collections with:
- UUID and name
- Associated texture
- Element count

### hytale://pieces
Lists all attachment piece bones with:
- UUID and name
- Origin position
- Rotation

## Tips

### Pivot Points
Set piece bone origins carefully:
- Origin = attachment point
- Rotation = attachment orientation
- Match base model's bone origin for perfect fit

### Animation Inheritance
Attached pieces inherit animation from base:
- No separate animation needed
- Follows parent bone transforms
- Visibility can be animated

### Texture Organization
Keep attachment textures separate:
- One texture per attachment collection
- Allows mixing and matching
- Efficient for palette swaps

### Performance
- Attachments are lightweight
- Only active attachment is rendered
- Use for equipment variations instead of model variants

## Common Patterns

### Armor System
\`\`\`
Base Model: character.blockymodel
 body
    [geometry]
 arm_left (can have attachments)
 arm_right (can have attachments)
 head (can have attachments)

Attachments:
 helmet.blockymodel
    head (is_piece: true)
 chestplate.blockymodel
    body (is_piece: true)
 gauntlet_left.blockymodel
     arm_left (is_piece: true)
\`\`\`

### Weapon Slots
\`\`\`
character.blockymodel
 hand_right

Weapon Attachments:
 sword.blockymodel  hand_right
 axe.blockymodel  hand_right
 pickaxe.blockymodel  hand_right
\`\`\`

### Accessory Layers
\`\`\`
Base: character.blockymodel
 head
 back

Accessories:
 hat.blockymodel  head
 glasses.blockymodel  head
 cape.blockymodel  back
\`\`\`
`}}]}}},"experimental"),console.log("[MCP] Hytale prompts registered successfully")}var zM=[pB,cB,iB,nB,oB,rB,aB,tB,sB,eB,QK],EM=[YK,JK,XK];for(let Q of zM)Q();for(let Q of EM)Q();d1("projects",{uriTemplate:"projects://{id}",title:"Blockbench Projects",description:"Returns information about available projects in Blockbench. Use without an ID to list all projects, or provide a project UUID/name to get details about a specific project.",async listCallback(){let Q=ModelProject.all;if(!Q||Q.length===0)return{resources:[]};return{resources:Q.map((W)=>({uri:`projects://${W.uuid}`,name:W.name||W.uuid,description:`${W.format?.name??"Unknown format"} project${W.saved?"":" (unsaved)"}`,mimeType:"application/json"}))}},async readCallback(Q,{id:W}){let $=ModelProject.all;if(!$||$.length===0)return{contents:[{uri:Q.href,text:JSON.stringify({projects:[],count:0}),mimeType:"application/json"}]};let Y=(J)=>({uuid:J.uuid,name:J.name,selected:J.selected,saved:J.saved,format:J.format?.id??null,formatName:J.format?.name??null,boxUv:J.box_uv,textureWidth:J.texture_width,textureHeight:J.texture_height,savePath:J.save_path||null,exportPath:J.export_path||null,elementCount:J.elements?.length??0,groupCount:J.groups?.length??0,textureCount:J.textures?.length??0,animationCount:J.animations?.length??0,modelIdentifier:J.model_identifier||null,geometryName:J.geometry_name||null});if(W){let J=$.find((X)=>X.uuid===W||X.name===W);if(!J)throw Error(`Project with ID "${W}" not found.`);return{contents:[{uri:Q.href,text:JSON.stringify(Y(J)),mimeType:"application/json"}]}}return{contents:[{uri:Q.href,text:JSON.stringify({projects:$.map(Y),count:$.length,activeProject:Project?Project.uuid:null}),mimeType:"application/json"}]}}});d1("nodes",{uriTemplate:"nodes://{id}",title:"Blockbench Nodes",description:"Returns the current nodes in the Blockbench editor.",async listCallback(){if(!Project?.nodes_3d)return{resources:[]};return{resources:Object.values(Project.nodes_3d).map((W)=>({uri:`nodes://${W.uuid}`,name:W.name||W.uuid,description:"3D node in current project",mimeType:"application/json"}))}},async readCallback(Q,{id:W}){if(!Project?.nodes_3d)throw Error("No nodes found in the Blockbench editor.");let $=Project.nodes_3d[W]??Object.values(Project.nodes_3d).find((H)=>H.name===W||H.uuid===W);if(!$)throw Error(`Node with ID "${W}" not found.`);let{position:Y,rotation:J,scale:X,...G}=$;return{contents:[{uri:Q.href,text:JSON.stringify({...G,position:Y.toArray(),rotation:J.toArray(),scale:X.toArray()}),mimeType:"application/json"}]}}});d1("textures",{uriTemplate:"textures://{id}",title:"Blockbench Textures",description:"Returns information about textures in the current Blockbench project. Use without an ID to list all textures, or provide a texture UUID/name to get details about a specific texture.",async listCallback(){let Q=Project?.textures??[];if(Q.length===0)return{resources:[]};return{resources:Q.map((W)=>({uri:`textures://${W.uuid}`,name:W.name||W.uuid,mimeType:"application/json",description:W.path?`Texture from ${W.path}`:"Embedded texture"}))}},async readCallback(Q,{id:W}){let $=Project?.textures??[];if($.length===0)return{contents:[{uri:Q.href,text:JSON.stringify({textures:[],count:0}),mimeType:"application/json"}]};let Y=(J)=>({uuid:J.uuid,name:J.name,id:J.id,width:J.width,height:J.height,frameCount:J.frameCount,ratio:J.ratio,path:J.path||null,folder:J.folder||null,namespace:J.namespace||null,particle:J.particle??!1,render_mode:J.render_mode||"default",render_sides:J.render_sides||"auto",visible:J.visible??!0,saved:J.saved??!1,selected:J.selected??!1,source:J.source||null});if(W){let J=$.find((X)=>X.uuid===W||X.name===W||X.id===W);if(!J)throw Error(`Texture with ID "${W}" not found.`);return{contents:[{uri:Q.href,text:JSON.stringify(Y(J)),mimeType:"application/json"}]}}return{contents:[{uri:Q.href,text:JSON.stringify({textures:$.map(Y),count:$.length}),mimeType:"application/json"}]}}});w6("blockbench_native_apis",{description:"Essential information about Blockbench v5.0 native API security model and requireNativeModule() usage. Use this when working with Node.js modules, file system access, or native APIs in Blockbench plugins.",argsSchema:V.object({}),async generate(){return{messages:[{role:"user",content:{type:"text",text:await`# Blockbench v5.0 Native API Security Model

**CRITICAL: Read this carefully before using any Node.js APIs or native modules in Blockbench plugins.**

## Overview

Blockbench v5.0 introduces a new security model that significantly changes how plugins access native Node.js APIs. These changes give users more control and trust over plugin capabilities.

## Key Changes from Previous Versions

### 1. Global Module Variables Removed

- **OLD (pre-v5.0)**: All Node.js APIs were globally available (e.g., \`fs\`, \`os\`, \`child_process\`)
- **NEW (v5.0+)**: Most global variables have been removed
- **EXCEPTION**: \`PathModule\` is still globally available for Node's \`path\` module

### 2. Module Access via \`requireNativeModule()\`

Use the new \`requireNativeModule()\` function instead of \`require()\` for better TypeScript support:

\`\`\`javascript
// TypeScript-friendly with proper type support
const os = requireNativeModule('os');

// Add custom permission message
const child_process = requireNativeModule('child_process', {
    message: 'This permission is required to open ffmpeg and encode the video.'
});
\`\`\`

**IMPORTANT**: \`requireNativeModule()\` will:
- Open a user permission prompt for restricted modules
- Return the module **synchronously** if the user accepts
- Return \`undefined\` if the user denies
- Always check if the module is defined before use!

### 3. Module Categories

#### Safe Modules (No Permission Required)
These can be required without user confirmation:
- \`path\`
- \`crypto\`
- \`events\`
- \`zlib\`
- \`timers\`
- \`url\`
- \`string_decoder\`
- \`querystring\`

#### Restricted Modules (Require User Permission)
These prompt the user for permission:
- \`fs\` (File System - see scoped access below)
- \`child_process\`
- \`electron\`
- \`https\`
- \`net\`
- \`tls\`
- \`util\`
- \`os\`
- \`v8\`

### 4. Scoped File System Access

The \`fs\` module is now limited. For even more restrictive access, use **scoped file systems**:

\`\`\`javascript
// Request scoped fs access to specific directory
const scoped_fs = requireNativeModule('fs', {
    scope: 'C:/path/to/directory'
});

if (scoped_fs) {
    //  Will succeed - inside scope
    scoped_fs.writeFileSync('C:/path/to/directory/file.json', 'hello world');
    
    //  Will throw error - outside scope
    scoped_fs.writeFileSync('C:/foo/bar.json', 'hello world');
}
\`\`\`

**Benefits**:
- Gives users more control over file access
- Builds trust by limiting plugin scope
- Prevents accidental or malicious file system access

### 5. Limited File System Capabilities

Even with permission, the \`fs\` module has reduced capabilities:
-  Reading and writing files is allowed
-  Advanced operations like modifying file permissions are NOT available

### 6. SystemInfo Interface

For basic system information, use the new \`SystemInfo\` global instead of requiring \`os\` or \`process\`:

\`\`\`javascript
// Available properties:
SystemInfo.platform          // 'win32' | 'darwin' | 'linux'
SystemInfo.home_directory    // 'path/to/home'
SystemInfo.arch             // 'x64' | 'arm64'
SystemInfo.appdata_directory // 'C:\\\\Users\\\\Name\\\\AppData\\\\Roaming'
SystemInfo.os_version       // 'Windows 11 Home', etc.
\`\`\`

## Best Practices for Plugin Development

### 1. Request Permissions On-Demand

**DON'T** request modules during plugin load:
\`\`\`javascript
//  BAD - Bombards user with prompts on install
BBPlugin.register('my_plugin', {
    onload() {
        const fs = requireNativeModule('fs');
        const os = requireNativeModule('os');
        const child_process = requireNativeModule('child_process');
    }
});
\`\`\`

**DO** request when actually needed:
\`\`\`javascript
//  GOOD - User knows why permission is needed
BBPlugin.register('my_plugin', {
    onload() {
        // Setup without requiring modules
    }
});

function exportModel() {
    const fs = requireNativeModule('fs', {
        message: 'File system access needed to save your model.'
    });
    
    if (!fs) {
        Blockbench.showQuickMessage('Export cancelled - file system access denied', 2000);
        return;
    }
    
    // Proceed with export...
}
\`\`\`

### 2. Always Check for undefined

\`\`\`javascript
const os = requireNativeModule('os');

//  ALWAYS check before use
if (!os) {
    console.warn('OS module access denied');
    return;
}

// Now safe to use
const platform = os.platform();
\`\`\`

### 3. Use Scoped Access When Possible

If you only need access to specific directories, use scoped file systems:

\`\`\`javascript
// Instead of full fs access
const project_dir = 'C:/Users/Name/Projects/MyProject';
const scoped_fs = requireNativeModule('fs', {
    scope: project_dir,
    message: 'Access needed to read/write project files in ' + project_dir
});

if (scoped_fs) {
    // Limited to project_dir only - safer!
    scoped_fs.writeFileSync(PathModule.join(project_dir, 'output.json'), data);
}
\`\`\`

### 4. Provide Clear Permission Messages

\`\`\`javascript
const child_process = requireNativeModule('child_process', {
    message: 'This plugin needs to run FFmpeg to encode your animation as a video file.'
});
\`\`\`

### 5. Use SystemInfo for Basic Info

\`\`\`javascript
//  No permission needed
if (SystemInfo.platform === 'win32') {
    // Windows-specific code
}

//  Requires permission unnecessarily
const os = requireNativeModule('os');
if (os?.platform() === 'win32') {
    // Windows-specific code
}
\`\`\`

## Example: Safe Plugin Structure

\`\`\`javascript
BBPlugin.register('safe_exporter', {
    title: 'Safe Model Exporter',
    onload() {
        // Minimal setup - no permissions yet
        new Action('export_custom', {
            name: 'Export Custom Format',
            icon: 'save',
            click: () => this.exportModel()
        });
    },
    
    exportModel() {
        // Request permission only when needed
        const fs = requireNativeModule('fs', {
            message: 'Save your model to disk'
        });
        
        if (!fs) {
            Blockbench.showMessageBox({
                title: 'Permission Required',
                message: 'File system access is required to save the model.'
            });
            return;
        }
        
        // Proceed with export
        try {
            const data = this.generateModelData();
            fs.writeFileSync(this.getExportPath(), data);
            Blockbench.showQuickMessage('Export successful!', 2000);
        } catch (error) {
            console.error('Export failed:', error);
            Blockbench.showQuickMessage('Export failed', 2000);
        }
    }
});
\`\`\`

## Migration from Pre-v5.0 Plugins

| Old (Pre-v5.0) | New (v5.0+) |
|----------------|-------------|
| \`fs.readFileSync()\` | \`const fs = requireNativeModule('fs'); if (fs) fs.readFileSync()\` |
| \`os.platform()\` | \`SystemInfo.platform\` |
| \`process.cwd()\` | Use Blockbench APIs or SystemInfo |
| \`require('path')\` | \`PathModule\` (still global) |
| Module at load time | Module on-demand with permission check |

## Summary Checklist

When using native APIs in Blockbench v5.0 plugins:

- [ ] Use \`requireNativeModule()\` instead of \`require()\`
- [ ] Always check if module is defined before use
- [ ] Request permissions on-demand, not during plugin load
- [ ] Provide clear permission messages
- [ ] Use \`SystemInfo\` for basic system info instead of \`os\`
- [ ] Consider scoped file system access for better security
- [ ] Use \`PathModule\` for path operations (no permission needed)
- [ ] Test with user denying permissions to ensure graceful failures

---

**Remember**: These changes improve user trust and security. Embrace them to build better, safer plugins!
`}}]}}});w6("blockbench_code_eval_safety",{description:"Critical safety guide for agents using code evaluation/execution tools with Blockbench v5.0+. Contains breaking changes, quick reference, common mistakes, and safe code patterns for native module usage. MUST READ before generating or executing Blockbench plugin code.",argsSchema:V.object({}),async generate(){return{messages:[{role:"user",content:{type:"text",text:await`# Blockbench Code Evaluation Safety Guide

**FOR AGENTS USING CODE EVALUATION TOOLS (e.g., \`risky_eval\`, code execution, REPL tools)**

## Critical Security Changes in Blockbench v5.0+

###  BREAKING: Global Node.js APIs Removed

\`\`\`javascript
//  THESE NO LONGER WORK IN v5.0+
fs.readFileSync()         // undefined
os.platform()             // undefined  
child_process.spawn()     // undefined

//  USE THESE INSTEAD
const fs = requireNativeModule('fs');
SystemInfo.platform
PathModule.join()         // Still global
\`\`\`

## Quick Reference for Code Generation

### File System Operations
\`\`\`javascript
// Always wrap in permission check
const fs = requireNativeModule('fs', {
    message: 'Describe why you need file system access'
});

if (!fs) {
    // User denied - handle gracefully
    return { error: 'File system access denied' };
}

// Now safe to use
fs.writeFileSync(path, data);
\`\`\`

### System Information
\`\`\`javascript
// No permission needed - USE THIS
const platform = SystemInfo.platform;        // 'win32' | 'darwin' | 'linux'
const home = SystemInfo.home_directory;
const arch = SystemInfo.arch;                // 'x64' | 'arm64'
const appdata = SystemInfo.appdata_directory;
const version = SystemInfo.os_version;
\`\`\`

### Path Operations
\`\`\`javascript
// No permission needed - USE THIS
const joined = PathModule.join('path', 'to', 'file');
const dirname = PathModule.dirname(path);
const basename = PathModule.basename(path);
\`\`\`

### Child Process (Requires Permission)
\`\`\`javascript
const child_process = requireNativeModule('child_process', {
    message: 'Execute external commands (e.g., FFmpeg for video encoding)'
});

if (!child_process) {
    return { error: 'Process execution denied' };
}

child_process.spawn('command', ['args']);
\`\`\`

## Module Permission Matrix

| Module | Permission | Alternative |
|--------|-----------|-------------|
| \`path\` |  None | Use \`PathModule\` |
| \`crypto\` |  None | Direct require |
| \`fs\` |  User prompt | \`requireNativeModule('fs')\` |
| \`os\` |  User prompt | Use \`SystemInfo\` instead |
| \`child_process\` |  User prompt | \`requireNativeModule('child_process')\` |
| \`http/https\` |  User prompt | \`requireNativeModule('https')\` |

## Code Generation Template

When generating Blockbench plugin code, use this pattern:

\`\`\`javascript
//  SAFE PATTERN FOR v5.0+
function myFeature() {
    // 1. Check if we need native modules
    const needsFileSystem = true; // or false
    
    if (needsFileSystem) {
        // 2. Request permission with clear message
        const fs = requireNativeModule('fs', {
            message: 'Save configuration to disk'
        });
        
        // 3. Handle denial gracefully
        if (!fs) {
            Blockbench.showQuickMessage('Feature requires file system access', 2000);
            return false;
        }
        
        // 4. Use the module
        try {
            fs.writeFileSync(path, data);
            return true;
        } catch (error) {
            console.error('Failed:', error);
            return false;
        }
    }
    
    // 5. Use SystemInfo for basic system checks
    if (SystemInfo.platform === 'win32') {
        // Windows-specific code
    }
}
\`\`\`

## Common Mistakes to Avoid

###  Don't Do This
\`\`\`javascript
// Requesting at plugin load
BBPlugin.register('my_plugin', {
    onload() {
        const fs = requireNativeModule('fs');
        const os = requireNativeModule('os');
        const cp = requireNativeModule('child_process');
        // Bombards user with 3 permission prompts!
    }
});

// Using without checking
const fs = requireNativeModule('fs');
fs.readFileSync(path); // Crashes if user denied!

// Using old globals
if (process.platform === 'win32') { // undefined in v5.0!
\`\`\`

###  Do This
\`\`\`javascript
// Request on-demand
BBPlugin.register('my_plugin', {
    onload() {
        // Just setup, no permissions yet
        new Action('my_action', {
            click: () => this.doWork()
        });
    },
    
    doWork() {
        // Request only when needed
        const fs = requireNativeModule('fs', {
            message: 'Save your work'
        });
        
        if (!fs) {
            return; // Handle gracefully
        }
        
        // Use safely
        fs.writeFileSync(path, data);
    }
});

// Use SystemInfo instead of process/os
if (SystemInfo.platform === 'win32') {
    // Windows-specific
}
\`\`\`

## Scoped File System (Enhanced Security)

For directory-specific access:

\`\`\`javascript
const project_fs = requireNativeModule('fs', {
    scope: '/path/to/project',
    message: 'Access project files in /path/to/project'
});

if (project_fs) {
    //  Works - inside scope
    project_fs.writeFileSync('/path/to/project/file.json', data);
    
    //  Throws - outside scope  
    project_fs.writeFileSync('/etc/passwd', data);
}
\`\`\`

## Evaluation Safety Checklist

Before running ANY generated code in Blockbench v5.0+:

- [ ] Uses \`requireNativeModule()\` instead of \`require()\` for native modules
- [ ] Checks if module is defined before use (\`if (!module) return\`)
- [ ] Uses \`SystemInfo\` for platform/arch/home instead of \`os\`/\`process\`
- [ ] Uses \`PathModule\` for path operations
- [ ] Requests permissions on-demand, not at plugin load
- [ ] Includes clear permission messages
- [ ] Handles user denial gracefully
- [ ] Avoids direct use of \`fs\`, \`os\`, \`child_process\` globals

## Migration Quick-Fixes

| Old Code | New Code |
|----------|----------|
| \`fs.readFileSync()\` | \`const fs = requireNativeModule('fs'); if (fs) fs.readFileSync()\` |
| \`os.platform()\` | \`SystemInfo.platform\` |
| \`os.homedir()\` | \`SystemInfo.home_directory\` |
| \`process.platform\` | \`SystemInfo.platform\` |
| \`require('path')\` | \`PathModule\` |
| At plugin load | On-demand in action handlers |

---

**Remember**: Code that works in Blockbench 4.x WILL BREAK in 5.0+ if it uses native modules. Always use the new patterns above.
`}}]}}});w6("model_creation_strategy",{description:"A strategy for creating a new 3D model in Blockbench.",argsSchema:V.object({format:V.enum(["java_block","bedrock"]).optional(),approach:V.enum(["ui","programmatic","import"]).optional()}),async generate({format:Q,approach:W}){let $=[];if(Q==="java_block")$.push(await`Create a new block model for Minecraft: Java Edition.
- Rotations are limited to 22.5 degree steps and one axis per element
- The model is limited to a size of 3 by 3 by 3 blocks. Display settings can make item models larger though
`);if(Q==="bedrock")$.push(await`Create a new block model for Minecraft: Bedrock Edition.
- Size total size of a block is limited to 30 pixels in all dimensions. The limit can be off-centered in all directions by 7 pixels from the block center.
`);if(W==="ui")$.push(await"### Prefer tools, actions, and UI interactivity to assemble models\nWhen creating Blockbench models, use the following MCP tools (if available). They are listed in order of preference.\n\n1. `list_outline` - Check to see what the current project structure is like. This returns the 3D model outline information for the current project.\n2. `create_project` - If no project is open, or if the prompt calls for a new project, create a new project in Blockbench prior to attempting to use other tools.\n3. `add_group` - Organize meshes into bones\n4. `place_cube` - Creates new cube meshes in the project, with optional texture assignment.\n5. `modify_cube` - Edits existing cubes in the current project.\n6. `remove_element` - Removes a mesh from the active project.\n7. `trigger_action` - Dispatches default event for the given Blockbench Action name. Some actions will require follow-up with `fill_dialog` \n8. `fill_dialog` - Attempts to populate and submit form values in the currently open or visible Dialog window\n9. `emulate_clicks` - Attempts to dispatch click events at the given position in the app window.");if(W==="programmatic")$.push(await`### Lean on your programming expertise when creating Blockbench models

- Utilize the \`risky_eval\` MCP tool to call Blockbench, Node.js, Electron, and JavaScript functions and run scripts.
- The MCP server has access to all variables and functions in the global scope.
- Blockbench exposes much of its API functionality on the \`Blockbench\` global variable namespace.
- Functions and classes can be converted to strings and logged to the console to inspect their source to determine how to properly use them.
- The API reference on the [Blockbench Wiki](https://www.blockbench.net/wiki) is incomplete.
- Never use these tools or APIs to make system changes.`);if(W==="import")$.push(await"# Generate valid .geo.json directly\n- Use tool `from_geo_json` to import .geo.json string(s) directly into Blockbench.");return{messages:[{role:"user",content:{type:"text",text:$.join(`
`)}}]}}});class GK{sessions=new Map;listeners=new Set;add(Q){if(this.sessions.has(Q)){this.updateActivity(Q);return}let W={id:Q,connectedAt:new Date,lastActivity:new Date};this.resetTimeout(W),this.sessions.set(Q,W),this.notifyListeners(),console.log(`[MCP] Session connected: ${Q.slice(0,8)}...`)}remove(Q){let W=this.sessions.get(Q);if(!W)return;if(W.timeoutHandle)clearTimeout(W.timeoutHandle);this.sessions.delete(Q),this.notifyListeners(),console.log(`[MCP] Session disconnected: ${Q.slice(0,8)}...`)}updateActivity(Q){let W=this.sessions.get(Q);if(W)W.lastActivity=new Date,this.resetTimeout(W)}updateClientInfo(Q,W,$){let Y=this.sessions.get(Q);if(Y){Y.clientName=W,Y.clientVersion=$,this.notifyListeners();let J=W||Q.slice(0,8)+"...";console.log(`[MCP] Session identified: ${J}${$?` v${$}`:""}`)}}resetTimeout(Q){if(Q.timeoutHandle)clearTimeout(Q.timeoutHandle);Q.timeoutHandle=setTimeout(()=>{console.log(`[MCP] Session timed out: ${Q.id.slice(0,8)}...`),this.remove(Q.id)},300000)}getAll(){return[...this.sessions.values()]}getCount(){return this.sessions.size}has(Q){return this.sessions.has(Q)}subscribe(Q){return this.listeners.add(Q),Q(this.getAll()),()=>this.listeners.delete(Q)}notifyListeners(){let Q=this.getAll();this.listeners.forEach((W)=>{try{W(Q)}catch($){console.error("[MCP] Session listener error:",$)}})}clear(){for(let Q of this.sessions.values())if(Q.timeoutHandle)clearTimeout(Q.timeoutHandle);this.sessions.clear(),this.listeners.clear()}}var P1=new GK;var d6,kQ;function HK(Q){let W=Settings.get("mcp_port")||3000,$=Settings.get("mcp_endpoint")||"/bb-mcp";Blockbench.addCSS("#mcp-status-bar{display:flex;align-items:center;gap:8px;padding:4px 12px;background-color:var(--color-dark);border-block-start:1px solid var(--color-border);font-size:0.85em;user-select:none}#mcp-status-bar .mcp-status-indicator{display:flex;align-items:center;gap:6px;cursor:pointer;padding:2px 8px;border-radius:4px;transition:background-color 0.2s}#mcp-status-bar .mcp-status-indicator:hover{background-color:var(--color-button)}#mcp-status-bar .mcp-status-dot{inline-size:8px;block-size:8px;border-radius:50%;background-color:var(--color-subtle_text);transition:background-color 0.3s}#mcp-status-bar .mcp-status-dot.connected{background-color:#4caf50;box-shadow:0 0 8px rgba(76,175,80,0.6);animation:pulse 2s ease-in-out infinite}#mcp-status-bar .mcp-status-dot.disconnected{background-color:#f44336}@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}#mcp-status-bar .mcp-status-text{color:var(--color-text);font-weight:500}#mcp-status-bar .mcp-server-info{color:var(--color-subtle_text);font-size:0.9em;margin-inline-start:4px}"),d6=document.createElement("div"),d6.id="mcp-status-bar";let Y=document.createElement("div");Y.className="mcp-status-indicator",Y.title="Click to view MCP panel";let J=document.createElement("div");J.className="mcp-status-dot";let X=document.createElement("span");X.className="mcp-status-text",X.textContent="MCP Server";let G=document.createElement("span");G.className="mcp-server-info",G.textContent=`(${W}${$})`,Y.appendChild(J),Y.appendChild(X),Y.appendChild(G),d6.appendChild(Y);let H=(K)=>{let F=K.length;if(F>0)J.classList.remove("disconnected"),J.classList.add("connected"),X.textContent=F===1?"MCP Server (1 client)":`MCP Server (${F} clients)`;else J.classList.remove("connected"),J.classList.add("disconnected"),X.textContent="MCP Server"};kQ=P1.subscribe(H),Y.addEventListener("click",()=>{let K=Panels.mcp_panel;if(!K)return;if(K.folded){K.fold(!1);return}if(K.slot==="float")K.moveToFront()});let B=document.getElementById("status_bar");if(!B){console.warn("Could not find status_bar element");return}B.appendChild(d6)}function BK(){if(kQ)kQ(),kQ=void 0;if(d6)d6.remove(),d6=void 0}function _Q(Q){let W=Q._def,$=W.typeName,Y=!1,J=!1,X=W.description,G=void 0,H,B,K,F;if($==="ZodOptional"||$==="ZodNullable"){Y=!0;let U=W.innerType;return{..._Q(U),isOptional:!0}}if($==="ZodDefault"){G=W.defaultValue?.();let U=W.innerType;return{..._Q(U),defaultValue:G,isOptional:!0}}if($==="ZodArray")J=!0,F=W.type;if($==="ZodEnum")H=W.values;if($==="ZodNumber")W.checks?.forEach((q)=>{if(q.kind==="min")B=q.value;if(q.kind==="max")K=q.value});let L="text";switch($){case"ZodString":L="text";break;case"ZodNumber":L="number";break;case"ZodBoolean":L="checkbox";break;case"ZodEnum":L="select";break;case"ZodArray":L="textarea";break;case"ZodObject":L="textarea";break;case"ZodUnion":L="textarea";break;default:L="text"}return{type:L,isOptional:Y,isArray:J,description:X,defaultValue:G,enumValues:H,min:B,max:K,innerType:F}}function RM(Q){let W={};for(let[$,Y]of Object.entries(Q)){let J=_Q(Y),X=Y._def,G={label:`${$}${J.isOptional?"":" *"}`,description:J.description||`Parameter: ${$}`,type:J.type};if(J.defaultValue!==void 0)if(J.type==="textarea")G.value=JSON.stringify(J.defaultValue,null,2);else G.value=J.defaultValue;if(J.description)G.placeholder=J.description;if(J.enumValues){G.options={};for(let H of J.enumValues)G.options[H]=H}if(J.min!==void 0)G.min=J.min;if(J.max!==void 0)G.max=J.max;if(J.type==="textarea"){if(G.height=100,J.isArray)G.placeholder="Enter JSON array, e.g. [1, 2, 3]",G.value=G.value??"[]";else if(X.typeName==="ZodObject")G.placeholder="Enter JSON object",G.value=G.value??"{}"}W[$]=G}return W}function KK(Q,W){let $={};for(let[Y,J]of Object.entries(W)){let X=Q[Y],G=_Q(J);if(G.isOptional&&(X===""||X===void 0||X===null))continue;if(G.type==="textarea"&&typeof X==="string")try{$[Y]=JSON.parse(X)}catch{$[Y]=X}else if(G.type==="number"&&typeof X==="string")$[Y]=parseFloat(X);else $[Y]=X}return $}var M7=null;function VK(Q,W,$){let Y=typeof W==="string"?W:JSON.stringify(W,null,2);M7?.hide(),M7=new Dialog({id:"mcp_tool_result",title:`Result: ${Q}`,width:600,lines:[`<pre style="
        background: var(--color-back);
        padding: 12px;
        border-radius: 4px;
        overflow: auto;
        max-height: 400px;
        white-space: pre-wrap;
        word-break: break-word;
        color: ${$?"var(--color-error)":"var(--color-text)"};
        font-family: var(--font-code);
        font-size: 12px;
      ">${IM(Y)}</pre>`],singleButton:!0,buttons:["Close"]}),M7.show()}function IM(Q){return Q.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var j7=null;function FK(Q){let $=gB()[Q];if(!$){Blockbench.showQuickMessage(`Tool "${Q}" not found`,2000);return}j7?.hide();let Y=RM($.inputSchema),J=Object.keys(Y).length>0;j7=new Dialog({id:"mcp_tool_test",title:$.title||Q,width:500,form:J?Y:void 0,lines:J?void 0:['<p style="color: var(--color-subtle_text); font-style: italic;">This tool has no parameters.</p>'],buttons:["Run Tool","Copy Input","Cancel"],confirmIndex:0,cancelIndex:2,onButton(X){if(X===1){let H=this.form?.result??{},B=J?KK(H,$.inputSchema):{},K=JSON.stringify({tool:Q,arguments:B},null,2);return navigator.clipboard.writeText(K).then(()=>{Blockbench.showQuickMessage("Input copied to clipboard",1500)}).catch(()=>{Blockbench.showQuickMessage("Failed to copy to clipboard",1500)}),!1}},async onConfirm(X){let G=J?KK(X,$.inputSchema):{};Blockbench.showQuickMessage("Running tool...",1000);try{let H=await $.execute(G),B;if(typeof H==="string")B=H;else if(H&&typeof H==="object"&&"content"in H)B=H.content.map((F)=>{if(F.type==="text")return F.text;if(F.type==="image")return`[Image: ${F.data?.slice(0,50)}...]`;return JSON.stringify(F)}).join(`
`);else B=H;VK(Q,B,!1)}catch(H){let B=H instanceof Error?H.message:String(H);VK(Q,`Error: ${B}`,!0)}}}),j7.show()}function P7(Q){let W=Q._def,$=W.typeName,Y=!1,J=W.description,X=void 0,G;if($==="ZodOptional"||$==="ZodNullable"){Y=!0;let B=W.innerType;return{...P7(B),isOptional:!0}}if($==="ZodDefault"){X=W.defaultValue?.();let B=W.innerType;return{...P7(B),defaultValue:X,isOptional:!0}}if($==="ZodEnum")G=W.values;let H="text";switch($){case"ZodString":H="text";break;case"ZodNumber":H="number";break;case"ZodBoolean":H="checkbox";break;case"ZodEnum":H="select";break;default:H="text"}return{type:H,isOptional:Y,description:J,defaultValue:X,enumValues:G}}function SM(Q){let W={};for(let[$,Y]of Object.entries(Q)){let J=P7(Y),X={label:`${$}${J.isOptional?"":" *"}`,description:J.description||`Argument: ${$}`,type:J.type};if(J.defaultValue!==void 0)X.value=J.defaultValue;if(J.description)X.placeholder=J.description;if(J.enumValues){X.options={"":"(none)"};for(let G of J.enumValues)X.options[G]=G}W[$]=X}return W}function qK(Q){return Q.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var z7=null;function LK(Q,W,$=!1){z7?.hide(),z7=new Dialog({id:"mcp_prompt_content",title:`Prompt: ${Q}`,width:700,lines:[`<pre style="
        background: var(--color-back);
        padding: 12px;
        border-radius: 4px;
        overflow: auto;
        max-height: 500px;
        white-space: pre-wrap;
        word-break: break-word;
        color: ${$?"var(--color-error)":"var(--color-text)"};
        font-family: var(--font-code);
        font-size: 12px;
        line-height: 1.5;
      ">${qK(W)}</pre>`],buttons:["Copy","Close"],onButton(Y){if(Y===0)return navigator.clipboard.writeText(W).then(()=>{Blockbench.showQuickMessage("Prompt copied to clipboard",1500)}).catch(()=>{Blockbench.showQuickMessage("Failed to copy to clipboard",1500)}),!1}}),z7.show()}var E7=null;function UK(Q){let $=lB()[Q];if(!$){Blockbench.showQuickMessage(`Prompt "${Q}" not found`,2000);return}E7?.hide();let Y=$.argsSchema&&Object.keys($.argsSchema).length>0,J=Y?SM($.argsSchema):{};E7=new Dialog({id:"mcp_prompt_preview",title:$.title||Q,width:500,form:Y?J:void 0,lines:[`<p style="margin-bottom: 12px; color: var(--color-subtle_text);">${qK($.description)}</p>`,...Y?[]:['<p style="color: var(--color-subtle_text); font-style: italic;">This prompt has no arguments.</p>']],buttons:["Generate Prompt","Cancel"],confirmIndex:0,cancelIndex:1,async onConfirm(X){let G={};for(let[H,B]of Object.entries(X))if(B!==""&&B!==void 0&&B!==null)G[H]=B;Blockbench.showQuickMessage("Generating prompt...",1000);try{let B=(await $.generate(G)).messages.map((K)=>{let F=K.role==="user"?"User":"Assistant",L=typeof K.content==="string"?K.content:K.content.text;return`[${F}]
${L}`}).join(`

---

`);LK(Q,B)}catch(H){let B=H instanceof Error?H.message:String(H);LK(Q,`Error: ${B}`,!0)}}}),E7.show()}var R7,xQ;function AK({server:Q,tools:W,resources:$,prompts:Y}){return Blockbench.addCSS(".mcp-panel{display:grid;grid-template-rows:auto 1fr auto;max-block-size:66vh;overflow:auto;padding:10px;details{overflow:auto}summary{cursor:pointer}dl{display:grid;grid-template-columns:1fr 1fr;grid-auto-flow:row;margin:0;padding:0;dt{font-size:0.825em;font-weight:bold;grid-column:1;margin:0;padding:0}dd{grid-column:2;margin:0;padding:0}}.stable{border:1px solid green;border-radius:4px;background:hsla(from green h 90% 80% / 0.5);color:hsl(from green h 30% 20%)}.experimental{border:1px solid orange;border-radius:4px;background:hsla(from orange h 90% 80% / 0.5);color:hsl(from orange h 30% 20%)}.tool-toggle-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--color-border)}.tool-toggle-row:last-child{border-bottom:none}.tool-toggle-row.clickable{cursor:pointer;padding:8px;margin:0 -8px;border-radius:4px;transition:background-color 0.15s ease}.tool-toggle-row.clickable:hover{background-color:var(--color-button)}.tool-toggle-row.clickable:active{background-color:var(--color-accent)}.tool-toggle-row.clickable .tool-name::after{content:\"chevron_right\";font-family:\"Material Icons\";font-size:16px;margin-left:4px;opacity:0.5;vertical-align:middle}.tool-info{flex:1;min-width:0}.tool-name{font-weight:bold;font-size:0.9em;margin-bottom:2px}.tool-description{font-size:0.8em;color:var(--color-subtle_text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.tool-description+.tool-description{margin-top:4px}.tool-toggle{margin-left:12px;flex-shrink:0;label{font-size:0.9em}}.tool-status{display:inline-block;padding:2px 4px;border-radius:3px;font-size:0.666em;font-weight:bold;text-transform:uppercase;margin-left:8px}.session-item{display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--color-border);font-size:0.85em}.session-item:last-child{border-bottom:none}.session-id{font-family:monospace;color:var(--color-text)}.session-time{color:var(--color-subtle_text);font-size:0.9em}.no-sessions{color:var(--color-subtle_text);font-style:italic;padding:8px 0}}"),HK(Q),R7=new Panel("mcp_panel",{id:"mcp_panel",icon:"robot",name:"MCP",default_side:"right",resizable:!0,component:{mounted(){let J=this;xQ=P1.subscribe((X)=>{J.sessions=X.map((G)=>({id:G.id,connectedAt:G.connectedAt,lastActivity:G.lastActivity,clientName:G.clientName,clientVersion:G.clientVersion})),J.server.connected=X.length>0})},beforeDestroy(){if(xQ)xQ(),xQ=void 0},data:()=>({sessions:[],server:{connected:!1,name:"Blockbench MCP",version:n6},tools:Object.values(W).map((J)=>({name:J.name,description:J.description,enabled:J.enabled,status:J.status})),resources:Object.values($).map((J)=>({name:J.name,description:J.description,uriTemplate:J.uriTemplate})),prompts:Object.values(Y).map((J)=>({name:J.name,description:J.description,enabled:J.enabled,status:J.status,argumentCount:Object.keys(J.arguments).length}))}),methods:{getDisplayName(J){return J.replace("blockbench_","")},formatSessionId(J){if(J.clientName)return J.clientVersion?`${J.clientName} v${J.clientVersion}`:J.clientName;return J.id.slice(0,8)+"..."},formatTime(J){return new Date(J).toLocaleTimeString()},openToolTest(J){FK(J)},openPromptPreview(J){UK(J)}},name:"mcp_panel",template:`<div class="mcp-panel"><details name="mcp_panel" open><summary>Sessions ({{sessions.length}})</summary><div v-if="sessions.length > 0"><div v-for="session in sessions" :key="session.id" class="session-item" :title="session.id"><span class="session-id">{{formatSessionId(session)}}</span><span class="session-time">{{formatTime(session.connectedAt)}}</span></div></div><div v-else class="no-sessions"> No clients connected </div></details><details name="mcp_panel"><summary>Server</summary><dl><dt>Server Name</dt><dd>{{server.name}}</dd><dt>Server Version</dt><dd>{{server.version}}</dd><dt>Connected Clients</dt><dd>{{sessions.length}}</dd></dl></details><details name="mcp_panel"><summary>Tools</summary><div v-if="tools.length > 0"><div v-for="tool in tools" :key="tool.name" class="tool-toggle-row clickable" @click="openToolTest(tool.name)" :title="'Click to test ' + getDisplayName(tool.name)"><div class="tool-info"><div class="tool-name"> {{getDisplayName(tool.name)}} <span :class="['tool-status', tool.status]">{{tool.status}}</span></div><div class="tool-description" :title="tool.description">{{tool.description}}</div></div></div></div><div v-else><p>No tools available.</p></div></details><details name="mcp_panel"><summary>Resources</summary><div v-if="resources.length > 0"><div v-for="resource in resources" :key="resource.name" class="tool-toggle-row"><div class="tool-info"><div class="tool-name">{{getDisplayName(resource.name)}}</div><div class="tool-description" :title="resource.description">{{resource.description}}</div><div class="tool-description" style="font-style: italic; margin-top: 2px;" :title="resource.uriTemplate">{{resource.uriTemplate}}</div></div></div></div><div v-else><p>No resources available.</p></div></details><details name="mcp_panel"><summary>Prompts</summary><div v-if="prompts.length > 0"><div v-for="prompt in prompts" :key="prompt.name" class="tool-toggle-row clickable" @click="openPromptPreview(prompt.name)" :title="'Click to preview ' + getDisplayName(prompt.name)"><div class="tool-info"><div class="tool-name"> {{getDisplayName(prompt.name)}} <span :class="['tool-status', prompt.status]">{{prompt.status}}</span></div><div class="tool-description" :title="prompt.description">{{prompt.description}}</div><div v-if="prompt.argumentCount > 0" class="tool-description" style="font-style: italic; margin-top: 2px;"> {{prompt.argumentCount}} argument{{prompt.argumentCount > 1 ? 's' : ''}} </div></div></div></div><div v-else><p>No prompts available.</p></div></details></div>`},expand_button:!0}),R7}function DK(){BK(),R7?.delete()}var OK=[];function I7(){OK.push(new Setting("mcp_instructions",{name:"MCP System Instructions",description:"Instructions for the MCP system.",type:"text",value:"Generate simple, low-poly models for Minecraft inside Blockbench.",category:"general",icon:"psychology"}),new Setting("mcp_port",{name:"MCP Server Port",description:"Port for the MCP server.",type:"number",value:3000,category:"general",icon:"numbers"}),new Setting("mcp_endpoint",{name:"MCP Server Endpoint",description:"Endpoint for the MCP server.",type:"text",value:"/bb-mcp",category:"general",icon:"webhook"}))}function S7(){OK.forEach((Q)=>{Q.delete()})}class b7{constructor(Q={}){this._started=!1,this._streamMapping=new Map,this._requestToStreamMapping=new Map,this._requestResponseMap=new Map,this._initialized=!1,this._enableJsonResponse=!1,this._standaloneSseStreamId="_GET_stream",this.sessionIdGenerator=Q.sessionIdGenerator,this._enableJsonResponse=Q.enableJsonResponse??!1,this._eventStore=Q.eventStore,this._onsessioninitialized=Q.onsessioninitialized,this._onsessionclosed=Q.onsessionclosed,this._allowedHosts=Q.allowedHosts,this._allowedOrigins=Q.allowedOrigins,this._enableDnsRebindingProtection=Q.enableDnsRebindingProtection??!1,this._retryInterval=Q.retryInterval}async start(){if(this._started)throw Error("Transport already started");this._started=!0}createJsonErrorResponse(Q,W,$,Y){let J={code:W,message:$};if(Y?.data!==void 0)J.data=Y.data;return new Response(JSON.stringify({jsonrpc:"2.0",error:J,id:null}),{status:Q,headers:{"Content-Type":"application/json",...Y?.headers}})}validateRequestHeaders(Q){if(!this._enableDnsRebindingProtection)return;if(this._allowedHosts&&this._allowedHosts.length>0){let W=Q.headers.get("host");if(!W||!this._allowedHosts.includes(W)){let $=`Invalid Host header: ${W}`;return this.onerror?.(Error($)),this.createJsonErrorResponse(403,-32000,$)}}if(this._allowedOrigins&&this._allowedOrigins.length>0){let W=Q.headers.get("origin");if(W&&!this._allowedOrigins.includes(W)){let $=`Invalid Origin header: ${W}`;return this.onerror?.(Error($)),this.createJsonErrorResponse(403,-32000,$)}}return}async handleRequest(Q,W){let $=this.validateRequestHeaders(Q);if($)return $;switch(Q.method){case"POST":return this.handlePostRequest(Q,W);case"GET":return this.handleGetRequest(Q);case"DELETE":return this.handleDeleteRequest(Q);default:return this.handleUnsupportedRequest()}}async writePrimingEvent(Q,W,$,Y){if(!this._eventStore)return;if(Y<"2025-11-25")return;let J=await this._eventStore.storeEvent($,{}),X=`id: ${J}
data: 

`;if(this._retryInterval!==void 0)X=`id: ${J}
retry: ${this._retryInterval}
data: 

`;Q.enqueue(W.encode(X))}async handleGetRequest(Q){if(!Q.headers.get("accept")?.includes("text/event-stream"))return this.createJsonErrorResponse(406,-32000,"Not Acceptable: Client must accept text/event-stream");let $=this.validateSession(Q);if($)return $;let Y=this.validateProtocolVersion(Q);if(Y)return Y;if(this._eventStore){let B=Q.headers.get("last-event-id");if(B)return this.replayEvents(B)}if(this._streamMapping.get(this._standaloneSseStreamId)!==void 0)return this.createJsonErrorResponse(409,-32000,"Conflict: Only one SSE stream is allowed per session");let J=new TextEncoder,X,G=new ReadableStream({start:(B)=>{X=B},cancel:()=>{this._streamMapping.delete(this._standaloneSseStreamId)}}),H={"Content-Type":"text/event-stream","Cache-Control":"no-cache, no-transform",Connection:"keep-alive"};if(this.sessionId!==void 0)H["mcp-session-id"]=this.sessionId;return this._streamMapping.set(this._standaloneSseStreamId,{controller:X,encoder:J,cleanup:()=>{this._streamMapping.delete(this._standaloneSseStreamId);try{X.close()}catch{}}}),new Response(G,{headers:H})}async replayEvents(Q){if(!this._eventStore)return this.createJsonErrorResponse(400,-32000,"Event store not configured");try{let W;if(this._eventStore.getStreamIdForEventId){if(W=await this._eventStore.getStreamIdForEventId(Q),!W)return this.createJsonErrorResponse(400,-32000,"Invalid event ID format");if(this._streamMapping.get(W)!==void 0)return this.createJsonErrorResponse(409,-32000,"Conflict: Stream already has an active connection")}let $={"Content-Type":"text/event-stream","Cache-Control":"no-cache, no-transform",Connection:"keep-alive"};if(this.sessionId!==void 0)$["mcp-session-id"]=this.sessionId;let Y=new TextEncoder,J,X=new ReadableStream({start:(H)=>{J=H},cancel:()=>{}}),G=await this._eventStore.replayEventsAfter(Q,{send:async(H,B)=>{if(!this.writeSSEEvent(J,Y,B,H)){this.onerror?.(Error("Failed replay events"));try{J.close()}catch{}}}});return this._streamMapping.set(G,{controller:J,encoder:Y,cleanup:()=>{this._streamMapping.delete(G);try{J.close()}catch{}}}),new Response(X,{headers:$})}catch(W){return this.onerror?.(W),this.createJsonErrorResponse(500,-32000,"Error replaying events")}}writeSSEEvent(Q,W,$,Y){try{let J=`event: message
`;if(Y)J+=`id: ${Y}
`;return J+=`data: ${JSON.stringify($)}

`,Q.enqueue(W.encode(J)),!0}catch{return!1}}handleUnsupportedRequest(){return new Response(JSON.stringify({jsonrpc:"2.0",error:{code:-32000,message:"Method not allowed."},id:null}),{status:405,headers:{Allow:"GET, POST, DELETE","Content-Type":"application/json"}})}async handlePostRequest(Q,W){try{let $=Q.headers.get("accept");if(!$?.includes("application/json")||!$.includes("text/event-stream"))return this.createJsonErrorResponse(406,-32000,"Not Acceptable: Client must accept both application/json and text/event-stream");let Y=Q.headers.get("content-type");if(!Y||!Y.includes("application/json"))return this.createJsonErrorResponse(415,-32000,"Unsupported Media Type: Content-Type must be application/json");let J={headers:Object.fromEntries(Q.headers.entries())},X;if(W?.parsedBody!==void 0)X=W.parsedBody;else try{X=await Q.json()}catch{return this.createJsonErrorResponse(400,-32700,"Parse error: Invalid JSON")}let G;try{if(Array.isArray(X))G=X.map((O)=>YY.parse(O));else G=[YY.parse(X)]}catch{return this.createJsonErrorResponse(400,-32700,"Parse error: Invalid JSON-RPC message")}let H=G.some(JY);if(H){if(this._initialized&&this.sessionId!==void 0)return this.createJsonErrorResponse(400,-32600,"Invalid Request: Server already initialized");if(G.length>1)return this.createJsonErrorResponse(400,-32600,"Invalid Request: Only one initialization request is allowed");if(this.sessionId=this.sessionIdGenerator?.(),this._initialized=!0,this.sessionId&&this._onsessioninitialized)await Promise.resolve(this._onsessioninitialized(this.sessionId))}if(!H){let O=this.validateSession(Q);if(O)return O;let w=this.validateProtocolVersion(Q);if(w)return w}if(!G.some(X6)){for(let O of G)this.onmessage?.(O,{authInfo:W?.authInfo,requestInfo:J});return new Response(null,{status:202})}let K=crypto.randomUUID(),F=G.find((O)=>JY(O)),L=F?F.params.protocolVersion:Q.headers.get("mcp-protocol-version")??CX;if(this._enableJsonResponse)return new Promise((O)=>{this._streamMapping.set(K,{resolveJson:O,cleanup:()=>{this._streamMapping.delete(K)}});for(let w of G)if(X6(w))this._requestToStreamMapping.set(w.id,K);for(let w of G)this.onmessage?.(w,{authInfo:W?.authInfo,requestInfo:J})});let U=new TextEncoder,q,A=new ReadableStream({start:(O)=>{q=O},cancel:()=>{this._streamMapping.delete(K)}}),D={"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"};if(this.sessionId!==void 0)D["mcp-session-id"]=this.sessionId;for(let O of G)if(X6(O))this._streamMapping.set(K,{controller:q,encoder:U,cleanup:()=>{this._streamMapping.delete(K);try{q.close()}catch{}}}),this._requestToStreamMapping.set(O.id,K);await this.writePrimingEvent(q,U,K,L);for(let O of G){let w,j;if(X6(O)&&this._eventStore&&L>="2025-11-25")w=()=>{this.closeSSEStream(O.id)},j=()=>{this.closeStandaloneSSEStream()};this.onmessage?.(O,{authInfo:W?.authInfo,requestInfo:J,closeSSEStream:w,closeStandaloneSSEStream:j})}return new Response(A,{status:200,headers:D})}catch($){return this.onerror?.($),this.createJsonErrorResponse(400,-32700,"Parse error",{data:String($)})}}async handleDeleteRequest(Q){let W=this.validateSession(Q);if(W)return W;let $=this.validateProtocolVersion(Q);if($)return $;return await Promise.resolve(this._onsessionclosed?.(this.sessionId)),await this.close(),new Response(null,{status:200})}validateSession(Q){if(this.sessionIdGenerator===void 0)return;if(!this._initialized)return this.createJsonErrorResponse(400,-32000,"Bad Request: Server not initialized");let W=Q.headers.get("mcp-session-id");if(!W)return this.createJsonErrorResponse(400,-32000,"Bad Request: Mcp-Session-Id header is required");if(W!==this.sessionId)return this.createJsonErrorResponse(404,-32001,"Session not found");return}validateProtocolVersion(Q){let W=Q.headers.get("mcp-protocol-version");if(W!==null&&!J9.includes(W))return this.createJsonErrorResponse(400,-32000,`Bad Request: Unsupported protocol version: ${W} (supported versions: ${J9.join(", ")})`);return}async close(){this._streamMapping.forEach(({cleanup:Q})=>{Q()}),this._streamMapping.clear(),this._requestResponseMap.clear(),this.onclose?.()}closeSSEStream(Q){let W=this._requestToStreamMapping.get(Q);if(!W)return;let $=this._streamMapping.get(W);if($)$.cleanup()}closeStandaloneSSEStream(){let Q=this._streamMapping.get(this._standaloneSseStreamId);if(Q)Q.cleanup()}async send(Q,W){let $=W?.relatedRequestId;if(f1(Q)||U4(Q))$=Q.id;if($===void 0){if(f1(Q)||U4(Q))throw Error("Cannot send a response on a standalone SSE stream unless resuming a previous client request");let X;if(this._eventStore)X=await this._eventStore.storeEvent(this._standaloneSseStreamId,Q);let G=this._streamMapping.get(this._standaloneSseStreamId);if(G===void 0)return;if(G.controller&&G.encoder)this.writeSSEEvent(G.controller,G.encoder,Q,X);return}let Y=this._requestToStreamMapping.get($);if(!Y)throw Error(`No connection established for request ID: ${String($)}`);let J=this._streamMapping.get(Y);if(!this._enableJsonResponse&&J?.controller&&J?.encoder){let X;if(this._eventStore)X=await this._eventStore.storeEvent(Y,Q);this.writeSSEEvent(J.controller,J.encoder,Q,X)}if(f1(Q)||U4(Q)){this._requestResponseMap.set($,Q);let X=Array.from(this._requestToStreamMapping.entries()).filter(([H,B])=>B===Y).map(([H])=>H);if(X.every((H)=>this._requestResponseMap.has(H))){if(!J)throw Error(`No connection established for request ID: ${String($)}`);if(this._enableJsonResponse&&J.resolveJson){let H={"Content-Type":"application/json"};if(this.sessionId!==void 0)H["mcp-session-id"]=this.sessionId;let B=X.map((K)=>this._requestResponseMap.get(K));if(B.length===1)J.resolveJson(new Response(JSON.stringify(B[0]),{status:200,headers:H}));else J.resolveJson(new Response(JSON.stringify(B),{status:200,headers:H}))}else J.cleanup();for(let H of X)this._requestResponseMap.delete(H),this._requestToStreamMapping.delete(H)}}}}function wK(Q){return{200:"OK",201:"Created",204:"No Content",400:"Bad Request",404:"Not Found",405:"Method Not Allowed",500:"Internal Server Error"}[Q]||"Unknown"}function C7({createServer:Q},{port:W,endpoint:$}){let Y=new Map,J=Q((X)=>{let G=Buffer.alloc(0);X.on("data",(F)=>{G=Buffer.concat([G,F]),H().catch((L)=>{if(console.error("[MCP] Unhandled error in processHttpRequests:",L),!X.destroyed)try{K(X,500,{"content-type":"application/json"},JSON.stringify({error:"Internal server error"}),void 0)}catch(U){console.error("[MCP] Failed to send error response:",U),X.destroy()}})}),X.on("error",(F)=>{if(F.message!=="read ECONNRESET")console.error("[MCP] Socket error:",F.message);X.destroy()}),X.on("close",()=>{G=Buffer.alloc(0)});async function H(){while(!0){let F=G.indexOf(`\r
\r
`);if(F===-1)return;let U=G.subarray(0,F).toString().split(`\r
`),[q,A]=U[0].split(" "),D={};for(let j0=1;j0<U.length;j0++){let R0=U[j0].indexOf(":");if(R0>0){let l0=U[j0].substring(0,R0).trim().toLowerCase(),n1=U[j0].substring(R0+1).trim();D[l0]=n1}}let O=F+4,w=parseInt(D["content-length"]||"0",10),j=O+w;if(G.length<j)return;let z=G.subarray(O,j).toString();G=G.subarray(j);let C=`http://localhost:${W}${A}`,b=new Headers;for(let[j0,R0]of Object.entries(D))b.set(j0,R0);let D0={method:q,headers:b};if(q!=="GET"&&q!=="HEAD"&&z)D0.body=z;let S0=new Request(C,D0);if(A.split("?")[0]!==$&&!A.startsWith($+"/")&&!A.startsWith($+"?")){K(X,404,{"content-type":"text/plain"},"Not Found",D.connection);continue}try{let j0=D["mcp-session-id"],R0=j0?Y.get(j0):null;if(!R0){let s0=u9();hB(s0),uB(s0),mB(s0);let i6=new b7({sessionIdGenerator:()=>crypto.randomUUID(),enableJsonResponse:!0,onsessioninitialized:(Y1)=>{console.log(`[MCP] Session initialized: ${Y1.slice(0,8)}...`),P1.add(Y1);let g4=Y.get("__pending__");if(g4){Y.delete("__pending__"),Y.set(Y1,g4);let o9=g4.server.server;o9.oninitialized=()=>{let hQ=o9.getClientVersion();if(hQ)P1.updateClientInfo(Y1,hQ.name,hQ.version)}}},onsessionclosed:(Y1)=>{console.log(`[MCP] Session closed: ${Y1.slice(0,8)}...`),P1.remove(Y1),Y.delete(Y1)}});if(await s0.connect(i6),R0={transport:i6,server:s0},!j0)Y.set("__pending__",R0)}if(j0)P1.updateActivity(j0);let l0=await R0.transport.handleRequest(S0);console.log(`[MCP] Response: ${l0.status} ${l0.headers.get("content-type")}`);let n1={};if(l0.headers.forEach((s0,i6)=>{n1[i6]=s0}),(l0.headers.get("content-type")||"").includes("text/event-stream"))if(B(X,l0.status,n1),l0.body){let s0=l0.body.getReader(),i6=new TextDecoder;try{while(!0){let{done:Y1,value:g4}=await s0.read();if(Y1)break;let o9=i6.decode(g4,{stream:!0});X.write(o9)}}catch(Y1){console.error("[MCP] SSE stream error:",Y1)}finally{X.end()}}else X.end();else{let s0=await l0.text();K(X,l0.status,n1,s0,D.connection)}}catch(j0){console.error("[MCP] Request handler error:",j0),K(X,500,{"content-type":"application/json"},JSON.stringify({error:String(j0)}),D.connection)}}}function B(F,L,U){let q=`HTTP/1.1 ${L} ${wK(L)}\r
`;delete U["content-length"],U["cache-control"]="no-cache",U.connection="keep-alive";for(let[A,D]of Object.entries(U))q+=`${A}: ${D}\r
`;q+=`\r
`,F.write(q)}function K(F,L,U,q,A){let D=`HTTP/1.1 ${L} ${wK(L)}\r
`;if(!U["content-length"])U["content-length"]=Buffer.byteLength(q).toString();for(let[O,w]of Object.entries(U))D+=`${O}: ${w}\r
`;if(D+=`\r
`,D+=q,F.write(D),A?.toLowerCase()!=="keep-alive")F.end()}});return J.listen(W,()=>{console.log(`[MCP] Server listening on http://localhost:${W}${$}`)}),J.on("error",(X)=>{console.error("[MCP] Server error:",X),Blockbench.showQuickMessage(`MCP Server error: ${X.message}`,3000)}),[J,Y]}var yQ=null,Z7=null;BBPlugin.register("mcp",{version:n6,title:"MCP Server",author:"Jason J. Gardner",description:"Create an MCP server inside Blockbench.",tags:["MCP","AI"],icon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMzMuODkgMzcyLjg0Ij48cGF0aCBkPSJNMjU5LjU0LDc0LjI0YzYwLjcxLTcuNDEsOTcuNTYsNjIuMDYsNTYuNCwxMDguOWwtMTM0LjQzLDEzMy44MWMtMS4wOSwyLjExLTEuNjUsNC44NC0uMDIsNi44NWwyOS4zLDI5LjdjNC43OCwxMi41LTYuMDUsMjMuMDktMTguMTMsMTcuMTMtMy43Ny0xLjg2LTI3LjM1LTI1LjU5LTMwLjkyLTMwLjA0LTEwLjM1LTEyLjkzLTkuNjEtMjguMDQuMTUtNDEuMDFsMTM3LjQ2LTEzNi45OWMyOC42My0zOC45OS0yMi4yOS04NS4wOC01OC4zNC01Mi4zOGwtMTExLjk3LDExMi4wM2MtMTIuMzIsOC4wMS0yNS43Mi03Ljg0LTE3LjAzLTE5LjAzbDExNC40OC0xMTQuNzRjMjYuOTItMzguNjEtMjEuMDUtODIuNzItNTcuNjEtNTEuODlMMjEuOTIsMTg0LjA3Yy0xNC42MywxMC4xLTI5LjQzLTguMzQtMTYuNC0yMC4zNUwxNTcuNjMsMTIuODJjMzQuMTMtMjUuNDcsODQuNjEtOS41NCw5OC42OSwzMC4xNC41NSwxLjU1LDMuMjMsMTAuMDMsMy4yMywxMC43N3YyMC41WiIgc3R5bGU9ImZpbGw6Izc4Nzg3ODsgc3Ryb2tlOiNmZmY7IHN0cm9rZS1taXRlcmxpbWl0OjEwOyIvPjxwYXRoIGQ9Ik0yMDEuOTYsNzYuNjVjLTMwLjk1LDMzLjY3LTY1Ljk5LDYzLjg3LTk3LjQ3LDk3LjAzLTcuMjgsNy42Ny0xNC44LDE0Ljg2LTE3LjQ4LDI1LjUyLTkuODQsMzkuMTcsMzcuNzcsNjQuNjUsNjYuMDYsMzYuMDZsMTA5LjEtMTA4LjljMTEuODktNS41MywyNC4xNyw2LjQ0LDE3LjIyLDE4LjIybC0xMTcuMzMsMTE2LjY3Yy02NC4xOSw0My40My0xMzYuNy0zNy40MS04NC41Ny05Ni41NCwzMy4yMi0zNy42OCw3NC45OC03MS42NSwxMDkuMTMtMTA4Ljg5LDExLTEwLjAxLDI2LjY3LDEuOTYsMjAuMywxNS4zMS0xLjEsMi4zMS0zLjQxLDMuODEtNC45OCw1LjUyWiIgc3R5bGU9ImZpbGw6Izc4Nzg3ODsgc3Ryb2tlOiNmZmY7IHN0cm9rZS1taXRlcmxpbWl0OjEwOyIvPjwvc3ZnPg==",variant:"desktop",async onload(){let Q=requireNativeModule("net",{message:"Network access is required for the MCP server to accept connections.",detail:"The MCP plugin needs to create a local server that AI assistants can connect to.",optional:!1});if(!Q){console.error("[MCP] Failed to get net module - server will not start"),Blockbench.showQuickMessage("MCP Server requires network permission",3000);return}I7(),[yQ,Z7]=C7(Q,{port:Number(Settings.get("mcp_port")||3000),endpoint:String(Settings.get("mcp_endpoint")||"/bb-mcp")});let W=u9();AK({server:W,tools:h6,resources:k4,prompts:f6})},onunload(){if(yQ)yQ.close(),yQ=null;let Q=Array.from(Z7?.values()??[]);for(let W of Q)W.transport.close();Z7?.clear(),P1.clear(),DK(),S7()},oninstall(){Blockbench.showQuickMessage("Installed MCP Server plugin",2000),I7()},onuninstall(){Blockbench.showQuickMessage("Uninstalled MCP Server plugin",2000),S7()}});
